{"version":3,"file":"BandGame-m_knVGP-.js","sources":["../../src/components/band/BandConfigModal.tsx","../../src/components/band/BandInstrumentSelector.tsx","../../src/components/musicians/MusicianDetailModal.tsx","../../src/components/band/BandManagementScreen.tsx","../../src/components/musicians/MusiciansContractScreen.tsx","../../src/components/stage/StageTopValuesBar.tsx","../../src/components/stage/StageBottomNav.tsx","../../src/components/stage/StageProgressList.tsx","../../src/components/stage/StageCenterPanel.tsx","../../src/components/stage/StageCurrentSongBar.tsx","../../src/components/stage/StageVisualEffectsLayer.tsx","../../src/components/stage/Stage3DScene.tsx","../../src/rsc/images/icons/Icone_fechar.png","../../src/components/stage/StageMapModal.tsx","../../src/hooks/useBandScreensState.ts","../../src/assets/bandGameAssets.ts","../../src/constants/bandGame.ts","../../src/rsc/images/maps/Local_Badge_Arena_Central.png?url","../../src/rsc/images/maps/Local_Badge_Bar.png?url","../../src/rsc/images/maps/Local_Badge_Clube.png?url","../../src/rsc/images/maps/Local_Badge_Equipamentos.png?url","../../src/rsc/images/maps/Local_Badge_Estadio_Internacional.png?url","../../src/rsc/images/maps/Local_Badge_Festa_Aniversario.png?url","../../src/rsc/images/maps/Local_Badge_Festival_Escolar.png?url","../../src/rsc/images/maps/Local_Badge_Festival_da_Cidade.png?url","../../src/rsc/images/maps/Local_Badge_Garagem.png?url","../../src/rsc/images/maps/Local_Badge_Isntrumentos.png?url","../../src/rsc/images/maps/Local_Badge_Musicas.png?url","../../src/rsc/images/maps/Local_Badge_Musicos.png?url","../../src/rsc/images/maps/Local_Badge_Teatro.png?url","../../src/rsc/images/maps/Mapa_Mundo.jpeg?url","../../src/rsc/images/maps/Preview_cidade.png?url","../../src/rsc/images/maps/sdsd.png?url","../../src/rsc/videos/palcos/bar_video.mp4?url","../../src/rsc/videos/palcos/festa_aniversario_video.mp4?url","../../src/rsc/videos/palcos/garagem_video.mp4?url","../../src/rsc/videos/palcos/palco_aniversario_video.mp4?url","../../src/rsc/videos/palcos/palco_bar_video.mp4?url","../../src/rsc/videos/palcos/palco_feira_cidade_video.mp4?url","../../src/rsc/videos/palcos/palco_garagem_video.mp4?url","../../src/rsc/musics/Music_background_mapa.mp3?url","../../src/rsc/musics/blues_na_garagem/Musica_Blues_na_Garagem.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_Bass.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_Drums.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_ElectricGuitar.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_Keys.mp3?url","../../src/rsc/musics/garage_music_01.mp3?url","../../src/rsc/images/facesets/9a0bc07b-6a85-418b-95cb-5896ed343429.png?url","../../src/rsc/images/facesets/9c402695-ebce-40ef-bff5-0f5826a90633.png?url","../../src/rsc/images/facesets/Faceset_1.png?url","../../src/rsc/images/facesets/Faceset_10.png?url","../../src/rsc/images/facesets/Faceset_11.png?url","../../src/rsc/images/facesets/Faceset_12.png?url","../../src/rsc/images/facesets/Faceset_13.png?url","../../src/rsc/images/facesets/Faceset_14.png?url","../../src/rsc/images/facesets/Faceset_15.png?url","../../src/rsc/images/facesets/Faceset_16.png?url","../../src/rsc/images/facesets/Faceset_17.png?url","../../src/rsc/images/facesets/Faceset_18.png?url","../../src/rsc/images/facesets/Faceset_19.png?url","../../src/rsc/images/facesets/Faceset_2.png?url","../../src/rsc/images/facesets/Faceset_20.png?url","../../src/rsc/images/facesets/Faceset_21.png?url","../../src/rsc/images/facesets/Faceset_22.png?url","../../src/rsc/images/facesets/Faceset_23.png?url","../../src/rsc/images/facesets/Faceset_24.png?url","../../src/rsc/images/facesets/Faceset_3.png?url","../../src/rsc/images/facesets/Faceset_4.png?url","../../src/rsc/images/facesets/Faceset_5.png?url","../../src/rsc/images/facesets/Faceset_6.png?url","../../src/rsc/images/facesets/Faceset_7.png?url","../../src/rsc/images/facesets/Faceset_8.png?url","../../src/rsc/images/facesets/Faceset_9.png?url","../../src/rsc/images/facesets/Sofia_FullBody.png?url","../../src/rsc/images/facesets/Sofia_ZoomFace.png?url","../../src/rsc/images/facesets/df2dfa63-de5c-4d23-8542-da26085daf37.png?url","../../src/rsc/images/facesets/velho_contratante_musicos.png?url","../../src/rsc/images/portraits/Portrait_1.png?url","../../src/rsc/images/portraits/Portrait_10.png?url","../../src/rsc/images/portraits/Portrait_11.png?url","../../src/rsc/images/portraits/Portrait_12.png?url","../../src/rsc/images/portraits/Portrait_13.png?url","../../src/rsc/images/portraits/Portrait_14.png?url","../../src/rsc/images/portraits/Portrait_15.png?url","../../src/rsc/images/portraits/Portrait_16.png?url","../../src/rsc/images/portraits/Portrait_17.png?url","../../src/rsc/images/portraits/Portrait_18.png?url","../../src/rsc/images/portraits/Portrait_19.png?url","../../src/rsc/images/portraits/Portrait_2.png?url","../../src/rsc/images/portraits/Portrait_20.png?url","../../src/rsc/images/portraits/Portrait_21.png?url","../../src/rsc/images/portraits/Portrait_22.png?url","../../src/rsc/images/portraits/Portrait_23.png?url","../../src/rsc/images/portraits/Portrait_24.png?url","../../src/rsc/images/portraits/Portrait_3.png?url","../../src/rsc/images/portraits/Portrait_4.png?url","../../src/rsc/images/portraits/Portrait_5.png?url","../../src/rsc/images/portraits/Portrait_6.png?url","../../src/rsc/images/portraits/Portrait_7.png?url","../../src/rsc/images/portraits/Portrait_8.png?url","../../src/rsc/images/portraits/Portrait_9.png?url","../../src/utils/assetResolvers.ts","../../src/hooks/useBandGameComputed.ts","../../src/components/BandGame.tsx"],"sourcesContent":["import React from 'react';\r\nimport './BandConfigModal.css';\r\nimport type { Instrument } from '../../state/gameStore';\r\n\r\ntype InstrumentVolumeControl = {\r\n  instrument: Instrument;\r\n  label: string;\r\n  icon: string;\r\n  value: number;\r\n};\r\n\r\ntype BandConfigModalProps = {\r\n  isVisible: boolean;\r\n  isClosing: boolean;\r\n  bandName: string;\r\n  bandLogoUrl: string;\r\n  isSfxEnabled: boolean;\r\n  isMusicEnabled: boolean;\r\n  isCameraMotionEnabled: boolean;\r\n  iconConfig: string;\r\n  iconFechar: string;\r\n  iconAudioOn: string;\r\n  iconCamera: string;\r\n  iconExitBand: string;\r\n  instrumentVolumeControls: InstrumentVolumeControl[];\r\n  onClose: () => void;\r\n  onToggleSfx: (enabled: boolean) => void;\r\n  onToggleMusic: (enabled: boolean) => void;\r\n  onToggleCameraMotion: (enabled: boolean) => void;\r\n  onChangeInstrumentVolume: (instrument: Instrument, value: number) => void;\r\n  onExitBand: () => void;\r\n};\r\n\r\nconst BandConfigModal: React.FC<BandConfigModalProps> = ({\r\n  isVisible,\r\n  isClosing,\r\n  bandName,\r\n  bandLogoUrl,\r\n  isSfxEnabled,\r\n  isMusicEnabled,\r\n  isCameraMotionEnabled,\r\n  iconConfig,\r\n  iconFechar,\r\n  iconAudioOn,\r\n  iconCamera,\r\n  iconExitBand,\r\n  instrumentVolumeControls,\r\n  onClose,\r\n  onToggleSfx,\r\n  onToggleMusic,\r\n  onToggleCameraMotion,\r\n  onChangeInstrumentVolume,\r\n  onExitBand,\r\n}) => {\r\n  if (!isVisible) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className={`band-config-overlay${isClosing ? ' closing' : ' show'}`} aria-hidden=\"true\" />\r\n      <article className={`band-config-card${isClosing ? ' closing' : ' show'}`}>\r\n        <header className=\"band-config-header\">\r\n          <h3>\r\n            <img src={iconConfig} alt=\"\" aria-hidden=\"true\" className=\"band-config-title-icon\" />\r\n            <span>Configurações</span>\r\n          </h3>\r\n          <button\r\n            type=\"button\"\r\n            className=\"band-config-close\"\r\n            onClick={onClose}\r\n            data-click-sfx=\"close\"\r\n            aria-label=\"Fechar configurações\"\r\n          >\r\n            <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"band-config-close-icon\" />\r\n          </button>\r\n        </header>\r\n        <div className=\"band-config-body\">\r\n          <img src={bandLogoUrl} alt={`Logo ${bandName}`} className=\"band-config-logo\" />\r\n          <strong className=\"band-config-name\">{bandName}</strong>\r\n          <div className=\"band-config-audio-title\">\r\n            <img src={iconAudioOn} alt=\"\" aria-hidden=\"true\" />\r\n            <span>Áudio</span>\r\n          </div>\r\n          <label className=\"band-config-option\">\r\n            <input type=\"checkbox\" checked={isSfxEnabled} onChange={(event) => onToggleSfx(event.target.checked)} />\r\n            <span>Efeitos Sonoros</span>\r\n          </label>\r\n          <label className=\"band-config-option\">\r\n            <input type=\"checkbox\" checked={isMusicEnabled} onChange={(event) => onToggleMusic(event.target.checked)} />\r\n            <span>Música</span>\r\n          </label>\r\n          <div className=\"band-config-instrument-volumes\">\r\n            {instrumentVolumeControls.map((control) => {\r\n              const sliderValue = Math.round(Math.max(0, Math.min(1, control.value)) * 100);\r\n              return (\r\n                <label className=\"band-config-volume-column\" key={control.instrument}>\r\n                  <img src={control.icon} alt=\"\" aria-hidden=\"true\" className=\"band-config-volume-icon\" />\r\n                  <span className=\"band-config-volume-label\">{control.label}</span>\r\n                  <input\r\n                    className=\"band-config-volume-slider-vertical\"\r\n                    type=\"range\"\r\n                    min={0}\r\n                    max={100}\r\n                    step={1}\r\n                    value={sliderValue}\r\n                    onInput={(event) => onChangeInstrumentVolume(control.instrument, Number((event.target as HTMLInputElement).value) / 100)}\r\n                    onChange={(event) => onChangeInstrumentVolume(control.instrument, Number(event.target.value) / 100)}\r\n                    disabled={!isMusicEnabled}\r\n                  />\r\n                  <strong className=\"band-config-volume-value\">{sliderValue}%</strong>\r\n                </label>\r\n              );\r\n            })}\r\n          </div>\r\n          <div className=\"band-config-audio-title\">\r\n            <img src={iconCamera} alt=\"\" aria-hidden=\"true\" />\r\n            <span>Câmera</span>\r\n          </div>\r\n          <label className=\"band-config-option\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={isCameraMotionEnabled}\r\n              onChange={(event) => onToggleCameraMotion(event.target.checked)}\r\n            />\r\n            <span>Movimento de câmera</span>\r\n          </label>\r\n          <button\r\n            type=\"button\"\r\n            className=\"band-config-exit\"\r\n            onClick={onExitBand}\r\n            data-click-sfx=\"close\"\r\n          >\r\n            <img src={iconExitBand} alt=\"\" aria-hidden=\"true\" className=\"band-config-exit-icon\" />\r\n            <span>Sair da banda</span>\r\n          </button>\r\n        </div>\r\n      </article>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BandConfigModal;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport type { Instrument } from '../../state/gameStore';\r\nimport './BandInstrumentSelector.css';\r\n\r\ntype BandInstrumentColumn = {\r\n  id: Instrument;\r\n  label: string;\r\n  icon: string;\r\n  emptyInstrumentIcon: string;\r\n  musicianId: number | null;\r\n  musicianFirstName: string;\r\n  musicianFace: string | null;\r\n  hasMusician: boolean;\r\n  rarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n};\r\n\r\ntype SelectorMusician = {\r\n  id: number;\r\n  name: string;\r\n  firstName: string;\r\n  face: string | null;\r\n  portrait: string | null;\r\n  rarityClass: 'bronze' | 'silver' | 'gold';\r\n  rarityLabel: string;\r\n  hype: number;\r\n  fans: number;\r\n  performance: number;\r\n  cache: number;\r\n};\r\n\r\ntype BandInstrumentSelectorProps = {\r\n  bandInstrumentColumns: BandInstrumentColumn[];\r\n  activeInstrument: Instrument | null;\r\n  isDetailOpen: boolean;\r\n  selectorMusicians: SelectorMusician[];\r\n  selectedMusicianId: number | null;\r\n  instrumentLabels: Record<Instrument, string>;\r\n  iconFechar: string;\r\n  iconMusicoVazio: string;\r\n  onOpenInstrument: (instrument: Instrument) => void;\r\n  onCloseSelector: () => void;\r\n  onSelectEmpty: (instrument: Instrument) => void;\r\n  onOpenMusicianDetail: (musician: SelectorMusician) => void;\r\n};\r\n\r\nconst BandInstrumentSelector: React.FC<BandInstrumentSelectorProps> = ({\r\n  bandInstrumentColumns,\r\n  activeInstrument,\r\n  isDetailOpen,\r\n  selectorMusicians,\r\n  selectedMusicianId,\r\n  instrumentLabels,\r\n  iconFechar,\r\n  iconMusicoVazio,\r\n  onOpenInstrument,\r\n  onCloseSelector,\r\n  onSelectEmpty,\r\n  onOpenMusicianDetail,\r\n}) => {\r\n  const SELECTOR_CLOSE_MS = 190;\r\n  const [isSelectorClosing, setIsSelectorClosing] = useState(false);\r\n  const selectorCloseTimeoutRef = useRef<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!activeInstrument) {\r\n      setIsSelectorClosing(false);\r\n    }\r\n  }, [activeInstrument]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (selectorCloseTimeoutRef.current) {\r\n        window.clearTimeout(selectorCloseTimeoutRef.current);\r\n        selectorCloseTimeoutRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const runSelectorCloseAnimation = (onClosed: () => void) => {\r\n    if (selectorCloseTimeoutRef.current) {\r\n      window.clearTimeout(selectorCloseTimeoutRef.current);\r\n      selectorCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setIsSelectorClosing(true);\r\n    selectorCloseTimeoutRef.current = window.setTimeout(() => {\r\n      onClosed();\r\n      setIsSelectorClosing(false);\r\n      selectorCloseTimeoutRef.current = null;\r\n    }, SELECTOR_CLOSE_MS);\r\n  };\r\n\r\n  const instrumentRoleByKey: Record<Instrument, string> = {\r\n    guitar: 'guitarrista',\r\n    bass: 'baixista',\r\n    drums: 'baterista',\r\n    keys: 'tecladista',\r\n  };\r\n\r\n  const activeColumn = activeInstrument\r\n    ? bandInstrumentColumns.find((column) => column.id === activeInstrument)\r\n    : null;\r\n  const activeInstrumentIcon = activeColumn?.icon ?? iconMusicoVazio;\r\n  const activeInstrumentRole = activeInstrument ? instrumentRoleByKey[activeInstrument] : 'músico';\r\n\r\n  const handleOpenInstrument = (instrument: Instrument, musicianId: number | null) => {\r\n    onOpenInstrument(instrument);\r\n    if (musicianId !== null && musicianId !== undefined) {\r\n      const detailMusician = selectorMusicians.find((item) => item.id === musicianId);\r\n      if (detailMusician) {\r\n        onOpenMusicianDetail(detailMusician);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n    <div className={`band-slot-columns${activeInstrument ? ' selector-open' : ''}${isDetailOpen ? ' detail-open' : ''}`}>\r\n      {bandInstrumentColumns.map((column) => (\r\n        <div\r\n          key={column.id}\r\n          className={`band-slot-column${activeInstrument === column.id ? ' active' : ''}${activeInstrument && activeInstrument !== column.id ? ' dimmed' : ''}`}\r\n        >\r\n          <div className=\"band-slot-header\">\r\n            <img src={column.icon} alt={column.label} />\r\n            <span>{column.label}</span>\r\n          </div>\r\n\r\n          <button\r\n            type=\"button\"\r\n            className={`band-slot-musician-card${column.rarityClass ? ` rarity-${column.rarityClass}` : ''}`}\r\n            onClick={() => handleOpenInstrument(column.id, column.musicianId)}\r\n          >\r\n            <div\r\n              key={`${column.id}-${column.musicianId ?? 'empty'}`}\r\n              className=\"band-slot-musician-swap\"\r\n            >\r\n              {column.hasMusician ? (\r\n                <div className=\"band-slot-musician-info\">\r\n                  {column.musicianFace ? (\r\n                    <img src={column.musicianFace} alt=\"\" className=\"band-slot-musician-face\" />\r\n                  ) : null}\r\n                  <span className=\"band-slot-musician-name\">{column.musicianFirstName}</span>\r\n                </div>\r\n              ) : (\r\n                <img src={iconMusicoVazio} alt=\"Músico vazio\" className=\"band-slot-empty-icon\" />\r\n              )}\r\n            </div>\r\n          </button>\r\n\r\n          <button type=\"button\" className=\"band-slot-instrument-card\">\r\n            <img src={column.emptyInstrumentIcon} alt={`Instrumento ${column.label}`} className=\"band-slot-empty-icon\" />\r\n          </button>\r\n        </div>\r\n      ))}\r\n    </div>\r\n\r\n      {activeInstrument ? (\r\n        <div className=\"band-selector-overlay\">\r\n          <div className={`band-selector-panel${isSelectorClosing ? ' closing' : ''}${isDetailOpen ? ' detail-open' : ''}`}>\r\n            <div className=\"band-selector-head\">\r\n              <strong className=\"band-selector-title\">\r\n                <img src={activeInstrumentIcon} alt=\"\" aria-hidden=\"true\" className=\"band-selector-title-icon\" />\r\n                <span>Selecionar {activeInstrumentRole}</span>\r\n              </strong>\r\n              <span className=\"band-selector-instrument-label\">{instrumentLabels[activeInstrument]}</span>\r\n              <button\r\n                type=\"button\"\r\n                className=\"band-selector-close\"\r\n                onClick={() => runSelectorCloseAnimation(onCloseSelector)}\r\n                data-click-sfx=\"close\"\r\n                aria-label=\"Fechar seletor de músicos\"\r\n              >\r\n                <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"band-selector-gallery\">\r\n              <button\r\n                type=\"button\"\r\n                className={`band-selector-item empty${selectedMusicianId === null ? ' selected' : ''}`}\r\n                data-click-sfx=\"cancel\"\r\n                onClick={() => runSelectorCloseAnimation(() => onSelectEmpty(activeInstrument))}\r\n              >\r\n                <div className=\"band-selector-face-empty\">\r\n                  <img src={iconMusicoVazio} alt=\"\" aria-hidden=\"true\" />\r\n                </div>\r\n                <span className=\"band-selector-name\">Vazio</span>\r\n              </button>\r\n              {selectorMusicians.map((musician) => (\r\n                <button\r\n                  key={musician.id}\r\n                  type=\"button\"\r\n                  className={`band-selector-item rarity-${musician.rarityClass}${selectedMusicianId === musician.id ? ' selected' : ''}`}\r\n                  onClick={() => onOpenMusicianDetail(musician)}\r\n                >\r\n                  {musician.face ? (\r\n                    <img src={musician.face} alt=\"\" className=\"band-selector-face\" />\r\n                  ) : (\r\n                    <div className=\"band-selector-face-empty\">\r\n                      <img src={iconMusicoVazio} alt=\"\" aria-hidden=\"true\" />\r\n                    </div>\r\n                  )}\r\n                  <span className=\"band-selector-name\">{musician.firstName}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BandInstrumentSelector;\r\n","import React from 'react';\r\n\r\ntype MusicianData = {\r\n  ID: number;\r\n  Instrumentista: string;\r\n  Instrumento: number;\r\n  Asset_Face: string;\r\n  Asset_Portrait?: string;\r\n  Asset: string;\r\n  Asset_Char?: string;\r\n  Hype: number;\r\n  Fans: number;\r\n  Apresentacao: number;\r\n  Sexo: string;\r\n  Custo: number;\r\n  Cache: number;\r\n  Nivel: number;\r\n  ID_Instrumento: number;\r\n  Contratado: boolean;\r\n  Historia: string;\r\n};\r\n\r\ntype MusicianDetailModalProps = {\r\n  musician: MusicianData | null;\r\n  selectedMusicianFace: string | null;\r\n  selectedMusicianPortrait?: string | null;\r\n  selectedMusicianInitials: string;\r\n  selectedMusicianRarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n  selectedInstrumentIcon: string;\r\n  isClosing: boolean;\r\n  isStoryOpen: boolean;\r\n  isSelectedMusicianHired: boolean;\r\n  isSelectedMusicianLockedByCoins: boolean;\r\n  canHireSelectedMusician: boolean;\r\n  selectedMusicianPrice: number;\r\n  iconFechar: string;\r\n  iconBloqueado: string;\r\n  iconDisponivel: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  instrumentNameById: Record<number, string>;\r\n  showStoryToggle?: boolean;\r\n  hideCloseButton?: boolean;\r\n  customAction?: {\r\n    label: string;\r\n    onClick: () => void;\r\n    variant?: 'select' | 'remove';\r\n    disabled?: boolean;\r\n  };\r\n  onCloseDetails: () => void;\r\n  onToggleStory: () => void;\r\n  onHireSelected: () => void;\r\n  displayMode?: 'card' | 'hero-stage';\r\n};\r\n\r\nconst MusicianDetailModal: React.FC<MusicianDetailModalProps> = ({\r\n  musician,\r\n  selectedMusicianFace,\r\n  selectedMusicianPortrait,\r\n  selectedMusicianInitials,\r\n  selectedMusicianRarityClass,\r\n  selectedInstrumentIcon,\r\n  isClosing,\r\n  isStoryOpen,\r\n  isSelectedMusicianHired,\r\n  isSelectedMusicianLockedByCoins,\r\n  canHireSelectedMusician,\r\n  selectedMusicianPrice,\r\n  iconFechar,\r\n  iconBloqueado,\r\n  iconDisponivel,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  instrumentNameById,\r\n  showStoryToggle = true,\r\n  hideCloseButton = false,\r\n  customAction,\r\n  onCloseDetails,\r\n  onToggleStory,\r\n  onHireSelected,\r\n  displayMode = 'card',\r\n}) => {\r\n  const [displayMusician, setDisplayMusician] = React.useState<MusicianData | null>(musician);\r\n  const [isContentLeaving, setIsContentLeaving] = React.useState(false);\r\n  const [isContentEntering, setIsContentEntering] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (!musician) {\r\n      setDisplayMusician(null);\r\n      setIsContentLeaving(false);\r\n      setIsContentEntering(false);\r\n      return;\r\n    }\r\n\r\n    if (!displayMusician || displayMusician.ID === musician.ID) {\r\n      setDisplayMusician(musician);\r\n      return;\r\n    }\r\n\r\n    setIsContentLeaving(true);\r\n\r\n    const switchTimer = window.setTimeout(() => {\r\n      setDisplayMusician(musician);\r\n      setIsContentLeaving(false);\r\n      setIsContentEntering(true);\r\n    }, 130);\r\n\r\n    const settleTimer = window.setTimeout(() => {\r\n      setIsContentEntering(false);\r\n    }, 340);\r\n\r\n    return () => {\r\n      window.clearTimeout(switchTimer);\r\n      window.clearTimeout(settleTimer);\r\n    };\r\n  }, [musician, displayMusician]);\r\n\r\n  const currentMusician = displayMusician;\r\n\r\n  if (!currentMusician) {\r\n    return null;\r\n  }\r\n\r\n  const rarityLabel = selectedMusicianRarityClass === 'gold'\r\n    ? 'Ouro'\r\n    : selectedMusicianRarityClass === 'silver'\r\n      ? 'Prata'\r\n      : 'Bronze';\r\n\r\n  const displayPortrait = selectedMusicianPortrait ?? selectedMusicianFace;\r\n  const transitionClass = `musician-detail-transition${isContentLeaving ? ' leaving' : ''}${isContentEntering ? ' entering' : ''}`;\r\n\r\n  return (\r\n    <article\r\n      className={`musician-detail-card${selectedMusicianRarityClass ? ` rarity-${selectedMusicianRarityClass}` : ''}${isClosing ? ' closing' : ' show'}${isStoryOpen ? ' story-open' : ''}${displayMode === 'hero-stage' ? ' hero-stage' : ''}${customAction ? ' has-custom-action' : ''}`}\r\n    >\r\n      {!hideCloseButton ? (\r\n        <button\r\n          type=\"button\"\r\n          className=\"musician-detail-close\"\r\n          onClick={onCloseDetails}\r\n          data-click-sfx=\"close\"\r\n          aria-label=\"Fechar detalhes do músico\"\r\n        >\r\n          <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n        </button>\r\n      ) : null}\r\n\r\n      {showStoryToggle ? (\r\n        <button\r\n          type=\"button\"\r\n          className=\"musician-detail-info-btn\"\r\n          onClick={onToggleStory}\r\n          data-click-sfx=\"open\"\r\n          aria-label=\"Mostrar detalhes da história do músico\"\r\n        >\r\n          <span className=\"musician-info-icon\" aria-hidden=\"true\">i</span>\r\n        </button>\r\n      ) : null}\r\n      {isStoryOpen ? (\r\n        <div className=\"musician-detail-story\">\r\n          <p>{currentMusician.Historia}</p>\r\n        </div>\r\n      ) : displayMode === 'hero-stage' ? (\r\n        <>\r\n          <header className={`musician-hero-header ${transitionClass}`}>\r\n            <strong>{currentMusician.Instrumentista}</strong>\r\n          </header>\r\n\r\n          <div className={`musician-hero-scene ${transitionClass}`}>\r\n            <span className=\"musician-hero-stat stat-hype\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFameWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Hype</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Hype)}</strong>\r\n            </span>\r\n            <span className=\"musician-hero-stat stat-fans\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFansWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Público</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Fans)}</strong>\r\n            </span>\r\n            <span className=\"musician-hero-stat stat-performance\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconRhythmWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Perf.</span>\r\n              </span>\r\n              <strong>{formatPerformancePercent(currentMusician.Apresentacao)}</strong>\r\n            </span>\r\n            <span className=\"musician-hero-stat stat-cache\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconCost} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Cachê</span>\r\n              </span>\r\n              <strong>- R$ {formatNumber(currentMusician.Cache).replace(/,00$/, '')}</strong>\r\n            </span>\r\n\r\n            <div className=\"musician-hero-floor\" aria-hidden=\"true\" />\r\n            <div className=\"musician-hero-shadow\" aria-hidden=\"true\" />\r\n            <div className={`musician-hero-portrait${currentMusician.Instrumento === 3 ? ' is-drummer' : ''}`} aria-hidden=\"true\">\r\n              {displayPortrait ? (\r\n                <img src={displayPortrait} alt=\"\" className=\"musician-hero-portrait-image\" />\r\n              ) : (\r\n                <div className=\"musician-hero-portrait-fallback\">{selectedMusicianInitials}</div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"musician-hero-cta-stack\">\r\n              <span className=\"musician-hero-instrument-badge\">\r\n                <img\r\n                  src={selectedInstrumentIcon}\r\n                  alt=\"\"\r\n                  aria-hidden=\"true\"\r\n                  className=\"musician-instrument-mini\"\r\n                />\r\n                <span>{instrumentNameById[currentMusician.Instrumento] ?? 'Instrumento'}</span>\r\n              </span>\r\n              {customAction ? (\r\n                <button\r\n                  type=\"button\"\r\n                  className={`musician-hero-hire-btn${customAction.variant === 'remove' ? ' is-remove' : ' is-select'}`}\r\n                  disabled={customAction.disabled}\r\n                  data-click-sfx={customAction.variant === 'remove' ? 'cancel' : 'confirm'}\r\n                  onClick={customAction.onClick}\r\n                >\r\n                  <span>{customAction.label}</span>\r\n                </button>\r\n              ) : !isSelectedMusicianHired && canHireSelectedMusician ? (\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"musician-hero-hire-btn\"\r\n                  onClick={onHireSelected}\r\n                >\r\n                  <img src={iconMoneyWhite} alt=\"\" aria-hidden=\"true\" />\r\n                  <span>R$ {formatNumber(selectedMusicianPrice)}</span>\r\n                </button>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <div className={`musician-detail-body ${transitionClass}`}>\r\n            <div className=\"musician-detail-photo\" aria-hidden=\"true\">\r\n              {selectedMusicianFace ? (\r\n                <img src={selectedMusicianFace} alt=\"\" className=\"musician-detail-face\" />\r\n              ) : (\r\n                selectedMusicianInitials\r\n              )}\r\n            </div>\r\n            <div className=\"musician-detail-side\">\r\n              <header className=\"musician-detail-header\">\r\n                <strong>{currentMusician.Instrumentista}</strong>\r\n                <span>Músico disponível</span>\r\n              </header>\r\n              <div className=\"musician-detail-badges\">\r\n                <span className=\"musician-detail-instrument\">\r\n                  <img\r\n                    src={selectedInstrumentIcon}\r\n                    alt=\"\"\r\n                    aria-hidden=\"true\"\r\n                    className=\"musician-instrument-mini\"\r\n                  />\r\n                  <span>{instrumentNameById[currentMusician.Instrumento] ?? 'Instrumento'}</span>\r\n                </span>\r\n                <span className={`musician-rarity ${selectedMusicianRarityClass ?? 'bronze'}`}>\r\n                  {rarityLabel}\r\n                </span>\r\n                {isSelectedMusicianHired ? <span className=\"musician-status-badge\">Contratado</span> : null}\r\n                {!isSelectedMusicianHired ? (\r\n                  <span className={`musician-detail-availability${isSelectedMusicianLockedByCoins ? ' locked' : ' available'}`}>\r\n                    <img\r\n                      src={isSelectedMusicianLockedByCoins ? iconBloqueado : iconDisponivel}\r\n                      alt={isSelectedMusicianLockedByCoins ? 'Bloqueado' : 'Disponível'}\r\n                      className=\"musician-detail-availability-icon\"\r\n                    />\r\n                    <span>{isSelectedMusicianLockedByCoins ? 'Bloqueado' : 'Disponível'}</span>\r\n                  </span>\r\n                ) : null}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className={`musician-attr-grid ${transitionClass}`}>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFameWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Hype</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Hype)}</strong>\r\n            </span>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFansWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Público</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Fans)}</strong>\r\n            </span>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconRhythmWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Perf.</span>\r\n              </span>\r\n              <strong>{formatPerformancePercent(currentMusician.Apresentacao)}</strong>\r\n            </span>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconCost} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Cachê</span>\r\n              </span>\r\n              <strong>- R$ {formatNumber(currentMusician.Cache).replace(/,00$/, '')}</strong>\r\n            </span>\r\n          </div>\r\n        </>\r\n      )}\r\n      {customAction && displayMode !== 'hero-stage' ? (\r\n        <button\r\n          type=\"button\"\r\n          className={`musician-detail-hire-btn${customAction.variant === 'remove' ? ' is-remove' : ' is-select'}`}\r\n          disabled={customAction.disabled}\r\n          data-click-sfx={customAction.variant === 'remove' ? 'cancel' : 'confirm'}\r\n          onClick={customAction.onClick}\r\n        >\r\n          <span>{customAction.label}</span>\r\n        </button>\r\n      ) : !isSelectedMusicianHired && displayMode !== 'hero-stage' ? (\r\n        <button\r\n          type=\"button\"\r\n          className=\"musician-detail-hire-btn\"\r\n          disabled={!canHireSelectedMusician}\r\n          onClick={onHireSelected}\r\n        >\r\n          <img src={iconMoneyWhite} alt=\"\" aria-hidden=\"true\" />\r\n          <span>R$ {formatNumber(selectedMusicianPrice)}</span>\r\n        </button>\r\n      ) : null}\r\n    </article>\r\n  );\r\n};\r\n\r\nexport default MusicianDetailModal;\r\n","import React from 'react';\r\nimport type { Instrument } from '../../state/gameStore';\r\nimport BandInstrumentSelector from './BandInstrumentSelector';\r\nimport MusicianDetailModal from '../musicians/MusicianDetailModal';\r\nimport './BandManagementScreen.css';\r\n\r\ntype BandMenuView = 'band' | 'specials' | 'analysis';\r\n\r\ntype BandInstrumentColumn = {\r\n  id: Instrument;\r\n  label: string;\r\n  icon: string;\r\n  emptyInstrumentIcon: string;\r\n  musicianId: number | null;\r\n  musicianName: string;\r\n  musicianFirstName: string;\r\n  musicianFace: string | null;\r\n  hasMusician: boolean;\r\n  rarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n};\r\n\r\ntype SelectorMusician = {\r\n  id: number;\r\n  name: string;\r\n  firstName: string;\r\n  face: string | null;\r\n  portrait: string | null;\r\n  rarityClass: 'bronze' | 'silver' | 'gold';\r\n  rarityLabel: string;\r\n  hype: number;\r\n  fans: number;\r\n  performance: number;\r\n  cache: number;\r\n};\r\n\r\ntype BandManagementScreenProps = {\r\n  isVisible: boolean;\r\n  isClosing: boolean;\r\n  backgroundBackstage: string;\r\n  iconFechar: string;\r\n  iconBloqueado: string;\r\n  iconDisponivel: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  bandHypeValue: number;\r\n  bandFansValue: number;\r\n  bandPerformanceValue: number;\r\n  bandCostValue: number;\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  formatCurrency: (value: number) => string;\r\n  bandMenuView: BandMenuView;\r\n  bandMenuOptions: Array<{ id: BandMenuView; label: string; icon: string }>;\r\n  onChangeBandMenuView: (view: BandMenuView) => void;\r\n  activeBandSelectorInstrument: Instrument | null;\r\n  bandInstrumentColumns: BandInstrumentColumn[];\r\n  selectorMusicians: SelectorMusician[];\r\n  selectedSelectorMusicianId: number | null;\r\n  instrumentLabels: Record<Instrument, string>;\r\n  iconMusicoVazio: string;\r\n  onOpenInstrument: (instrument: Instrument) => void;\r\n  onCloseSelector: () => void;\r\n  onSelectEmpty: (instrument: Instrument) => void;\r\n  onSelectMusician: (instrument: Instrument, musicianId: number) => void;\r\n  onCloseScreen: () => void;\r\n};\r\n\r\nconst BandManagementScreen: React.FC<BandManagementScreenProps> = ({\r\n  isVisible,\r\n  isClosing,\r\n  backgroundBackstage,\r\n  iconFechar,\r\n  iconBloqueado,\r\n  iconDisponivel,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  bandHypeValue,\r\n  bandFansValue,\r\n  bandPerformanceValue,\r\n  bandCostValue,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  formatCurrency,\r\n  bandMenuView,\r\n  bandMenuOptions,\r\n  onChangeBandMenuView,\r\n  activeBandSelectorInstrument,\r\n  bandInstrumentColumns,\r\n  selectorMusicians,\r\n  selectedSelectorMusicianId,\r\n  instrumentLabels,\r\n  iconMusicoVazio,\r\n  onOpenInstrument,\r\n  onCloseSelector,\r\n  onSelectEmpty,\r\n  onSelectMusician,\r\n  onCloseScreen,\r\n}) => {\r\n  const DETAIL_CLOSE_MS = 180;\r\n  const [selectedSelectorDetail, setSelectedSelectorDetail] = React.useState<SelectorMusician | null>(null);\r\n  const [isDetailClosing, setIsDetailClosing] = React.useState(false);\r\n  const detailCloseTimeoutRef = React.useRef<number | null>(null);\r\n\r\n  const isSelectorDetailOpen = Boolean(selectedSelectorDetail);\r\n\r\n  const instrumentIdByKey: Record<Instrument, number> = {\r\n    guitar: 1,\r\n    bass: 2,\r\n    drums: 3,\r\n    keys: 4,\r\n  };\r\n\r\n  const instrumentRoleByKey: Record<Instrument, string> = {\r\n    guitar: 'guitarrista',\r\n    bass: 'baixista',\r\n    drums: 'baterista',\r\n    keys: 'tecladista',\r\n  };\r\n\r\n  const instrumentNameById: Record<number, string> = {\r\n    1: instrumentLabels.guitar,\r\n    2: instrumentLabels.bass,\r\n    3: instrumentLabels.drums,\r\n    4: instrumentLabels.keys,\r\n  };\r\n\r\n  const activeBandColumn = activeBandSelectorInstrument\r\n    ? bandInstrumentColumns.find((column) => column.id === activeBandSelectorInstrument)\r\n    : null;\r\n\r\n  const activeInstrumentIcon = activeBandColumn?.icon ?? iconMusicoVazio;\r\n  const activeInstrumentRole = activeBandSelectorInstrument ? instrumentRoleByKey[activeBandSelectorInstrument] : 'músico';\r\n\r\n  React.useEffect(() => {\r\n    if (!activeBandSelectorInstrument || selectedSelectorDetail) {\r\n      return;\r\n    }\r\n\r\n    const currentMusicianId = activeBandColumn?.musicianId;\r\n    if (currentMusicianId === null || currentMusicianId === undefined) {\r\n      return;\r\n    }\r\n\r\n    const currentMusician = selectorMusicians.find((item) => item.id === currentMusicianId);\r\n    if (currentMusician) {\r\n      openSelectorDetail(currentMusician);\r\n    }\r\n  }, [activeBandSelectorInstrument, activeBandColumn, selectorMusicians, selectedSelectorDetail]);\r\n\r\n  const openSelectorDetail = (musician: SelectorMusician) => {\r\n    if (detailCloseTimeoutRef.current) {\r\n      window.clearTimeout(detailCloseTimeoutRef.current);\r\n      detailCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setIsDetailClosing(false);\r\n    setSelectedSelectorDetail(musician);\r\n  };\r\n\r\n  const closeSelectorDetail = () => {\r\n    if (!selectedSelectorDetail) {\r\n      return;\r\n    }\r\n\r\n    if (detailCloseTimeoutRef.current) {\r\n      window.clearTimeout(detailCloseTimeoutRef.current);\r\n      detailCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setIsDetailClosing(true);\r\n    detailCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setSelectedSelectorDetail(null);\r\n      setIsDetailClosing(false);\r\n      detailCloseTimeoutRef.current = null;\r\n    }, DETAIL_CLOSE_MS);\r\n  };\r\n\r\n  const closeSelectorAndDetail = (action: () => void) => {\r\n    if (detailCloseTimeoutRef.current) {\r\n      window.clearTimeout(detailCloseTimeoutRef.current);\r\n      detailCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setSelectedSelectorDetail(null);\r\n    setIsDetailClosing(false);\r\n    action();\r\n    onCloseSelector();\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (!activeBandSelectorInstrument) {\r\n      setSelectedSelectorDetail(null);\r\n      setIsDetailClosing(false);\r\n    }\r\n  }, [activeBandSelectorInstrument]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (detailCloseTimeoutRef.current) {\r\n        window.clearTimeout(detailCloseTimeoutRef.current);\r\n        detailCloseTimeoutRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  if (!isVisible) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`band-management-screen${isClosing ? ' closing' : ''}`}\r\n      style={{ backgroundImage: `url(${backgroundBackstage})` }}\r\n    >\r\n      <div className={`band-management-content${isSelectorDetailOpen ? ' detail-open' : ''}`}>\r\n        <div className=\"band-management-top-hero\">\r\n          <div className=\"musicians-contract-overlay\" />\r\n          <div className={`band-management-header${isSelectorDetailOpen ? ' hidden' : ''}`}>\r\n            <h2>Banda</h2>\r\n            <p>Gerencie os músicos da sua banda</p>\r\n            {!isSelectorDetailOpen ? (\r\n              <button\r\n                type=\"button\"\r\n                className=\"musicians-close-btn\"\r\n                onClick={onCloseScreen}\r\n                data-click-sfx=\"close\"\r\n                aria-label=\"Fechar tela da banda\"\r\n              >\r\n                <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n              </button>\r\n            ) : null}\r\n          </div>\r\n\r\n          {activeBandSelectorInstrument && selectedSelectorDetail ? (\r\n            <MusicianDetailModal\r\n              musician={{\r\n                ID: selectedSelectorDetail.id,\r\n                Instrumentista: selectedSelectorDetail.name,\r\n                Instrumento: instrumentIdByKey[activeBandSelectorInstrument],\r\n                Asset_Face: '',\r\n                Asset: '',\r\n                Hype: selectedSelectorDetail.hype,\r\n                Fans: selectedSelectorDetail.fans,\r\n                Apresentacao: selectedSelectorDetail.performance,\r\n                Sexo: '',\r\n                Custo: 0,\r\n                Cache: selectedSelectorDetail.cache,\r\n                Nivel: selectedSelectorDetail.rarityClass === 'gold' ? 3 : selectedSelectorDetail.rarityClass === 'silver' ? 2 : 1,\r\n                ID_Instrumento: instrumentIdByKey[activeBandSelectorInstrument],\r\n                Contratado: selectedSelectorMusicianId === selectedSelectorDetail.id,\r\n                Historia: '',\r\n              }}\r\n              selectedMusicianFace={selectedSelectorDetail.face}\r\n              selectedMusicianPortrait={selectedSelectorDetail.portrait}\r\n              selectedMusicianInitials={selectedSelectorDetail.firstName.slice(0, 2).toUpperCase()}\r\n              selectedMusicianRarityClass={selectedSelectorDetail.rarityClass}\r\n              selectedInstrumentIcon={activeInstrumentIcon}\r\n              isClosing={isDetailClosing}\r\n              isStoryOpen={false}\r\n              isSelectedMusicianHired={selectedSelectorMusicianId === selectedSelectorDetail.id}\r\n              isSelectedMusicianLockedByCoins={false}\r\n              canHireSelectedMusician={true}\r\n              selectedMusicianPrice={0}\r\n              iconFechar={iconFechar}\r\n              iconBloqueado={iconBloqueado}\r\n              iconDisponivel={iconDisponivel}\r\n              iconMoneyWhite={iconMoneyWhite}\r\n              iconFameWhite={iconFameWhite}\r\n              iconFansWhite={iconFansWhite}\r\n              iconRhythmWhite={iconRhythmWhite}\r\n              iconCost={iconCost}\r\n              formatNumber={formatNumber}\r\n              formatPerformancePercent={formatPerformancePercent}\r\n              instrumentNameById={instrumentNameById}\r\n              hideCloseButton\r\n              displayMode=\"hero-stage\"\r\n              showStoryToggle={false}\r\n              customAction={selectedSelectorMusicianId === selectedSelectorDetail.id\r\n                ? {\r\n                  label: `Remover ${activeInstrumentRole}`,\r\n                  variant: 'remove',\r\n                  onClick: () => closeSelectorAndDetail(() => onSelectEmpty(activeBandSelectorInstrument)),\r\n                }\r\n                : {\r\n                  label: `Selecionar ${activeInstrumentRole}`,\r\n                  variant: 'select',\r\n                  onClick: () => closeSelectorAndDetail(() => onSelectMusician(activeBandSelectorInstrument, selectedSelectorDetail.id)),\r\n                }}\r\n              onCloseDetails={closeSelectorDetail}\r\n              onToggleStory={() => undefined}\r\n              onHireSelected={() => undefined}\r\n            />\r\n          ) : null}\r\n        </div>\r\n\r\n        <div className={`band-management-bottom-panel${isSelectorDetailOpen ? ' detail-open' : ''}`}>\r\n          <div className=\"band-management-placeholder\">\r\n            <div className=\"band-menu-nav\">\r\n              {bandMenuOptions.map((option) => (\r\n                <button\r\n                  key={option.id}\r\n                  type=\"button\"\r\n                  className={`band-menu-tab${bandMenuView === option.id ? ' active' : ''}`}\r\n                  onClick={() => onChangeBandMenuView(option.id)}\r\n                >\r\n                  <img src={option.icon} alt={option.label} />\r\n                  <span>{option.label}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n\r\n            {bandMenuView === 'band' ? (\r\n              <>\r\n                <div className=\"band-gains-row\">\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconFameWhite} alt=\"Hype\" />\r\n                    <span>Hype</span>\r\n                    <strong>+{formatNumber(bandHypeValue)}</strong>\r\n                  </span>\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconFansWhite} alt=\"Público\" />\r\n                    <span>Fãs</span>\r\n                    <strong>+{formatNumber(bandFansValue)}</strong>\r\n                  </span>\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconRhythmWhite} alt=\"Performance\" />\r\n                    <span>Perfor.</span>\r\n                    <strong>{formatPerformancePercent(bandPerformanceValue)}</strong>\r\n                  </span>\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconCost} alt=\"Cachê\" />\r\n                    <span>Cachê</span>\r\n                    <strong>-{formatCurrency(bandCostValue)}</strong>\r\n                  </span>\r\n                </div>\r\n\r\n                <BandInstrumentSelector\r\n                  bandInstrumentColumns={bandInstrumentColumns}\r\n                  activeInstrument={activeBandSelectorInstrument}\r\n                  isDetailOpen={isSelectorDetailOpen}\r\n                  selectorMusicians={selectorMusicians}\r\n                  selectedMusicianId={selectedSelectorMusicianId}\r\n                  instrumentLabels={instrumentLabels}\r\n                  iconFechar={iconFechar}\r\n                  iconMusicoVazio={iconMusicoVazio}\r\n                  onOpenInstrument={onOpenInstrument}\r\n                  onCloseSelector={onCloseSelector}\r\n                  onSelectEmpty={onSelectEmpty}\r\n                  onOpenMusicianDetail={openSelectorDetail}\r\n                />\r\n              </>\r\n            ) : (\r\n              <div className=\"band-menu-empty-view\">\r\n                <strong>{bandMenuView === 'specials' ? 'Especiais' : 'Análise'}</strong>\r\n                <span>Conteúdo desta seção será adicionado nas próximas etapas.</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BandManagementScreen;\r\n","import React from 'react';\r\nimport MusicianDetailModal from './MusicianDetailModal';\r\nimport type { Instrument } from '../../state/gameStore';\r\nimport './MusiciansContractScreen.css';\r\n\r\ntype HireFilter = 'all' | Instrument;\r\n\r\ntype MusicianData = {\r\n  ID: number;\r\n  Instrumentista: string;\r\n  Instrumento: number;\r\n  Asset_Face: string;\r\n  Asset_Portrait?: string;\r\n  Asset: string;\r\n  Asset_Char?: string;\r\n  Hype: number;\r\n  Fans: number;\r\n  Apresentacao: number;\r\n  Sexo: string;\r\n  Custo: number;\r\n  Cache: number;\r\n  Nivel: number;\r\n  ID_Instrumento: number;\r\n  Contratado: boolean;\r\n  Historia: string;\r\n};\r\n\r\ntype MusicianListItem = {\r\n  musician: MusicianData;\r\n  rarityClass: 'bronze' | 'silver' | 'gold';\r\n  rarityLabel: string;\r\n  instrumentIcon: string;\r\n  isMusicianHired: boolean;\r\n  isLockedByCoins: boolean;\r\n  musicianFaceSrc: string | null;\r\n  initials: string;\r\n};\r\n\r\ntype FilterOption = {\r\n  id: HireFilter;\r\n  label: string;\r\n  icon: string;\r\n};\r\n\r\ntype MusiciansContractScreenProps = {\r\n  isVisible: boolean;\r\n  isClosing: boolean;\r\n  backgroundAudicao: string;\r\n  portraitContratante: string;\r\n  iconFechar: string;\r\n  iconBloqueado: string;\r\n  iconDisponivel: string;\r\n  selectedInstrumentIcon: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  selectedMusicianDetails: MusicianData | null;\r\n  selectedMusicianFace: string | null;\r\n  selectedMusicianPortrait: string | null;\r\n  selectedMusicianInitials: string;\r\n  selectedMusicianRarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n  isClosingMusicianDetails: boolean;\r\n  isMusicianStoryOpen: boolean;\r\n  isSelectedMusicianHired: boolean;\r\n  isSelectedMusicianLockedByCoins: boolean;\r\n  canHireSelectedMusician: boolean;\r\n  selectedMusicianPrice: number;\r\n  hireFilter: HireFilter;\r\n  filterOptions: FilterOption[];\r\n  listedMusicianItems: MusicianListItem[];\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  instrumentNameById: Record<number, string>;\r\n  onCloseScreen: () => void;\r\n  onCloseDetails: () => void;\r\n  onToggleStory: () => void;\r\n  onChangeFilter: (filter: HireFilter) => void;\r\n  onOpenMusicianDetails: (musician: MusicianData) => void;\r\n  onHireSelected: () => void;\r\n};\r\n\r\nconst MusiciansContractScreen: React.FC<MusiciansContractScreenProps> = ({\r\n  isVisible,\r\n  isClosing,\r\n  backgroundAudicao,\r\n  portraitContratante,\r\n  iconFechar,\r\n  iconBloqueado,\r\n  iconDisponivel,\r\n  selectedInstrumentIcon,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  selectedMusicianDetails,\r\n  selectedMusicianFace,\r\n  selectedMusicianPortrait,\r\n  selectedMusicianInitials,\r\n  selectedMusicianRarityClass,\r\n  isClosingMusicianDetails,\r\n  isMusicianStoryOpen,\r\n  isSelectedMusicianHired,\r\n  isSelectedMusicianLockedByCoins,\r\n  canHireSelectedMusician,\r\n  selectedMusicianPrice,\r\n  hireFilter,\r\n  filterOptions,\r\n  listedMusicianItems,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  instrumentNameById,\r\n  onCloseScreen,\r\n  onCloseDetails,\r\n  onToggleStory,\r\n  onChangeFilter,\r\n  onOpenMusicianDetails,\r\n  onHireSelected,\r\n}) => {\r\n  const [collapsedGroups, setCollapsedGroups] = React.useState({\r\n    hired: false,\r\n    available: false,\r\n  });\r\n  const prevHireMapRef = React.useRef<Map<number, boolean>>(new Map());\r\n  const [recentlyHiredId, setRecentlyHiredId] = React.useState<number | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    let detectedHiredId: number | null = null;\r\n    const nextMap = new Map<number, boolean>();\r\n\r\n    listedMusicianItems.forEach((item) => {\r\n      const id = item.musician.ID;\r\n      const wasHired = prevHireMapRef.current.get(id);\r\n      if (wasHired === false && item.isMusicianHired) {\r\n        detectedHiredId = id;\r\n      }\r\n      nextMap.set(id, item.isMusicianHired);\r\n    });\r\n\r\n    prevHireMapRef.current = nextMap;\r\n\r\n    if (detectedHiredId !== null) {\r\n      setRecentlyHiredId(detectedHiredId);\r\n      window.setTimeout(() => {\r\n        setRecentlyHiredId((current) => (current === detectedHiredId ? null : current));\r\n      }, 650);\r\n    }\r\n  }, [listedMusicianItems]);\r\n\r\n  if (!isVisible) {\r\n    return null;\r\n  }\r\n\r\n  const rarityRank = {\r\n    bronze: 0,\r\n    silver: 1,\r\n    gold: 2,\r\n  } as const;\r\n\r\n  const hiredMusicianItems = listedMusicianItems\r\n    .filter((item) => item.isMusicianHired)\r\n    .sort((a, b) => {\r\n      const rarityDiff = rarityRank[a.rarityClass] - rarityRank[b.rarityClass];\r\n      if (rarityDiff !== 0) {\r\n        return rarityDiff;\r\n      }\r\n      // Keep purchase order: older first (stable by original order)\r\n      return listedMusicianItems.indexOf(a) - listedMusicianItems.indexOf(b);\r\n    });\r\n  const availableMusicianItems = listedMusicianItems.filter((item) => !item.isMusicianHired);\r\n\r\n  const toggleGroup = (group: 'hired' | 'available') => {\r\n    setCollapsedGroups((prev) => ({\r\n      ...prev,\r\n      [group]: !prev[group],\r\n    }));\r\n  };\r\n\r\n  const renderMusicianCard = (item: MusicianListItem) => (\r\n    <article\r\n      key={item.musician.ID}\r\n      className={`musician-contract-card rarity-${item.rarityClass}${item.isMusicianHired ? ' is-hired' : ' is-available'}${!item.isMusicianHired ? (item.isLockedByCoins ? ' is-locked-by-coins' : ' is-available-to-buy') : ''}${recentlyHiredId === item.musician.ID ? ' just-hired' : ''}`}\r\n      data-click-sfx=\"open\"\r\n      onClick={() => onOpenMusicianDetails(item.musician)}\r\n    >\r\n      <div className=\"musician-card-top\">\r\n        <div className=\"musician-avatar-column\">\r\n          {item.musicianFaceSrc ? (\r\n            <img src={item.musicianFaceSrc} alt=\"\" className=\"musician-avatar-face\" />\r\n          ) : (\r\n            <div className=\"musician-avatar-fallback\" aria-hidden=\"true\">\r\n              {item.initials}\r\n            </div>\r\n          )}\r\n          {!item.isMusicianHired ? (\r\n            <img\r\n              src={item.isLockedByCoins ? iconBloqueado : iconDisponivel}\r\n              alt={item.isLockedByCoins ? 'Bloqueado' : 'Disponível'}\r\n              className={`musician-card-status-icon ${item.isLockedByCoins ? 'locked' : 'available'}`}\r\n            />\r\n          ) : null}\r\n        </div>\r\n        <div className=\"musician-main-meta\">\r\n          <strong>{item.musician.Instrumentista}</strong>\r\n          <div className=\"musician-meta-badges\">\r\n            <span className=\"musician-card-instrument-badge\">\r\n              <img src={item.instrumentIcon} alt=\"\" aria-hidden=\"true\" className=\"musician-instrument-mini\" />\r\n              <span>{instrumentNameById[item.musician.Instrumento] ?? 'Instrumento'}</span>\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </article>\r\n  );\r\n\r\n  return (\r\n    <div className={`musicians-contract-screen${isClosing ? ' closing' : ''}`} style={{ backgroundImage: `url(${backgroundAudicao})` }}>\r\n      <div className=\"musicians-contract-content\">\r\n        <div className=\"musicians-top-hero\">\r\n          <div className=\"musicians-contract-overlay\" />\r\n          <div className={`musicians-contract-header${selectedMusicianDetails ? ' hidden' : ''}`}>\r\n            <h2>Músicos</h2>\r\n            <p>Contrate novos talentos para sua banda</p>\r\n            {!selectedMusicianDetails ? (\r\n              <button\r\n                type=\"button\"\r\n                className=\"musicians-close-btn\"\r\n                onClick={onCloseScreen}\r\n                data-click-sfx=\"close\"\r\n                aria-label=\"Fechar tela de músicos\"\r\n              >\r\n                <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n              </button>\r\n            ) : null}\r\n          </div>\r\n\r\n          <MusicianDetailModal\r\n            musician={selectedMusicianDetails}\r\n            selectedMusicianFace={selectedMusicianFace}\r\n            selectedMusicianPortrait={selectedMusicianPortrait}\r\n            selectedMusicianInitials={selectedMusicianInitials}\r\n            selectedMusicianRarityClass={selectedMusicianRarityClass}\r\n            selectedInstrumentIcon={selectedInstrumentIcon}\r\n            isClosing={isClosingMusicianDetails}\r\n            isStoryOpen={isMusicianStoryOpen}\r\n            isSelectedMusicianHired={isSelectedMusicianHired}\r\n            isSelectedMusicianLockedByCoins={isSelectedMusicianLockedByCoins}\r\n            canHireSelectedMusician={canHireSelectedMusician}\r\n            selectedMusicianPrice={selectedMusicianPrice}\r\n            iconFechar={iconFechar}\r\n            iconBloqueado={iconBloqueado}\r\n            iconDisponivel={iconDisponivel}\r\n            iconMoneyWhite={iconMoneyWhite}\r\n            iconFameWhite={iconFameWhite}\r\n            iconFansWhite={iconFansWhite}\r\n            iconRhythmWhite={iconRhythmWhite}\r\n            iconCost={iconCost}\r\n            formatNumber={formatNumber}\r\n            formatPerformancePercent={formatPerformancePercent}\r\n            instrumentNameById={instrumentNameById}\r\n            displayMode=\"hero-stage\"\r\n            onCloseDetails={onCloseDetails}\r\n            onToggleStory={onToggleStory}\r\n            onHireSelected={onHireSelected}\r\n          />\r\n\r\n          <div className=\"musicians-hero-slot\">\r\n            <img\r\n              src={portraitContratante}\r\n              alt=\"Contratante\"\r\n              className={`musicians-contractor-portrait${selectedMusicianDetails && !isClosingMusicianDetails ? ' hide' : ' show'}`}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"musicians-bottom-panel\">\r\n          <div className=\"musicians-filter-row\">\r\n            {filterOptions.map((option) => (\r\n              <button\r\n                key={option.id}\r\n                type=\"button\"\r\n                className={`musicians-filter-btn${hireFilter === option.id ? ' active' : ''}`}\r\n                onClick={() => onChangeFilter(option.id)}\r\n              >\r\n                <img src={option.icon} alt={option.label} />\r\n                <span>{option.label}</span>\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"musicians-list-groups\">\r\n            {hiredMusicianItems.length > 0 ? (\r\n              <section className=\"musicians-list-group\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"musicians-group-toggle\"\r\n                  onClick={() => toggleGroup('hired')}\r\n                  aria-expanded={!collapsedGroups.hired}\r\n                >\r\n                  <span className=\"musicians-group-title-wrap\">\r\n                    <h3>Contratados</h3>\r\n                    <span className=\"musicians-group-count\">{hiredMusicianItems.length}</span>\r\n                  </span>\r\n                  <span className=\"musicians-group-arrow\" aria-hidden=\"true\">\r\n                    {collapsedGroups.hired ? '▸' : '▾'}\r\n                  </span>\r\n                </button>\r\n                {!collapsedGroups.hired ? <div className=\"musicians-list-grid\">{hiredMusicianItems.map(renderMusicianCard)}</div> : null}\r\n              </section>\r\n            ) : null}\r\n\r\n            {availableMusicianItems.length > 0 ? (\r\n              <section className=\"musicians-list-group\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"musicians-group-toggle\"\r\n                  onClick={() => toggleGroup('available')}\r\n                  aria-expanded={!collapsedGroups.available}\r\n                >\r\n                  <span className=\"musicians-group-title-wrap\">\r\n                    <h3>A contratar</h3>\r\n                    <span className=\"musicians-group-count\">{availableMusicianItems.length}</span>\r\n                  </span>\r\n                  <span className=\"musicians-group-arrow\" aria-hidden=\"true\">\r\n                    {collapsedGroups.available ? '▸' : '▾'}\r\n                  </span>\r\n                </button>\r\n                {!collapsedGroups.available ? (\r\n                  <div className=\"musicians-list-grid\">{availableMusicianItems.map(renderMusicianCard)}</div>\r\n                ) : null}\r\n              </section>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MusiciansContractScreen;\r\n","import React from 'react';\r\nimport './StageTopValuesBar.css';\r\n\r\ntype StageTopValuesBarProps = {\r\n  configIcon: string;\r\n  availableBandCoins: number;\r\n  fans: number;\r\n  fameStars: number;\r\n  iconMoneyBlack: string;\r\n  iconFansBlack: string;\r\n  iconFameBlack: string;\r\n  onOpenBandConfig: () => void;\r\n  formatCurrency: (value: number) => string;\r\n  formatNumber: (value: number) => string;\r\n  famePulseTick: number;\r\n  topMoneyRef: React.RefObject<HTMLDivElement | null>;\r\n  topFansRef: React.RefObject<HTMLDivElement | null>;\r\n  topFameRef: React.RefObject<HTMLDivElement | null>;\r\n  className?: string;\r\n  isConfigOpen?: boolean;\r\n};\r\n\r\nconst StageTopValuesBar: React.FC<StageTopValuesBarProps> = ({\r\n  configIcon,\r\n  availableBandCoins,\r\n  fans,\r\n  fameStars,\r\n  iconMoneyBlack,\r\n  iconFansBlack,\r\n  iconFameBlack,\r\n  onOpenBandConfig,\r\n  formatCurrency,\r\n  formatNumber,\r\n  famePulseTick,\r\n  topMoneyRef,\r\n  topFansRef,\r\n  topFameRef,\r\n  className = '',\r\n  isConfigOpen = false,\r\n}) => {\r\n  return (\r\n    <div className={`stage-top-values${className ? ` ${className}` : ''}`}>\r\n      <button\r\n        type=\"button\"\r\n        className={`band-config-trigger${isConfigOpen ? ' is-open' : ''}`}\r\n        onClick={onOpenBandConfig}\r\n        aria-label=\"Abrir configurações da banda\"\r\n      >\r\n        <img src={configIcon} alt=\"Configurações\" className=\"band-config-trigger-logo\" />\r\n      </button>\r\n      <div className=\"top-pill top-pill-money\" ref={topMoneyRef}>\r\n        <img src={iconMoneyBlack} alt=\"Dinheiro\" className=\"top-pill-icon\" />\r\n        <strong className=\"top-pill-value\">{formatCurrency(availableBandCoins)}</strong>\r\n      </div>\r\n      <div className=\"top-pill top-pill-fans\" ref={topFansRef}>\r\n        <img src={iconFansBlack} alt=\"Fãs\" className=\"top-pill-icon\" />\r\n        <strong className=\"top-pill-value\">{formatNumber(fans)}</strong>\r\n      </div>\r\n      <div className=\"top-pill top-pill-fame\" ref={topFameRef}>\r\n        <img src={iconFameBlack} alt=\"Fama\" className=\"top-pill-icon\" />\r\n        <strong key={famePulseTick} className=\"top-pill-value fame-pop\">{formatNumber(fameStars)}</strong>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageTopValuesBar;\r\n","import React from 'react';\r\nimport './StageBottomNav.css';\r\n\r\ntype StageBottomNavProps = {\r\n  variant?: 'bottom' | 'side';\r\n  isHiding?: boolean;\r\n  isBandManagementScreenVisible: boolean;\r\n  availableToHireCount: number;\r\n  className?: string;\r\n  navBand: string;\r\n  navHire: string;\r\n  navStore: string;\r\n  navStage: string;\r\n  navSongs: string;\r\n  onOpenBandManagementScreen: () => void;\r\n  onOpenMusiciansScreen: () => void;\r\n  onCycleStage: () => void;\r\n};\r\n\r\nconst StageBottomNav: React.FC<StageBottomNavProps> = ({\r\n  variant = 'bottom',\r\n  isHiding = false,\r\n  isBandManagementScreenVisible,\r\n  availableToHireCount,\r\n  className = '',\r\n  navBand,\r\n  navHire,\r\n  navStore,\r\n  navStage,\r\n  navSongs,\r\n  onOpenBandManagementScreen,\r\n  onOpenMusiciansScreen,\r\n  onCycleStage,\r\n}) => {\r\n  const resolvedClassName = !isHiding && className ? ` ${className}` : '';\r\n\r\n  return (\r\n    <div className={`game-bottom-nav${variant === 'side' ? ' game-side-nav' : ''}${isHiding ? ' is-hiding' : ''}${resolvedClassName}`}>\r\n      <button\r\n        type=\"button\"\r\n        className={`bottom-item${isBandManagementScreenVisible ? ' active' : ''}`}\r\n        onClick={onOpenBandManagementScreen}\r\n      >\r\n        <img src={navBand} alt=\"Banda\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Banda</span>\r\n      </button>\r\n      <button type=\"button\" className={`bottom-item${availableToHireCount > 0 ? ' has-badge' : ''}`} onClick={onOpenMusiciansScreen}>\r\n        {availableToHireCount > 0 ? (\r\n          <span className=\"bottom-item-badge bottom-item-badge-green\">{availableToHireCount > 99 ? '99+' : availableToHireCount}</span>\r\n        ) : null}\r\n        <img src={navHire} alt=\"Músicos\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Músicos</span>\r\n      </button>\r\n      <button type=\"button\" className=\"bottom-item\">\r\n        <img src={navStore} alt=\"Loja\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Loja</span>\r\n      </button>\r\n      <button type=\"button\" className=\"bottom-item\" onClick={onCycleStage}>\r\n        <img src={navStage} alt=\"Palco\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Palco</span>\r\n      </button>\r\n      <button type=\"button\" className=\"bottom-item\">\r\n        <img src={navSongs} alt=\"Músicas\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Músicas</span>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageBottomNav;\r\n","import React from 'react';\r\nimport './StageProgressList.css';\r\n\r\ntype StageProgressListProps = {\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  famePct: number;\r\n  fameValue: number;\r\n  fameTarget: number;\r\n  lotacaoPct: number;\r\n  lotacaoValue: number;\r\n  lotacaoTarget: number;\r\n  formatNumber: (value: number) => string;\r\n  fameTrackRef: React.RefObject<HTMLDivElement | null>;\r\n  crowdTrackRef: React.RefObject<HTMLDivElement | null>;\r\n};\r\n\r\nconst StageProgressList: React.FC<StageProgressListProps> = ({\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  famePct,\r\n  fameValue,\r\n  fameTarget,\r\n  lotacaoPct,\r\n  lotacaoValue,\r\n  lotacaoTarget,\r\n  formatNumber,\r\n  fameTrackRef,\r\n  crowdTrackRef,\r\n}) => {\r\n  return (\r\n    <div className=\"stage-progress-list\">\r\n      <div className=\"stage-progress-item fame-track\" ref={fameTrackRef}>\r\n        <img src={iconFameWhite} alt=\"Fama\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${famePct}%` }} />\r\n          <div className=\"progress-text\">\r\n            <span>Fama</span>\r\n            <strong>{formatNumber(fameValue)} / {formatNumber(fameTarget)}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"stage-progress-item crowd-track\" ref={crowdTrackRef}>\r\n        <img src={iconFansWhite} alt=\"Fãs\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${lotacaoPct}%` }} />\r\n          <div className=\"progress-text\">\r\n            <span>Público / Lotação</span>\r\n            <strong>{formatNumber(lotacaoValue)} / {formatNumber(lotacaoTarget)}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageProgressList;\r\n","import React from 'react';\r\nimport './StageCenterPanel.css';\r\n\r\ntype StageCenterPanelProps = {\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  iconIngresso: string;\r\n  iconValorCacheTotal: string;\r\n  iconCache: string;\r\n  bandHypeValue: number;\r\n  bandFansValue: number;\r\n  bandPerformanceValue: number;\r\n  selectedStageName: string;\r\n  onExitShow: () => void;\r\n  venueBadgeIcon: string;\r\n  stageTicketPrice: number;\r\n  lotacaoTotalValue: number;\r\n  costSharePct: number;\r\n  gainSharePct: number;\r\n  gainValue: number;\r\n  metronomeTick: boolean;\r\n  beatHitFeedback: boolean;\r\n  isMusicPlaying: boolean;\r\n  metronomeBeatMs: number;\r\n  rhythmBonus: number;\r\n  bonusFlash: boolean;\r\n  rhythmMeter: number;\r\n  musicStartThreshold: number;\r\n  rhythmTone: string;\r\n  bandCostValue: number;\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  formatCurrency: (value: number) => string;\r\n  gainMeterRef: React.RefObject<HTMLDivElement | null>;\r\n  wrapperRef?: React.RefObject<HTMLDivElement | null>;\r\n};\r\n\r\nconst StageCenterPanel: React.FC<StageCenterPanelProps> = ({\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  iconIngresso,\r\n  iconValorCacheTotal,\r\n  iconCache,\r\n  bandHypeValue,\r\n  bandFansValue,\r\n  bandPerformanceValue,\r\n  selectedStageName,\r\n  onExitShow,\r\n  venueBadgeIcon,\r\n  stageTicketPrice,\r\n  lotacaoTotalValue,\r\n  costSharePct,\r\n  gainSharePct,\r\n  gainValue,\r\n  metronomeTick,\r\n  beatHitFeedback,\r\n  isMusicPlaying,\r\n  metronomeBeatMs,\r\n  rhythmBonus,\r\n  bonusFlash,\r\n  rhythmMeter,\r\n  musicStartThreshold,\r\n  rhythmTone,\r\n  bandCostValue,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  formatCurrency,\r\n  gainMeterRef,\r\n  wrapperRef,\r\n}) => {\r\n  return (\r\n    <div className=\"stage-center-panel\" ref={wrapperRef}>\r\n      <div className=\"venue-card\">\r\n        <div className=\"venue-layout\">\r\n          <img src={venueBadgeIcon} alt=\"Badge do local\" className=\"venue-badge-icon\" />\r\n          <div className=\"venue-info\">\r\n            <div className=\"venue-title-row\">\r\n              <h3>{selectedStageName}</h3>\r\n              <button type=\"button\" className=\"venue-exit-btn\" onClick={onExitShow} data-click-sfx=\"close\">\r\n                Voltar ao mapa\r\n              </button>\r\n            </div>\r\n            <div className=\"venue-meta\">\r\n              <span><img src={iconIngresso} alt=\"Ingresso\" className=\"venue-meta-icon\" /> {formatCurrency(stageTicketPrice)}</span>\r\n              <span><img src={iconValorCacheTotal} alt=\"Valor total da lotação\" className=\"venue-meta-icon\" /> {formatCurrency(lotacaoTotalValue)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mini-kpis\">\r\n        <div className=\"kpi-box\">\r\n          <img src={iconFameWhite} alt=\"Fama\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Hype</span>\r\n            <strong>+{formatNumber(bandHypeValue)}</strong>\r\n          </div>\r\n        </div>\r\n        <div className=\"kpi-box\">\r\n          <img src={iconFansWhite} alt=\"Fãs\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Fãs</span>\r\n            <strong>+{formatNumber(bandFansValue)}</strong>\r\n          </div>\r\n        </div>\r\n        <div className=\"kpi-box\">\r\n          <img src={iconRhythmWhite} alt=\"Performance\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Perfor.</span>\r\n            <strong>{formatPerformancePercent(bandPerformanceValue)}</strong>\r\n          </div>\r\n        </div>\r\n        <div className=\"kpi-box kpi-box-cache\">\r\n          <img src={iconCost} alt=\"Cachê\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Cachê</span>\r\n            <strong>{formatCurrency(bandCostValue)}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"cost-gain-meter\" aria-label=\"Barra lateral de custo versus ganho\" ref={gainMeterRef}>\r\n        <img src={iconCost} alt=\"Custo\" className=\"cost-gain-icon\" />\r\n        <div className=\"cost-gain-core\">\r\n          <div className=\"cost-gain-track\">\r\n            <span className=\"cost-gain-fill-cost\" style={{ height: `${costSharePct}%` }} />\r\n            <span className=\"cost-gain-fill-gain\" style={{ height: `${gainSharePct}%` }} />\r\n          </div>\r\n          <div className=\"cost-gain-value\" style={{ top: `${costSharePct}%` }}>{formatCurrency(gainValue)}</div>\r\n        </div>\r\n        <img src={iconCache} alt=\"Ganho\" className=\"cost-gain-icon\" />\r\n      </div>\r\n\r\n      <div className=\"rhythm-side-meter\" aria-label=\"Barra lateral de ritmo\">\r\n        <div className={`rhythm-metronome${metronomeTick ? ' tick' : ''}${beatHitFeedback ? ' hit' : ''}`}>\r\n          <span className={`rhythm-metronome-arm${isMusicPlaying ? ' active' : ''}`} style={{ animationDuration: `${metronomeBeatMs}ms` }} />\r\n        </div>\r\n        <div className={`beat-hit-badge${beatHitFeedback ? ' show' : ''}`}>ACERTOU!</div>\r\n        <div className={`rhythm-bonus-tag${rhythmBonus > 1 ? ' active' : ''}${bonusFlash ? ' flash' : ''}`}>\r\n          {rhythmBonus > 1 ? `Bônus x${rhythmBonus.toFixed(1)}` : 'Sem bônus'}\r\n        </div>\r\n        <div className=\"rhythm-side-track\">\r\n          <span className=\"rhythm-start-marker\" style={{ bottom: `${musicStartThreshold}%` }} />\r\n          <span className=\"rhythm-side-fill\" style={{ height: `${rhythmMeter}%`, background: rhythmTone }} />\r\n        </div>\r\n        <img src={iconRhythmWhite} alt=\"Ritmo\" className=\"rhythm-side-icon\" />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageCenterPanel;\r\n","import React from 'react';\r\nimport './StageCurrentSongBar.css';\r\n\r\ntype StageCurrentSongBarProps = {\r\n  iconFansWhite: string;\r\n  iconMusicWhite: string;\r\n  fansGainBarPct: number;\r\n  fansGainRate: number;\r\n  fansStepFlash: boolean;\r\n  songProgressPct: number;\r\n  currentSongName: string;\r\n  wrapperRef?: React.RefObject<HTMLDivElement | null>;\r\n  fansTrackRef?: React.RefObject<HTMLDivElement | null>;\r\n};\r\n\r\nconst StageCurrentSongBar: React.FC<StageCurrentSongBarProps> = ({\r\n  iconFansWhite,\r\n  iconMusicWhite,\r\n  fansGainBarPct,\r\n  fansGainRate,\r\n  fansStepFlash,\r\n  songProgressPct,\r\n  currentSongName,\r\n  wrapperRef,\r\n  fansTrackRef,\r\n}) => {\r\n  return (\r\n    <div className=\"stage-current-song\" ref={wrapperRef}>\r\n      <div className=\"stage-progress-item song-track\">\r\n        <img src={iconMusicWhite} alt=\"Música\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${songProgressPct}%` }} />\r\n          <div className=\"progress-text song-progress-text\">\r\n            <strong>{currentSongName}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"stage-progress-item fans-gain-track\" ref={fansTrackRef}>\r\n        <img src={iconFansWhite} alt=\"Ganho de fãs\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${fansGainBarPct}%` }} />\r\n          <div className=\"progress-text fans-gain-text\">\r\n            <strong>{Math.round(fansGainRate * 100)}%</strong>\r\n          </div>\r\n          <span className={`fans-gain-step-burst${fansStepFlash ? ' show' : ''}`}>+5%</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageCurrentSongBar;\r\n","import React from 'react';\r\nimport './StageVisualEffectsLayer.css';\r\n\r\ntype TapEffect = {\r\n  id: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\ntype RewardParticle = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  x: number;\r\n  y: number;\r\n  dx: number;\r\n  dy: number;\r\n  delay: number;\r\n  duration: number;\r\n};\r\n\r\ntype RewardFloatText = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  value: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\ntype StageVisualEffectsLayerProps = {\r\n  tapEffects: TapEffect[];\r\n  rewardParticles: RewardParticle[];\r\n  rewardTexts: RewardFloatText[];\r\n  iconFansWhite: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  formatNumber: (value: number) => string;\r\n};\r\n\r\nconst StageVisualEffectsLayer: React.FC<StageVisualEffectsLayerProps> = ({\r\n  tapEffects,\r\n  rewardParticles,\r\n  rewardTexts,\r\n  iconFansWhite,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  formatNumber,\r\n}) => {\r\n  const getRewardIcon = (kind: RewardParticle['kind']) => {\r\n    if (kind === 'fans') {\r\n      return iconFansWhite;\r\n    }\r\n\r\n    if (kind === 'fame') {\r\n      return iconFameWhite;\r\n    }\r\n\r\n    return iconMoneyWhite;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"rhythm-tap-layer\" aria-hidden=\"true\">\r\n        {tapEffects.map((effect) => (\r\n          <span key={effect.id} className=\"rhythm-tap-pulse\" style={{ left: effect.x, top: effect.y }} />\r\n        ))}\r\n      </div>\r\n      <div className=\"reward-fly-layer\" aria-hidden=\"true\">\r\n        {rewardParticles.map((particle) => (\r\n          <img\r\n            key={particle.id}\r\n            src={getRewardIcon(particle.kind)}\r\n            alt=\"\"\r\n            className={`reward-fly-icon ${particle.kind}`}\r\n            style={{\r\n              left: particle.x,\r\n              top: particle.y,\r\n              ['--dx' as string]: `${particle.dx}px`,\r\n              ['--dy' as string]: `${particle.dy}px`,\r\n              ['--delay' as string]: `${particle.delay}ms`,\r\n              ['--duration' as string]: `${particle.duration}ms`,\r\n            }}\r\n          />\r\n        ))}\r\n        {rewardTexts.map((entry) => (\r\n          <span\r\n            key={entry.id}\r\n            className={`reward-rise-text ${entry.kind}`}\r\n            style={{ left: entry.x, top: entry.y }}\r\n          >\r\n            +{formatNumber(entry.value)}\r\n          </span>\r\n        ))}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default StageVisualEffectsLayer;\r\n","import React, { useEffect, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\r\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\r\nimport { BokehPass } from 'three/examples/jsm/postprocessing/BokehPass.js';\r\nimport './Stage3DScene.css';\r\n\r\ntype StagePerformerInstrument = 'drums' | 'guitar' | 'bass' | 'keys';\r\n\r\ntype StageMusicianSprite = {\r\n  instrument: StagePerformerInstrument;\r\n  id: number;\r\n  portraitSrc: string;\r\n};\r\n\r\ntype Stage3DSceneProps = {\r\n  textureUrl: string;\r\n  backgroundImageUrl?: string;\r\n  backgroundVideoUrl?: string | null;\r\n  isMusicPlaying: boolean;\r\n  activeMusicians: StageMusicianSprite[];\r\n  activeMusiciansSignature?: string;\r\n  isCameraMotionEnabled: boolean;\r\n};\r\n\r\nconst baseCameraPosition = new THREE.Vector3(0, 5.25, 14.45);\r\nconst baseLookAtPosition = new THREE.Vector3(0, 0.76, 0.42);\r\nconst stageVerticalOffset = -1.22;\r\n\r\nconst performerPositions: Record<StagePerformerInstrument, THREE.Vector3> = {\r\n  drums: new THREE.Vector3(0.95, 0.9 + stageVerticalOffset, -0.66),\r\n  guitar: new THREE.Vector3(-2.7, 1 + stageVerticalOffset, 0.42),\r\n  bass: new THREE.Vector3(2.7, 1 + stageVerticalOffset, 1.06),\r\n  keys: new THREE.Vector3(-0.72, 1 + stageVerticalOffset, 2.6),\r\n};\r\n\r\nconst performerSpriteScale: Record<StagePerformerInstrument, [number, number]> = {\r\n  drums: [2.1, 3.1],\r\n  guitar: [2.05, 3],\r\n  bass: [2.05, 3],\r\n  keys: [2.2, 3.15],\r\n};\r\n\r\nconst performerShadowScale: Record<StagePerformerInstrument, [number, number]> = {\r\n  drums: [1.9, 0.66],\r\n  guitar: [1.72, 0.58],\r\n  bass: [1.72, 0.58],\r\n  keys: [1.98, 0.7],\r\n};\r\n\r\ntype CameraShot = {\r\n  type: 'general' | 'focus' | 'sweep';\r\n  instrument: StagePerformerInstrument | null;\r\n  pos: THREE.Vector3;\r\n  look: THREE.Vector3;\r\n  fov: number;\r\n  duration: number;\r\n};\r\n\r\nconst generalShot: CameraShot = {\r\n  type: 'general',\r\n  instrument: null,\r\n  pos: new THREE.Vector3(0, 4.95, 14.8),\r\n  look: new THREE.Vector3(0, 0.35, 0.06),\r\n  fov: 67,\r\n  duration: 1.6,\r\n};\r\n\r\nconst sweepShotLeft: CameraShot = {\r\n  type: 'sweep',\r\n  instrument: null,\r\n  pos: new THREE.Vector3(-5.7, 4.38, 9.8),\r\n  look: new THREE.Vector3(0, 0.4, 0.12),\r\n  fov: 62,\r\n  duration: 8,\r\n};\r\n\r\nconst sweepShotRight: CameraShot = {\r\n  type: 'sweep',\r\n  instrument: null,\r\n  pos: new THREE.Vector3(5.7, 4.38, 9.8),\r\n  look: new THREE.Vector3(0, 0.4, 0.12),\r\n  fov: 62,\r\n  duration: 8,\r\n};\r\n\r\nconst focusShotByInstrument: Record<StagePerformerInstrument, CameraShot> = {\r\n  guitar: {\r\n    type: 'focus',\r\n    instrument: 'guitar',\r\n    pos: new THREE.Vector3(-2.5, 1.2, 3.95),\r\n    look: new THREE.Vector3(-2.6, 2.08, -0.2),\r\n    fov: 50,\r\n    duration: 5,\r\n  },\r\n  bass: {\r\n    type: 'focus',\r\n    instrument: 'bass',\r\n    pos: new THREE.Vector3(2.5, 1.2, 3.95),\r\n    look: new THREE.Vector3(2.6, 2.08, -0.2),\r\n    fov: 50,\r\n    duration: 5,\r\n  },\r\n  drums: {\r\n    type: 'focus',\r\n    instrument: 'drums',\r\n    pos: new THREE.Vector3(0.9, 1.82, 3.08),\r\n    look: new THREE.Vector3(0.95, 2.22, -0.9),\r\n    fov: 49,\r\n    duration: 5,\r\n  },\r\n  keys: {\r\n    type: 'focus',\r\n    instrument: 'keys',\r\n    pos: new THREE.Vector3(-0.82, 1.1, 3.46),\r\n    look: new THREE.Vector3(-0.96, 2.1, 1.74),\r\n    fov: 49,\r\n    duration: 5,\r\n  },\r\n};\r\n\r\nconst buildShotQueue = (activeInstruments: StagePerformerInstrument[], cycle: number) => {\r\n  const sequenceOrder: StagePerformerInstrument[] = ['guitar', 'drums', 'bass', 'keys'];\r\n  const availableOrder = sequenceOrder.filter((instrument) => activeInstruments.includes(instrument));\r\n  if (!availableOrder.length) {\r\n    return [generalShot];\r\n  }\r\n\r\n  const rotateBy = cycle % availableOrder.length;\r\n  const rotatedOrder = [...availableOrder.slice(rotateBy), ...availableOrder.slice(0, rotateBy)];\r\n  const focusOrder = cycle % 2 === 0 ? rotatedOrder : [...rotatedOrder].reverse();\r\n  const sweepStart = cycle % 2 === 0 ? sweepShotLeft : sweepShotRight;\r\n  const sweepEnd = cycle % 2 === 0 ? sweepShotRight : sweepShotLeft;\r\n\r\n  const queue: CameraShot[] = [sweepStart];\r\n  focusOrder.forEach((instrument, index) => {\r\n    queue.push(focusShotByInstrument[instrument]);\r\n    if ((index + 1) % 2 === 0) {\r\n      queue.push(generalShot);\r\n    }\r\n  });\r\n  queue.push(sweepEnd);\r\n  queue.push(generalShot);\r\n\r\n  return queue;\r\n};\r\n\r\nconst Stage3DScene: React.FC<Stage3DSceneProps> = ({\r\n  textureUrl,\r\n  backgroundImageUrl,\r\n  backgroundVideoUrl,\r\n  isMusicPlaying,\r\n  activeMusicians,\r\n  activeMusiciansSignature,\r\n  isCameraMotionEnabled,\r\n}) => {\r\n  const isMobile = typeof window !== 'undefined' && window.matchMedia?.('(pointer: coarse)').matches;\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const isMusicPlayingRef = useRef(isMusicPlaying);\r\n  const activeMusiciansRef = useRef(activeMusicians);\r\n  const isCameraMotionEnabledRef = useRef(isCameraMotionEnabled);\r\n\r\n  const currentFocusedInstrumentRef = useRef<StagePerformerInstrument | null>(null);\r\n  const shotQueueRef = useRef<CameraShot[]>([]);\r\n  const shotIndexRef = useRef(0);\r\n  const currentShotRef = useRef<CameraShot>(generalShot);\r\n  const fromShotPosRef = useRef(baseCameraPosition.clone());\r\n  const fromShotLookRef = useRef(baseLookAtPosition.clone());\r\n  const fromShotFovRef = useRef(60);\r\n  const currentLookRef = useRef(baseLookAtPosition.clone());\r\n  const currentFovRef = useRef(60);\r\n  const shotEndsAtRef = useRef(0);\r\n  const shotStartedAtRef = useRef(0);\r\n  const shotMoveDurationRef = useRef(1.15);\r\n  const shotQueueCycleRef = useRef(0);\r\n  const lastShadowFrameSentAtRef = useRef(0);\r\n  const wasMusicPlayingRef = useRef(false);\r\n  const randomMotionRefreshAtRef = useRef(0);\r\n  const randomPosOffsetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n  const randomPosOffsetTargetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n  const randomLookOffsetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n  const randomLookOffsetTargetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n\r\n  useEffect(() => {\r\n    isMusicPlayingRef.current = isMusicPlaying;\r\n  }, [isMusicPlaying]);\r\n\r\n  useEffect(() => {\r\n    activeMusiciansRef.current = activeMusicians;\r\n  }, [activeMusicians]);\r\n\r\n  useEffect(() => {\r\n    isCameraMotionEnabledRef.current = isCameraMotionEnabled;\r\n  }, [isCameraMotionEnabled]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) {\r\n      return;\r\n    }\r\n\r\n    const renderer = new THREE.WebGLRenderer({\r\n      antialias: !isMobile,\r\n      alpha: true,\r\n      premultipliedAlpha: false,\r\n      powerPreference: isMobile ? 'low-power' : 'high-performance',\r\n    });\r\n    renderer.shadowMap.enabled = !isMobile;\r\n    renderer.shadowMap.type = isMobile ? THREE.BasicShadowMap : THREE.PCFSoftShadowMap;\r\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, isMobile ? 1.25 : 2));\r\n    renderer.setClearColor(0x000000, 0);\r\n    renderer.setClearAlpha(0);\r\n    renderer.outputColorSpace = THREE.SRGBColorSpace;\r\n    renderer.domElement.style.background = 'transparent';\r\n    container.appendChild(renderer.domElement);\r\n\r\n    const scene = new THREE.Scene();\r\n    scene.background = null;\r\n    scene.fog = null;\r\n\r\n    const camera = new THREE.PerspectiveCamera(38, 1, 0.1, 100);\r\n    camera.position.copy(baseCameraPosition);\r\n\r\n    const textureLoader = new THREE.TextureLoader();\r\n    let sceneBackgroundTexture: THREE.Texture | null = null;\r\n    let sceneBackgroundVideoElement: HTMLVideoElement | null = null;\r\n    let hasActiveVideoBackground = false;\r\n    const backgroundGeometry = new THREE.PlaneGeometry(1, 1, 1, 1);\r\n    const backgroundMaterial = new THREE.MeshBasicMaterial({\r\n      color: 0xffffff,\r\n      side: THREE.DoubleSide,\r\n      depthWrite: false,\r\n      depthTest: false,\r\n      toneMapped: false,\r\n    });\r\n    const backgroundPlane = new THREE.Mesh(backgroundGeometry, backgroundMaterial);\r\n    backgroundPlane.position.set(0, 12.8, -44);\r\n    backgroundPlane.renderOrder = -20;\r\n    scene.add(backgroundPlane);\r\n    const backgroundBaseY = 9.1;\r\n    const backgroundParallaxCurrent = new THREE.Vector2(0, 0);\r\n    const backgroundParallaxTarget = new THREE.Vector2(0, 0);\r\n    const backgroundParallaxLimits = new THREE.Vector2(0, 0);\r\n\r\n    const getBackgroundAspect = () => {\r\n      const bgMap = backgroundMaterial.map;\r\n      if (!bgMap) {\r\n        return 16 / 9;\r\n      }\r\n\r\n      const source = bgMap.image as {\r\n        videoWidth?: number;\r\n        videoHeight?: number;\r\n        width?: number;\r\n        height?: number;\r\n      } | null;\r\n\r\n      const width = source?.videoWidth ?? source?.width ?? 0;\r\n      const height = source?.videoHeight ?? source?.height ?? 0;\r\n      if (!width || !height) {\r\n        return 16 / 9;\r\n      }\r\n\r\n      return width / height;\r\n    };\r\n\r\n    const updateBackgroundPlaneScale = () => {\r\n      const fitScale = 4;\r\n      const distance = Math.abs(camera.position.z - backgroundPlane.position.z);\r\n      const frustumHeight = 2 * Math.tan(THREE.MathUtils.degToRad(camera.fov * 0.5)) * distance;\r\n      const frustumWidth = frustumHeight * camera.aspect;\r\n\r\n      const textureAspect = getBackgroundAspect();\r\n      let planeHeight = frustumHeight * fitScale;\r\n      let planeWidth = planeHeight * textureAspect;\r\n      if (planeWidth > frustumWidth * fitScale) {\r\n        planeWidth = frustumWidth * fitScale;\r\n        planeHeight = planeWidth / textureAspect;\r\n      }\r\n\r\n      const maxOffsetX = Math.max(0, (planeWidth - frustumWidth) * 0.5);\r\n      const maxOffsetY = Math.max(0, (planeHeight - frustumHeight) * 0.5);\r\n      backgroundParallaxLimits.set(maxOffsetX * 0.92, maxOffsetY * 0.92);\r\n      backgroundParallaxCurrent.x = THREE.MathUtils.clamp(\r\n        backgroundParallaxCurrent.x,\r\n        -backgroundParallaxLimits.x,\r\n        backgroundParallaxLimits.x\r\n      );\r\n      backgroundParallaxCurrent.y = THREE.MathUtils.clamp(\r\n        backgroundParallaxCurrent.y,\r\n        -backgroundParallaxLimits.y,\r\n        backgroundParallaxLimits.y\r\n      );\r\n\r\n      backgroundPlane.position.x = backgroundParallaxCurrent.x;\r\n      backgroundPlane.position.y = backgroundBaseY + backgroundParallaxCurrent.y;\r\n      backgroundPlane.scale.set(planeWidth, planeHeight, 1);\r\n    };\r\n\r\n    const applySceneBackground = () => {\r\n      if (backgroundImageUrl) {\r\n        const bgTexture = textureLoader.load(backgroundImageUrl);\r\n        bgTexture.colorSpace = THREE.SRGBColorSpace;\r\n        sceneBackgroundTexture = bgTexture;\r\n        backgroundMaterial.map = bgTexture;\r\n        backgroundMaterial.needsUpdate = true;\r\n      }\r\n\r\n      if (backgroundVideoUrl) {\r\n        const video = document.createElement('video');\r\n        video.src = backgroundVideoUrl;\r\n        video.muted = true;\r\n        video.loop = true;\r\n        video.autoplay = true;\r\n        video.playsInline = true;\r\n        video.preload = 'auto';\r\n\r\n        const videoTexture = new THREE.VideoTexture(video);\r\n        videoTexture.colorSpace = THREE.SRGBColorSpace;\r\n        videoTexture.minFilter = THREE.LinearFilter;\r\n        videoTexture.magFilter = THREE.LinearFilter;\r\n        videoTexture.generateMipmaps = false;\r\n\r\n        sceneBackgroundVideoElement = video;\r\n        const activateVideoTexture = () => {\r\n          if (!sceneBackgroundVideoElement || sceneBackgroundVideoElement.readyState < 2) {\r\n            return;\r\n          }\r\n          if (sceneBackgroundTexture && sceneBackgroundTexture !== videoTexture) {\r\n            sceneBackgroundTexture.dispose();\r\n          }\r\n          hasActiveVideoBackground = true;\r\n          sceneBackgroundTexture = videoTexture;\r\n          backgroundMaterial.map = videoTexture;\r\n          backgroundMaterial.needsUpdate = true;\r\n          updateBackgroundPlaneScale();\r\n        };\r\n\r\n        video.addEventListener('loadeddata', activateVideoTexture, { once: true });\r\n        video.addEventListener('canplay', activateVideoTexture, { once: true });\r\n\r\n        void video.play().catch(() => undefined);\r\n      }\r\n    };\r\n\r\n    applySceneBackground();\r\n\r\n    const ambientLight = new THREE.AmbientLight(0xffffff, 1.02);\r\n    scene.add(ambientLight);\r\n\r\n    const frontKeyLight = new THREE.SpotLight(0xfff3de, 2.42, 40, Math.PI * 0.24, 0.32, 1.05);\r\n    frontKeyLight.position.set(0, 7.1, 9.3);\r\n    frontKeyLight.castShadow = !isMobile;\r\n    frontKeyLight.shadow.mapSize.width = isMobile ? 512 : 1024;\r\n    frontKeyLight.shadow.mapSize.height = isMobile ? 512 : 1024;\r\n    frontKeyLight.shadow.bias = -0.00015;\r\n    frontKeyLight.shadow.radius = isMobile ? 1.5 : 4;\r\n    scene.add(frontKeyLight);\r\n    scene.add(frontKeyLight.target);\r\n\r\n    const fillLight = new THREE.DirectionalLight(0x93b7ff, 0.72);\r\n    fillLight.position.set(4.5, 5.5, -3.5);\r\n    scene.add(fillLight);\r\n\r\n    const backLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n    backLight.position.set(0, 6.4, -8);\r\n    scene.add(backLight);\r\n\r\n    const hemiLight = new THREE.HemisphereLight(0xe6efff, 0x7a5f4a, 0.62);\r\n    scene.add(hemiLight);\r\n\r\n    const floorTexture = new THREE.TextureLoader().load(textureUrl);\r\n    floorTexture.colorSpace = THREE.SRGBColorSpace;\r\n    floorTexture.wrapS = THREE.RepeatWrapping;\r\n    floorTexture.wrapT = THREE.RepeatWrapping;\r\n    floorTexture.repeat.set(8, 8);\r\n    floorTexture.anisotropy = Math.min(renderer.capabilities.getMaxAnisotropy(), isMobile ? 4 : 8);\r\n\r\n    const floorMaterial = new THREE.MeshStandardMaterial({\r\n      map: floorTexture,\r\n      roughness: 0.86,\r\n      metalness: 0.08,\r\n    });\r\n\r\n    const floorGeometry = new THREE.PlaneGeometry(19, 19, 1, 1);\r\n    const floor = new THREE.Mesh(floorGeometry, floorMaterial);\r\n    floor.rotation.x = -Math.PI / 2 + 0.055;\r\n    floor.position.y = stageVerticalOffset;\r\n    floor.receiveShadow = true;\r\n    scene.add(floor);\r\n\r\n    const frontEdgeGeometry = new THREE.BoxGeometry(19, 0.35, 0.85);\r\n    const frontEdgeMaterial = new THREE.MeshStandardMaterial({\r\n      color: 0x2a1b11,\r\n      roughness: 0.9,\r\n      metalness: 0,\r\n    });\r\n    const frontEdge = new THREE.Mesh(frontEdgeGeometry, frontEdgeMaterial);\r\n    frontEdge.position.set(0, -0.16 + stageVerticalOffset, 8.7);\r\n    frontEdge.receiveShadow = true;\r\n    scene.add(frontEdge);\r\n\r\n    const shadowCanvas = document.createElement('canvas');\r\n    shadowCanvas.width = 256;\r\n    shadowCanvas.height = 256;\r\n    const shadowCtx = shadowCanvas.getContext('2d');\r\n    if (shadowCtx) {\r\n      const gradient = shadowCtx.createRadialGradient(128, 128, 8, 128, 128, 118);\r\n      gradient.addColorStop(0, 'rgba(0, 0, 0, 0.72)');\r\n      gradient.addColorStop(0.62, 'rgba(0, 0, 0, 0.34)');\r\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\r\n      shadowCtx.fillStyle = gradient;\r\n      shadowCtx.fillRect(0, 0, 256, 256);\r\n    }\r\n\r\n    const shadowTexture = new THREE.CanvasTexture(shadowCanvas);\r\n    shadowTexture.colorSpace = THREE.SRGBColorSpace;\r\n    const shadowGeometry = new THREE.PlaneGeometry(1, 1);\r\n\r\n    const spriteTextureLoader = new THREE.TextureLoader();\r\n    const musicianSprites: Array<{\r\n      sprite: THREE.Sprite;\r\n      shadow: THREE.Mesh;\r\n      texture: THREE.Texture;\r\n      spriteMaterial: THREE.SpriteMaterial;\r\n      shadowMaterial: THREE.MeshBasicMaterial;\r\n    }> = [];\r\n\r\n    activeMusiciansRef.current.forEach((musician) => {\r\n      const basePosition = performerPositions[musician.instrument];\r\n      if (!basePosition) {\r\n        return;\r\n      }\r\n\r\n      const spriteTexture = spriteTextureLoader.load(musician.portraitSrc);\r\n      spriteTexture.colorSpace = THREE.SRGBColorSpace;\r\n\r\n      const spriteMaterial = new THREE.SpriteMaterial({\r\n        map: spriteTexture,\r\n        transparent: true,\r\n        depthWrite: false,\r\n        depthTest: false,\r\n      });\r\n\r\n      const sprite = new THREE.Sprite(spriteMaterial);\r\n      const [scaleX, scaleY] = performerSpriteScale[musician.instrument];\r\n      sprite.scale.set(scaleX, scaleY, 1);\r\n      sprite.center.set(0.5, 0.02);\r\n      sprite.position.set(basePosition.x, 0.11 + stageVerticalOffset, basePosition.z);\r\n      sprite.renderOrder = 5;\r\n      scene.add(sprite);\r\n\r\n      const shadowMaterial = new THREE.MeshBasicMaterial({\r\n        map: shadowTexture,\r\n        transparent: true,\r\n        opacity: 0.84,\r\n        depthWrite: false,\r\n        depthTest: false,\r\n      });\r\n      const shadow = new THREE.Mesh(shadowGeometry, shadowMaterial);\r\n      const [shadowWidth, shadowHeight] = performerShadowScale[musician.instrument];\r\n      shadow.scale.set(shadowWidth * 1.62, shadowHeight * 1.92, 1);\r\n      shadow.rotation.x = floor.rotation.x;\r\n      shadow.position.set(basePosition.x, 0.035 + stageVerticalOffset, basePosition.z - 0.2);\r\n      shadow.userData.baseX = shadow.position.x;\r\n      shadow.userData.baseZ = shadow.position.z;\r\n      shadow.renderOrder = 3;\r\n      scene.add(shadow);\r\n\r\n      musicianSprites.push({\r\n        sprite,\r\n        shadow,\r\n        texture: spriteTexture,\r\n        spriteMaterial,\r\n        shadowMaterial,\r\n      });\r\n    });\r\n\r\n    const standInGeometry = new THREE.CapsuleGeometry(0.35, 1.2, 2, 8);\r\n    const standInMaterial = new THREE.MeshStandardMaterial({\r\n      color: 0x1e1e1e,\r\n      transparent: true,\r\n      opacity: 0.04,\r\n      roughness: 1,\r\n      metalness: 0,\r\n    });\r\n\r\n    const performerStandIns: THREE.Mesh[] = [];\r\n    (Object.keys(performerPositions) as StagePerformerInstrument[]).forEach((instrument) => {\r\n      const position = performerPositions[instrument];\r\n      const standIn = new THREE.Mesh(standInGeometry, standInMaterial);\r\n      standIn.position.set(position.x, 1 + stageVerticalOffset, position.z);\r\n      standIn.castShadow = true;\r\n      standIn.receiveShadow = false;\r\n      performerStandIns.push(standIn);\r\n      scene.add(standIn);\r\n    });\r\n\r\n    const composerRenderTarget = !isMobile\r\n      ? new THREE.WebGLRenderTarget(1, 1, {\r\n          format: THREE.RGBAFormat,\r\n          depthBuffer: true,\r\n          stencilBuffer: false,\r\n        })\r\n      : null;\r\n\r\n    const composer = composerRenderTarget ? new EffectComposer(renderer, composerRenderTarget) : null;\r\n    const renderPass = composer ? new RenderPass(scene, camera) : null;\r\n    if (composer && renderPass) {\r\n      renderPass.clear = true;\r\n      renderPass.clearAlpha = 0;\r\n      composer.addPass(renderPass);\r\n    }\r\n    const bokehPass = composer\r\n      ? new BokehPass(scene, camera, {\r\n          focus: 8,\r\n          aperture: 0.000004,\r\n          maxblur: 0.00035,\r\n        })\r\n      : null;\r\n    if (composer && bokehPass) {\r\n      composer.addPass(bokehPass);\r\n    }\r\n\r\n    const resize = () => {\r\n      const { clientWidth, clientHeight } = container;\r\n      if (!clientWidth || !clientHeight) {\r\n        return;\r\n      }\r\n\r\n      renderer.setSize(clientWidth, clientHeight, false);\r\n      if (composer) {\r\n        composer.setSize(clientWidth, clientHeight);\r\n      }\r\n      camera.aspect = clientWidth / clientHeight;\r\n      camera.updateProjectionMatrix();\r\n      updateBackgroundPlaneScale();\r\n    };\r\n\r\n    resize();\r\n    const resizeObserver = new ResizeObserver(resize);\r\n    resizeObserver.observe(container);\r\n\r\n    const clock = new THREE.Clock();\r\n    let animationFrameId = 0;\r\n    const targetFps = isMobile ? 45 : 60;\r\n    let lastFrameTime = 0;\r\n    const cameraTarget = new THREE.Vector3();\r\n    const lookAtTarget = new THREE.Vector3();\r\n\r\n    const setFocusedInstrument = (instrument: StagePerformerInstrument | null) => {\r\n      currentFocusedInstrumentRef.current = instrument;\r\n    };\r\n\r\n    const rebuildShotQueue = () => {\r\n      shotQueueRef.current = buildShotQueue(\r\n        activeMusiciansRef.current.map((item) => item.instrument),\r\n        shotQueueCycleRef.current\r\n      );\r\n      shotQueueCycleRef.current += 1;\r\n      shotIndexRef.current = 0;\r\n    };\r\n\r\n    const applyNextShot = (elapsed: number, cameraObject: THREE.PerspectiveCamera) => {\r\n      const activeQueue = shotQueueRef.current;\r\n      if (!activeQueue.length) {\r\n        shotQueueRef.current = [generalShot];\r\n      }\r\n\r\n      const queue = shotQueueRef.current;\r\n      const nextIndex = shotIndexRef.current % queue.length;\r\n      const nextShot = queue[nextIndex];\r\n      shotIndexRef.current = (nextIndex + 1) % queue.length;\r\n\r\n      fromShotPosRef.current.copy(cameraObject.position);\r\n      fromShotLookRef.current.copy(currentLookRef.current);\r\n      fromShotFovRef.current = currentFovRef.current;\r\n\r\n      currentShotRef.current = nextShot;\r\n      setFocusedInstrument(nextShot.instrument);\r\n\r\n      shotStartedAtRef.current = elapsed;\r\n      if (nextShot.type === 'sweep') {\r\n        shotMoveDurationRef.current = 7.6;\r\n      } else if (nextShot.type === 'focus') {\r\n        shotMoveDurationRef.current = 3;\r\n      } else {\r\n        shotMoveDurationRef.current = 1.35;\r\n      }\r\n      shotEndsAtRef.current = elapsed + nextShot.duration;\r\n    };\r\n\r\n    const animate = () => {\r\n      const now = performance.now();\r\n      if (now - lastFrameTime < 1000 / targetFps) {\r\n        animationFrameId = window.requestAnimationFrame(animate);\r\n        return;\r\n      }\r\n      lastFrameTime = now;\r\n      const elapsed = clock.getElapsedTime();\r\n      const playing = isMusicPlayingRef.current;\r\n\r\n      frontKeyLight.position.x = Math.sin(elapsed * (playing ? 1.2 : 0.36)) * (playing ? 2.8 : 1.2);\r\n      frontKeyLight.position.y = 7 + Math.cos(elapsed * (playing ? 0.76 : 0.24)) * 0.45;\r\n      frontKeyLight.position.z = 9.1 + Math.sin(elapsed * (playing ? 0.54 : 0.18)) * 0.48;\r\n      frontKeyLight.target.position.set(frontKeyLight.position.x * 0.18, 1.1, -1.6);\r\n      frontKeyLight.target.updateMatrixWorld();\r\n\r\n      if (!isCameraMotionEnabledRef.current) {\r\n        camera.position.copy(generalShot.pos);\r\n        currentLookRef.current.copy(generalShot.look);\r\n        camera.up.set(0, 1, 0);\r\n        camera.lookAt(currentLookRef.current);\r\n        camera.fov = generalShot.fov;\r\n        camera.updateProjectionMatrix();\r\n        backgroundParallaxTarget.set(0, 0);\r\n        backgroundParallaxCurrent.set(0, 0);\r\n        updateBackgroundPlaneScale();\r\n        renderer.render(scene, camera);\r\n        animationFrameId = window.requestAnimationFrame(animate);\r\n        wasMusicPlayingRef.current = playing;\r\n        return;\r\n      }\r\n\r\n      if (!playing) {\r\n        if (wasMusicPlayingRef.current || currentShotRef.current.instrument !== null) {\r\n          fromShotPosRef.current.copy(camera.position);\r\n          fromShotLookRef.current.copy(currentLookRef.current);\r\n          fromShotFovRef.current = currentFovRef.current;\r\n          currentShotRef.current = generalShot;\r\n          setFocusedInstrument(null);\r\n          shotStartedAtRef.current = elapsed;\r\n          shotMoveDurationRef.current = 1.2;\r\n          shotEndsAtRef.current = elapsed + 1.2;\r\n          rebuildShotQueue();\r\n        }\r\n      } else if (!shotEndsAtRef.current || elapsed >= shotEndsAtRef.current) {\r\n        if (!shotQueueRef.current.length || shotIndexRef.current === 0) {\r\n          rebuildShotQueue();\r\n        }\r\n        applyNextShot(elapsed, camera);\r\n      }\r\n\r\n      const shot = currentShotRef.current;\r\n      const shotElapsed = Math.max(0, elapsed - shotStartedAtRef.current);\r\n      const moveDuration = Math.max(0.1, shotMoveDurationRef.current);\r\n      const moveProgress = Math.min(1, shotElapsed / moveDuration);\r\n      const easeProgress = moveProgress * moveProgress * (3 - 2 * moveProgress);\r\n      const isCloseShot = Boolean(shot.instrument);\r\n\r\n      if (playing && elapsed >= randomMotionRefreshAtRef.current) {\r\n        const nextWindow = isCloseShot\r\n          ? 1.6 + Math.random() * 1.8\r\n          : 2.4 + Math.random() * 2.6;\r\n        randomMotionRefreshAtRef.current = elapsed + nextWindow;\r\n\r\n        randomPosOffsetTargetRef.current.set(\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.2 : 0.4),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.08 : 0.16),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.18 : 0.34)\r\n        );\r\n\r\n        randomLookOffsetTargetRef.current.set(\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.12 : 0.24),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.05 : 0.1),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.1 : 0.16)\r\n        );\r\n\r\n      }\r\n\r\n      if (!playing || !isCloseShot) {\r\n        randomPosOffsetTargetRef.current.set(0, 0, 0);\r\n        randomLookOffsetTargetRef.current.set(0, 0, 0);\r\n      }\r\n\r\n      randomPosOffsetRef.current.lerp(randomPosOffsetTargetRef.current, isCloseShot ? 0.055 : 0.04);\r\n      randomLookOffsetRef.current.lerp(randomLookOffsetTargetRef.current, isCloseShot ? 0.065 : 0.05);\r\n\r\n      const handAmount = isCloseShot ? 0.024 : 0.015;\r\n\r\n      const targetPos = new THREE.Vector3(\r\n        shot.pos.x,\r\n        shot.pos.y,\r\n        shot.pos.z\r\n      );\r\n      const focusPosition = shot.instrument\r\n        ? performerPositions[shot.instrument]\r\n        : null;\r\n\r\n      const focusAnchor = focusPosition\r\n        ? new THREE.Vector3(\r\n          focusPosition.x,\r\n          focusPosition.y + 1.42,\r\n          focusPosition.z + 0.04\r\n        )\r\n        : null;\r\n\r\n      if (isCloseShot && focusAnchor) {\r\n        const shotDistanceToPortrait = Math.max(5.2, Math.min(6.7, shot.pos.distanceTo(focusAnchor)));\r\n        const closeDistance = shotDistanceToPortrait;\r\n        const shotDirection = new THREE.Vector3().subVectors(shot.pos, focusAnchor);\r\n        if (shotDirection.lengthSq() < 0.0001) {\r\n          shotDirection.set(0, 0.24, 1);\r\n        }\r\n        shotDirection.normalize();\r\n        targetPos.copy(focusAnchor).addScaledVector(shotDirection, closeDistance);\r\n        targetPos.y -= 0.72;\r\n      }\r\n\r\n      targetPos.x += Math.sin(elapsed * (isCloseShot ? 0.92 : 0.52)) * handAmount\r\n        + Math.sin(elapsed * 0.16) * (isCloseShot ? 0.12 : 0.16)\r\n        + (isCloseShot ? Math.sin(elapsed * 1.48) * 0.022 : 0)\r\n        + randomPosOffsetRef.current.x;\r\n      targetPos.y += Math.cos(elapsed * (isCloseShot ? 0.72 : 0.46)) * handAmount\r\n        + Math.cos(elapsed * 0.14) * (isCloseShot ? 0.06 : 0.07)\r\n        + randomPosOffsetRef.current.y;\r\n      targetPos.z += Math.sin(elapsed * (isCloseShot ? 0.62 : 0.4)) * handAmount\r\n        + Math.sin(elapsed * 0.11) * (isCloseShot ? 0.09 : 0.14)\r\n        + (isCloseShot ? Math.cos(elapsed * 1.22) * 0.018 : 0)\r\n        + randomPosOffsetRef.current.z;\r\n\r\n      const sideSway = Math.sin(elapsed * 0.42) * (isCloseShot ? 0.035 : 0.11);\r\n      const frontBackSway = Math.cos(elapsed * 0.31) * (isCloseShot ? 0.018 : 0.05);\r\n      targetPos.x += sideSway;\r\n      targetPos.z += frontBackSway;\r\n\r\n      if (!playing) {\r\n        const idleSwayX = Math.sin(elapsed * 0.24) * 0.06 + Math.sin(elapsed * 0.11) * 0.03;\r\n        const idleSwayY = Math.cos(elapsed * 0.2) * 0.028;\r\n        const idleSwayZ = Math.sin(elapsed * 0.18) * 0.04;\r\n        targetPos.x += idleSwayX;\r\n        targetPos.y += idleSwayY;\r\n        targetPos.z += idleSwayZ;\r\n      }\r\n\r\n      const targetLook = new THREE.Vector3(\r\n        (focusAnchor ? focusAnchor.x : shot.look.x)\r\n          + Math.sin(elapsed * 0.62) * (isCloseShot ? 0.009 : 0.005)\r\n          + Math.sin(elapsed * 0.42) * (isCloseShot ? 0.01 : 0.03)\r\n          + randomLookOffsetRef.current.x,\r\n        (focusAnchor ? focusAnchor.y - 0.2 : shot.look.y)\r\n          + Math.cos(elapsed * 0.41) * (isCloseShot ? 0.007 : 0.003)\r\n          + randomLookOffsetRef.current.y,\r\n        (focusAnchor ? focusAnchor.z : shot.look.z) + randomLookOffsetRef.current.z\r\n      );\r\n\r\n      if (!playing) {\r\n        targetLook.x += Math.sin(elapsed * 0.24) * 0.012;\r\n        targetLook.y += Math.cos(elapsed * 0.2) * 0.009;\r\n      }\r\n\r\n      targetLook.y += isCloseShot ? -0.14 : 0.3;\r\n\r\n      cameraTarget.lerpVectors(fromShotPosRef.current, targetPos, easeProgress);\r\n      lookAtTarget.lerpVectors(fromShotLookRef.current, targetLook, easeProgress);\r\n\r\n      camera.position.copy(cameraTarget);\r\n      currentLookRef.current.copy(lookAtTarget);\r\n      camera.up.set(0, 1, 0);\r\n      camera.lookAt(currentLookRef.current);\r\n\r\n      const sweepZoomBreath = shot.type === 'sweep'\r\n        ? Math.sin(elapsed * 0.34) * 0.9\r\n        : 0;\r\n      const targetFov = fromShotFovRef.current + ((shot.fov + sweepZoomBreath) - fromShotFovRef.current) * easeProgress;\r\n      currentFovRef.current += (targetFov - currentFovRef.current) * 0.12;\r\n      camera.fov = currentFovRef.current;\r\n      camera.updateProjectionMatrix();\r\n\r\n      backgroundParallaxTarget.set(\r\n        (camera.position.x - baseCameraPosition.x) * 0.2\r\n          + (currentLookRef.current.x - baseLookAtPosition.x) * 0.12,\r\n        (camera.position.y - baseCameraPosition.y) * 0.28\r\n          + (currentLookRef.current.y - baseLookAtPosition.y) * 0.08\r\n      );\r\n      backgroundParallaxTarget.x = THREE.MathUtils.clamp(\r\n        backgroundParallaxTarget.x,\r\n        -backgroundParallaxLimits.x,\r\n        backgroundParallaxLimits.x\r\n      );\r\n      backgroundParallaxTarget.y = THREE.MathUtils.clamp(\r\n        backgroundParallaxTarget.y,\r\n        -backgroundParallaxLimits.y,\r\n        backgroundParallaxLimits.y\r\n      );\r\n      backgroundParallaxCurrent.lerp(backgroundParallaxTarget, 0.045);\r\n      updateBackgroundPlaneScale();\r\n\r\n      if (bokehPass) {\r\n        const focusDistance = Math.max(1.2, Math.min(16, camera.position.distanceTo(currentLookRef.current)));\r\n        const closeStrengthRaw = isCloseShot ? 1 - (focusDistance - 2.3) / 5.8 : 0;\r\n        const closeStrength = Math.max(0, Math.min(1, closeStrengthRaw));\r\n        bokehPass.materialBokeh.uniforms.focus.value = focusDistance;\r\n        const smoothClose = closeStrength * closeStrength * (3 - 2 * closeStrength);\r\n        bokehPass.materialBokeh.uniforms.aperture.value = 0.0000013 + smoothClose * 0.0000022;\r\n        bokehPass.materialBokeh.uniforms.maxblur.value = 0.00008 + smoothClose * 0.00018;\r\n      }\r\n\r\n      if (elapsed - lastShadowFrameSentAtRef.current > 0.06) {\r\n        lastShadowFrameSentAtRef.current = elapsed;\r\n        const shadowDrift = frontKeyLight.position.x / 3.4;\r\n        musicianSprites.forEach(({ shadow, shadowMaterial }) => {\r\n          const baseShadowX = (shadow.userData.baseX as number) ?? shadow.position.x;\r\n          const baseShadowZ = (shadow.userData.baseZ as number) ?? shadow.position.z;\r\n          shadow.position.x = baseShadowX;\r\n          shadow.position.z = baseShadowZ;\r\n          shadowMaterial.opacity = 0.76 + Math.abs(shadowDrift) * 0.12;\r\n        });\r\n      }\r\n\r\n      renderer.render(scene, camera);\r\n      animationFrameId = window.requestAnimationFrame(animate);\r\n      wasMusicPlayingRef.current = playing;\r\n    };\r\n\r\n    animationFrameId = window.requestAnimationFrame(animate);\r\n\r\n    return () => {\r\n      window.cancelAnimationFrame(animationFrameId);\r\n      resizeObserver.disconnect();\r\n\r\n      floorGeometry.dispose();\r\n      floorMaterial.dispose();\r\n      floorTexture.dispose();\r\n      backgroundGeometry.dispose();\r\n      backgroundMaterial.dispose();\r\n      scene.remove(backgroundPlane);\r\n      standInGeometry.dispose();\r\n      standInMaterial.dispose();\r\n      frontEdgeGeometry.dispose();\r\n      frontEdgeMaterial.dispose();\r\n      shadowGeometry.dispose();\r\n      shadowTexture.dispose();\r\n      performerStandIns.forEach((standIn) => {\r\n        scene.remove(standIn);\r\n      });\r\n      musicianSprites.forEach(({ sprite, shadow, texture, spriteMaterial, shadowMaterial }) => {\r\n        scene.remove(sprite);\r\n        scene.remove(shadow);\r\n        texture.dispose();\r\n        spriteMaterial.dispose();\r\n        shadowMaterial.dispose();\r\n      });\r\n\r\n      setFocusedInstrument(null);\r\n      currentShotRef.current = generalShot;\r\n\r\n      composer?.dispose();\r\n      composerRenderTarget?.dispose();\r\n      if (sceneBackgroundVideoElement) {\r\n        sceneBackgroundVideoElement.pause();\r\n        sceneBackgroundVideoElement.src = '';\r\n        sceneBackgroundVideoElement.load();\r\n      }\r\n      if (sceneBackgroundTexture) {\r\n        sceneBackgroundTexture.dispose();\r\n      }\r\n\r\n      renderer.dispose();\r\n      renderer.forceContextLoss();\r\n      if (renderer.domElement.parentNode === container) {\r\n        container.removeChild(renderer.domElement);\r\n      }\r\n    };\r\n  }, [textureUrl, backgroundImageUrl, backgroundVideoUrl, activeMusiciansSignature]);\r\n\r\n  return <div className=\"stage-3d-layer\" ref={containerRef} aria-hidden=\"true\" />;\r\n};\r\n\r\nexport default Stage3DScene;\r\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFRElEQVR4nO2d3XLiNhiGuZhuzz3DcH1dSnbTNtlpUjbZDjJJzrJgHP7/HGwZY8A2JDnoLTTpicC9AnXkQJfNpN38WLZk9M5848zkJH4ekKXPjpxKiYiIiIiIiIiIiIiIiIiIvDDD4fB70zTLlmXdWZZ1a1lWGUL4hufzgRCSc7jTdf12MBiU+/0+m+czGo3SpmkuLMvC6xqNRqQW5HcpzmIYRtowjAWEEBuGgXVdx4PBAGuatuj3+2ydD4RQMk0TPQJ/Xf54PM6kOAmEUDIMAz2Ef3l5GZSmaX63281wAd+27aB4kQC/DR/3+33c7Xbjl/BU+KTG4zE5Mi0BPhF+r9cLqtPpxCfhufA3ikkJ8Jnwu90uEYBbrZbfaDQyXMCfTCZBsSYBvhB+u90mAnCz2YxOwmvhk5pOp+TosyDhtfBXAnC9XqcvISz4G+V7npfhHX6j0SACcK1W81VVzdBcZC3Cgu84TlDT6XTpOE46jnk+hHAZIvygLi4uFoqihL9YW61wQ4XvOA52XZccI5VAC361WiUCcKVS+Rz6H71qL4QO3/1SkQxHFIadr+CrqkoE/EVNAA34nucFRVtCFPBJKYryZ+h/vGVZJZrwPc/Ds9mMHJfz+TzN27Czhl+pVHC5XD6n8el5s2qsUYM/+1KhSogSvqIoi1Kp9F2KRmzblkajEaIJfz6fr8u/vr7O8DLsrOD7pVKJ7nVsLYEyfHx1dUXqVdeExMHflGDbNqIMH5OfZ7PZiyQkFv6mhMlkgijDxy+ZHSUe/kMJNOF79wKCtsVTekdbA39TwnQ6RTThO/cti292UbcO/qYEx3EQTfiT1VD3Xzd1thb+Oq7rBhJowh/f31Uj7ZCvJGw9/E0JrusimvBHq5U4kWCaZkbAfxDS1XRdd0kZPh4Oh9g0zWWE7YVluVxm63GU//smeJ6HKMPHBPzWjvlPkTCbzQIJAn6MEubzORKffAYkiGEnxtzc3Pz7TRBjfszXBHHBZWB2JGY7DKyYxVQzxmy2ssdinh+fBNu2g9ubYpEVowTLspBY4cYsYTgcItFeiDEQQglCGPTyRW8nJgFGRDdTzs/P//7xbdbJ5XJ8NdeSAj/3w9s/ctks3s3t+Lu7u9stAcYFf+cd/uWnn/GH/X3/cP9wOyUwAB8f/nqA87/l/ePj4+2SwAr8j/mP+PdPnzAAwD89Pd0OCQzCxycnJ7hYLPqFQiHZEhiGj0nJspxcCRzAx6tKngSO4OPESeAQPk6MBI7hY+4lJAA+5lZCguBj7iRE/azmDmms0YUfFABgCQBg+9HEOB6UzWaz0vudd4gmfC6+CXE+pbz3fk/6sLeHKMNnVwILj4gfHBxI+XweUYbPngQW4K9zdHQkAQAQZfjsSGAJ/jpnZ2dSsVhElOHHL4FF+OsAACRZllEEAuKRwDL8xEvgAX5iJfAEP3ESyJ5xj+2lzMM/xAEA0mQlG5GERbFYDH/PuNUu4tzBj0MCACD8PePIFu68DDsMDEfh7xmn6/odz/AjlhD+nnG6rpd4G3biGo4AAOHvGUfeHEFeXsA7/AgkLAqFAp094zRNkzRNQ7wNOxEOR/TXAkRCr9dDvMOnICG61TCR0Ol0EO/wQ5QQfT+o3W5LrVYL8Q4/BAnxdUSJhGaziXiH/woJ8d8TIBLq9TriHf4LJMQPf51qtSrVajXEO/xnSGAH/jrVajVNXl7w2F7K3Ow09WCdQOb0j83zmX08hbw5QlXVkqqqt4qikPpMbSPrCEK6mrIsl2RZviVFmmzUFlkiIiIiIiIiIiIiIiIiIqltyD83ZUIdSGxX9gAAAABJRU5ErkJggg==\"","import React from 'react';\r\nimport './StageMapModal.css';\r\nimport iconFechar from '../../rsc/images/icons/Icone_fechar.png';\r\n\r\ntype StageMapEntry = {\r\n  id: number;\r\n  name: string;\r\n  badgeUrl: string;\r\n  bannerUrl: string | null;\r\n  backgroundUrl: string | null;\r\n  ticketPrice: number;\r\n  capacity: number;\r\n  maxRevenue: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\ntype StageMapModalProps = {\r\n  isVisible: boolean;\r\n  mapImageUrl: string;\r\n  iconFansWhite: string;\r\n  iconIngressoWhite: string;\r\n  iconValorCacheTotal: string;\r\n  stages: StageMapEntry[];\r\n  currentStageId: number;\r\n  isEmbedded?: boolean;\r\n  introImageUrl?: string;\r\n  bandName?: string;\r\n  bandLogoUrl?: string;\r\n  introPlayId?: number;\r\n  resetViewToken?: number;\r\n  onIntroVisibilityChange?: (isVisible: boolean) => void;\r\n  onPreviewStageBannerChange?: (bannerUrl: string | null) => void;\r\n  onStageTransitionStart?: () => void;\r\n  onClose: () => void;\r\n  onSelectStage: (stageId: number) => void;\r\n};\r\nconst STAGE_SELECT_TRANSITION_MS = 1800;\r\nconst STAGE_MAP_CLOSE_FADE_MS = 620;\r\nconst STAGE_BLACKOUT_START_PROGRESS = 0.68;\r\nconst STAGE_SELECT_ZOOM_MULTIPLIER = 1.75;\r\nconst STAGE_SELECT_FINAL_BLACK_HOLD_MS = 120;\r\nconst STAGE_PREVIEW_EXIT_MS = 260;\r\nconst TOUCH_SCROLL_DAMPING = 0.52;\r\n\r\nconst StageMapModal: React.FC<StageMapModalProps> = ({\r\n  isVisible,\r\n  mapImageUrl,\r\n  iconFansWhite,\r\n  iconIngressoWhite,\r\n  iconValorCacheTotal,\r\n  stages,\r\n  currentStageId,\r\n  isEmbedded = false,\r\n  introImageUrl,\r\n  bandName,\r\n  bandLogoUrl,\r\n  introPlayId,\r\n  resetViewToken,\r\n  onIntroVisibilityChange,\r\n  onPreviewStageBannerChange,\r\n  onStageTransitionStart,\r\n  onClose,\r\n  onSelectStage,\r\n}) => {\r\n  const initialScaleMultiplier = 1.4;\r\n  const mapImageRef = React.useRef<HTMLImageElement | null>(null);\r\n  const mapScrollRef = React.useRef<HTMLDivElement | null>(null);\r\n  const hasInitializedOpenViewRef = React.useRef(false);\r\n  const [imageSize, setImageSize] = React.useState({ width: 0, height: 0 });\r\n  const [mapScale, setMapScale] = React.useState(1);\r\n  const mapScaleRef = React.useRef(1);\r\n  const pinchStartDistanceRef = React.useRef<number | null>(null);\r\n  const pinchStartScaleRef = React.useRef(1);\r\n  const touchPanLastPointRef = React.useRef<{ x: number; y: number } | null>(null);\r\n  const [shouldRender, setShouldRender] = React.useState(isVisible);\r\n  const [isClosing, setIsClosing] = React.useState(false);\r\n  const [isStageTransitioning, setIsStageTransitioning] = React.useState(false);\r\n  const [transitionOverlayOpacity, setTransitionOverlayOpacity] = React.useState(0);\r\n  const [previewStage, setPreviewStage] = React.useState<StageMapEntry | null>(null);\r\n  const [isPreviewClosing, setIsPreviewClosing] = React.useState(false);\r\n  const previewCloseTimeoutRef = React.useRef<number | null>(null);\r\n  const transitionFrameRef = React.useRef<number | null>(null);\r\n  const transitionTimeoutRef = React.useRef<number | null>(null);\r\n  const introHoldTimeoutRef = React.useRef<number | null>(null);\r\n  const introHideTimeoutRef = React.useRef<number | null>(null);\r\n  const lastIntroPlayIdRef = React.useRef<number | null>(null);\r\n  const [introPhase, setIntroPhase] = React.useState<'hidden' | 'show' | 'leaving'>(() =>\r\n    isVisible && introImageUrl && introPlayId && introPlayId > 0 ? 'show' : 'hidden',\r\n  );\r\n\r\n  const getClampedScrollPosition = React.useCallback((\r\n    scrollContainer: HTMLDivElement,\r\n    left: number,\r\n    top: number,\r\n    scale = mapScaleRef.current,\r\n  ) => {\r\n    const renderedWidth = imageSize.width > 0 ? imageSize.width * scale : scrollContainer.scrollWidth;\r\n    const renderedHeight = imageSize.height > 0 ? imageSize.height * scale : scrollContainer.scrollHeight;\r\n    const maxScrollLeft = Math.max(0, renderedWidth - scrollContainer.clientWidth);\r\n    const maxScrollTop = Math.max(0, renderedHeight - scrollContainer.clientHeight);\r\n\r\n    return {\r\n      left: Math.max(0, Math.min(maxScrollLeft, left)),\r\n      top: Math.max(0, Math.min(maxScrollTop, top)),\r\n    };\r\n  }, [imageSize]);\r\n\r\n  React.useEffect(() => {\r\n    mapScaleRef.current = mapScale;\r\n  }, [mapScale]);\r\n\r\n  React.useEffect(() => {\r\n    if (!isVisible) {\r\n      if (previewCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(previewCloseTimeoutRef.current);\r\n        previewCloseTimeoutRef.current = null;\r\n      }\r\n      setPreviewStage(null);\r\n      setIsPreviewClosing(false);\r\n    }\r\n  }, [isVisible]);\r\n\r\n  React.useEffect(() => {\r\n    onPreviewStageBannerChange?.(previewStage?.backgroundUrl ?? null);\r\n  }, [previewStage, onPreviewStageBannerChange]);\r\n\r\n  const closePreviewWithAnimation = React.useCallback(\r\n    (afterClose?: () => void) => {\r\n      if (!previewStage) {\r\n        return;\r\n      }\r\n\r\n      if (previewCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(previewCloseTimeoutRef.current);\r\n        previewCloseTimeoutRef.current = null;\r\n      }\r\n\r\n      setIsPreviewClosing(true);\r\n      previewCloseTimeoutRef.current = window.setTimeout(() => {\r\n        previewCloseTimeoutRef.current = null;\r\n        setPreviewStage(null);\r\n        setIsPreviewClosing(false);\r\n        afterClose?.();\r\n      }, STAGE_PREVIEW_EXIT_MS);\r\n    },\r\n    [previewStage]\r\n  );\r\n\r\n  const minScale = React.useMemo(() => {\r\n    if (imageSize.height <= 0 || imageSize.width <= 0 || !mapScrollRef.current) {\r\n      return 0.2;\r\n    }\r\n\r\n    const containerWidth = mapScrollRef.current.clientWidth;\r\n    const containerHeight = mapScrollRef.current.clientHeight;\r\n    if (!containerWidth || !containerHeight) {\r\n      return 0.2;\r\n    }\r\n\r\n    const fitHeightScale = containerHeight / imageSize.height;\r\n    const fitWidthScale = containerWidth / imageSize.width;\r\n    const coverScale = Math.max(fitHeightScale, fitWidthScale);\r\n\r\n    return Math.max(0.2, coverScale);\r\n  }, [imageSize]);\r\n\r\n  React.useLayoutEffect(() => {\r\n    setMapScale((current) => Math.max(minScale, Math.min(4, current)));\r\n  }, [minScale]);\r\n\r\n  const getTouchDistance = (touches: React.TouchList) => {\r\n    if (touches.length < 2) {\r\n      return null;\r\n    }\r\n\r\n    const first = touches[0];\r\n    const second = touches[1];\r\n    const dx = second.clientX - first.clientX;\r\n    const dy = second.clientY - first.clientY;\r\n    return Math.hypot(dx, dy);\r\n  };\r\n\r\n  const handleTouchStart = (event: React.TouchEvent<HTMLDivElement>) => {\r\n    if (event.touches.length === 1) {\r\n      const touch = event.touches[0];\r\n      touchPanLastPointRef.current = { x: touch.clientX, y: touch.clientY };\r\n    }\r\n\r\n    const distance = getTouchDistance(event.touches);\r\n    if (!distance) {\r\n      return;\r\n    }\r\n\r\n    pinchStartDistanceRef.current = distance;\r\n    pinchStartScaleRef.current = mapScale;\r\n  };\r\n\r\n  const handleTouchMove = (event: React.TouchEvent<HTMLDivElement>) => {\r\n    const scrollContainer = mapScrollRef.current;\r\n    if (event.touches.length === 1 && pinchStartDistanceRef.current === null && scrollContainer) {\r\n      const touch = event.touches[0];\r\n      const previousTouch = touchPanLastPointRef.current;\r\n      if (previousTouch) {\r\n        const deltaX = (touch.clientX - previousTouch.x) * TOUCH_SCROLL_DAMPING;\r\n        const deltaY = (touch.clientY - previousTouch.y) * TOUCH_SCROLL_DAMPING;\r\n\r\n        const targetLeft = scrollContainer.scrollLeft - deltaX;\r\n        const targetTop = scrollContainer.scrollTop - deltaY;\r\n        const clampedPosition = getClampedScrollPosition(scrollContainer, targetLeft, targetTop);\r\n\r\n        if (event.cancelable) {\r\n          event.preventDefault();\r\n        }\r\n        scrollContainer.scrollLeft = clampedPosition.left;\r\n        scrollContainer.scrollTop = clampedPosition.top;\r\n      }\r\n\r\n      touchPanLastPointRef.current = { x: touch.clientX, y: touch.clientY };\r\n      return;\r\n    }\r\n\r\n    const distance = getTouchDistance(event.touches);\r\n    const startDistance = pinchStartDistanceRef.current;\r\n    if (!distance || !startDistance) {\r\n      return;\r\n    }\r\n\r\n    if (event.cancelable) {\r\n      event.preventDefault();\r\n    }\r\n    const pinchRatio = distance / startDistance;\r\n    const nextScale = pinchStartScaleRef.current * pinchRatio;\r\n    setMapScale(Math.max(minScale, Math.min(4, nextScale)));\r\n  };\r\n\r\n  const handleTouchEnd = (event: React.TouchEvent<HTMLDivElement>) => {\r\n    if (event.touches.length === 0) {\r\n      touchPanLastPointRef.current = null;\r\n    }\r\n\r\n    if (event.touches.length < 2) {\r\n      pinchStartDistanceRef.current = null;\r\n      return;\r\n    }\r\n\r\n    const distance = getTouchDistance(event.touches);\r\n    if (!distance) {\r\n      return;\r\n    }\r\n\r\n    pinchStartDistanceRef.current = distance;\r\n    pinchStartScaleRef.current = mapScale;\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (isVisible) {\r\n      setShouldRender(true);\r\n      setIsClosing(false);\r\n      setIsStageTransitioning(false);\r\n      setTransitionOverlayOpacity(0);\r\n      hasInitializedOpenViewRef.current = false;\r\n      return;\r\n    }\r\n\r\n    if (!shouldRender) {\r\n      return;\r\n    }\r\n\r\n    setIsClosing(true);\r\n    const timeoutId = window.setTimeout(() => {\r\n      setShouldRender(false);\r\n      setIsClosing(false);\r\n    }, STAGE_MAP_CLOSE_FADE_MS);\r\n\r\n    return () => {\r\n      window.clearTimeout(timeoutId);\r\n    };\r\n  }, [isVisible, shouldRender]);\r\n\r\n  React.useEffect(() => {\r\n    const clearIntroTimers = () => {\r\n      if (introHoldTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHoldTimeoutRef.current);\r\n        introHoldTimeoutRef.current = null;\r\n      }\r\n      if (introHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHideTimeoutRef.current);\r\n        introHideTimeoutRef.current = null;\r\n      }\r\n    };\r\n\r\n    if (\r\n      isVisible &&\r\n      introImageUrl &&\r\n      introPlayId &&\r\n      introPlayId > 0 &&\r\n      introPlayId !== lastIntroPlayIdRef.current\r\n    ) {\r\n      lastIntroPlayIdRef.current = introPlayId;\r\n      clearIntroTimers();\r\n      setIntroPhase('show');\r\n      introHoldTimeoutRef.current = window.setTimeout(() => {\r\n        setIntroPhase('leaving');\r\n        introHideTimeoutRef.current = window.setTimeout(() => {\r\n          setIntroPhase('hidden');\r\n        }, 1000); // out animation\r\n      }, 2000); // steady hold after 1s in\r\n    } else {\r\n      clearIntroTimers();\r\n      setIntroPhase('hidden');\r\n    }\r\n  }, [isVisible, introImageUrl, introPlayId]);\r\n\r\n  React.useEffect(() => {\r\n    onIntroVisibilityChange?.(introPhase !== 'hidden');\r\n  }, [introPhase, onIntroVisibilityChange]);\r\n\r\n  React.useEffect(() => {\r\n    if (!isVisible || imageSize.width <= 0 || imageSize.height <= 0 || !mapScrollRef.current) {\r\n      return;\r\n    }\r\n\r\n    hasInitializedOpenViewRef.current = false;\r\n\r\n    const scrollContainer = mapScrollRef.current;\r\n    const defaultScale = Math.max(minScale, Math.min(4, minScale * initialScaleMultiplier));\r\n    setMapScale(defaultScale);\r\n\r\n    const renderedWidth = imageSize.width * defaultScale;\r\n    const renderedHeight = imageSize.height * defaultScale;\r\n    const defaultLeft = Math.max(0, (renderedWidth - scrollContainer.clientWidth) / 2);\r\n    const defaultTop = Math.max(0, (renderedHeight - scrollContainer.clientHeight) / 2);\r\n    const clampedPosition = getClampedScrollPosition(scrollContainer, defaultLeft, defaultTop, defaultScale);\r\n\r\n    scrollContainer.scrollTo({\r\n      left: clampedPosition.left,\r\n      top: clampedPosition.top,\r\n      behavior: 'auto',\r\n    });\r\n    touchPanLastPointRef.current = null;\r\n    pinchStartDistanceRef.current = null;\r\n    pinchStartScaleRef.current = defaultScale;\r\n  }, [resetViewToken, isVisible, imageSize, minScale, getClampedScrollPosition]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (transitionFrameRef.current !== null) {\r\n        window.cancelAnimationFrame(transitionFrameRef.current);\r\n      }\r\n      if (transitionTimeoutRef.current !== null) {\r\n        window.clearTimeout(transitionTimeoutRef.current);\r\n      }\r\n      if (previewCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(previewCloseTimeoutRef.current);\r\n      }\r\n      if (introHoldTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHoldTimeoutRef.current);\r\n      }\r\n      if (introHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHideTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (\r\n      !isVisible ||\r\n      !shouldRender ||\r\n      hasInitializedOpenViewRef.current ||\r\n      imageSize.width <= 0 ||\r\n      imageSize.height <= 0\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const scrollContainer = mapScrollRef.current;\r\n    if (!scrollContainer) {\r\n      return;\r\n    }\r\n\r\n    const defaultScale = Math.max(minScale, Math.min(4, minScale * initialScaleMultiplier));\r\n    const targetScale = defaultScale;\r\n\r\n    if (Math.abs(mapScale - targetScale) > 0.001) {\r\n      setMapScale(targetScale);\r\n      return;\r\n    }\r\n\r\n    const frameId = window.requestAnimationFrame(() => {\r\n      const renderedWidth = imageSize.width * mapScale;\r\n      const renderedHeight = imageSize.height * mapScale;\r\n\r\n      const defaultLeft = Math.max(0, (renderedWidth - scrollContainer.clientWidth) / 2);\r\n      const defaultTop = Math.max(0, (renderedHeight - scrollContainer.clientHeight) / 2);\r\n      const clampedPosition = getClampedScrollPosition(scrollContainer, defaultLeft, defaultTop);\r\n\r\n      scrollContainer.scrollTo({\r\n        left: clampedPosition.left,\r\n        top: clampedPosition.top,\r\n        behavior: 'auto',\r\n      });\r\n      hasInitializedOpenViewRef.current = true;\r\n    });\r\n\r\n    return () => {\r\n      window.cancelAnimationFrame(frameId);\r\n    };\r\n  }, [isVisible, shouldRender, imageSize, minScale, mapScale, getClampedScrollPosition]);\r\n\r\n  const handleMapScroll = (event: React.UIEvent<HTMLDivElement>) => {\r\n    if (isStageTransitioning) {\r\n      return;\r\n    }\r\n\r\n    const scrollContainer = event.currentTarget;\r\n    const clampedPosition = getClampedScrollPosition(scrollContainer, scrollContainer.scrollLeft, scrollContainer.scrollTop);\r\n\r\n    if (Math.abs(clampedPosition.left - scrollContainer.scrollLeft) > 0.5) {\r\n      scrollContainer.scrollLeft = clampedPosition.left;\r\n    }\r\n    if (Math.abs(clampedPosition.top - scrollContainer.scrollTop) > 0.5) {\r\n      scrollContainer.scrollTop = clampedPosition.top;\r\n    }\r\n\r\n  };\r\n\r\n  const handleCloseModal = React.useCallback(() => {\r\n    if (previewCloseTimeoutRef.current !== null) {\r\n      window.clearTimeout(previewCloseTimeoutRef.current);\r\n      previewCloseTimeoutRef.current = null;\r\n    }\r\n    setPreviewStage(null);\r\n    setIsPreviewClosing(false);\r\n    onClose();\r\n  }, [onClose]);\r\n\r\n  const handleSelectStageWithTransition = (stage: StageMapEntry) => {\r\n    if (isStageTransitioning) {\r\n      return;\r\n    }\r\n\r\n    const scrollContainer = mapScrollRef.current;\r\n    if (!scrollContainer || imageSize.width <= 0 || imageSize.height <= 0) {\r\n      onStageTransitionStart?.();\r\n      setIsPreviewClosing(false);\r\n      setPreviewStage(null);\r\n      onSelectStage(stage.id);\r\n      if (!isEmbedded) {\r\n        onClose();\r\n      }\r\n      setIsStageTransitioning(false);\r\n      setTransitionOverlayOpacity(0);\r\n      return;\r\n    }\r\n\r\n    if (transitionFrameRef.current !== null) {\r\n      window.cancelAnimationFrame(transitionFrameRef.current);\r\n      transitionFrameRef.current = null;\r\n    }\r\n    if (transitionTimeoutRef.current !== null) {\r\n      window.clearTimeout(transitionTimeoutRef.current);\r\n      transitionTimeoutRef.current = null;\r\n    }\r\n\r\n    onStageTransitionStart?.();\r\n    setIsStageTransitioning(true);\r\n    setTransitionOverlayOpacity(0);\r\n\r\n    const startScale = mapScale;\r\n    const startLeft = scrollContainer.scrollLeft;\r\n    const startTop = scrollContainer.scrollTop;\r\n    const targetScale = Math.max(minScale, Math.min(4, Math.max(mapScale * STAGE_SELECT_ZOOM_MULTIPLIER, minScale * 2.05)));\r\n\r\n    const targetPointX = (stage.x / 100) * imageSize.width * targetScale;\r\n    const targetPointY = (stage.y / 100) * imageSize.height * targetScale;\r\n    const requestedLeft = targetPointX - scrollContainer.clientWidth / 2;\r\n    const requestedTop = targetPointY - scrollContainer.clientHeight / 2;\r\n    const targetPosition = getClampedScrollPosition(scrollContainer, requestedLeft, requestedTop, targetScale);\r\n\r\n    const animationStart = performance.now();\r\n    const easeInOutCubic = (value: number) => (value < 0.5 ? 4 * value * value * value : 1 - Math.pow(-2 * value + 2, 3) / 2);\r\n\r\n    const animate = (now: number) => {\r\n      const elapsed = now - animationStart;\r\n      const progress = Math.min(1, elapsed / STAGE_SELECT_TRANSITION_MS);\r\n      const easedProgress = easeInOutCubic(progress);\r\n      const blackoutProgress = Math.max(0, (easedProgress - STAGE_BLACKOUT_START_PROGRESS) / (1 - STAGE_BLACKOUT_START_PROGRESS));\r\n\r\n      const nextScale = startScale + (targetScale - startScale) * easedProgress;\r\n      const nextLeft = startLeft + (targetPosition.left - startLeft) * easedProgress;\r\n      const nextTop = startTop + (targetPosition.top - startTop) * easedProgress;\r\n      const nextOverlayOpacity = Math.max(0, Math.min(1, blackoutProgress));\r\n\r\n      mapScaleRef.current = nextScale;\r\n      setMapScale(nextScale);\r\n      setTransitionOverlayOpacity(nextOverlayOpacity);\r\n      scrollContainer.scrollTo({\r\n        left: nextLeft,\r\n        top: nextTop,\r\n        behavior: 'auto',\r\n      });\r\n\r\n      if (progress < 1) {\r\n        transitionFrameRef.current = window.requestAnimationFrame(animate);\r\n        return;\r\n      }\r\n\r\n      transitionFrameRef.current = null;\r\n      setTransitionOverlayOpacity(1);\r\n      transitionTimeoutRef.current = window.setTimeout(() => {\r\n        setPreviewStage(null);\r\n        setIsPreviewClosing(false);\r\n        onSelectStage(stage.id);\r\n        if (!isEmbedded) {\r\n          onClose();\r\n        }\r\n        setIsStageTransitioning(false);\r\n        setTransitionOverlayOpacity(0);\r\n      }, STAGE_SELECT_FINAL_BLACK_HOLD_MS);\r\n    };\r\n\r\n    transitionFrameRef.current = window.requestAnimationFrame(animate);\r\n  };\r\n\r\n  const markersToRender = stages.map((stage) => ({\r\n    ...stage,\r\n    renderX: imageSize.width > 0 ? ((stage.x / 100) * imageSize.width) * mapScale : 0,\r\n    renderY: imageSize.height > 0 ? ((stage.y / 100) * imageSize.height) * mapScale : 0,\r\n  }));\r\n\r\n  if (!shouldRender) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <aside\r\n      className={`stage-map-modal${introPhase !== 'hidden' ? ' has-intro' : ''}${isClosing ? ' is-closing' : ''}${isStageTransitioning ? ' is-stage-transitioning' : ''}${isEmbedded ? ' is-embedded' : ''}`}\r\n      role={isEmbedded ? undefined : 'dialog'}\r\n      aria-modal={isEmbedded ? undefined : true}\r\n      aria-label=\"Mapa da cidade\"\r\n    >\r\n      {!isEmbedded ? (\r\n        <button type=\"button\" className=\"stage-map-backdrop\" onClick={handleCloseModal} aria-label=\"Fechar mapa\" disabled={isStageTransitioning} />\r\n      ) : null}\r\n      <div className=\"stage-map-card\">\r\n        {introPhase !== 'hidden' && introImageUrl ? (\r\n          <div className={`stage-map-intro${introPhase === 'leaving' ? ' leaving' : ''}`} style={{ backgroundImage: `url(${introImageUrl})` }} aria-hidden=\"true\">\r\n            <div className=\"stage-map-intro-scrim\" />\r\n            <div className={`stage-map-intro-card${introPhase === 'leaving' ? ' leaving' : ''}`}>\r\n              {bandLogoUrl ? <img src={bandLogoUrl} alt=\"Logo da banda\" className=\"stage-map-intro-logo\" /> : null}\r\n              {bandName ? <strong className=\"stage-map-intro-name\">{bandName}</strong> : null}\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n        {!isEmbedded ? (\r\n          <button type=\"button\" className=\"stage-map-close\" onClick={handleCloseModal} aria-label=\"Fechar mapa\" disabled={isStageTransitioning}>\r\n            Fechar mapa\r\n          </button>\r\n        ) : null}\r\n        <div className=\"stage-map-transition-overlay\" style={{ opacity: transitionOverlayOpacity }} aria-hidden=\"true\" />\r\n\r\n        <div\r\n          ref={mapScrollRef}\r\n          className=\"stage-map-scroll\"\r\n          onScroll={handleMapScroll}\r\n          onTouchStart={handleTouchStart}\r\n          onTouchMove={handleTouchMove}\r\n          onTouchEnd={handleTouchEnd}\r\n          onTouchCancel={handleTouchEnd}\r\n        >\r\n          <div\r\n            className=\"stage-map-world\"\r\n            style={{\r\n              width: imageSize.width > 0 ? `${imageSize.width * mapScale}px` : 'max-content',\r\n              height: imageSize.height > 0 ? `${imageSize.height * mapScale}px` : 'auto',\r\n            }}\r\n          >\r\n            <img\r\n              ref={mapImageRef}\r\n              src={mapImageUrl}\r\n              alt=\"Mapa da cidade\"\r\n              className=\"stage-map-image\"\r\n              style={{\r\n                width: imageSize.width > 0 ? `${imageSize.width * mapScale}px` : 'auto',\r\n                height: imageSize.height > 0 ? `${imageSize.height * mapScale}px` : 'auto',\r\n              }}\r\n              onLoad={(event) => {\r\n                const image = event.currentTarget;\r\n                setImageSize({ width: image.naturalWidth, height: image.naturalHeight });\r\n              }}\r\n            />\r\n          {markersToRender.map((marker) => {\r\n            const isActive = marker.id === currentStageId;\r\n            return (\r\n              <button\r\n                key={marker.id}\r\n                type=\"button\"\r\n                className={`stage-map-point${isActive ? ' is-active' : ''}`}\r\n                style={{ left: `${marker.renderX}px`, top: `${marker.renderY}px` }}\r\n                onClick={(event) => {\r\n                  event.stopPropagation();\r\n                  if (previewCloseTimeoutRef.current !== null) {\r\n                    window.clearTimeout(previewCloseTimeoutRef.current);\r\n                    previewCloseTimeoutRef.current = null;\r\n                  }\r\n                  setIsPreviewClosing(false);\r\n                  setPreviewStage(marker);\r\n                }}\r\n                title={marker.name}\r\n                aria-label={`Ir para ${marker.name}`}\r\n                disabled={isStageTransitioning}\r\n              >\r\n                <img src={marker.badgeUrl} alt={marker.name} />\r\n                <span>{marker.name}</span>\r\n              </button>\r\n            );\r\n          })}\r\n          </div>\r\n        </div>\r\n        {previewStage && !isStageTransitioning ? (\r\n          <div className={`stage-map-preview${isStageTransitioning ? ' is-transitioning' : ''}${isPreviewClosing ? ' is-closing' : ''}`}>\r\n            <div\r\n              className=\"stage-map-preview-card\"\r\n              style={(previewStage.backgroundUrl ?? previewStage.bannerUrl)\r\n                ? { backgroundImage: `linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.35) 60%), url(${previewStage.backgroundUrl ?? previewStage.bannerUrl})` }\r\n                : undefined}\r\n            >\r\n              <div className=\"stage-map-preview-top\">\r\n                <div className=\"stage-map-preview-identity\">\r\n                  {previewStage.badgeUrl ? (\r\n                    <div className=\"stage-map-preview-badge\" aria-hidden=\"true\">\r\n                      <img src={previewStage.badgeUrl} alt=\"\" />\r\n                    </div>\r\n                  ) : null}\r\n                  <div className=\"stage-map-preview-title\">\r\n                    <span>{previewStage.name}</span>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"stage-map-preview-close\"\r\n                  onClick={() => closePreviewWithAnimation()}\r\n                  aria-label=\"Fechar\"\r\n                  disabled={isStageTransitioning}\r\n                >\r\n                  <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"stage-map-preview-close-icon\" />\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"stage-map-preview-stats\">\r\n                <div className=\"stage-map-preview-stat\">\r\n                  <img src={iconFansWhite} alt=\"Público\" className=\"stage-map-preview-stat-icon\" />\r\n                  <div>\r\n                    <span>Lotação</span>\r\n                    <strong>{previewStage.capacity.toLocaleString('pt-BR')}</strong>\r\n                  </div>\r\n                </div>\r\n                <div className=\"stage-map-preview-stat\">\r\n                  <img src={iconIngressoWhite} alt=\"Ingresso\" className=\"stage-map-preview-stat-icon\" />\r\n                  <div>\r\n                    <span>Ingresso</span>\r\n                    <strong>R$ {previewStage.ticketPrice.toLocaleString('pt-BR')}</strong>\r\n                  </div>\r\n                </div>\r\n                <div className=\"stage-map-preview-stat\">\r\n                  <img src={iconValorCacheTotal} alt=\"Receita\" className=\"stage-map-preview-stat-icon\" />\r\n                  <div>\r\n                    <span>Receita máx.</span>\r\n                    <strong>R$ {previewStage.maxRevenue.toLocaleString('pt-BR')}</strong>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"stage-map-preview-actions\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"stage-map-preview-go\"\r\n                  onClick={() => {\r\n                    if (!previewStage || isStageTransitioning) return;\r\n                    const stageToGo = previewStage;\r\n                    closePreviewWithAnimation(() => handleSelectStageWithTransition(stageToGo));\r\n                  }}\r\n                  disabled={isStageTransitioning}\r\n                  aria-label={`Ir para ${previewStage.name}`}\r\n                  data-click-sfx=\"confirm\"\r\n                >\r\n                  Ir para o palco\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n        </div>\r\n    </aside>\r\n  );\r\n};\r\n\r\nexport default StageMapModal;\r\n","import { useCallback, useEffect, useRef, useState, type MutableRefObject } from 'react';\r\nimport type { Instrument } from '../state/gameStore';\r\n\r\ntype ActiveScreen = 'band' | 'musicians';\r\n\r\ntype UseBandScreensStateOptions<TMusician> = {\r\n  musiciansModalCloseMs: number;\r\n  musicianDetailsCloseMs: number;\r\n  bandModalCloseMs: number;\r\n  bandConfigCloseMs: number;\r\n  onStoryToggleSound?: (isOpening: boolean) => void;\r\n};\r\n\r\nconst useBandScreensState = <TMusician,>({\r\n  musiciansModalCloseMs,\r\n  musicianDetailsCloseMs,\r\n  bandModalCloseMs,\r\n  bandConfigCloseMs,\r\n  onStoryToggleSound,\r\n}: UseBandScreensStateOptions<TMusician>) => {\r\n  const [activeScreen, setActiveScreen] = useState<ActiveScreen>('band');\r\n  const [isClosingMusiciansScreen, setIsClosingMusiciansScreen] = useState(false);\r\n  const [selectedMusicianDetails, setSelectedMusicianDetails] = useState<TMusician | null>(null);\r\n  const [isMusicianStoryOpen, setIsMusicianStoryOpen] = useState(false);\r\n  const [isClosingMusicianDetails, setIsClosingMusicianDetails] = useState(false);\r\n  const [isBandConfigOpen, setIsBandConfigOpen] = useState(false);\r\n  const [isClosingBandConfig, setIsClosingBandConfig] = useState(false);\r\n  const [isBandManagementOpen, setIsBandManagementOpen] = useState(false);\r\n  const [isClosingBandManagement, setIsClosingBandManagement] = useState(false);\r\n  const [activeBandSelectorInstrument, setActiveBandSelectorInstrument] = useState<Instrument | null>(null);\r\n\r\n  const musiciansCloseTimeoutRef = useRef<number | null>(null);\r\n  const musicianDetailsCloseTimeoutRef = useRef<number | null>(null);\r\n  const bandManagementCloseTimeoutRef = useRef<number | null>(null);\r\n  const bandConfigCloseTimeoutRef = useRef<number | null>(null);\r\n\r\n  const clearTimeoutRef = (timeoutRef: MutableRefObject<number | null>) => {\r\n    if (timeoutRef.current) {\r\n      window.clearTimeout(timeoutRef.current);\r\n      timeoutRef.current = null;\r\n    }\r\n  };\r\n\r\n  const openBandConfig = useCallback(() => {\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n    setIsClosingBandConfig(false);\r\n    setIsBandConfigOpen(true);\r\n  }, []);\r\n\r\n  const closeBandConfig = useCallback(() => {\r\n    if (!isBandConfigOpen) {\r\n      return;\r\n    }\r\n\r\n    setIsClosingBandConfig(true);\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n\r\n    bandConfigCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setIsBandConfigOpen(false);\r\n      setIsClosingBandConfig(false);\r\n      bandConfigCloseTimeoutRef.current = null;\r\n    }, bandConfigCloseMs);\r\n  }, [bandConfigCloseMs, isBandConfigOpen]);\r\n\r\n  const openBandManagementScreen = useCallback(() => {\r\n    clearTimeoutRef(musiciansCloseTimeoutRef);\r\n    clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n\r\n    setActiveScreen('band');\r\n    setIsClosingMusiciansScreen(false);\r\n    setIsBandConfigOpen(false);\r\n    setIsClosingBandConfig(false);\r\n    setIsClosingBandManagement(false);\r\n    setActiveBandSelectorInstrument(null);\r\n    setIsBandManagementOpen(true);\r\n  }, []);\r\n\r\n  const closeBandManagementScreen = useCallback(() => {\r\n    if (!isBandManagementOpen) {\r\n      return;\r\n    }\r\n\r\n    setIsClosingBandManagement(true);\r\n    clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n\r\n    bandManagementCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setIsBandManagementOpen(false);\r\n      setIsClosingBandManagement(false);\r\n      setActiveBandSelectorInstrument(null);\r\n      bandManagementCloseTimeoutRef.current = null;\r\n    }, bandModalCloseMs);\r\n  }, [bandModalCloseMs, isBandManagementOpen]);\r\n\r\n  const openMusiciansScreen = useCallback(() => {\r\n    clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n    clearTimeoutRef(musiciansCloseTimeoutRef);\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n\r\n    setIsBandManagementOpen(false);\r\n    setIsClosingBandManagement(false);\r\n    setIsClosingMusiciansScreen(false);\r\n    setSelectedMusicianDetails(null);\r\n    setIsMusicianStoryOpen(false);\r\n    setIsClosingMusicianDetails(false);\r\n    setActiveBandSelectorInstrument(null);\r\n    setIsBandConfigOpen(false);\r\n    setIsClosingBandConfig(false);\r\n    setActiveScreen('musicians');\r\n  }, []);\r\n\r\n  const openMusicianDetails = useCallback((musician: TMusician) => {\r\n    clearTimeoutRef(musicianDetailsCloseTimeoutRef);\r\n    setIsClosingMusicianDetails(false);\r\n    setSelectedMusicianDetails(musician);\r\n    setIsMusicianStoryOpen(false);\r\n  }, []);\r\n\r\n  const closeMusicianDetails = useCallback(() => {\r\n    if (!selectedMusicianDetails) {\r\n      return;\r\n    }\r\n\r\n    setIsClosingMusicianDetails(true);\r\n    clearTimeoutRef(musicianDetailsCloseTimeoutRef);\r\n\r\n    musicianDetailsCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setSelectedMusicianDetails(null);\r\n      setIsMusicianStoryOpen(false);\r\n      setIsClosingMusicianDetails(false);\r\n      musicianDetailsCloseTimeoutRef.current = null;\r\n    }, musicianDetailsCloseMs);\r\n  }, [musicianDetailsCloseMs, selectedMusicianDetails]);\r\n\r\n  const closeMusiciansScreen = useCallback(() => {\r\n    if (activeScreen !== 'musicians') {\r\n      return;\r\n    }\r\n\r\n    setIsClosingMusiciansScreen(true);\r\n    clearTimeoutRef(musiciansCloseTimeoutRef);\r\n\r\n    musiciansCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setActiveScreen('band');\r\n      setIsClosingMusiciansScreen(false);\r\n      setSelectedMusicianDetails(null);\r\n      setIsMusicianStoryOpen(false);\r\n      setIsClosingMusicianDetails(false);\r\n      musiciansCloseTimeoutRef.current = null;\r\n    }, musiciansModalCloseMs);\r\n  }, [activeScreen, musiciansModalCloseMs]);\r\n\r\n  const toggleMusicianStory = useCallback(() => {\r\n    setIsMusicianStoryOpen((current) => {\r\n      const next = !current;\r\n      if (onStoryToggleSound) {\r\n        onStoryToggleSound(next);\r\n      }\r\n      return next;\r\n    });\r\n  }, [onStoryToggleSound]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      clearTimeoutRef(musiciansCloseTimeoutRef);\r\n      clearTimeoutRef(musicianDetailsCloseTimeoutRef);\r\n      clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n      clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    activeScreen,\r\n    isClosingMusiciansScreen,\r\n    selectedMusicianDetails,\r\n    isMusicianStoryOpen,\r\n    isClosingMusicianDetails,\r\n    isBandConfigOpen,\r\n    isClosingBandConfig,\r\n    isBandManagementOpen,\r\n    isClosingBandManagement,\r\n    activeBandSelectorInstrument,\r\n    setActiveBandSelectorInstrument,\r\n    setSelectedMusicianDetails,\r\n    openBandConfig,\r\n    closeBandConfig,\r\n    openBandManagementScreen,\r\n    closeBandManagementScreen,\r\n    openMusiciansScreen,\r\n    openMusicianDetails,\r\n    closeMusicianDetails,\r\n    closeMusiciansScreen,\r\n    toggleMusicianStory,\r\n  };\r\n};\r\n\r\nexport default useBandScreensState;\r\n","export const defaultStageBackground = new URL('../rsc/images/palcos/palco_garagem.png', import.meta.url).href;\r\nexport const defaultStageFloorTexture = new URL('../rsc/images/textura/3343397-madeira-textura-fundo-vetor.jpg', import.meta.url).href;\r\nexport const iconCache = new URL('../rsc/images/icons/cache_borda_brnca.png', import.meta.url).href;\r\nexport const iconCost = new URL('../rsc/images/icons/Custo_borda_branca.png', import.meta.url).href;\r\nexport const iconMoneyWhite = new URL('../rsc/images/icons/Dinheiro_Borda_branca.png', import.meta.url).href;\r\nexport const iconMoneyBlack = new URL('../rsc/images/icons/Dinheiro_borda_preta.png', import.meta.url).href;\r\nexport const iconFameWhite = new URL('../rsc/images/icons/fama_borda_branca.png', import.meta.url).href;\r\nexport const iconFameBlack = new URL('../rsc/images/icons/Fama_borda_preta.png', import.meta.url).href;\r\nexport const iconFansWhite = new URL('../rsc/images/icons/Fans_borda_branca.png', import.meta.url).href;\r\nexport const iconFansBlack = new URL('../rsc/images/icons/Fans_Borda_Preta.png', import.meta.url).href;\r\nexport const iconIngresso = new URL('../rsc/images/icons/Ingrresso.png', import.meta.url).href;\r\nexport const iconIngressoBranco = new URL('../rsc/images/icons/Icone_ingresso_branco.png', import.meta.url).href;\r\nexport const iconValorCacheTotal = new URL('../rsc/images/icons/valor_de_cache.png', import.meta.url).href;\r\nexport const iconMusicWhite = new URL('../rsc/images/icons/musica_branco.png', import.meta.url).href;\r\nexport const iconRhythmWhite = new URL('../rsc/images/icons/Ritmo_Borda_branca.png', import.meta.url).href;\r\nexport const navBand = new URL('../rsc/images/icons/banda.jpg', import.meta.url).href;\r\nexport const navHire = new URL('../rsc/images/icons/contratar.jpg', import.meta.url).href;\r\nexport const navStore = new URL('../rsc/images/icons/loja.jpg', import.meta.url).href;\r\nexport const navStage = new URL('../rsc/images/icons/palcos.jpg', import.meta.url).href;\r\nexport const navSongs = new URL('../rsc/images/icons/musicas.png', import.meta.url).href;\r\nexport const stageWorldMap = new URL('../rsc/images/maps/Mapa_Mundo.jpeg', import.meta.url).href;\r\nexport const stageWorldPreview = new URL('../rsc/images/maps/Preview_cidade.png', import.meta.url).href;\r\nexport const backgroundAudicao = new URL('../rsc/images/backgrounds/audicao.jpg', import.meta.url).href;\r\nexport const backgroundBackstage = new URL('../rsc/images/backgrounds/Backstage.jpg', import.meta.url).href;\r\nexport const portraitContratante = new URL('../rsc/images/facesets/velho_contratante_musicos.png', import.meta.url).href;\r\nexport const iconTodos = new URL('../rsc/images/icons/Icone_Todos.png', import.meta.url).href;\r\nexport const iconGuitarra = new URL('../rsc/images/icons/Icone_guitarra.png', import.meta.url).href;\r\nexport const iconBaixo = new URL('../rsc/images/icons/Icone_Baixo.png', import.meta.url).href;\r\nexport const iconBateria = new URL('../rsc/images/icons/Icone_Bateria.png', import.meta.url).href;\r\nexport const iconTeclado = new URL('../rsc/images/icons/Icone_Teclado.png', import.meta.url).href;\r\nexport const iconBandaMenu = new URL('../rsc/images/icons/Icone_Banda.png', import.meta.url).href;\r\nexport const iconEspeciaisMenu = new URL('../rsc/images/icons/Icone_Especiais.png', import.meta.url).href;\r\nexport const iconAnaliseMenu = new URL('../rsc/images/icons/icone_Analise.png', import.meta.url).href;\r\nexport const iconFechar = new URL('../rsc/images/icons/Icone_fechar.png', import.meta.url).href;\r\nexport const iconConfigBlack = new URL('../rsc/images/icons/Icone_config_preto.png', import.meta.url).href;\r\nexport const iconConfigWhite = new URL('../rsc/images/icons/Icone_config_branco.png', import.meta.url).href;\r\nexport const iconExitBand = new URL('../rsc/images/icons/Icone_Sair.png', import.meta.url).href;\r\nexport const iconBloqueado = new URL('../rsc/images/icons/Icone_bloquado.png', import.meta.url).href;\r\nexport const iconDisponivel = new URL('../rsc/images/icons/icone_disponivel.png', import.meta.url).href;\r\nexport const iconMusicoVazio = new URL('../rsc/images/icons/icone_musico.png', import.meta.url).href;\r\nexport const iconGuitarraVazia = new URL('../rsc/images/icons/Icone_guitarra_vazia.png', import.meta.url).href;\r\nexport const iconBaixoVazio = new URL('../rsc/images/icons/Icone_baixo_vazio.png', import.meta.url).href;\r\nexport const iconBateriaVazio = new URL('../rsc/images/icons/Icone_bateria_vazio.png', import.meta.url).href;\r\nexport const iconTecladoVazio = new URL('../rsc/images/icons/Icone_teclado_vazio.png', import.meta.url).href;\r\nexport const iconAudioOn = new URL('../rsc/images/icons/Icone_Audio_Ligado.png', import.meta.url).href;\r\nexport const iconCamera = new URL('../rsc/images/icons/Icone_camera.png', import.meta.url).href;\r\nexport const sfxMoneyReward = new URL('../rsc/audios/Dinheiro_Entrando_2.mp3', import.meta.url).href;\r\nexport const sfxCrowdApplause = new URL('../rsc/audios/Aplausos.mp3', import.meta.url).href;\r\nexport const sfxPurchased = new URL('../rsc/audios/Comprado.mp3', import.meta.url).href;\r\nexport const sfxStarReward = new URL('../rsc/audios/efeito_estrela.mp3', import.meta.url).href;\r\nexport const ambienceMapAudio = new URL('../rsc/audios/Ambience_Soud_Mapa.mp3', import.meta.url).href;\r\nexport const ambienceStageCrowdAudio = new URL('../rsc/audios/Ambiance_Pessoas_palco.mp3', import.meta.url).href;\r\n","import { iconAnaliseMenu, iconBaixo, iconBandaMenu, iconBateria, iconEspeciaisMenu, iconGuitarra, iconTeclado, iconTodos } from '../assets/bandGameAssets';\r\nimport type { Instrument } from '../state/gameStore';\r\nimport type { HireFilter } from '../types/bandGame.ts';\r\n\r\nexport const instrumentLabels: Record<Instrument, string> = {\r\n  guitar: 'Guitarra',\r\n  drums: 'Bateria',\r\n  bass: 'Baixo',\r\n  keys: 'Teclado',\r\n};\r\n\r\nexport const INITIAL_BPM = 220;\r\nexport const METRONOME_BEAT_MS = 60000 / INITIAL_BPM;\r\nexport const METRONOME_HIT_WINDOW_MS = METRONOME_BEAT_MS * 0.28;\r\nexport const RHYTHM_PLAY_THRESHOLD = 18;\r\nexport const SHOW_FAME_REWARD = 5;\r\nexport const FANS_GAIN_BASE_RATE = 0.05;\r\nexport const FANS_GAIN_MAX_RATE = 0.3;\r\nexport const FANS_GAIN_STEP_RATE = 0.05;\r\nexport const FANS_GAIN_STEP_MS = 20000;\r\nexport const DEFAULT_MUSIC_BPM = 120;\r\nexport const PRE_MUSIC_TAP_GAIN = 6.2;\r\nexport const PRE_MUSIC_DECAY = 0.9;\r\nexport const POST_MUSIC_DECAY = 1.3;\r\nexport const CROWD_DECAY_EVERY_STEPS = 1;\r\nexport const TAP_EFFECT_LIFETIME_MS = 140;\r\nexport const MAX_TAP_EFFECTS = 12;\r\nexport const MUSICIANS_MODAL_CLOSE_MS = 260;\r\nexport const MUSICIANS_DETAIL_CLOSE_MS = 220;\r\nexport const BAND_MODAL_CLOSE_MS = 240;\r\nexport const BAND_CONFIG_CLOSE_MS = 220;\r\nexport const MAP_RETURN_FADE_OUT_MS = 520;\r\nexport const MAP_RETURN_FADE_IN_MS = 420;\r\nexport const AMBIENCE_FADE_IN_MS = 900;\r\nexport const AMBIENCE_FADE_OUT_MS = 520;\r\nexport const STAGE_STEM_FADE_IN_MS = 700;\r\nexport const STAGE_STEM_FADE_OUT_MS = 420;\r\nexport const MAP_AMBIENCE_VOLUME = 0.04;\r\nexport const STAGE_AMBIENCE_VOLUME = 1.70;\r\n\r\nexport const instrumentById: Record<number, Instrument> = {\r\n  1: 'guitar',\r\n  2: 'bass',\r\n  3: 'drums',\r\n  4: 'keys',\r\n};\r\n\r\nexport const instrumentIconById: Record<number, string> = {\r\n  1: iconGuitarra,\r\n  2: iconBaixo,\r\n  3: iconBateria,\r\n  4: iconTeclado,\r\n};\r\n\r\nexport const instrumentNameById: Record<number, string> = {\r\n  1: 'Guitarra',\r\n  2: 'Baixo',\r\n  3: 'Bateria',\r\n  4: 'Teclado',\r\n};\r\n\r\nexport const instrumentPlaybackOrder: Instrument[] = ['drums', 'bass', 'guitar', 'keys'];\r\nexport const instrumentConfigOrder: Instrument[] = ['guitar', 'bass', 'drums', 'keys'];\r\nexport const instrumentIconByInstrument: Record<Instrument, string> = {\r\n  guitar: iconGuitarra,\r\n  drums: iconBateria,\r\n  bass: iconBaixo,\r\n  keys: iconTeclado,\r\n};\r\n\r\nexport const filterOptions: Array<{ id: HireFilter; label: string; icon: string }> = [\r\n  { id: 'all', label: 'Todos', icon: iconTodos },\r\n  { id: 'guitar', label: 'Guitarra', icon: iconGuitarra },\r\n  { id: 'bass', label: 'Baixo', icon: iconBaixo },\r\n  { id: 'drums', label: 'Bateria', icon: iconBateria },\r\n  { id: 'keys', label: 'Teclado', icon: iconTeclado },\r\n];\r\n\r\nexport const bandMenuOptions: Array<{ id: 'band' | 'specials' | 'analysis'; label: string; icon: string }> = [\r\n  { id: 'band', label: 'Banda', icon: iconBandaMenu },\r\n  { id: 'specials', label: 'Especiais', icon: iconEspeciaisMenu },\r\n  { id: 'analysis', label: 'Análise', icon: iconAnaliseMenu },\r\n];\r\n\r\nexport const stageMapPositionById: Record<number, { x: number; y: number }> = {\r\n  1: { x: 94.3, y: 82.27 },\r\n  2: { x: 22.81, y: 48.59 },\r\n  3: { x: 82.42, y: 59.61 },\r\n  4: { x: 46.56, y: 37.89 },\r\n  5: { x: 40.55, y: 52.11 },\r\n  6: { x: 75.08, y: 67.19 },\r\n  7: { x: 50.63, y: 71.88 },\r\n  8: { x: 59.3, y: 25.47 },\r\n  9: { x: 90.63, y: 30.86 },\r\n  10: { x: 49.84, y: 8.28 },\r\n};\r\n\r\nexport const getRhythmTone = (value: number) => {\r\n  if (value <= 15) {\r\n    return '#e13d35';\r\n  }\r\n  if (value <= 30) {\r\n    return '#ec8a2f';\r\n  }\r\n  if (value <= 50) {\r\n    return '#e7d34b';\r\n  }\r\n  if (value <= 75) {\r\n    return '#94e062';\r\n  }\r\n  return '#39c453';\r\n};\r\n\r\nexport const getRarity = (level: number) => {\r\n  if (level >= 3) {\r\n    return { label: 'Ouro', className: 'gold' as const };\r\n  }\r\n\r\n  if (level === 2) {\r\n    return { label: 'Prata', className: 'silver' as const };\r\n  }\r\n\r\n  return { label: 'Bronze', className: 'bronze' as const };\r\n};\r\n","export default \"__VITE_ASSET__CMRGMaOA__\"","export default \"__VITE_ASSET__DCRl27l___\"","export default \"__VITE_ASSET__BqIUf39S__\"","export default \"__VITE_ASSET__Cq_XVXU8__\"","export default \"__VITE_ASSET__Cni4HOSU__\"","export default \"__VITE_ASSET__Cv8hN5FR__\"","export default \"__VITE_ASSET__Y$5qmUhO__\"","export default \"__VITE_ASSET__CU53hyal__\"","export default \"__VITE_ASSET__7CxkXbu0__\"","export default \"__VITE_ASSET__w1nMzC7H__\"","export default \"__VITE_ASSET__CMzk59fj__\"","export default \"__VITE_ASSET__CaOz8BjV__\"","export default \"__VITE_ASSET__BJCM6Rql__\"","export default \"__VITE_ASSET__C7mUOnJF__\"","export default \"__VITE_ASSET__sVVvGHk7__\"","export default \"__VITE_ASSET__C3qIHsST__\"","export default \"__VITE_ASSET___efjDLCT__\"","export default \"__VITE_ASSET__C756J1OD__\"","export default \"__VITE_ASSET__2AelYROg__\"","export default \"__VITE_ASSET__BC5tcVY5__\"","export default \"__VITE_ASSET__CXgU3HsR__\"","export default \"__VITE_ASSET__BCC9EG6s__\"","export default \"__VITE_ASSET__DWbwp$Go__\"","export default \"__VITE_ASSET__CR_ohV98__\"","export default \"__VITE_ASSET__CSLnFAEy__\"","export default \"__VITE_ASSET__CpqiVIgp__\"","export default \"__VITE_ASSET__Bu4PUo$b__\"","export default \"__VITE_ASSET__oJNwHflO__\"","export default \"__VITE_ASSET__CJJvjDSM__\"","export default \"__VITE_ASSET__dctE0HMS__\"","export default \"__VITE_ASSET__lBVBiJ86__\"","export default \"__VITE_ASSET__B621p8Fn__\"","export default \"__VITE_ASSET__BhhO8YWV__\"","export default \"__VITE_ASSET__CVWGLKyJ__\"","export default \"__VITE_ASSET__Bui4yiLO__\"","export default \"__VITE_ASSET__Bgw6Xvxb__\"","export default \"__VITE_ASSET__B2Q3UZQI__\"","export default \"__VITE_ASSET__B2owDi3V__\"","export default \"__VITE_ASSET__BYTIyEu4__\"","export default \"__VITE_ASSET__DcbKch3p__\"","export default \"__VITE_ASSET__DbOgxMki__\"","export default \"__VITE_ASSET__Bp_kUgwP__\"","export default \"__VITE_ASSET__BzvfMTyy__\"","export default \"__VITE_ASSET__DfW19FGt__\"","export default \"__VITE_ASSET__DvRj7Jnm__\"","export default \"__VITE_ASSET__QmOWa5N9__\"","export default \"__VITE_ASSET__CErM0wHU__\"","export default \"__VITE_ASSET__07nf4Tmj__\"","export default \"__VITE_ASSET__CLnwY0lj__\"","export default \"__VITE_ASSET__CDmjKpwD__\"","export default \"__VITE_ASSET__Bh0XvO6X__\"","export default \"__VITE_ASSET__C9sCJ7Jk__\"","export default \"__VITE_ASSET__DmBu$lBs__\"","export default \"__VITE_ASSET__C_8pi9Q8__\"","export default \"__VITE_ASSET__iTbD2AZ$__\"","export default \"__VITE_ASSET__CTjgd9PD__\"","export default \"__VITE_ASSET__Zu0CPBt6__\"","export default \"__VITE_ASSET__D4emD9Us__\"","export default \"__VITE_ASSET__B9jUX0YK__\"","export default \"__VITE_ASSET__DCtxs4sl__\"","export default \"__VITE_ASSET__Be6tXjGB__\"","export default \"__VITE_ASSET__DtGNK5x5__\"","export default \"__VITE_ASSET__ldK0Uu_R__\"","export default \"__VITE_ASSET__CJNQZaKt__\"","export default \"__VITE_ASSET__Dc8Iv_of__\"","export default \"__VITE_ASSET__BrihPwup__\"","export default \"__VITE_ASSET__DWr8wLzD__\"","export default \"__VITE_ASSET__DQ5qrn0o__\"","export default \"__VITE_ASSET__BQeam8NP__\"","export default \"__VITE_ASSET__CEEYWRX8__\"","export default \"__VITE_ASSET__DUclY5v7__\"","export default \"__VITE_ASSET__DdxJiBhV__\"","export default \"__VITE_ASSET__DUnNBJvm__\"","export default \"__VITE_ASSET__DMTZTm6t__\"","export default \"__VITE_ASSET__CP0Xv6xR__\"","export default \"__VITE_ASSET__lFUQ2oQE__\"","export default \"__VITE_ASSET__D$4_mzuD__\"","export default \"__VITE_ASSET__C$XP5jgr__\"","export default \"__VITE_ASSET__sa2SNJ2f__\"","export default \"__VITE_ASSET__C4cW1Lj___\"","export default \"__VITE_ASSET__Q3kb3Tc7__\"","export default \"__VITE_ASSET__BAGgNNWs__\"","export default \"__VITE_ASSET__DDQdi6M3__\"","export default \"__VITE_ASSET__Crfki0Bp__\"","import { defaultStageBackground, navStage } from '../assets/bandGameAssets';\r\n\r\nconst stageImageAssetMap = import.meta.glob('../rsc/images/palcos/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst stageMapBadgeAssetMap = import.meta.glob('../rsc/images/maps/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst stageVideoAssetMap = import.meta.glob('../rsc/videos/palcos/*.{mp4,webm}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst musicStreamAssetMap = import.meta.glob('../rsc/musics/**/*.mp3', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst musicianFaceAssetMap = import.meta.glob('../rsc/images/facesets/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst musicianPortraitAssetMap = import.meta.glob('../rsc/images/portraits/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nexport const resolveStageAsset = (assetPath: string) => {\r\n  if (!assetPath || !assetPath.startsWith('src/')) {\r\n    return defaultStageBackground;\r\n  }\r\n\r\n  const viteAssetPath = `../${assetPath.replace(/^src\\//, '')}`;\r\n  return stageImageAssetMap[viteAssetPath] ?? defaultStageBackground;\r\n};\r\n\r\nexport const resolveStageAnimatedAsset = (animatedPath: string) => {\r\n  if (!animatedPath || !animatedPath.startsWith('src/')) {\r\n    return null;\r\n  }\r\n\r\n  const viteAssetPath = `../${animatedPath.replace(/^src\\//, '')}`;\r\n  return stageVideoAssetMap[viteAssetPath] ?? null;\r\n};\r\n\r\nexport const resolveStageMapBadgeAsset = (badgePath: string) => {\r\n  if (!badgePath || !badgePath.startsWith('src/')) {\r\n    return navStage;\r\n  }\r\n\r\n  const viteAssetPath = `../${badgePath.replace(/^src\\//, '')}`;\r\n  return stageMapBadgeAssetMap[viteAssetPath] ?? navStage;\r\n};\r\n\r\nexport const resolveMusicStreamAsset = (streamPath: string) => {\r\n  if (!streamPath || !streamPath.startsWith('src/')) {\r\n    return null;\r\n  }\r\n\r\n  const viteAssetPath = `../${streamPath.replace(/^src\\//, '')}`;\r\n  return musicStreamAssetMap[viteAssetPath] ?? null;\r\n};\r\n\r\nexport const resolveMusicianFaceAsset = (faceAsset: string) => {\r\n  if (!faceAsset) {\r\n    return null;\r\n  }\r\n\r\n  if (faceAsset.startsWith('src/')) {\r\n    const viteAssetPath = `../${faceAsset.replace(/^src\\//, '')}`;\r\n    return musicianFaceAssetMap[viteAssetPath] ?? null;\r\n  }\r\n\r\n  const directFacePath = `../rsc/images/facesets/${faceAsset}`;\r\n  if (musicianFaceAssetMap[directFacePath]) {\r\n    return musicianFaceAssetMap[directFacePath];\r\n  }\r\n\r\n  const legacyFaceMatch = faceAsset.match(/^Face_(\\d+)$/i);\r\n  if (legacyFaceMatch) {\r\n    const parsedFaceNumber = Number.parseInt(legacyFaceMatch[1], 10);\r\n    if (Number.isFinite(parsedFaceNumber) && parsedFaceNumber > 0) {\r\n      const migratedFacePath = `../rsc/images/facesets/Faceset_${parsedFaceNumber}.png`;\r\n      return musicianFaceAssetMap[migratedFacePath] ?? null;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const resolveMusicianPortraitAsset = (portraitAsset: string) => {\r\n  if (!portraitAsset) {\r\n    return null;\r\n  }\r\n\r\n  if (portraitAsset.startsWith('src/')) {\r\n    const viteAssetPath = `../${portraitAsset.replace(/^src\\//, '')}`;\r\n    return musicianPortraitAssetMap[viteAssetPath] ?? null;\r\n  }\r\n\r\n  const directPortraitPath = `../rsc/images/portraits/${portraitAsset}`;\r\n  return musicianPortraitAssetMap[directPortraitPath] ?? null;\r\n};\r\n","import { useMemo } from 'react';\r\nimport palcosData from '../locals/palcos.json';\r\nimport musicsData from '../locals/musics.json';\r\nimport musicosData from '../locals/musicos.json';\r\nimport { instrumentLabels, instrumentById, instrumentIconById, instrumentNameById, instrumentPlaybackOrder, instrumentConfigOrder, instrumentIconByInstrument, stageMapPositionById, getRarity } from '../constants/bandGame';\r\nimport type { Band, Instrument } from '../state/gameStore';\r\nimport type { HireFilter, MusicData, MusicianData, StageData, StagePerformerInstrument } from '../types/bandGame';\r\nimport { resolveMusicStreamAsset, resolveMusicianFaceAsset, resolveMusicianPortraitAsset, resolveStageAnimatedAsset, resolveStageAsset, resolveStageMapBadgeAsset } from '../utils/assetResolvers';\r\nimport { iconBaixoVazio, iconBateriaVazio, iconGuitarraVazia, iconTecladoVazio, iconTodos } from '../assets/bandGameAssets';\r\n\r\nexport type UseBandGameComputedParams = {\r\n  bands: Band[];\r\n  activeBandId: string | null;\r\n  currentStageId: number;\r\n  hireFilter: HireFilter;\r\n  instrumentVolumes: Record<Instrument, number>;\r\n  activeBandSelectorInstrument: Instrument | null;\r\n  selectedMusicianDetails: MusicianData | null;\r\n};\r\n\r\nexport const useBandGameComputed = ({\r\n  bands,\r\n  activeBandId,\r\n  currentStageId,\r\n  hireFilter,\r\n  instrumentVolumes,\r\n  activeBandSelectorInstrument,\r\n  selectedMusicianDetails,\r\n}: UseBandGameComputedParams) => {\r\n  const availableMusics = useMemo(() => musicsData.musicas as MusicData[], []);\r\n  const musicians = useMemo(() => musicosData.musicos as MusicianData[], []);\r\n  const stages = useMemo(() => palcosData.palcos as StageData[], []);\r\n\r\n  const selectedMusic = useMemo(\r\n    () => availableMusics.find((music) => music.id === 'blues_na_garagem') ?? availableMusics[0] ?? null,\r\n    [availableMusics]\r\n  );\r\n\r\n  const activeBand = useMemo(\r\n    () => bands.find((band) => band.id === activeBandId) ?? null,\r\n    [bands, activeBandId]\r\n  );\r\n\r\n  const activeBandMusicians = useMemo(() => {\r\n    if (!activeBand) {\r\n      return [] as MusicianData[];\r\n    }\r\n\r\n    return Object.values(activeBand.musicians)\r\n      .filter((slot) => slot.hired && slot.musicianId !== null)\r\n      .map((slot) => musicians.find((musician) => musician.ID === slot.musicianId))\r\n      .filter((musician): musician is MusicianData => musician !== undefined);\r\n  }, [activeBand, musicians]);\r\n\r\n  const bandHypeValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Hype, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const bandFansValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Fans, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const bandPerformanceValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Apresentacao, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const bandCacheValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Cache, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const selectedStage = useMemo(\r\n    () => stages.find((stage) => stage.IDPalco === currentStageId) ?? stages.find((stage) => stage.IDPalco === 1) ?? stages[0],\r\n    [currentStageId, stages]\r\n  );\r\n\r\n  const stageMapEntries = useMemo(\r\n    () => stages.map((stage) => {\r\n      const position = stageMapPositionById[stage.IDPalco] ?? { x: 50, y: 50 };\r\n      return {\r\n        id: stage.IDPalco,\r\n        name: stage.Palco,\r\n        badgeUrl: resolveStageMapBadgeAsset(stage.map_badge ?? ''),\r\n        bannerUrl: resolveStageAsset(stage.asset_horizontal ?? stage.Asset ?? ''),\r\n        backgroundUrl: resolveStageAsset(stage.Asset ?? stage.asset_horizontal ?? ''),\r\n        ticketPrice: Math.max(0, stage.Ingresso),\r\n        capacity: Math.max(0, stage.Lotacao),\r\n        maxRevenue: Math.max(0, stage.Ingresso * stage.Lotacao),\r\n        x: position.x,\r\n        y: position.y,\r\n      };\r\n    }),\r\n    [stages]\r\n  );\r\n\r\n  const stageBackground = useMemo(\r\n    () => resolveStageAsset(selectedStage?.Asset ?? ''),\r\n    [selectedStage]\r\n  );\r\n\r\n  const stage3DBackground = useMemo(\r\n    () => resolveStageAsset(selectedStage?.asset_parallax ?? selectedStage?.asset_horizontal ?? selectedStage?.Asset ?? ''),\r\n    [selectedStage]\r\n  );\r\n\r\n  const selectedStageBadge = useMemo(\r\n    () => resolveStageMapBadgeAsset(selectedStage?.map_badge ?? ''),\r\n    [selectedStage]\r\n  );\r\n\r\n  const stageAnimatedBackground = useMemo(\r\n    () => (selectedStage?.asset_parallax || selectedStage?.asset_horizontal\r\n      ? null\r\n      : resolveStageAnimatedAsset(selectedStage?.animated ?? '')),\r\n    [selectedStage]\r\n  );\r\n\r\n  const filteredMusicians = useMemo(() => {\r\n    if (hireFilter === 'all') {\r\n      return musicians;\r\n    }\r\n\r\n    return musicians.filter((musician) => instrumentById[musician.Instrumento] === hireFilter);\r\n  }, [musicians, hireFilter]);\r\n\r\n  const listedMusicians = useMemo(() => {\r\n    return [...filteredMusicians].sort((left, right) => {\r\n      const leftInstrument = instrumentById[left.Instrumento];\r\n      const rightInstrument = instrumentById[right.Instrumento];\r\n      const leftSlot = leftInstrument ? activeBand?.musicians[leftInstrument] : null;\r\n      const rightSlot = rightInstrument ? activeBand?.musicians[rightInstrument] : null;\r\n      const leftHired = Boolean(leftSlot?.hired && leftSlot.musicianId === left.ID);\r\n      const rightHired = Boolean(rightSlot?.hired && rightSlot.musicianId === right.ID);\r\n\r\n      if (leftHired === rightHired) {\r\n        return left.ID - right.ID;\r\n      }\r\n\r\n      return leftHired ? -1 : 1;\r\n    });\r\n  }, [filteredMusicians, activeBand]);\r\n\r\n  const availableBandCoins = activeBand?.coins ?? 0;\r\n  const selectedMusicianPrice = selectedMusicianDetails?.Custo ?? 0;\r\n\r\n  const selectedInstrument = selectedMusicianDetails\r\n    ? instrumentById[selectedMusicianDetails.Instrumento]\r\n    : null;\r\n\r\n  const unlockedMusicianIdSet = useMemo(() => {\r\n    if (!activeBand) {\r\n      return new Set<number>();\r\n    }\r\n\r\n    const persistedIds = activeBand.unlockedMusicianIds ?? [];\r\n    const equippedIds = Object.values(activeBand.musicians)\r\n      .map((slot) => slot.musicianId)\r\n      .filter((id): id is number => id !== null);\r\n\r\n    return new Set<number>([...persistedIds, ...equippedIds]);\r\n  }, [activeBand]);\r\n\r\n  const isSelectedMusicianHired = Boolean(\r\n    selectedMusicianDetails\r\n      && unlockedMusicianIdSet.has(selectedMusicianDetails.ID)\r\n  );\r\n\r\n  const hasEnoughCoinsForSelected = selectedMusicianPrice > 0 && availableBandCoins >= selectedMusicianPrice;\r\n\r\n  const canHireSelectedMusician = Boolean(\r\n    selectedInstrument\r\n      && activeBand\r\n      && !isSelectedMusicianHired\r\n      && hasEnoughCoinsForSelected\r\n  );\r\n\r\n  const isSelectedMusicianLockedByCoins = !isSelectedMusicianHired && !hasEnoughCoinsForSelected;\r\n\r\n  const selectedMusicianRarityClass = selectedMusicianDetails\r\n    ? getRarity(selectedMusicianDetails.Nivel).className\r\n    : null;\r\n  const selectedMusicianFace = selectedMusicianDetails\r\n    ? resolveMusicianFaceAsset(selectedMusicianDetails.Asset_Face)\r\n    : null;\r\n  const selectedMusicianPortrait = selectedMusicianDetails\r\n    ? resolveMusicianPortraitAsset(selectedMusicianDetails.Asset_Portrait ?? '')\r\n    : null;\r\n  const selectedMusicianInitials = selectedMusicianDetails\r\n    ? selectedMusicianDetails.Instrumentista\r\n      .split(' ')\r\n      .slice(0, 2)\r\n      .map((part) => part[0]?.toUpperCase() ?? '')\r\n      .join('')\r\n    : '';\r\n  const selectedMusicianInstrumentIcon = selectedMusicianDetails\r\n    ? instrumentIconById[selectedMusicianDetails.Instrumento] ?? iconTodos\r\n    : iconTodos;\r\n\r\n  const listedMusicianItems = useMemo(() => {\r\n    return listedMusicians.map((musician) => {\r\n      const rarity = getRarity(musician.Nivel);\r\n      const instrument = instrumentById[musician.Instrumento];\r\n      const isMusicianHired = unlockedMusicianIdSet.has(musician.ID);\r\n      const isLockedByCoins = !isMusicianHired && availableBandCoins < musician.Custo;\r\n      const instrumentIcon = instrumentIconById[musician.Instrumento] ?? iconTodos;\r\n      const initials = musician.Instrumentista\r\n        .split(' ')\r\n        .slice(0, 2)\r\n        .map((part) => part[0]?.toUpperCase() ?? '')\r\n        .join('');\r\n\r\n      return {\r\n        musician,\r\n        rarityClass: rarity.className,\r\n        rarityLabel: rarity.label,\r\n        instrumentIcon,\r\n        isMusicianHired,\r\n        isLockedByCoins,\r\n        musicianFaceSrc: resolveMusicianFaceAsset(musician.Asset_Face),\r\n        initials,\r\n      };\r\n    });\r\n  }, [listedMusicians, availableBandCoins, unlockedMusicianIdSet]);\r\n\r\n  const availableToHireCount = useMemo(() => {\r\n    return musicians.filter((musician) => {\r\n      if (unlockedMusicianIdSet.has(musician.ID)) {\r\n        return false;\r\n      }\r\n\r\n      return availableBandCoins >= musician.Custo;\r\n    }).length;\r\n  }, [musicians, unlockedMusicianIdSet, availableBandCoins]);\r\n\r\n  const selectedMusicStems = useMemo(() => {\r\n    return {\r\n      guitar: resolveMusicStreamAsset(selectedMusic?.eletricguitar ?? ''),\r\n      bass: resolveMusicStreamAsset(selectedMusic?.bass ?? ''),\r\n      drums: resolveMusicStreamAsset(selectedMusic?.drums ?? ''),\r\n      keys: resolveMusicStreamAsset(selectedMusic?.keys ?? ''),\r\n    } as Record<Instrument, string | null>;\r\n  }, [selectedMusic]);\r\n\r\n  const activeBandInstruments = useMemo(() => {\r\n    if (!activeBand) {\r\n      return [] as Instrument[];\r\n    }\r\n\r\n    return instrumentPlaybackOrder.filter((instrument) => {\r\n      const slot = activeBand.musicians[instrument];\r\n      return slot.hired && slot.musicianId !== null;\r\n    });\r\n  }, [\r\n    activeBand?.musicians.guitar.hired,\r\n    activeBand?.musicians.guitar.musicianId,\r\n    activeBand?.musicians.bass.hired,\r\n    activeBand?.musicians.bass.musicianId,\r\n    activeBand?.musicians.drums.hired,\r\n    activeBand?.musicians.drums.musicianId,\r\n    activeBand?.musicians.keys.hired,\r\n    activeBand?.musicians.keys.musicianId,\r\n  ]);\r\n\r\n  const instrumentVolumeControls = useMemo(() => {\r\n    return instrumentConfigOrder.map((instrument) => ({\r\n      instrument,\r\n      label: instrumentLabels[instrument],\r\n      icon: instrumentIconByInstrument[instrument],\r\n      value: instrumentVolumes[instrument] ?? 1,\r\n    }));\r\n  }, [instrumentVolumes]);\r\n\r\n  const guitarMusician = musicians.find((item) => item.ID === activeBand?.musicians.guitar.musicianId);\r\n  const bassMusician = musicians.find((item) => item.ID === activeBand?.musicians.bass.musicianId);\r\n  const drumsMusician = musicians.find((item) => item.ID === activeBand?.musicians.drums.musicianId);\r\n  const keysMusician = musicians.find((item) => item.ID === activeBand?.musicians.keys.musicianId);\r\n\r\n  const bandInstrumentColumns = [\r\n    {\r\n      id: 'guitar' as const,\r\n      label: 'Guitarra',\r\n      icon: instrumentIconByInstrument.guitar,\r\n      emptyInstrumentIcon: iconGuitarraVazia,\r\n      musicianId: guitarMusician?.ID ?? null,\r\n      musicianName: guitarMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: guitarMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(guitarMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.guitar.hired),\r\n      rarityClass: activeBand?.musicians.guitar.hired\r\n        ? getRarity(guitarMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n    {\r\n      id: 'bass' as const,\r\n      label: 'Baixo',\r\n      icon: instrumentIconByInstrument.bass,\r\n      emptyInstrumentIcon: iconBaixoVazio,\r\n      musicianId: bassMusician?.ID ?? null,\r\n      musicianName: bassMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: bassMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(bassMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.bass.hired),\r\n      rarityClass: activeBand?.musicians.bass.hired\r\n        ? getRarity(bassMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n    {\r\n      id: 'drums' as const,\r\n      label: 'Bateria',\r\n      icon: instrumentIconByInstrument.drums,\r\n      emptyInstrumentIcon: iconBateriaVazio,\r\n      musicianId: drumsMusician?.ID ?? null,\r\n      musicianName: drumsMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: drumsMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(drumsMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.drums.hired),\r\n      rarityClass: activeBand?.musicians.drums.hired\r\n        ? getRarity(drumsMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n    {\r\n      id: 'keys' as const,\r\n      label: 'Teclado',\r\n      icon: instrumentIconByInstrument.keys,\r\n      emptyInstrumentIcon: iconTecladoVazio,\r\n      musicianId: keysMusician?.ID ?? null,\r\n      musicianName: keysMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: keysMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(keysMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.keys.hired),\r\n      rarityClass: activeBand?.musicians.keys.hired\r\n        ? getRarity(keysMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n  ];\r\n\r\n  const selectorMusicians = useMemo(() => {\r\n    if (!activeBandSelectorInstrument) {\r\n      return [] as Array<{\r\n        id: number;\r\n        name: string;\r\n        firstName: string;\r\n        face: string | null;\r\n        portrait: string | null;\r\n        rarityClass: 'bronze' | 'silver' | 'gold';\r\n        rarityLabel: string;\r\n        hype: number;\r\n        fans: number;\r\n        performance: number;\r\n        cache: number;\r\n      }>;\r\n    }\r\n\r\n    return musicians\r\n      .filter((musician) => instrumentById[musician.Instrumento] === activeBandSelectorInstrument)\r\n      .filter((musician) => unlockedMusicianIdSet.has(musician.ID))\r\n      .map((musician) => {\r\n        const rarity = getRarity(musician.Nivel);\r\n        return {\r\n          id: musician.ID,\r\n          name: musician.Instrumentista,\r\n          firstName: musician.Instrumentista.split(' ')[0] ?? 'Músico',\r\n          face: resolveMusicianFaceAsset(musician.Asset_Face),\r\n          portrait: resolveMusicianPortraitAsset(musician.Asset_Portrait ?? ''),\r\n          rarityClass: rarity.className,\r\n          rarityLabel: rarity.label,\r\n          hype: musician.Hype,\r\n          fans: musician.Fans,\r\n          performance: musician.Apresentacao,\r\n          cache: musician.Cache,\r\n        };\r\n      });\r\n  }, [activeBandSelectorInstrument, musicians, unlockedMusicianIdSet]);\r\n\r\n  const selectedSelectorMusicianId = activeBandSelectorInstrument\r\n    ? activeBand?.musicians[activeBandSelectorInstrument].musicianId ?? null\r\n    : null;\r\n\r\n  const stageBandPerformers = useMemo(() => {\r\n    const performerEntries = [\r\n      {\r\n        instrument: 'drums' as const,\r\n        musician: drumsMusician,\r\n        isHired: Boolean(activeBand?.musicians.drums.hired),\r\n      },\r\n      {\r\n        instrument: 'guitar' as const,\r\n        musician: guitarMusician,\r\n        isHired: Boolean(activeBand?.musicians.guitar.hired),\r\n      },\r\n      {\r\n        instrument: 'bass' as const,\r\n        musician: bassMusician,\r\n        isHired: Boolean(activeBand?.musicians.bass.hired),\r\n      },\r\n      {\r\n        instrument: 'keys' as const,\r\n        musician: keysMusician,\r\n        isHired: Boolean(activeBand?.musicians.keys.hired),\r\n      },\r\n    ];\r\n\r\n    return performerEntries\r\n      .map((entry) => {\r\n        if (!entry.isHired || !entry.musician) {\r\n          return null;\r\n        }\r\n\r\n        const portraitSrc = resolveMusicianPortraitAsset(entry.musician.Asset_Portrait ?? '');\r\n        if (!portraitSrc) {\r\n          return null;\r\n        }\r\n\r\n        return {\r\n          instrument: entry.instrument,\r\n          id: entry.musician.ID,\r\n          name: entry.musician.Instrumentista,\r\n          portraitSrc,\r\n        };\r\n      })\r\n      .filter((entry): entry is { instrument: Instrument; id: number; name: string; portraitSrc: string } => Boolean(entry));\r\n  }, [\r\n    activeBand?.musicians.bass.hired,\r\n    activeBand?.musicians.drums.hired,\r\n    activeBand?.musicians.guitar.hired,\r\n    activeBand?.musicians.keys.hired,\r\n    bassMusician,\r\n    drumsMusician,\r\n    guitarMusician,\r\n    keysMusician,\r\n  ]);\r\n\r\n  const stage3DActiveMusicians = useMemo(\r\n    () => stageBandPerformers.map((performer) => ({\r\n      instrument: performer.instrument as StagePerformerInstrument,\r\n      id: performer.id,\r\n      portraitSrc: performer.portraitSrc,\r\n    })),\r\n    [stageBandPerformers]\r\n  );\r\n\r\n  const stage3DActiveMusiciansSignature = useMemo(\r\n    () => stage3DActiveMusicians\r\n      .map((performer) => `${performer.instrument}:${performer.id}:${performer.portraitSrc}`)\r\n      .join('|'),\r\n    [stage3DActiveMusicians]\r\n  );\r\n\r\n  return {\r\n    stages,\r\n    availableMusics,\r\n    musicians,\r\n    selectedMusic,\r\n    activeBand,\r\n    activeBandMusicians,\r\n    bandHypeValue,\r\n    bandFansValue,\r\n    bandPerformanceValue,\r\n    bandCacheValue,\r\n    selectedStage,\r\n    stageMapEntries,\r\n    stageBackground,\r\n    stage3DBackground,\r\n    selectedStageBadge,\r\n    stageAnimatedBackground,\r\n    filteredMusicians,\r\n    listedMusicians,\r\n    availableBandCoins,\r\n    selectedInstrument,\r\n    unlockedMusicianIdSet,\r\n    isSelectedMusicianHired,\r\n    hasEnoughCoinsForSelected,\r\n    canHireSelectedMusician,\r\n    isSelectedMusicianLockedByCoins,\r\n    selectedMusicianRarityClass,\r\n    selectedMusicianFace,\r\n    selectedMusicianPortrait,\r\n    selectedMusicianInitials,\r\n    selectedMusicianInstrumentIcon,\r\n    selectedMusicianPrice,\r\n    listedMusicianItems,\r\n    availableToHireCount,\r\n    selectedMusicStems,\r\n    activeBandInstruments,\r\n    instrumentVolumeControls,\r\n    bandInstrumentColumns,\r\n    selectorMusicians,\r\n    selectedSelectorMusicianId,\r\n    stageBandPerformers,\r\n    stage3DActiveMusicians,\r\n    stage3DActiveMusiciansSignature,\r\n  };\r\n};\r\n","import React, { useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\r\nimport { Howl, Howler } from 'howler';\r\nimport { useGameStore, type Instrument } from '../state/gameStore';\r\nimport BandConfigModal from './band/BandConfigModal';\r\nimport BandManagementScreen from './band/BandManagementScreen';\r\nimport MusiciansContractScreen from './musicians/MusiciansContractScreen';\r\nimport StageTopValuesBar from './stage/StageTopValuesBar';\r\nimport StageBottomNav from './stage/StageBottomNav';\r\nimport StageProgressList from './stage/StageProgressList';\r\nimport StageCenterPanel from './stage/StageCenterPanel';\r\nimport StageCurrentSongBar from './stage/StageCurrentSongBar';\r\nimport StageVisualEffectsLayer from './stage/StageVisualEffectsLayer';\r\nimport Stage3DScene from './stage/Stage3DScene';\r\nimport StageMapModal from './stage/StageMapModal';\r\nimport useBandScreensState from '../hooks/useBandScreensState';\r\nimport { playUiClickSound } from '../utils/clickAudio';\r\nimport { pauseThemeMusic, playThemeMusic } from '../utils/themeAudio';\r\nimport { useBandGameComputed } from '../hooks/useBandGameComputed';\r\nimport { resolveStageAsset, resolveStageMapBadgeAsset } from '../utils/assetResolvers';\r\nimport {\r\n  AMBIENCE_FADE_IN_MS,\r\n  AMBIENCE_FADE_OUT_MS,\r\n  BAND_CONFIG_CLOSE_MS,\r\n  BAND_MODAL_CLOSE_MS,\r\n  CROWD_DECAY_EVERY_STEPS,\r\n  DEFAULT_MUSIC_BPM,\r\n  FANS_GAIN_BASE_RATE,\r\n  FANS_GAIN_MAX_RATE,\r\n  FANS_GAIN_STEP_MS,\r\n  FANS_GAIN_STEP_RATE,\r\n  MAP_AMBIENCE_VOLUME,\r\n  MAP_RETURN_FADE_IN_MS,\r\n  MAP_RETURN_FADE_OUT_MS,\r\n  MAX_TAP_EFFECTS,\r\n  MUSICIANS_DETAIL_CLOSE_MS,\r\n  MUSICIANS_MODAL_CLOSE_MS,\r\n  POST_MUSIC_DECAY,\r\n  PRE_MUSIC_DECAY,\r\n  PRE_MUSIC_TAP_GAIN,\r\n  RHYTHM_PLAY_THRESHOLD,\r\n  SHOW_FAME_REWARD,\r\n  STAGE_AMBIENCE_VOLUME,\r\n  STAGE_STEM_FADE_IN_MS,\r\n  STAGE_STEM_FADE_OUT_MS,\r\n  TAP_EFFECT_LIFETIME_MS,\r\n  instrumentPlaybackOrder,\r\n  bandMenuOptions,\r\n  instrumentLabels,\r\n  filterOptions,\r\n  instrumentNameById,\r\n  getRhythmTone,\r\n} from '../constants/bandGame';\r\nimport {\r\n  ambienceMapAudio,\r\n  ambienceStageCrowdAudio,\r\n  backgroundAudicao,\r\n  backgroundBackstage,\r\n  defaultStageFloorTexture,\r\n  iconAudioOn,\r\n  iconCamera,\r\n  iconBloqueado,\r\n  iconCache,\r\n  iconConfigBlack,\r\n  iconConfigWhite,\r\n  iconCost,\r\n  iconDisponivel,\r\n  iconExitBand,\r\n  iconFameBlack,\r\n  iconFameWhite,\r\n  iconFansBlack,\r\n  iconFansWhite,\r\n  iconFechar,\r\n  iconIngresso,\r\n  iconIngressoBranco,\r\n  iconMoneyBlack,\r\n  iconMoneyWhite,\r\n  iconMusicWhite,\r\n  iconRhythmWhite,\r\n  iconValorCacheTotal,\r\n  iconMusicoVazio,\r\n  navBand,\r\n  navHire,\r\n  navSongs,\r\n  navStage,\r\n  navStore,\r\n  portraitContratante,\r\n  sfxCrowdApplause,\r\n  sfxMoneyReward,\r\n  sfxPurchased,\r\n  sfxStarReward,\r\n  stageWorldMap,\r\n  stageWorldPreview,\r\n} from '../assets/bandGameAssets';\r\nimport type { BandMenuView, HireFilter, MusicianData } from '../types/bandGame';\r\n\r\ntype BandGameProps = {\r\n  onBackToMenu: () => void;\r\n};\r\n\r\ntype RewardParticle = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  x: number;\r\n  y: number;\r\n  dx: number;\r\n  dy: number;\r\n  delay: number;\r\n  duration: number;\r\n};\r\n\r\ntype RewardFloatText = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  value: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\nconst formatCurrency = (value: number) =>\r\n  value.toLocaleString('pt-BR', {\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2,\r\n  });\r\n\r\nconst formatNumber = (value: number) => value.toLocaleString('pt-BR');\r\n\r\nconst formatPerformancePercent = (value: number) => {\r\n  const normalized = value <= 10 ? value * 10 : value;\r\n  const clamped = Math.max(0, Math.min(100, normalized));\r\n  return `+${Math.round(clamped)}%`;\r\n};\r\n\r\nconst getHowlCurrentTime = (audio: Howl | null) => {\r\n  if (!audio) {\r\n    return 0;\r\n  }\r\n\r\n  const seekValue = audio.seek();\r\n  if (typeof seekValue !== 'number' || !Number.isFinite(seekValue)) {\r\n    return 0;\r\n  }\r\n\r\n  return Math.max(0, seekValue);\r\n};\r\n\r\nconst isAudioActuallyPlaying = (audio: Howl | null) =>\r\n  Boolean(audio && audio.playing() && getHowlCurrentTime(audio) > 0);\r\n\r\n\r\nconst BandGame: React.FC<BandGameProps> = ({ onBackToMenu }) => {\r\n  const bands = useGameStore((state) => state.bands);\r\n  const activeBandId = useGameStore((state) => state.activeBandId);\r\n  const currentStageId = useGameStore((state) => state.currentStageId);\r\n  const setCurrentStage = useGameStore((state) => state.setCurrentStage);\r\n  const applyShowRewards = useGameStore((state) => state.applyShowRewards);\r\n  const addFameStars = useGameStore((state) => state.addFameStars);\r\n  const hireMusician = useGameStore((state) => state.hireMusician);\r\n  const setBandMusicianSelection = useGameStore((state) => state.setBandMusicianSelection);\r\n  const showPerformance = useGameStore((state) => state.showPerformance);\r\n  const score = useGameStore((state) => state.score);\r\n  const isMusicEnabled = useGameStore((state) => state.audioSettings.musicEnabled);\r\n  const isSfxEnabled = useGameStore((state) => state.audioSettings.sfxEnabled);\r\n  const instrumentVolumes = useGameStore((state) => state.audioSettings.instrumentVolumes);\r\n  const isCameraMotionEnabled = useGameStore((state) => state.cameraMotionEnabled);\r\n  const setMusicEnabled = useGameStore((state) => state.setMusicEnabled);\r\n  const setSfxEnabled = useGameStore((state) => state.setSfxEnabled);\r\n  const setCameraMotionEnabled = useGameStore((state) => state.setCameraMotionEnabled);\r\n  const setInstrumentVolume = useGameStore((state) => state.setInstrumentVolume);\r\n  const [hireFilter, setHireFilter] = useState<HireFilter>('all');\r\n  const [rhythmMeter, setRhythmMeter] = useState(0);\r\n  const [showCrowd, setShowCrowd] = useState(0);\r\n  const [sessionNetGain, setSessionNetGain] = useState(0);\r\n  const [isMusicPlaying, setIsMusicPlaying] = useState(false);\r\n  const [fansGainRate, setFansGainRate] = useState(0);\r\n  const [musicStreakMs, setMusicStreakMs] = useState(0);\r\n  const [fansStepFlash, setFansStepFlash] = useState(false);\r\n  const [rhythmBonus, setRhythmBonus] = useState(1);\r\n  const [bonusFlash, setBonusFlash] = useState(false);\r\n  const [metronomeTick, setMetronomeTick] = useState(false);\r\n  const [beatHitFeedback, setBeatHitFeedback] = useState(false);\r\n  const [songDurationSec, setSongDurationSec] = useState(0);\r\n  const [songCurrentSec, setSongCurrentSec] = useState(0);\r\n  const lastPulseAtRef = useRef<number | null>(null);\r\n  const metronomeStartAtRef = useRef(Date.now());\r\n  const garageAudioRef = useRef<Howl | null>(null);\r\n  const stageStemAudiosRef = useRef<Partial<Record<Instrument, Howl>>>({});\r\n  const stagePlaybackSecRef = useRef(0);\r\n  const stageStemFadeTimeoutsRef = useRef<Partial<Record<Instrument, number>>>({});\r\n  const isMusicPlayingRef = useRef(false);\r\n  const rhythmStreakRef = useRef(0);\r\n  const rhythmBonusRef = useRef(1);\r\n  const bonusFlashTimeoutRef = useRef<number | null>(null);\r\n  const metronomeFlashTimeoutRef = useRef<number | null>(null);\r\n  const metronomeAnimationFrameRef = useRef<number | null>(null);\r\n  const metronomeBeatIndexRef = useRef(-1);\r\n  const beatHitTimeoutRef = useRef<number | null>(null);\r\n  const loopTransitionTimeoutRef = useRef<number | null>(null);\r\n  const stagePlayPendingRef = useRef(false);\r\n  const rhythmMeterRef = useRef(0);\r\n  const hasActiveMusiciansRef = useRef(false);\r\n  const isMusicEnabledRef = useRef(true);\r\n  const stageVideoRef = useRef<HTMLVideoElement | null>(null);\r\n  const stageRef = useRef<HTMLElement | null>(null);\r\n  const topFansRef = useRef<HTMLDivElement | null>(null);\r\n  const topMoneyRef = useRef<HTMLDivElement | null>(null);\r\n  const topFameRef = useRef<HTMLDivElement | null>(null);\r\n  const fameTrackRef = useRef<HTMLDivElement | null>(null);\r\n  const crowdTrackRef = useRef<HTMLDivElement | null>(null);\r\n  const gainMeterRef = useRef<HTMLDivElement | null>(null);\r\n  const centerPanelRef = useRef<HTMLDivElement | null>(null);\r\n  const currentSongBarRef = useRef<HTMLDivElement | null>(null);\r\n  const fansGainTrackRef = useRef<HTMLDivElement | null>(null);\r\n  const tapEffectIdRef = useRef(0);\r\n  const rewardAnimationIdRef = useRef(0);\r\n  const soldOutHandledRef = useRef(false);\r\n  const fameProgressRef = useRef(0);\r\n  const crowdDecayStepRef = useRef(0);\r\n  const crowdDecayAmountRef = useRef(0);\r\n  const fansStepIndexRef = useRef(0);\r\n  const fansStepFlashTimeoutRef = useRef<number | null>(null);\r\n  const mapReturnTransitionTimeoutRef = useRef<number | null>(null);\r\n  const [tapEffects, setTapEffects] = useState<Array<{ id: number; x: number; y: number }>>([]);\r\n  const [rewardParticles, setRewardParticles] = useState<RewardParticle[]>([]);\r\n  const [rewardTexts, setRewardTexts] = useState<RewardFloatText[]>([]);\r\n  const [isLoopTransitioning, setIsLoopTransitioning] = useState(false);\r\n  const [isStageShowActive, setIsStageShowActive] = useState(false);\r\n  const [isSideMenuHiding, setIsSideMenuHiding] = useState(false);\r\n  const [shouldRenderSideMenu, setShouldRenderSideMenu] = useState(true);\r\n  const [mapIntroPlayId, setMapIntroPlayId] = useState(0);\r\n  const [mapUiRevealId, setMapUiRevealId] = useState(0);\r\n  const [isMapIntroVisible, setIsMapIntroVisible] = useState(false);\r\n  const [mapPreviewBannerUrl, setMapPreviewBannerUrl] = useState<string | null>(null);\r\n  const [mapReturnTransitionPhase, setMapReturnTransitionPhase] = useState<'idle' | 'to-black' | 'from-black'>('idle');\r\n  const [bandMenuView, setBandMenuView] = useState<BandMenuView>('band');\r\n  const [fameProgressValue, setFameProgressValue] = useState(0);\r\n  const [famePulseTick, setFamePulseTick] = useState(0);\r\n  const prevActiveScreenRef = useRef<'band' | 'musicians'>('band');\r\n  const prevActiveBandIdRef = useRef<string | null>(activeBandId ?? null);\r\n  const hasInitialMapIntroPlayedRef = useRef(false);\r\n  const prevIntroVisibleRef = useRef(false);\r\n  const sideMenuHideTimeoutRef = useRef<number | null>(null);\r\n  const moneyRewardHowlRef = useRef<Howl | null>(null);\r\n  const applauseHowlRef = useRef<Howl | null>(null);\r\n  const purchaseHowlRef = useRef<Howl | null>(null);\r\n  const starRewardHowlRef = useRef<Howl | null>(null);\r\n  const mapAmbienceHowlRef = useRef<Howl | null>(null);\r\n  const stageAmbienceHowlRef = useRef<Howl | null>(null);\r\n  const mapAmbienceFadeTimeoutRef = useRef<number | null>(null);\r\n  const stageAmbienceFadeTimeoutRef = useRef<number | null>(null);\r\n  const {\r\n    activeScreen,\r\n    isClosingMusiciansScreen,\r\n    selectedMusicianDetails,\r\n    isMusicianStoryOpen,\r\n    isClosingMusicianDetails,\r\n    isBandConfigOpen,\r\n    isClosingBandConfig,\r\n    isBandManagementOpen,\r\n    isClosingBandManagement,\r\n    activeBandSelectorInstrument,\r\n    setActiveBandSelectorInstrument,\r\n    openBandConfig,\r\n    closeBandConfig,\r\n    openBandManagementScreen,\r\n    closeBandManagementScreen,\r\n    openMusiciansScreen,\r\n    openMusicianDetails,\r\n    closeMusicianDetails,\r\n    closeMusiciansScreen,\r\n    toggleMusicianStory,\r\n  } = useBandScreensState<MusicianData>({\r\n    musiciansModalCloseMs: MUSICIANS_MODAL_CLOSE_MS,\r\n    musicianDetailsCloseMs: MUSICIANS_DETAIL_CLOSE_MS,\r\n    bandModalCloseMs: BAND_MODAL_CLOSE_MS,\r\n    bandConfigCloseMs: BAND_CONFIG_CLOSE_MS,\r\n    onStoryToggleSound: (isOpening) => {\r\n      playUiClickSound(isOpening ? 'open' : 'close');\r\n    },\r\n  });\r\n\r\n  const {\r\n    stages,\r\n    selectedMusic,\r\n    activeBand,\r\n    activeBandMusicians,\r\n    bandHypeValue,\r\n    bandFansValue,\r\n    bandPerformanceValue,\r\n    bandCacheValue,\r\n    selectedStage,\r\n    stageMapEntries,\r\n    stageBackground,\r\n    stage3DBackground,\r\n    selectedStageBadge,\r\n    stageAnimatedBackground,\r\n    listedMusicians,\r\n    availableBandCoins,\r\n    selectedInstrument,\r\n    unlockedMusicianIdSet,\r\n    isSelectedMusicianHired,\r\n    hasEnoughCoinsForSelected,\r\n    canHireSelectedMusician,\r\n    isSelectedMusicianLockedByCoins,\r\n    selectedMusicianRarityClass,\r\n    selectedMusicianFace,\r\n    selectedMusicianPortrait,\r\n    selectedMusicianInitials,\r\n    selectedMusicianInstrumentIcon,\r\n    selectedMusicianPrice,\r\n    listedMusicianItems,\r\n    availableToHireCount,\r\n    selectedMusicStems,\r\n    activeBandInstruments,\r\n    instrumentVolumeControls,\r\n    bandInstrumentColumns,\r\n    selectorMusicians,\r\n    selectedSelectorMusicianId,\r\n    stage3DActiveMusicians,\r\n    stage3DActiveMusiciansSignature,\r\n  } = useBandGameComputed({\r\n    bands,\r\n    activeBandId,\r\n    currentStageId,\r\n    hireFilter,\r\n    instrumentVolumes,\r\n    activeBandSelectorInstrument,\r\n    selectedMusicianDetails,\r\n  });\r\n\r\n  const hasActiveMusicians = activeBandMusicians.length > 0;\r\n  const isMusiciansScreenVisible = activeScreen === 'musicians' || isClosingMusiciansScreen;\r\n  const isBandManagementScreenVisible = isBandManagementOpen || isClosingBandManagement;\r\n  const isBandConfigVisible = isBandConfigOpen || isClosingBandConfig;\r\n  const activeBandInstrumentsKey = activeBandInstruments.join('|');\r\n  const bandManagementBackgroundImage = !isStageShowActive && mapPreviewBannerUrl ? mapPreviewBannerUrl : backgroundBackstage;\r\n\r\n  useEffect(() => {\r\n    const shouldPlayMapTheme = isMusicEnabled && !isStageShowActive && mapReturnTransitionPhase !== 'to-black';\r\n\r\n    if (!shouldPlayMapTheme) {\r\n      pauseThemeMusic('map');\r\n      return;\r\n    }\r\n\r\n    playThemeMusic('map');\r\n  }, [isMusicEnabled, isStageShowActive, mapReturnTransitionPhase]);\r\n\r\n  const getStageAudios = () =>\r\n    Object.values(stageStemAudiosRef.current).filter((audio): audio is Howl => Boolean(audio));\r\n\r\n  const clearStageStemFadeTimeout = (instrument: Instrument) => {\r\n    const timeoutId = stageStemFadeTimeoutsRef.current[instrument];\r\n    if (timeoutId) {\r\n      window.clearTimeout(timeoutId);\r\n      delete stageStemFadeTimeoutsRef.current[instrument];\r\n    }\r\n  };\r\n\r\n  const pauseStageAudios = () => {\r\n    const stageAudios = getStageAudios();\r\n    if (stageAudios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const primaryAudio = garageAudioRef.current ?? stageAudios[0];\r\n    stagePlaybackSecRef.current = getHowlCurrentTime(primaryAudio);\r\n\r\n    instrumentPlaybackOrder.forEach((instrument) => {\r\n      const audio = stageStemAudiosRef.current[instrument];\r\n      if (!audio) {\r\n        return;\r\n      }\r\n\r\n      clearStageStemFadeTimeout(instrument);\r\n\r\n      if (!audio.playing()) {\r\n        audio.volume(0);\r\n        return;\r\n      }\r\n\r\n      const currentVolume = Number(audio.volume()) || 0;\r\n      audio.fade(currentVolume, 0, STAGE_STEM_FADE_OUT_MS);\r\n      stageStemFadeTimeoutsRef.current[instrument] = window.setTimeout(() => {\r\n        if (audio.playing()) {\r\n          audio.pause();\r\n        }\r\n        audio.volume(0);\r\n        delete stageStemFadeTimeoutsRef.current[instrument];\r\n      }, STAGE_STEM_FADE_OUT_MS + 40);\r\n    });\r\n  };\r\n\r\n  const clearAmbienceFadeTimeout = (timeoutRef: React.MutableRefObject<number | null>) => {\r\n    if (timeoutRef.current) {\r\n      window.clearTimeout(timeoutRef.current);\r\n      timeoutRef.current = null;\r\n    }\r\n  };\r\n\r\n  const playAmbienceWithFade = (\r\n    ambienceHowl: Howl | null,\r\n    targetVolume: number,\r\n    fadeTimeoutRef: React.MutableRefObject<number | null>\r\n  ) => {\r\n    if (!ambienceHowl) {\r\n      return;\r\n    }\r\n\r\n    clearAmbienceFadeTimeout(fadeTimeoutRef);\r\n\r\n    if (!ambienceHowl.playing()) {\r\n      ambienceHowl.volume(0);\r\n      ambienceHowl.play();\r\n    }\r\n\r\n    const currentVolume = Number(ambienceHowl.volume()) || 0;\r\n    if (currentVolume >= targetVolume) {\r\n      ambienceHowl.volume(targetVolume);\r\n      return;\r\n    }\r\n\r\n    ambienceHowl.fade(currentVolume, targetVolume, AMBIENCE_FADE_IN_MS);\r\n  };\r\n\r\n  const stopAmbienceWithFade = (\r\n    ambienceHowl: Howl | null,\r\n    fadeTimeoutRef: React.MutableRefObject<number | null>\r\n  ) => {\r\n    if (!ambienceHowl) {\r\n      return;\r\n    }\r\n\r\n    clearAmbienceFadeTimeout(fadeTimeoutRef);\r\n\r\n    if (!ambienceHowl.playing()) {\r\n      ambienceHowl.stop();\r\n      ambienceHowl.seek(0);\r\n      ambienceHowl.volume(0);\r\n      return;\r\n    }\r\n\r\n    const currentVolume = Number(ambienceHowl.volume()) || 0;\r\n    ambienceHowl.fade(currentVolume, 0, AMBIENCE_FADE_OUT_MS);\r\n    fadeTimeoutRef.current = window.setTimeout(() => {\r\n      ambienceHowl.stop();\r\n      ambienceHowl.seek(0);\r\n      ambienceHowl.volume(0);\r\n      fadeTimeoutRef.current = null;\r\n    }, AMBIENCE_FADE_OUT_MS + 60);\r\n  };\r\n\r\n  const attemptStageAudioPlay = () => {\r\n    const stageAudios = getStageAudios();\r\n    if (stageAudios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const stageAudio = garageAudioRef.current ?? stageAudios[0];\r\n    garageAudioRef.current = stageAudio;\r\n\r\n    if (!hasActiveMusiciansRef.current || !isMusicEnabledRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (rhythmMeterRef.current <= RHYTHM_PLAY_THRESHOLD) {\r\n      return;\r\n    }\r\n\r\n    const baseTime = Math.max(stagePlaybackSecRef.current, getHowlCurrentTime(stageAudio));\r\n\r\n    if (stagePlayPendingRef.current || isMusicPlayingRef.current || stageAudio.playing()) {\r\n      return;\r\n    }\r\n\r\n    Howler.autoSuspend = false;\r\n    void Howler.ctx?.resume();\r\n\r\n    stagePlayPendingRef.current = true;\r\n\r\n    instrumentPlaybackOrder.forEach((instrument) => {\r\n      const audio = stageStemAudiosRef.current[instrument];\r\n      if (!audio) {\r\n        return;\r\n      }\r\n\r\n      clearStageStemFadeTimeout(instrument);\r\n\r\n      const targetVolume = isMusicEnabledRef.current ? (instrumentVolumes[instrument] ?? 1) : 0;\r\n      const startFromZero = !audio.playing();\r\n\r\n      if (startFromZero) {\r\n        audio.seek(baseTime);\r\n        audio.volume(0);\r\n        audio.play();\r\n      }\r\n\r\n      const currentVolume = Number(audio.volume()) || 0;\r\n      if (currentVolume === targetVolume) {\r\n        return;\r\n      }\r\n\r\n      audio.fade(currentVolume, targetVolume, STAGE_STEM_FADE_IN_MS);\r\n    });\r\n  };\r\n\r\n  if (!activeBand) {\r\n    return (\r\n      <section className=\"game-screen\">\r\n        <div className=\"empty-card\">\r\n          <p>Nenhuma banda selecionada.</p>\r\n          <button type=\"button\" className=\"primary-btn\" onClick={onBackToMenu} data-click-sfx=\"close\">\r\n            Voltar ao menu\r\n          </button>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  const fameTarget = selectedStage?.Hype ?? 5000;\r\n  const lotacaoTarget = selectedStage?.Lotacao ?? 100;\r\n  const fameValue = fameProgressValue;\r\n  const lotacaoValue = showCrowd;\r\n  const fansTapGain = Math.max(0, bandFansValue);\r\n  const hypeTapGain = Math.max(0, bandHypeValue);\r\n  const famePct = Math.min(100, (fameValue / fameTarget) * 100);\r\n  const lotacaoPct = Math.min(100, (lotacaoValue / lotacaoTarget) * 100);\r\n  const bandCostValue = Math.max(0, bandCacheValue);\r\n  const stageTicketPrice = selectedStage?.Ingresso ?? 5;\r\n  const lotacaoTotalValue = lotacaoTarget * stageTicketPrice;\r\n  const gainValue = Math.max(0, lotacaoTotalValue - bandCostValue);\r\n  const fansRewardOnSoldOut = Math.round(lotacaoTarget * fansGainRate);\r\n  const currentSongName = selectedMusic?.nome ?? 'Música Principal';\r\n  const currentSongBpm = Math.max(1, selectedMusic?.bpm ?? DEFAULT_MUSIC_BPM);\r\n  const metronomeBeatMs = 60000 / currentSongBpm;\r\n  const metronomeHitWindowMs = metronomeBeatMs * 0.28;\r\n  const elapsedInCurrentStepMs = musicStreakMs % FANS_GAIN_STEP_MS;\r\n  const stepProgress = elapsedInCurrentStepMs / FANS_GAIN_STEP_MS;\r\n  const nextVisualRate = Math.min(FANS_GAIN_MAX_RATE, fansGainRate + FANS_GAIN_STEP_RATE * stepProgress);\r\n  const fansGainDisplayRate = isMusicPlaying ? nextVisualRate : fansGainRate;\r\n  const fansGainBarPct = (fansGainDisplayRate / FANS_GAIN_MAX_RATE) * 100;\r\n  const songProgressPct = songDurationSec > 0 ? Math.min(100, (songCurrentSec / songDurationSec) * 100) : 0;\r\n  const totalFlow = Math.max(1, gainValue + bandCostValue);\r\n  const costSharePct = (bandCostValue / totalFlow) * 100;\r\n  const gainSharePct = 100 - costSharePct;\r\n\r\n\r\n  useEffect(() => {\r\n    metronomeStartAtRef.current = Date.now();\r\n  }, [metronomeBeatMs]);\r\n\r\n  const getCenter = (element: HTMLElement | null) => {\r\n    if (!element || !stageRef.current) {\r\n      return null;\r\n    }\r\n\r\n    const stageBounds = stageRef.current.getBoundingClientRect();\r\n    const bounds = element.getBoundingClientRect();\r\n    return {\r\n      x: bounds.left - stageBounds.left + bounds.width / 2,\r\n      y: bounds.top - stageBounds.top + bounds.height / 2,\r\n    };\r\n  };\r\n\r\n  const triggerFameStarRewardAnimation = (starsGained: number) => {\r\n    if (starsGained <= 0) {\r\n      return;\r\n    }\r\n\r\n    const fameStart = getCenter(fameTrackRef.current);\r\n    const fameEnd = getCenter(topFameRef.current);\r\n\r\n    if (!fameStart || !fameEnd) {\r\n      return;\r\n    }\r\n\r\n    for (let index = 0; index < starsGained; index += 1) {\r\n      const id = rewardAnimationIdRef.current + 1;\r\n      rewardAnimationIdRef.current = id;\r\n      const delay = index * 180;\r\n\r\n      const fameParticle: RewardParticle = {\r\n        id,\r\n        kind: 'fame',\r\n        x: fameStart.x,\r\n        y: fameStart.y,\r\n        dx: fameEnd.x - fameStart.x,\r\n        dy: fameEnd.y - fameStart.y,\r\n        delay,\r\n        duration: 920,\r\n      };\r\n\r\n      setRewardParticles((currentParticles) => [...currentParticles, fameParticle]);\r\n      window.setTimeout(() => {\r\n        setRewardParticles((currentParticles) =>\r\n          currentParticles.filter((particle) => particle.id !== id)\r\n        );\r\n      }, delay + 1200);\r\n\r\n      window.setTimeout(() => {\r\n        setFamePulseTick((current) => current + 1);\r\n      }, delay + 900);\r\n    }\r\n  };\r\n\r\n  const applyFameGain = (gain: number) => {\r\n    if (gain <= 0 || fameTarget <= 0) {\r\n      return;\r\n    }\r\n\r\n    const total = fameProgressRef.current + gain;\r\n    const earnedStars = Math.floor(total / fameTarget);\r\n    const nextProgress = total % fameTarget;\r\n\r\n    fameProgressRef.current = nextProgress;\r\n    setFameProgressValue(nextProgress);\r\n\r\n    if (earnedStars > 0) {\r\n      addFameStars(earnedStars);\r\n      triggerFameStarRewardAnimation(earnedStars);\r\n      playFameStarSound();\r\n    }\r\n  };\r\n\r\n  const triggerSoldOutRewardAnimation = () => {\r\n\r\n    const fansStart = getCenter(crowdTrackRef.current);\r\n    const fansEnd = getCenter(topFansRef.current);\r\n    const moneyStart = getCenter(gainMeterRef.current);\r\n    const moneyEnd = getCenter(topMoneyRef.current);\r\n\r\n    if (fansStart && fansEnd) {\r\n      const newFansParticles: RewardParticle[] = Array.from({ length: 10 }, (_, index) => {\r\n        const id = rewardAnimationIdRef.current + 1;\r\n        rewardAnimationIdRef.current = id;\r\n        return {\r\n          id,\r\n          kind: 'fans',\r\n          x: fansStart.x + (Math.random() * 12 - 6),\r\n          y: fansStart.y + (Math.random() * 12 - 6),\r\n          dx: fansEnd.x - fansStart.x + (Math.random() * 26 - 13),\r\n          dy: fansEnd.y - fansStart.y + (Math.random() * 18 - 9),\r\n          delay: index * 34,\r\n          duration: 820,\r\n        };\r\n      });\r\n      const idsToClear = newFansParticles.map((particle) => particle.id);\r\n      setRewardParticles((currentParticles) => [...currentParticles, ...newFansParticles]);\r\n      window.setTimeout(() => {\r\n        setRewardParticles((currentParticles) =>\r\n          currentParticles.filter((particle) => !idsToClear.includes(particle.id))\r\n        );\r\n      }, 1480);\r\n\r\n      const fansTextId = rewardAnimationIdRef.current + 1;\r\n      rewardAnimationIdRef.current = fansTextId;\r\n      setRewardTexts((currentTexts) => [\r\n        ...currentTexts,\r\n        { id: fansTextId, kind: 'fans', value: fansRewardOnSoldOut, x: fansEnd.x, y: fansEnd.y },\r\n      ]);\r\n      window.setTimeout(() => {\r\n        setRewardTexts((currentTexts) => currentTexts.filter((entry) => entry.id !== fansTextId));\r\n      }, 3200);\r\n    }\r\n\r\n    if (moneyStart && moneyEnd) {\r\n      const newMoneyParticles: RewardParticle[] = Array.from({ length: 8 }, (_, index) => {\r\n        const id = rewardAnimationIdRef.current + 1;\r\n        rewardAnimationIdRef.current = id;\r\n        return {\r\n          id,\r\n          kind: 'money',\r\n          x: moneyStart.x + (Math.random() * 12 - 6),\r\n          y: moneyStart.y + (Math.random() * 12 - 6),\r\n          dx: moneyEnd.x - moneyStart.x + (Math.random() * 22 - 11),\r\n          dy: moneyEnd.y - moneyStart.y + (Math.random() * 16 - 8),\r\n          delay: index * 30,\r\n          duration: 860,\r\n        };\r\n      });\r\n      const idsToClear = newMoneyParticles.map((particle) => particle.id);\r\n      setRewardParticles((currentParticles) => [...currentParticles, ...newMoneyParticles]);\r\n      window.setTimeout(() => {\r\n        setRewardParticles((currentParticles) =>\r\n          currentParticles.filter((particle) => !idsToClear.includes(particle.id))\r\n        );\r\n      }, 1520);\r\n\r\n      const moneyTextId = rewardAnimationIdRef.current + 1;\r\n      rewardAnimationIdRef.current = moneyTextId;\r\n      setRewardTexts((currentTexts) => [\r\n        ...currentTexts,\r\n        { id: moneyTextId, kind: 'money', value: gainValue, x: moneyEnd.x, y: moneyEnd.y },\r\n      ]);\r\n      window.setTimeout(() => {\r\n        setRewardTexts((currentTexts) => currentTexts.filter((entry) => entry.id !== moneyTextId));\r\n      }, 3400);\r\n    }\r\n  };\r\n\r\n  const handleExitStageShow = () => {\r\n    if (mapReturnTransitionPhase !== 'idle') {\r\n      return;\r\n    }\r\n\r\n    pauseStageAudios();\r\n    stopAmbienceWithFade(stageAmbienceHowlRef.current, stageAmbienceFadeTimeoutRef);\r\n    stagePlayPendingRef.current = false;\r\n    lastPulseAtRef.current = 0;\r\n    rhythmStreakRef.current = 0;\r\n    rhythmBonusRef.current = 1;\r\n    metronomeBeatIndexRef.current = -1;\r\n\r\n    setIsMusicPlaying(false);\r\n    setMetronomeTick(false);\r\n    setBeatHitFeedback(false);\r\n    setRhythmBonus(1);\r\n    setRhythmMeter(0);\r\n    setBonusFlash(false);\r\n\r\n    setMapReturnTransitionPhase('to-black');\r\n    if (mapReturnTransitionTimeoutRef.current) {\r\n      window.clearTimeout(mapReturnTransitionTimeoutRef.current);\r\n    }\r\n\r\n    mapReturnTransitionTimeoutRef.current = window.setTimeout(() => {\r\n      setIsLoopTransitioning(false);\r\n      setIsStageShowActive(false);\r\n      setIsSideMenuHiding(false);\r\n      setMapReturnTransitionPhase('from-black');\r\n\r\n      mapReturnTransitionTimeoutRef.current = window.setTimeout(() => {\r\n        setMapReturnTransitionPhase('idle');\r\n        mapReturnTransitionTimeoutRef.current = null;\r\n      }, MAP_RETURN_FADE_IN_MS);\r\n    }, MAP_RETURN_FADE_OUT_MS);\r\n  };\r\n\r\n  const triggerLoopTransition = () => {\r\n    setIsLoopTransitioning(true);\r\n    if (loopTransitionTimeoutRef.current) {\r\n      window.clearTimeout(loopTransitionTimeoutRef.current);\r\n    }\r\n    loopTransitionTimeoutRef.current = window.setTimeout(() => {\r\n      setIsLoopTransitioning(false);\r\n    }, 360);\r\n  };\r\n\r\n  const handleStageVideoEnded = () => {\r\n    const stageVideo = stageVideoRef.current;\r\n    if (!stageVideo) {\r\n      return;\r\n    }\r\n\r\n    triggerLoopTransition();\r\n    stageVideo.currentTime = 0;\r\n    void stageVideo.play().catch(() => undefined);\r\n  };\r\n\r\n  const handleRhythmPulse = () => {\r\n    const stageAudio = garageAudioRef.current;\r\n    const audioRunning = isAudioActuallyPlaying(stageAudio);\r\n\r\n    if (audioRunning) {\r\n      if (fansTapGain > 0) {\r\n        setShowCrowd((current) => Math.min(lotacaoTarget, current + fansTapGain));\r\n      }\r\n      if (hypeTapGain > 0) {\r\n        applyShowRewards(0, hypeTapGain, 0);\r\n        applyFameGain(hypeTapGain);\r\n      }\r\n    }\r\n\r\n    if (!audioRunning) {\r\n      setBeatHitFeedback(false);\r\n      rhythmStreakRef.current = 0;\r\n      if (rhythmBonusRef.current !== 1) {\r\n        rhythmBonusRef.current = 1;\r\n        setRhythmBonus(1);\r\n      }\r\n      setRhythmMeter((current) => Math.min(100, current + PRE_MUSIC_TAP_GAIN));\r\n      return;\r\n    }\r\n\r\n    const now = Date.now();\r\n    const delta = lastPulseAtRef.current ? now - lastPulseAtRef.current : 0;\r\n    lastPulseAtRef.current = now;\r\n\r\n    const elapsed = stageAudio ? getHowlCurrentTime(stageAudio) * 1000 : now - metronomeStartAtRef.current;\r\n    const beatRemainder = elapsed % metronomeBeatMs;\r\n    const beatDistance = Math.min(beatRemainder, metronomeBeatMs - beatRemainder);\r\n    const onBeat = beatDistance <= metronomeHitWindowMs;\r\n\r\n    if (onBeat) {\r\n      setBeatHitFeedback(true);\r\n      if (beatHitTimeoutRef.current) {\r\n        window.clearTimeout(beatHitTimeoutRef.current);\r\n      }\r\n      beatHitTimeoutRef.current = window.setTimeout(() => {\r\n        setBeatHitFeedback(false);\r\n      }, 220);\r\n    }\r\n\r\n    if (delta > 0) {\r\n      if (onBeat) {\r\n        rhythmStreakRef.current += 1;\r\n      } else if (beatDistance <= metronomeHitWindowMs * 2) {\r\n        rhythmStreakRef.current = Math.max(0, rhythmStreakRef.current - 1);\r\n      } else {\r\n        rhythmStreakRef.current = 0;\r\n      }\r\n    }\r\n\r\n    const nextBonus =\r\n      rhythmStreakRef.current >= 10 ? 1.9 : rhythmStreakRef.current >= 7 ? 1.6 : rhythmStreakRef.current >= 4 ? 1.3 : 1;\r\n\r\n    if (nextBonus !== rhythmBonusRef.current) {\r\n      rhythmBonusRef.current = nextBonus;\r\n      setRhythmBonus(nextBonus);\r\n      if (nextBonus > 1) {\r\n        setBonusFlash(true);\r\n        if (bonusFlashTimeoutRef.current) {\r\n          window.clearTimeout(bonusFlashTimeoutRef.current);\r\n        }\r\n        bonusFlashTimeoutRef.current = window.setTimeout(() => {\r\n          setBonusFlash(false);\r\n        }, 240);\r\n      }\r\n    }\r\n\r\n    const gainBase = onBeat ? 8 : beatDistance <= metronomeHitWindowMs * 2 ? 5 : 3;\r\n    const gain = Math.ceil(gainBase * rhythmBonusRef.current);\r\n    setRhythmMeter((current) => Math.min(100, current + gain));\r\n  };\r\n\r\n  useEffect(() => {\r\n    fameProgressRef.current = 0;\r\n    setFameProgressValue(0);\r\n  }, [currentStageId, activeBandId]);\r\n\r\n  useEffect(() => {\r\n    if (!isStageShowActive) {\r\n      if (sideMenuHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(sideMenuHideTimeoutRef.current);\r\n        sideMenuHideTimeoutRef.current = null;\r\n      }\r\n      setIsSideMenuHiding(false);\r\n      setShouldRenderSideMenu(true);\r\n    }\r\n  }, [isStageShowActive]);\r\n\r\n  useEffect(() => {\r\n    if (prevIntroVisibleRef.current && !isMapIntroVisible) {\r\n      setMapUiRevealId((value) => value + 1);\r\n    }\r\n\r\n    prevIntroVisibleRef.current = isMapIntroVisible;\r\n  }, [isMapIntroVisible]);\r\n\r\n  useEffect(() => {\r\n    const isReturningFromMusicians = prevActiveScreenRef.current === 'musicians';\r\n\r\n    if (!isStageShowActive && activeScreen === 'band' && prevActiveScreenRef.current !== 'band' && !isReturningFromMusicians) {\r\n      setMapIntroPlayId((value) => value + 1);\r\n    }\r\n\r\n    prevActiveScreenRef.current = activeScreen;\r\n  }, [activeScreen, isStageShowActive]);\r\n\r\n  useEffect(() => {\r\n    if (!activeBandId) {\r\n      return;\r\n    }\r\n\r\n    if (!hasInitialMapIntroPlayedRef.current) {\r\n      setMapIntroPlayId((value) => value + 1);\r\n      hasInitialMapIntroPlayedRef.current = true;\r\n    }\r\n  }, [activeBandId]);\r\n\r\n  useEffect(() => {\r\n    if (!activeBandId) {\r\n      prevActiveBandIdRef.current = null;\r\n      hasInitialMapIntroPlayedRef.current = false;\r\n      return;\r\n    }\r\n\r\n    const isFirstBand = prevActiveBandIdRef.current === null;\r\n    const hasBandChanged = prevActiveBandIdRef.current !== null && prevActiveBandIdRef.current !== activeBandId;\r\n    const shouldPlayIntro = !isStageShowActive && (hasBandChanged || (isFirstBand && !hasInitialMapIntroPlayedRef.current));\r\n\r\n    if (shouldPlayIntro) {\r\n      setMapIntroPlayId((value) => value + 1);\r\n      hasInitialMapIntroPlayedRef.current = true;\r\n    }\r\n\r\n    prevActiveBandIdRef.current = activeBandId;\r\n    if (isFirstBand && activeBandId) {\r\n      hasInitialMapIntroPlayedRef.current = true;\r\n    }\r\n  }, [activeBandId, isStageShowActive]);\r\n\r\n  useEffect(() => {\r\n    mapAmbienceHowlRef.current = new Howl({\r\n      src: [ambienceMapAudio],\r\n      preload: true,\r\n      html5: false,\r\n      loop: true,\r\n      volume: 0,\r\n    });\r\n\r\n    stageAmbienceHowlRef.current = new Howl({\r\n      src: [ambienceStageCrowdAudio],\r\n      preload: true,\r\n      html5: false,\r\n      loop: true,\r\n      volume: 0,\r\n    });\r\n\r\n    return () => {\r\n      clearAmbienceFadeTimeout(mapAmbienceFadeTimeoutRef);\r\n      clearAmbienceFadeTimeout(stageAmbienceFadeTimeoutRef);\r\n\r\n      if (sideMenuHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(sideMenuHideTimeoutRef.current);\r\n        sideMenuHideTimeoutRef.current = null;\r\n      }\r\n\r\n      mapAmbienceHowlRef.current?.stop();\r\n      mapAmbienceHowlRef.current?.unload();\r\n      mapAmbienceHowlRef.current = null;\r\n\r\n      stageAmbienceHowlRef.current?.stop();\r\n      stageAmbienceHowlRef.current?.unload();\r\n      stageAmbienceHowlRef.current = null;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const isMapMenuModalOpen = isMusiciansScreenVisible || isBandManagementScreenVisible || isBandConfigVisible;\r\n    const shouldPlayMapAmbience =\r\n      isSfxEnabled && !isStageShowActive && mapReturnTransitionPhase !== 'to-black' && !isMapMenuModalOpen;\r\n    const shouldPlayStageAmbience = isMusicEnabled && isSfxEnabled && isStageShowActive;\r\n\r\n    if (isStageShowActive) {\r\n      stopAmbienceWithFade(mapAmbienceHowlRef.current, mapAmbienceFadeTimeoutRef);\r\n      if (shouldPlayStageAmbience) {\r\n        playAmbienceWithFade(stageAmbienceHowlRef.current, STAGE_AMBIENCE_VOLUME, stageAmbienceFadeTimeoutRef);\r\n      } else {\r\n        stopAmbienceWithFade(stageAmbienceHowlRef.current, stageAmbienceFadeTimeoutRef);\r\n      }\r\n      return;\r\n    }\r\n\r\n    stopAmbienceWithFade(stageAmbienceHowlRef.current, stageAmbienceFadeTimeoutRef);\r\n    if (shouldPlayMapAmbience) {\r\n      playAmbienceWithFade(mapAmbienceHowlRef.current, MAP_AMBIENCE_VOLUME, mapAmbienceFadeTimeoutRef);\r\n    } else {\r\n      stopAmbienceWithFade(mapAmbienceHowlRef.current, mapAmbienceFadeTimeoutRef);\r\n    }\r\n  }, [\r\n    isStageShowActive,\r\n    isMusicEnabled,\r\n    isSfxEnabled,\r\n    isMusiciansScreenVisible,\r\n    isBandManagementScreenVisible,\r\n    isBandConfigVisible,\r\n    mapReturnTransitionPhase,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    pauseStageAudios();\r\n    getStageAudios().forEach((audio) => {\r\n      audio.seek(0);\r\n    });\r\n\r\n    stagePlayPendingRef.current = false;\r\n    stagePlaybackSecRef.current = 0;\r\n    soldOutHandledRef.current = false;\r\n    crowdDecayStepRef.current = 0;\r\n\r\n    rhythmStreakRef.current = 0;\r\n    rhythmBonusRef.current = 1;\r\n    lastPulseAtRef.current = 0;\r\n\r\n    setSongCurrentSec(0);\r\n    setRhythmMeter(0);\r\n    setRhythmBonus(1);\r\n    setIsMusicPlaying(false);\r\n    setMetronomeTick(false);\r\n    metronomeBeatIndexRef.current = -1;\r\n  }, [currentStageId]);\r\n\r\n  useEffect(() => {\r\n    moneyRewardHowlRef.current = new Howl({\r\n      src: [sfxMoneyReward],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    applauseHowlRef.current = new Howl({\r\n      src: [sfxCrowdApplause],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    purchaseHowlRef.current = new Howl({\r\n      src: [sfxPurchased],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    starRewardHowlRef.current = new Howl({\r\n      src: [sfxStarReward],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    return () => {\r\n      moneyRewardHowlRef.current?.stop();\r\n      moneyRewardHowlRef.current?.unload();\r\n      moneyRewardHowlRef.current = null;\r\n\r\n      applauseHowlRef.current?.stop();\r\n      applauseHowlRef.current?.unload();\r\n      applauseHowlRef.current = null;\r\n\r\n      purchaseHowlRef.current?.stop();\r\n      purchaseHowlRef.current?.unload();\r\n      purchaseHowlRef.current = null;\r\n\r\n      starRewardHowlRef.current?.stop();\r\n      starRewardHowlRef.current?.unload();\r\n      starRewardHowlRef.current = null;\r\n    };\r\n  }, []);\r\n\r\n  const playSoldOutRewardSounds = () => {\r\n    if (!isSfxEnabled) {\r\n      return;\r\n    }\r\n\r\n    const moneySfx = moneyRewardHowlRef.current;\r\n    const applauseSfx = applauseHowlRef.current;\r\n\r\n    if (moneySfx) {\r\n      moneySfx.stop();\r\n      moneySfx.play();\r\n    }\r\n\r\n    if (applauseSfx) {\r\n      applauseSfx.stop();\r\n      applauseSfx.play();\r\n    }\r\n  };\r\n\r\n  const playPurchaseSound = () => {\r\n    if (!isSfxEnabled) {\r\n      return;\r\n    }\r\n\r\n    const purchaseSfx = purchaseHowlRef.current;\r\n    if (!purchaseSfx) {\r\n      return;\r\n    }\r\n\r\n    purchaseSfx.stop();\r\n    purchaseSfx.play();\r\n  };\r\n\r\n  const playFameStarSound = () => {\r\n    if (!isSfxEnabled) {\r\n      return;\r\n    }\r\n\r\n    const starRewardSfx = starRewardHowlRef.current;\r\n    if (!starRewardSfx) {\r\n      return;\r\n    }\r\n\r\n    starRewardSfx.stop();\r\n    starRewardSfx.play();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!isMusicPlayingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (showCrowd < lotacaoTarget) {\r\n      soldOutHandledRef.current = false;\r\n      return;\r\n    }\r\n\r\n    if (soldOutHandledRef.current) {\r\n      return;\r\n    }\r\n\r\n    soldOutHandledRef.current = true;\r\n  playSoldOutRewardSounds();\r\n    triggerSoldOutRewardAnimation();\r\n    applyShowRewards(fansRewardOnSoldOut, SHOW_FAME_REWARD, gainValue);\r\n    applyFameGain(SHOW_FAME_REWARD);\r\n    setSessionNetGain((current) => current + gainValue);\r\n    setShowCrowd(0);\r\n  }, [showCrowd, lotacaoTarget, fansRewardOnSoldOut, applyShowRewards, gainValue, applyFameGain]);\r\n\r\n  useEffect(() => {\r\n    if (!isMusicPlaying) {\r\n      setMusicStreakMs(0);\r\n      setFansGainRate(0);\r\n      fansStepIndexRef.current = 0;\r\n      if (fansStepFlashTimeoutRef.current) {\r\n        window.clearTimeout(fansStepFlashTimeoutRef.current);\r\n      }\r\n      setFansStepFlash(false);\r\n      return;\r\n    }\r\n\r\n    setFansGainRate(FANS_GAIN_BASE_RATE);\r\n    fansStepIndexRef.current = 0;\r\n    const intervalId = window.setInterval(() => {\r\n      setMusicStreakMs((current) => {\r\n        const next = current + 200;\r\n        const rawStepCount = Math.floor(next / FANS_GAIN_STEP_MS);\r\n        const maxStepCount = Math.floor((FANS_GAIN_MAX_RATE - FANS_GAIN_BASE_RATE) / FANS_GAIN_STEP_RATE);\r\n        const stepCount = Math.min(maxStepCount, rawStepCount);\r\n        const nextRate = Math.min(FANS_GAIN_MAX_RATE, FANS_GAIN_BASE_RATE + stepCount * FANS_GAIN_STEP_RATE);\r\n\r\n        if (stepCount > fansStepIndexRef.current) {\r\n          fansStepIndexRef.current = stepCount;\r\n          setFansStepFlash(true);\r\n          if (fansStepFlashTimeoutRef.current) {\r\n            window.clearTimeout(fansStepFlashTimeoutRef.current);\r\n          }\r\n          fansStepFlashTimeoutRef.current = window.setTimeout(() => {\r\n            setFansStepFlash(false);\r\n          }, 850);\r\n        }\r\n\r\n        setFansGainRate(nextRate);\r\n        return next;\r\n      });\r\n    }, 200);\r\n\r\n    return () => {\r\n      window.clearInterval(intervalId);\r\n    };\r\n  }, [isMusicPlaying]);\r\n\r\n  useLayoutEffect(() => {\r\n    const stageElement = stageRef.current;\r\n    const centerPanelElement = centerPanelRef.current;\r\n    const currentSongElement = currentSongBarRef.current;\r\n    const fansTrackElement = fansGainTrackRef.current;\r\n\r\n    if (!stageElement || !centerPanelElement || (!currentSongElement && !fansTrackElement)) {\r\n      return;\r\n    }\r\n\r\n    const updateSideMetersPosition = () => {\r\n      const nextCenterPanelElement = centerPanelRef.current;\r\n      const nextFansTrackElement = fansGainTrackRef.current;\r\n      const nextCurrentSongElement = currentSongBarRef.current;\r\n      const anchorElement = nextFansTrackElement ?? nextCurrentSongElement;\r\n\r\n      if (!anchorElement || !nextCenterPanelElement) {\r\n        return;\r\n      }\r\n\r\n      const centerPanelBounds = nextCenterPanelElement.getBoundingClientRect();\r\n      const anchorBounds = anchorElement.getBoundingClientRect();\r\n\r\n      const desiredBottom = Math.round(centerPanelBounds.bottom - anchorBounds.top + 10);\r\n      const clampedBottom = Math.max(-180, Math.min(120, desiredBottom));\r\n      stageElement.style.setProperty('--stage-side-meter-bottom', `${clampedBottom}px`);\r\n    };\r\n\r\n    updateSideMetersPosition();\r\n\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      updateSideMetersPosition();\r\n    });\r\n\r\n    resizeObserver.observe(stageElement);\r\n    resizeObserver.observe(centerPanelElement);\r\n    if (currentSongElement) {\r\n      resizeObserver.observe(currentSongElement);\r\n    }\r\n    if (fansTrackElement) {\r\n      resizeObserver.observe(fansTrackElement);\r\n    }\r\n    window.addEventListener('resize', updateSideMetersPosition);\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n      window.removeEventListener('resize', updateSideMetersPosition);\r\n      stageElement.style.removeProperty('--stage-side-meter-bottom');\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (fansStepFlashTimeoutRef.current) {\r\n        window.clearTimeout(fansStepFlashTimeoutRef.current);\r\n      }\r\n      if (loopTransitionTimeoutRef.current) {\r\n        window.clearTimeout(loopTransitionTimeoutRef.current);\r\n      }\r\n      if (mapReturnTransitionTimeoutRef.current) {\r\n        window.clearTimeout(mapReturnTransitionTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const spawnTapEffect = (clientX: number, clientY: number) => {\r\n    const bounds = stageRef.current?.getBoundingClientRect();\r\n    if (!bounds) {\r\n      return;\r\n    }\r\n\r\n    const id = tapEffectIdRef.current + 1;\r\n    tapEffectIdRef.current = id;\r\n\r\n    setTapEffects((current) => [\r\n      ...current.slice(-(MAX_TAP_EFFECTS - 1)),\r\n      {\r\n        id,\r\n        x: clientX - bounds.left,\r\n        y: clientY - bounds.top,\r\n      },\r\n    ]);\r\n\r\n    window.setTimeout(() => {\r\n      setTapEffects((current) => current.filter((effect) => effect.id !== id));\r\n    }, TAP_EFFECT_LIFETIME_MS);\r\n  };\r\n\r\n  const handlePointerPulse = (event: React.PointerEvent<HTMLElement>) => {\r\n    if (activeScreen !== 'band' || isBandManagementScreenVisible || isBandConfigVisible || !isStageShowActive) {\r\n      return;\r\n    }\r\n\r\n    event.preventDefault();\r\n    handleRhythmPulse();\r\n    spawnTapEffect(event.clientX, event.clientY);\r\n  };\r\n\r\n  useEffect(() => {\r\n    setSongDurationSec(0);\r\n    setSongCurrentSec(0);\r\n    const stemEntries = activeBandInstruments\r\n      .map((instrument) => ({ instrument, src: selectedMusicStems[instrument] }))\r\n      .filter((entry): entry is { instrument: Instrument; src: string } => Boolean(entry.src));\r\n\r\n    const stageStemAudios: Partial<Record<Instrument, Howl>> = {};\r\n    stemEntries.forEach(({ instrument, src }) => {\r\n      stageStemAudios[instrument] = new Howl({\r\n        src: [src],\r\n        preload: true,\r\n        html5: false,\r\n        pool: 1,\r\n        volume: isMusicEnabled ? (instrumentVolumes[instrument] ?? 1) : 0,\r\n      });\r\n    });\r\n\r\n    stageStemAudiosRef.current = stageStemAudios;\r\n\r\n    const stageAudio = instrumentPlaybackOrder\r\n      .map((instrument) => stageStemAudios[instrument])\r\n      .find((audio): audio is Howl => Boolean(audio)) ?? null;\r\n\r\n    garageAudioRef.current = stageAudio;\r\n\r\n    if (stageAudio) {\r\n      stagePlaybackSecRef.current = Math.max(0, Math.min(stagePlaybackSecRef.current, stageAudio.duration() || stagePlaybackSecRef.current));\r\n    }\r\n\r\n    const handleLoadedMetadata = () => {\r\n      if (stageAudio) {\r\n        const duration = stageAudio.duration();\r\n        if (Number.isFinite(duration) && duration > 0) {\r\n          setSongDurationSec(duration);\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleAudioSeek = () => {\r\n      if (stageAudio) {\r\n        const currentTime = getHowlCurrentTime(stageAudio);\r\n        stagePlaybackSecRef.current = currentTime;\r\n        setSongCurrentSec(currentTime);\r\n        if (stageAudio.playing() && currentTime > 0 && !isMusicPlayingRef.current) {\r\n          setIsMusicPlaying(true);\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleAudioPlay = () => {\r\n      stagePlayPendingRef.current = false;\r\n      metronomeStartAtRef.current = Date.now();\r\n      metronomeBeatIndexRef.current = -1;\r\n      setIsMusicPlaying(true);\r\n    };\r\n\r\n    const handleAudioPause = () => {\r\n      stagePlayPendingRef.current = false;\r\n      setIsMusicPlaying(false);\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n    };\r\n\r\n    const handleAudioEnded = () => {\r\n      setSongCurrentSec(stageAudio ? stageAudio.duration() : 0);\r\n      stagePlaybackSecRef.current = 0;\r\n      handleAudioPause();\r\n    };\r\n\r\n    const handlePlayError = () => {\r\n      stagePlayPendingRef.current = false;\r\n      setIsMusicPlaying(false);\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n      if (!stageAudio) {\r\n        return;\r\n      }\r\n\r\n      stageAudio.once('unlock', () => {\r\n        attemptStageAudioPlay();\r\n      });\r\n      window.setTimeout(() => {\r\n        attemptStageAudioPlay();\r\n      }, 140);\r\n    };\r\n\r\n    stageAudio?.on('load', handleLoadedMetadata);\r\n    stageAudio?.on('play', handleAudioPlay);\r\n    stageAudio?.on('pause', handleAudioPause);\r\n    stageAudio?.on('end', handleAudioEnded);\r\n    stageAudio?.on('seek', handleAudioSeek);\r\n    stageAudio?.on('playerror', handlePlayError);\r\n\r\n    if (stageAudio?.state() === 'loaded') {\r\n      handleLoadedMetadata();\r\n    }\r\n\r\n    const decay = window.setInterval(() => {\r\n      if (stageAudio) {\r\n        const currentTime = getHowlCurrentTime(stageAudio);\r\n        stagePlaybackSecRef.current = currentTime;\r\n        setSongCurrentSec(currentTime);\r\n        if (stageAudio.playing() && currentTime > 0 && !isMusicPlayingRef.current) {\r\n          setIsMusicPlaying(true);\r\n        }\r\n      }\r\n\r\n      setRhythmMeter((current) => Math.max(0, current - (isMusicPlayingRef.current ? POST_MUSIC_DECAY : PRE_MUSIC_DECAY)));\r\n      if (!isMusicPlayingRef.current) {\r\n        crowdDecayStepRef.current += 1;\r\n        if (crowdDecayStepRef.current >= CROWD_DECAY_EVERY_STEPS) {\r\n          crowdDecayStepRef.current = 0;\r\n          setShowCrowd((current) => Math.max(0, current - crowdDecayAmountRef.current));\r\n        }\r\n      } else {\r\n        crowdDecayStepRef.current = 0;\r\n      }\r\n\r\n      const now = Date.now();\r\n      if (lastPulseAtRef.current && now - lastPulseAtRef.current > 900 && rhythmBonusRef.current > 1) {\r\n        rhythmStreakRef.current = 0;\r\n        rhythmBonusRef.current = 1;\r\n        setRhythmBonus(1);\r\n      }\r\n    }, 100);\r\n\r\n    return () => {\r\n      window.clearInterval(decay);\r\n      if (bonusFlashTimeoutRef.current) {\r\n        window.clearTimeout(bonusFlashTimeoutRef.current);\r\n      }\r\n      if (metronomeFlashTimeoutRef.current) {\r\n        window.clearTimeout(metronomeFlashTimeoutRef.current);\r\n      }\r\n      if (beatHitTimeoutRef.current) {\r\n        window.clearTimeout(beatHitTimeoutRef.current);\r\n      }\r\n      stagePlayPendingRef.current = false;\r\n      stageAudio?.off('load', handleLoadedMetadata);\r\n      stageAudio?.off('play', handleAudioPlay);\r\n      stageAudio?.off('pause', handleAudioPause);\r\n      stageAudio?.off('end', handleAudioEnded);\r\n      stageAudio?.off('seek', handleAudioSeek);\r\n      stageAudio?.off('playerror', handlePlayError);\r\n      instrumentPlaybackOrder.forEach((instrument) => {\r\n        clearStageStemFadeTimeout(instrument);\r\n      });\r\n      pauseStageAudios();\r\n      getStageAudios().forEach((audio) => {\r\n        audio.stop();\r\n        audio.unload();\r\n      });\r\n      stageStemAudiosRef.current = {};\r\n      garageAudioRef.current = null;\r\n    };\r\n  }, [selectedMusicStems, activeBandInstrumentsKey]);\r\n\r\n  useEffect(() => {\r\n    instrumentPlaybackOrder.forEach((instrument) => {\r\n      const audio = stageStemAudiosRef.current[instrument];\r\n      if (!audio) {\r\n        return;\r\n      }\r\n\r\n      audio.volume(isMusicEnabled ? (instrumentVolumes[instrument] ?? 1) : 0);\r\n    });\r\n  }, [isMusicEnabled, instrumentVolumes]);\r\n\r\n  useEffect(() => {\r\n    if (!isMusicPlaying) {\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n      if (metronomeAnimationFrameRef.current) {\r\n        window.cancelAnimationFrame(metronomeAnimationFrameRef.current);\r\n        metronomeAnimationFrameRef.current = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const syncMetronomeWithAudio = () => {\r\n      const stageAudio = garageAudioRef.current;\r\n      if (!isAudioActuallyPlaying(stageAudio)) {\r\n        setMetronomeTick(false);\r\n        setIsMusicPlaying(false);\r\n        metronomeBeatIndexRef.current = -1;\r\n        return;\r\n      }\r\n      const elapsedMs = stageAudio ? Math.max(0, getHowlCurrentTime(stageAudio) * 1000) : 0;\r\n      const beatIndex = Math.floor(elapsedMs / metronomeBeatMs);\r\n\r\n      if (beatIndex !== metronomeBeatIndexRef.current) {\r\n        metronomeBeatIndexRef.current = beatIndex;\r\n        setMetronomeTick(true);\r\n        if (metronomeFlashTimeoutRef.current) {\r\n          window.clearTimeout(metronomeFlashTimeoutRef.current);\r\n        }\r\n        metronomeFlashTimeoutRef.current = window.setTimeout(() => {\r\n          setMetronomeTick(false);\r\n        }, 120);\r\n      }\r\n\r\n      metronomeAnimationFrameRef.current = window.requestAnimationFrame(syncMetronomeWithAudio);\r\n    };\r\n\r\n    metronomeAnimationFrameRef.current = window.requestAnimationFrame(syncMetronomeWithAudio);\r\n\r\n    return () => {\r\n      if (metronomeAnimationFrameRef.current) {\r\n        window.cancelAnimationFrame(metronomeAnimationFrameRef.current);\r\n        metronomeAnimationFrameRef.current = null;\r\n      }\r\n    };\r\n  }, [isMusicPlaying, metronomeBeatMs]);\r\n\r\n  useEffect(() => {\r\n    isMusicPlayingRef.current = isMusicPlaying;\r\n  }, [isMusicPlaying]);\r\n\r\n  useEffect(() => {\r\n    rhythmMeterRef.current = rhythmMeter;\r\n  }, [rhythmMeter]);\r\n\r\n  useEffect(() => {\r\n    hasActiveMusiciansRef.current = hasActiveMusicians;\r\n  }, [hasActiveMusicians]);\r\n\r\n  useEffect(() => {\r\n    crowdDecayAmountRef.current = Math.max(0, Math.floor(bandFansValue));\r\n  }, [bandFansValue]);\r\n\r\n  useEffect(() => {\r\n    isMusicEnabledRef.current = isMusicEnabled;\r\n  }, [isMusicEnabled]);\r\n\r\n  useEffect(() => {\r\n    const stageAudio = garageAudioRef.current;\r\n    if (!stageAudio) {\r\n      return;\r\n    }\r\n\r\n    if (!hasActiveMusicians) {\r\n      pauseStageAudios();\r\n      setIsMusicPlaying(false);\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n      return;\r\n    }\r\n\r\n    if (rhythmMeter > RHYTHM_PLAY_THRESHOLD) {\r\n      attemptStageAudioPlay();\r\n      return;\r\n    }\r\n\r\n    pauseStageAudios();\r\n    setIsMusicPlaying(false);\r\n    setMetronomeTick(false);\r\n    metronomeBeatIndexRef.current = -1;\r\n  }, [rhythmMeter, hasActiveMusicians]);\r\n\r\n  useEffect(() => {\r\n    const tryResumeStageMusic = () => {\r\n      const stageAudio = garageAudioRef.current;\r\n      if (!stageAudio || !isMusicEnabled || !hasActiveMusicians) {\r\n        return;\r\n      }\r\n\r\n      if (typeof document !== 'undefined' && document.visibilityState === 'hidden') {\r\n        return;\r\n      }\r\n\r\n      attemptStageAudioPlay();\r\n    };\r\n\r\n    const handleVisibilityChange = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        tryResumeStageMusic();\r\n      }\r\n    };\r\n\r\n    const handlePageShow = () => {\r\n      tryResumeStageMusic();\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    window.addEventListener('pageshow', handlePageShow);\r\n\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      window.removeEventListener('pageshow', handlePageShow);\r\n    };\r\n  }, [rhythmMeter, hasActiveMusicians, isMusicEnabled]);\r\n\r\n  useEffect(() => {\r\n    const unlockAudio = () => {\r\n      Howler.autoSuspend = false;\r\n      void Howler.ctx?.resume();\r\n      attemptStageAudioPlay();\r\n    };\r\n\r\n    window.addEventListener('pointerdown', unlockAudio, { passive: true });\r\n    window.addEventListener('keydown', unlockAudio);\r\n\r\n    return () => {\r\n      window.removeEventListener('pointerdown', unlockAudio);\r\n      window.removeEventListener('keydown', unlockAudio);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <section\r\n      className=\"game-screen stage-screen\"\r\n      ref={stageRef}\r\n      style={{ backgroundImage: `url(${stageBackground})` }}\r\n      onPointerDownCapture={handlePointerPulse}\r\n    >\r\n      <div className={`stage-loop-fade${isLoopTransitioning ? ' show' : ''}`} aria-hidden=\"true\" />\r\n      <div className=\"stage-overlay\" />\r\n      {isStageShowActive ? (\r\n        <>\r\n          <Stage3DScene\r\n            key={`stage3d-${currentStageId}`}\r\n            textureUrl={defaultStageFloorTexture}\r\n            backgroundImageUrl={stage3DBackground}\r\n            backgroundVideoUrl={stageAnimatedBackground}\r\n            isMusicPlaying={isMusicPlaying}\r\n            activeMusicians={stage3DActiveMusicians}\r\n            activeMusiciansSignature={stage3DActiveMusiciansSignature}\r\n            isCameraMotionEnabled={isCameraMotionEnabled}\r\n          />\r\n          <StageVisualEffectsLayer\r\n            tapEffects={tapEffects}\r\n            rewardParticles={rewardParticles}\r\n            rewardTexts={rewardTexts}\r\n            iconFansWhite={iconFansWhite}\r\n            iconMoneyWhite={iconMoneyWhite}\r\n            iconFameWhite={iconFameWhite}\r\n            formatNumber={formatNumber}\r\n          />\r\n        </>\r\n      ) : null}\r\n\r\n      <button type=\"button\" className=\"back-link\" onClick={onBackToMenu} data-click-sfx=\"close\">\r\n        Bandas\r\n      </button>\r\n\r\n      <MusiciansContractScreen\r\n        isVisible={isMusiciansScreenVisible}\r\n        isClosing={isClosingMusiciansScreen}\r\n        backgroundAudicao={backgroundAudicao}\r\n        portraitContratante={portraitContratante}\r\n        iconFechar={iconFechar}\r\n        iconBloqueado={iconBloqueado}\r\n        iconDisponivel={iconDisponivel}\r\n        selectedInstrumentIcon={selectedMusicianInstrumentIcon}\r\n        iconMoneyWhite={iconMoneyWhite}\r\n        iconFameWhite={iconFameWhite}\r\n        iconFansWhite={iconFansWhite}\r\n        iconRhythmWhite={iconRhythmWhite}\r\n        iconCost={iconCost}\r\n        selectedMusicianDetails={selectedMusicianDetails}\r\n        selectedMusicianFace={selectedMusicianFace}\r\n        selectedMusicianPortrait={selectedMusicianPortrait}\r\n        selectedMusicianInitials={selectedMusicianInitials}\r\n        selectedMusicianRarityClass={selectedMusicianRarityClass}\r\n        isClosingMusicianDetails={isClosingMusicianDetails}\r\n        isMusicianStoryOpen={isMusicianStoryOpen}\r\n        isSelectedMusicianHired={isSelectedMusicianHired}\r\n        isSelectedMusicianLockedByCoins={isSelectedMusicianLockedByCoins}\r\n        canHireSelectedMusician={canHireSelectedMusician}\r\n        selectedMusicianPrice={selectedMusicianPrice}\r\n        hireFilter={hireFilter}\r\n        filterOptions={filterOptions}\r\n        listedMusicianItems={listedMusicianItems}\r\n        formatNumber={formatNumber}\r\n        formatPerformancePercent={formatPerformancePercent}\r\n        instrumentNameById={instrumentNameById}\r\n        onCloseScreen={closeMusiciansScreen}\r\n        onCloseDetails={closeMusicianDetails}\r\n        onToggleStory={toggleMusicianStory}\r\n        onChangeFilter={setHireFilter}\r\n        onOpenMusicianDetails={openMusicianDetails}\r\n        onHireSelected={() => {\r\n          if (!selectedInstrument || !canHireSelectedMusician || !selectedMusicianDetails || availableBandCoins < selectedMusicianPrice) {\r\n            return;\r\n          }\r\n\r\n          hireMusician(selectedInstrument, selectedMusicianPrice, selectedMusicianDetails.ID);\r\n          playPurchaseSound();\r\n        }}\r\n      />\r\n\r\n      <BandManagementScreen\r\n        isVisible={isBandManagementScreenVisible}\r\n        isClosing={isClosingBandManagement}\r\n        backgroundBackstage={bandManagementBackgroundImage}\r\n        iconFechar={iconFechar}\r\n        iconBloqueado={iconBloqueado}\r\n        iconDisponivel={iconDisponivel}\r\n        iconMoneyWhite={iconMoneyWhite}\r\n        iconFameWhite={iconFameWhite}\r\n        iconFansWhite={iconFansWhite}\r\n        iconRhythmWhite={iconRhythmWhite}\r\n        iconCost={iconCost}\r\n        bandHypeValue={bandHypeValue}\r\n        bandFansValue={bandFansValue}\r\n        bandPerformanceValue={bandPerformanceValue}\r\n        bandCostValue={bandCostValue}\r\n        formatNumber={formatNumber}\r\n        formatPerformancePercent={formatPerformancePercent}\r\n        formatCurrency={formatCurrency}\r\n        bandMenuView={bandMenuView}\r\n        bandMenuOptions={bandMenuOptions}\r\n        onChangeBandMenuView={setBandMenuView}\r\n        activeBandSelectorInstrument={activeBandSelectorInstrument}\r\n        bandInstrumentColumns={bandInstrumentColumns}\r\n        selectorMusicians={selectorMusicians}\r\n        selectedSelectorMusicianId={selectedSelectorMusicianId}\r\n        instrumentLabels={instrumentLabels}\r\n        iconMusicoVazio={iconMusicoVazio}\r\n        onOpenInstrument={setActiveBandSelectorInstrument}\r\n        onCloseSelector={() => setActiveBandSelectorInstrument(null)}\r\n        onSelectEmpty={(instrument) => {\r\n          setBandMusicianSelection(instrument, null);\r\n          setActiveBandSelectorInstrument(null);\r\n        }}\r\n        onSelectMusician={(instrument, musicianId) => {\r\n          setBandMusicianSelection(instrument, musicianId);\r\n          setActiveBandSelectorInstrument(null);\r\n        }}\r\n        onCloseScreen={closeBandManagementScreen}\r\n      />\r\n\r\n      <StageTopValuesBar\r\n        key={`top-${mapUiRevealId}`}\r\n        configIcon={iconConfigBlack}\r\n        isConfigOpen={isBandConfigOpen}\r\n        availableBandCoins={availableBandCoins}\r\n        fans={activeBand.fans}\r\n        fameStars={Math.max(0, Math.floor(activeBand.fameStars ?? 0))}\r\n        iconMoneyBlack={iconMoneyBlack}\r\n        iconFansBlack={iconFansBlack}\r\n        iconFameBlack={iconFameBlack}\r\n        onOpenBandConfig={openBandConfig}\r\n        formatCurrency={formatCurrency}\r\n        formatNumber={formatNumber}\r\n        famePulseTick={famePulseTick}\r\n        topMoneyRef={topMoneyRef}\r\n        topFansRef={topFansRef}\r\n        topFameRef={topFameRef}\r\n        className=\"map-ui-reveal\"\r\n      />\r\n\r\n      <BandConfigModal\r\n        isVisible={isBandConfigVisible}\r\n        isClosing={isClosingBandConfig}\r\n        bandName={activeBand.name}\r\n        bandLogoUrl={activeBand.logoUrl}\r\n        isSfxEnabled={isSfxEnabled}\r\n        isMusicEnabled={isMusicEnabled}\r\n        isCameraMotionEnabled={isCameraMotionEnabled}\r\n        iconConfig={iconConfigWhite}\r\n        iconFechar={iconFechar}\r\n        iconAudioOn={iconAudioOn}\r\n        iconCamera={iconCamera}\r\n        iconExitBand={iconExitBand}\r\n        instrumentVolumeControls={instrumentVolumeControls}\r\n        onClose={closeBandConfig}\r\n        onToggleSfx={setSfxEnabled}\r\n        onToggleMusic={setMusicEnabled}\r\n        onToggleCameraMotion={setCameraMotionEnabled}\r\n        onChangeInstrumentVolume={setInstrumentVolume}\r\n        onExitBand={() => {\r\n          closeBandConfig();\r\n          onBackToMenu();\r\n        }}\r\n      />\r\n\r\n      {isStageShowActive ? (\r\n        <div className=\"stage-progress-stack\">\r\n          <StageProgressList\r\n            iconFameWhite={iconFameWhite}\r\n            iconFansWhite={iconFansWhite}\r\n            famePct={famePct}\r\n            fameValue={fameValue}\r\n            fameTarget={fameTarget}\r\n            lotacaoPct={lotacaoPct}\r\n            lotacaoValue={lotacaoValue}\r\n            lotacaoTarget={lotacaoTarget}\r\n            formatNumber={formatNumber}\r\n            fameTrackRef={fameTrackRef}\r\n            crowdTrackRef={crowdTrackRef}\r\n          />\r\n\r\n          <StageCurrentSongBar\r\n            iconFansWhite={iconFansWhite}\r\n            iconMusicWhite={iconMusicWhite}\r\n            fansGainBarPct={fansGainBarPct}\r\n            fansGainRate={fansGainRate}\r\n            fansStepFlash={fansStepFlash}\r\n            songProgressPct={songProgressPct}\r\n            currentSongName={currentSongName}\r\n            wrapperRef={currentSongBarRef}\r\n            fansTrackRef={fansGainTrackRef}\r\n          />\r\n        </div>\r\n      ) : null}\r\n\r\n      {isStageShowActive ? (\r\n        <StageCenterPanel\r\n          iconFameWhite={iconFameWhite}\r\n          iconFansWhite={iconFansWhite}\r\n          iconRhythmWhite={iconRhythmWhite}\r\n          iconCost={iconCost}\r\n          iconIngresso={iconIngresso}\r\n          iconValorCacheTotal={iconValorCacheTotal}\r\n          iconCache={iconCache}\r\n          bandHypeValue={bandHypeValue}\r\n          bandFansValue={bandFansValue}\r\n          bandPerformanceValue={bandPerformanceValue}\r\n          selectedStageName={selectedStage?.Palco ?? 'Garagem de Casa'}\r\n          onExitShow={handleExitStageShow}\r\n          venueBadgeIcon={selectedStageBadge}\r\n          stageTicketPrice={stageTicketPrice}\r\n          lotacaoTotalValue={lotacaoTotalValue}\r\n          costSharePct={costSharePct}\r\n          gainSharePct={gainSharePct}\r\n          gainValue={gainValue}\r\n          metronomeTick={metronomeTick}\r\n          beatHitFeedback={beatHitFeedback}\r\n          isMusicPlaying={isMusicPlaying}\r\n          metronomeBeatMs={metronomeBeatMs}\r\n          rhythmBonus={rhythmBonus}\r\n          bonusFlash={bonusFlash}\r\n          rhythmMeter={rhythmMeter}\r\n          musicStartThreshold={RHYTHM_PLAY_THRESHOLD}\r\n          rhythmTone={getRhythmTone(rhythmMeter)}\r\n          bandCostValue={bandCostValue}\r\n          formatNumber={formatNumber}\r\n          formatPerformancePercent={formatPerformancePercent}\r\n          formatCurrency={formatCurrency}\r\n          gainMeterRef={gainMeterRef}\r\n          wrapperRef={centerPanelRef}\r\n        />\r\n      ) : null}\r\n\r\n      <StageMapModal\r\n        isVisible={!isStageShowActive}\r\n        mapImageUrl={stageWorldMap}\r\n        iconFansWhite={iconFansWhite}\r\n        iconIngressoWhite={iconIngressoBranco}\r\n        iconValorCacheTotal={iconCache}\r\n        introImageUrl={stageWorldPreview}\r\n        bandName={activeBand.name}\r\n        bandLogoUrl={activeBand.logoUrl}\r\n        introPlayId={mapIntroPlayId}\r\n        onIntroVisibilityChange={setIsMapIntroVisible}\r\n        onPreviewStageBannerChange={setMapPreviewBannerUrl}\r\n        stages={stageMapEntries}\r\n        currentStageId={currentStageId}\r\n        isEmbedded\r\n        onClose={() => undefined}\r\n        onSelectStage={(stageId) => {\r\n          setCurrentStage(stageId);\r\n          setIsStageShowActive(true);\r\n        }}\r\n      />\r\n      {shouldRenderSideMenu && (!isStageShowActive || isSideMenuHiding) && activeScreen !== 'musicians' && !isBandManagementScreenVisible && (\r\n        <StageBottomNav\r\n          key={`nav-${mapUiRevealId}`}\r\n          variant=\"side\"\r\n          isHiding={isSideMenuHiding}\r\n          isBandManagementScreenVisible={isBandManagementScreenVisible}\r\n          className=\"map-ui-reveal\"\r\n          availableToHireCount={availableToHireCount}\r\n          navBand={navBand}\r\n          navHire={navHire}\r\n          navStore={navStore}\r\n          navStage={navStage}\r\n          navSongs={navSongs}\r\n          onOpenBandManagementScreen={openBandManagementScreen}\r\n          onOpenMusiciansScreen={openMusiciansScreen}\r\n          onCycleStage={() => undefined}\r\n        />\r\n      )}\r\n\r\n      <div\r\n        className={`stage-map-return-overlay${mapReturnTransitionPhase !== 'idle' ? ' active' : ''}${mapReturnTransitionPhase === 'to-black' ? ' to-black' : ''}${mapReturnTransitionPhase === 'from-black' ? ' from-black' : ''}`}\r\n        aria-hidden=\"true\"\r\n      />\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default BandGame;\r\n"],"names":["BandConfigModal","isVisible","isClosing","bandName","bandLogoUrl","isSfxEnabled","isMusicEnabled","isCameraMotionEnabled","iconConfig","iconFechar","iconAudioOn","iconCamera","iconExitBand","instrumentVolumeControls","onClose","onToggleSfx","onToggleMusic","onToggleCameraMotion","onChangeInstrumentVolume","onExitBand","jsxs","Fragment","jsx","event","control","sliderValue","BandInstrumentSelector","bandInstrumentColumns","activeInstrument","isDetailOpen","selectorMusicians","selectedMusicianId","instrumentLabels","iconMusicoVazio","onOpenInstrument","onCloseSelector","onSelectEmpty","onOpenMusicianDetail","isSelectorClosing","setIsSelectorClosing","useState","selectorCloseTimeoutRef","useRef","useEffect","runSelectorCloseAnimation","onClosed","instrumentRoleByKey","activeInstrumentIcon","column","activeInstrumentRole","handleOpenInstrument","instrument","musicianId","detailMusician","item","musician","MusicianDetailModal","selectedMusicianFace","selectedMusicianPortrait","selectedMusicianInitials","selectedMusicianRarityClass","selectedInstrumentIcon","isStoryOpen","isSelectedMusicianHired","isSelectedMusicianLockedByCoins","canHireSelectedMusician","selectedMusicianPrice","iconBloqueado","iconDisponivel","iconMoneyWhite","iconFameWhite","iconFansWhite","iconRhythmWhite","iconCost","formatNumber","formatPerformancePercent","instrumentNameById","showStoryToggle","hideCloseButton","customAction","onCloseDetails","onToggleStory","onHireSelected","displayMode","displayMusician","setDisplayMusician","React","isContentLeaving","setIsContentLeaving","isContentEntering","setIsContentEntering","switchTimer","settleTimer","currentMusician","rarityLabel","displayPortrait","transitionClass","BandManagementScreen","backgroundBackstage","bandHypeValue","bandFansValue","bandPerformanceValue","bandCostValue","formatCurrency","bandMenuView","bandMenuOptions","onChangeBandMenuView","activeBandSelectorInstrument","selectedSelectorMusicianId","onSelectMusician","onCloseScreen","selectedSelectorDetail","setSelectedSelectorDetail","isDetailClosing","setIsDetailClosing","detailCloseTimeoutRef","isSelectorDetailOpen","instrumentIdByKey","activeBandColumn","currentMusicianId","openSelectorDetail","closeSelectorDetail","closeSelectorAndDetail","action","option","MusiciansContractScreen","backgroundAudicao","portraitContratante","selectedMusicianDetails","isClosingMusicianDetails","isMusicianStoryOpen","hireFilter","filterOptions","listedMusicianItems","onChangeFilter","onOpenMusicianDetails","collapsedGroups","setCollapsedGroups","prevHireMapRef","recentlyHiredId","setRecentlyHiredId","detectedHiredId","nextMap","id","current","rarityRank","hiredMusicianItems","a","b","rarityDiff","availableMusicianItems","toggleGroup","group","prev","renderMusicianCard","StageTopValuesBar","configIcon","availableBandCoins","fans","fameStars","iconMoneyBlack","iconFansBlack","iconFameBlack","onOpenBandConfig","famePulseTick","topMoneyRef","topFansRef","topFameRef","className","isConfigOpen","StageBottomNav","variant","isHiding","isBandManagementScreenVisible","availableToHireCount","navBand","navHire","navStore","navStage","navSongs","onOpenBandManagementScreen","onOpenMusiciansScreen","onCycleStage","resolvedClassName","StageProgressList","famePct","fameValue","fameTarget","lotacaoPct","lotacaoValue","lotacaoTarget","fameTrackRef","crowdTrackRef","StageCenterPanel","iconIngresso","iconValorCacheTotal","iconCache","selectedStageName","onExitShow","venueBadgeIcon","stageTicketPrice","lotacaoTotalValue","costSharePct","gainSharePct","gainValue","metronomeTick","beatHitFeedback","isMusicPlaying","metronomeBeatMs","rhythmBonus","bonusFlash","rhythmMeter","musicStartThreshold","rhythmTone","gainMeterRef","wrapperRef","StageCurrentSongBar","iconMusicWhite","fansGainBarPct","fansGainRate","fansStepFlash","songProgressPct","currentSongName","fansTrackRef","StageVisualEffectsLayer","tapEffects","rewardParticles","rewardTexts","getRewardIcon","kind","effect","particle","entry","baseCameraPosition","THREE.Vector3","baseLookAtPosition","stageVerticalOffset","performerPositions","performerSpriteScale","performerShadowScale","generalShot","sweepShotLeft","sweepShotRight","focusShotByInstrument","buildShotQueue","activeInstruments","cycle","availableOrder","rotateBy","rotatedOrder","focusOrder","sweepStart","sweepEnd","queue","index","Stage3DScene","textureUrl","backgroundImageUrl","backgroundVideoUrl","activeMusicians","activeMusiciansSignature","isMobile","containerRef","isMusicPlayingRef","activeMusiciansRef","isCameraMotionEnabledRef","currentFocusedInstrumentRef","shotQueueRef","shotIndexRef","currentShotRef","fromShotPosRef","fromShotLookRef","fromShotFovRef","currentLookRef","currentFovRef","shotEndsAtRef","shotStartedAtRef","shotMoveDurationRef","shotQueueCycleRef","lastShadowFrameSentAtRef","wasMusicPlayingRef","randomMotionRefreshAtRef","randomPosOffsetRef","randomPosOffsetTargetRef","randomLookOffsetRef","randomLookOffsetTargetRef","container","renderer","THREE.WebGLRenderer","THREE.BasicShadowMap","THREE.PCFSoftShadowMap","THREE.SRGBColorSpace","scene","THREE.Scene","camera","THREE.PerspectiveCamera","textureLoader","THREE.TextureLoader","sceneBackgroundTexture","sceneBackgroundVideoElement","backgroundGeometry","THREE.PlaneGeometry","backgroundMaterial","THREE.MeshBasicMaterial","THREE.DoubleSide","backgroundPlane","THREE.Mesh","backgroundBaseY","backgroundParallaxCurrent","THREE.Vector2","backgroundParallaxTarget","backgroundParallaxLimits","getBackgroundAspect","bgMap","source","width","height","updateBackgroundPlaneScale","distance","frustumHeight","THREE.MathUtils","frustumWidth","textureAspect","planeHeight","planeWidth","maxOffsetX","maxOffsetY","bgTexture","video","videoTexture","THREE.VideoTexture","THREE.LinearFilter","activateVideoTexture","ambientLight","THREE.AmbientLight","frontKeyLight","THREE.SpotLight","fillLight","THREE.DirectionalLight","backLight","hemiLight","THREE.HemisphereLight","floorTexture","THREE.RepeatWrapping","floorMaterial","THREE.MeshStandardMaterial","floorGeometry","floor","frontEdgeGeometry","THREE.BoxGeometry","frontEdgeMaterial","frontEdge","shadowCanvas","shadowCtx","gradient","shadowTexture","THREE.CanvasTexture","shadowGeometry","spriteTextureLoader","musicianSprites","basePosition","spriteTexture","spriteMaterial","THREE.SpriteMaterial","sprite","THREE.Sprite","scaleX","scaleY","shadowMaterial","shadow","shadowWidth","shadowHeight","standInGeometry","THREE.CapsuleGeometry","standInMaterial","performerStandIns","position","standIn","composerRenderTarget","THREE.WebGLRenderTarget","THREE.RGBAFormat","composer","EffectComposer","renderPass","RenderPass","bokehPass","BokehPass","resize","clientWidth","clientHeight","resizeObserver","clock","THREE.Clock","animationFrameId","targetFps","lastFrameTime","cameraTarget","lookAtTarget","setFocusedInstrument","rebuildShotQueue","applyNextShot","elapsed","cameraObject","nextIndex","nextShot","animate","now","playing","shot","shotElapsed","moveDuration","moveProgress","easeProgress","isCloseShot","nextWindow","handAmount","targetPos","focusPosition","focusAnchor","closeDistance","shotDirection","sideSway","frontBackSway","idleSwayX","idleSwayY","idleSwayZ","targetLook","sweepZoomBreath","targetFov","focusDistance","closeStrengthRaw","closeStrength","smoothClose","shadowDrift","baseShadowX","baseShadowZ","texture","iconFechar$1","STAGE_SELECT_TRANSITION_MS","STAGE_MAP_CLOSE_FADE_MS","STAGE_BLACKOUT_START_PROGRESS","STAGE_SELECT_ZOOM_MULTIPLIER","STAGE_SELECT_FINAL_BLACK_HOLD_MS","STAGE_PREVIEW_EXIT_MS","TOUCH_SCROLL_DAMPING","StageMapModal","mapImageUrl","iconIngressoWhite","stages","currentStageId","isEmbedded","introImageUrl","introPlayId","resetViewToken","onIntroVisibilityChange","onPreviewStageBannerChange","onStageTransitionStart","onSelectStage","mapImageRef","mapScrollRef","hasInitializedOpenViewRef","imageSize","setImageSize","mapScale","setMapScale","mapScaleRef","pinchStartDistanceRef","pinchStartScaleRef","touchPanLastPointRef","shouldRender","setShouldRender","setIsClosing","isStageTransitioning","setIsStageTransitioning","transitionOverlayOpacity","setTransitionOverlayOpacity","previewStage","setPreviewStage","isPreviewClosing","setIsPreviewClosing","previewCloseTimeoutRef","transitionFrameRef","transitionTimeoutRef","introHoldTimeoutRef","introHideTimeoutRef","lastIntroPlayIdRef","introPhase","setIntroPhase","getClampedScrollPosition","scrollContainer","left","top","scale","renderedWidth","renderedHeight","maxScrollLeft","maxScrollTop","closePreviewWithAnimation","afterClose","minScale","containerWidth","containerHeight","fitHeightScale","fitWidthScale","coverScale","getTouchDistance","touches","first","second","dx","dy","handleTouchStart","touch","handleTouchMove","previousTouch","deltaX","deltaY","targetLeft","targetTop","clampedPosition","startDistance","pinchRatio","nextScale","handleTouchEnd","timeoutId","clearIntroTimers","defaultScale","defaultLeft","defaultTop","targetScale","frameId","handleMapScroll","handleCloseModal","handleSelectStageWithTransition","stage","startScale","startLeft","startTop","targetPointX","targetPointY","requestedLeft","requestedTop","targetPosition","animationStart","easeInOutCubic","value","progress","easedProgress","blackoutProgress","nextLeft","nextTop","nextOverlayOpacity","markersToRender","image","marker","isActive","stageToGo","useBandScreensState","musiciansModalCloseMs","musicianDetailsCloseMs","bandModalCloseMs","bandConfigCloseMs","onStoryToggleSound","activeScreen","setActiveScreen","isClosingMusiciansScreen","setIsClosingMusiciansScreen","setSelectedMusicianDetails","setIsMusicianStoryOpen","setIsClosingMusicianDetails","isBandConfigOpen","setIsBandConfigOpen","isClosingBandConfig","setIsClosingBandConfig","isBandManagementOpen","setIsBandManagementOpen","isClosingBandManagement","setIsClosingBandManagement","setActiveBandSelectorInstrument","musiciansCloseTimeoutRef","musicianDetailsCloseTimeoutRef","bandManagementCloseTimeoutRef","bandConfigCloseTimeoutRef","clearTimeoutRef","timeoutRef","openBandConfig","useCallback","closeBandConfig","openBandManagementScreen","closeBandManagementScreen","openMusiciansScreen","openMusicianDetails","closeMusicianDetails","closeMusiciansScreen","toggleMusicianStory","next","defaultStageBackground","defaultStageFloorTexture","iconIngressoBranco","stageWorldMap","stageWorldPreview","iconTodos","iconGuitarra","iconBaixo","iconBateria","iconTeclado","iconBandaMenu","iconEspeciaisMenu","iconAnaliseMenu","iconConfigBlack","iconConfigWhite","iconGuitarraVazia","iconBaixoVazio","iconBateriaVazio","iconTecladoVazio","sfxMoneyReward","sfxCrowdApplause","sfxPurchased","sfxStarReward","ambienceMapAudio","ambienceStageCrowdAudio","RHYTHM_PLAY_THRESHOLD","SHOW_FAME_REWARD","FANS_GAIN_BASE_RATE","FANS_GAIN_MAX_RATE","FANS_GAIN_STEP_RATE","FANS_GAIN_STEP_MS","DEFAULT_MUSIC_BPM","PRE_MUSIC_TAP_GAIN","PRE_MUSIC_DECAY","POST_MUSIC_DECAY","CROWD_DECAY_EVERY_STEPS","TAP_EFFECT_LIFETIME_MS","MUSICIANS_MODAL_CLOSE_MS","MUSICIANS_DETAIL_CLOSE_MS","BAND_MODAL_CLOSE_MS","BAND_CONFIG_CLOSE_MS","MAP_RETURN_FADE_OUT_MS","MAP_RETURN_FADE_IN_MS","AMBIENCE_FADE_IN_MS","AMBIENCE_FADE_OUT_MS","STAGE_STEM_FADE_IN_MS","STAGE_STEM_FADE_OUT_MS","MAP_AMBIENCE_VOLUME","STAGE_AMBIENCE_VOLUME","instrumentById","instrumentIconById","instrumentPlaybackOrder","instrumentConfigOrder","instrumentIconByInstrument","stageMapPositionById","getRhythmTone","getRarity","level","__vite_glob_1_0","__vite_glob_1_1","__vite_glob_1_2","__vite_glob_1_3","__vite_glob_1_4","__vite_glob_1_5","__vite_glob_1_6","__vite_glob_1_7","__vite_glob_1_8","__vite_glob_1_9","__vite_glob_1_10","__vite_glob_1_11","__vite_glob_1_12","__vite_glob_1_13","__vite_glob_1_14","__vite_glob_1_15","__vite_glob_2_0","__vite_glob_2_1","__vite_glob_2_2","__vite_glob_2_3","__vite_glob_2_4","__vite_glob_2_5","__vite_glob_2_6","__vite_glob_3_0","__vite_glob_3_1","__vite_glob_3_2","__vite_glob_3_3","__vite_glob_3_4","__vite_glob_3_5","__vite_glob_3_6","__vite_glob_4_0","__vite_glob_4_1","__vite_glob_4_2","__vite_glob_4_3","__vite_glob_4_4","__vite_glob_4_5","__vite_glob_4_6","__vite_glob_4_7","__vite_glob_4_8","__vite_glob_4_9","__vite_glob_4_10","__vite_glob_4_11","__vite_glob_4_12","__vite_glob_4_13","__vite_glob_4_14","__vite_glob_4_15","__vite_glob_4_16","__vite_glob_4_17","__vite_glob_4_18","__vite_glob_4_19","__vite_glob_4_20","__vite_glob_4_21","__vite_glob_4_22","__vite_glob_4_23","__vite_glob_4_24","__vite_glob_4_25","__vite_glob_4_26","__vite_glob_4_27","__vite_glob_4_28","__vite_glob_4_29","__vite_glob_5_0","__vite_glob_5_1","__vite_glob_5_2","__vite_glob_5_3","__vite_glob_5_4","__vite_glob_5_5","__vite_glob_5_6","__vite_glob_5_7","__vite_glob_5_8","__vite_glob_5_9","__vite_glob_5_10","__vite_glob_5_11","__vite_glob_5_12","__vite_glob_5_13","__vite_glob_5_14","__vite_glob_5_15","__vite_glob_5_16","__vite_glob_5_17","__vite_glob_5_18","__vite_glob_5_19","__vite_glob_5_20","__vite_glob_5_21","__vite_glob_5_22","__vite_glob_5_23","stageImageAssetMap","__vite_glob_0_0","__vite_glob_0_1","__vite_glob_0_2","__vite_glob_0_3","__vite_glob_0_4","__vite_glob_0_5","__vite_glob_0_6","__vite_glob_0_7","__vite_glob_0_8","__vite_glob_0_9","__vite_glob_0_10","__vite_glob_0_11","__vite_glob_0_12","__vite_glob_0_13","__vite_glob_0_14","__vite_glob_0_15","__vite_glob_0_16","stageMapBadgeAssetMap","stageVideoAssetMap","musicStreamAssetMap","musicianFaceAssetMap","musicianPortraitAssetMap","resolveStageAsset","assetPath","viteAssetPath","resolveStageAnimatedAsset","animatedPath","resolveStageMapBadgeAsset","badgePath","resolveMusicStreamAsset","streamPath","resolveMusicianFaceAsset","faceAsset","directFacePath","legacyFaceMatch","parsedFaceNumber","migratedFacePath","resolveMusicianPortraitAsset","portraitAsset","directPortraitPath","useBandGameComputed","bands","activeBandId","instrumentVolumes","availableMusics","useMemo","musicsData","musicians","musicosData","palcosData","selectedMusic","music","activeBand","band","activeBandMusicians","slot","total","bandCacheValue","selectedStage","stageMapEntries","stageBackground","stage3DBackground","selectedStageBadge","stageAnimatedBackground","filteredMusicians","listedMusicians","right","leftInstrument","rightInstrument","leftSlot","rightSlot","leftHired","rightHired","selectedInstrument","unlockedMusicianIdSet","persistedIds","equippedIds","hasEnoughCoinsForSelected","part","selectedMusicianInstrumentIcon","rarity","isMusicianHired","isLockedByCoins","instrumentIcon","initials","selectedMusicStems","activeBandInstruments","guitarMusician","bassMusician","drumsMusician","keysMusician","stageBandPerformers","portraitSrc","stage3DActiveMusicians","performer","stage3DActiveMusiciansSignature","normalized","clamped","getHowlCurrentTime","audio","seekValue","isAudioActuallyPlaying","BandGame","onBackToMenu","useGameStore","state","setCurrentStage","applyShowRewards","addFameStars","hireMusician","setBandMusicianSelection","setMusicEnabled","setSfxEnabled","setCameraMotionEnabled","setInstrumentVolume","setHireFilter","setRhythmMeter","showCrowd","setShowCrowd","sessionNetGain","setSessionNetGain","setIsMusicPlaying","setFansGainRate","musicStreakMs","setMusicStreakMs","setFansStepFlash","setRhythmBonus","setBonusFlash","setMetronomeTick","setBeatHitFeedback","songDurationSec","setSongDurationSec","songCurrentSec","setSongCurrentSec","lastPulseAtRef","metronomeStartAtRef","garageAudioRef","stageStemAudiosRef","stagePlaybackSecRef","stageStemFadeTimeoutsRef","rhythmStreakRef","rhythmBonusRef","bonusFlashTimeoutRef","metronomeFlashTimeoutRef","metronomeAnimationFrameRef","metronomeBeatIndexRef","beatHitTimeoutRef","loopTransitionTimeoutRef","stagePlayPendingRef","rhythmMeterRef","hasActiveMusiciansRef","isMusicEnabledRef","stageRef","centerPanelRef","currentSongBarRef","fansGainTrackRef","tapEffectIdRef","rewardAnimationIdRef","soldOutHandledRef","fameProgressRef","crowdDecayStepRef","crowdDecayAmountRef","fansStepIndexRef","fansStepFlashTimeoutRef","mapReturnTransitionTimeoutRef","setTapEffects","setRewardParticles","setRewardTexts","isLoopTransitioning","setIsLoopTransitioning","isStageShowActive","setIsStageShowActive","isSideMenuHiding","setIsSideMenuHiding","shouldRenderSideMenu","setShouldRenderSideMenu","mapIntroPlayId","setMapIntroPlayId","mapUiRevealId","setMapUiRevealId","isMapIntroVisible","setIsMapIntroVisible","mapPreviewBannerUrl","setMapPreviewBannerUrl","mapReturnTransitionPhase","setMapReturnTransitionPhase","setBandMenuView","fameProgressValue","setFameProgressValue","setFamePulseTick","prevActiveScreenRef","prevActiveBandIdRef","hasInitialMapIntroPlayedRef","prevIntroVisibleRef","sideMenuHideTimeoutRef","moneyRewardHowlRef","applauseHowlRef","purchaseHowlRef","starRewardHowlRef","mapAmbienceHowlRef","stageAmbienceHowlRef","mapAmbienceFadeTimeoutRef","stageAmbienceFadeTimeoutRef","isOpening","playUiClickSound","hasActiveMusicians","isMusiciansScreenVisible","isBandConfigVisible","activeBandInstrumentsKey","bandManagementBackgroundImage","pauseThemeMusic","playThemeMusic","getStageAudios","clearStageStemFadeTimeout","pauseStageAudios","stageAudios","primaryAudio","currentVolume","clearAmbienceFadeTimeout","playAmbienceWithFade","ambienceHowl","targetVolume","fadeTimeoutRef","stopAmbienceWithFade","attemptStageAudioPlay","stageAudio","baseTime","Howler","fansTapGain","hypeTapGain","fansRewardOnSoldOut","metronomeHitWindowMs","stepProgress","nextVisualRate","totalFlow","getCenter","element","stageBounds","bounds","triggerFameStarRewardAnimation","starsGained","fameStart","fameEnd","delay","fameParticle","currentParticles","applyFameGain","gain","earnedStars","nextProgress","playFameStarSound","triggerSoldOutRewardAnimation","fansStart","fansEnd","moneyStart","moneyEnd","newFansParticles","_","idsToClear","fansTextId","currentTexts","newMoneyParticles","moneyTextId","handleExitStageShow","handleRhythmPulse","audioRunning","delta","beatRemainder","beatDistance","onBeat","nextBonus","gainBase","isReturningFromMusicians","isFirstBand","hasBandChanged","Howl","shouldPlayMapAmbience","shouldPlayStageAmbience","playSoldOutRewardSounds","moneySfx","applauseSfx","playPurchaseSound","purchaseSfx","starRewardSfx","intervalId","rawStepCount","maxStepCount","stepCount","nextRate","useLayoutEffect","stageElement","centerPanelElement","currentSongElement","fansTrackElement","updateSideMetersPosition","nextCenterPanelElement","nextFansTrackElement","nextCurrentSongElement","anchorElement","centerPanelBounds","anchorBounds","desiredBottom","clampedBottom","spawnTapEffect","clientX","clientY","handlePointerPulse","stemEntries","stageStemAudios","src","handleLoadedMetadata","duration","handleAudioSeek","currentTime","handleAudioPlay","handleAudioPause","handleAudioEnded","handlePlayError","decay","syncMetronomeWithAudio","elapsedMs","beatIndex","tryResumeStageMusic","handleVisibilityChange","handlePageShow","unlockAudio","stageId"],"mappings":"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"}