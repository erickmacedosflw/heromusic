{"version":3,"mappings":"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","names":["getDefaultMusicians","getDefaultCreation","getDefaultAudioSettings","getBandUnlockedMusicianIds","band","persistedIds","equippedIds","slot","id","useGameStore","create","persist","set","get","isLoaded","step","state","logoUrl","name","enabled","instrument","volume","creation","trimmedName","bandId","stageId","nextBands","nextActiveBandId","quality","bonus","activeBand","activeMusicianCount","scoreByQuality","fansByQuality","nextCombo","bandMultiplier","scoreGain","fanGain","coinGain","fansGain","fameGain","coinsGain","stars","starsToAdd","hireCostOverride","musicianId","hireCost","unlockedMusicianIds","incomingMusicianId","nextMusicianId","upgradeCost","persistedState","defaultAudioSettings","rawInstrumentVolumes","migratedAudioSettings","BootScene","onLoadComplete","setLoaded","useEffect","timeout","React","useGameLoop","update","requestRef","useRef","previousTimeRef","loop","time","deltaTime","clickInSrc","clickOutSrc","clickConfirmSrc","clickCancelSrc","interactiveSelector","getClickType","value","clickInHowl","Howl","clickOutHowl","clickConfirmHowl","clickCancelHowl","activeHowl","activeSoundId","ensureClickAudioReady","Howler","stopCurrentClick","playUiClickSound","type","playNow","howl","nextId","context","globalClickCleanup","setupGlobalUiClickSound","handleGlobalPointerDown","event","target","explicitSoundElement","isInsideStageScreen","isInteractiveTarget","menuThemeMusicSrc","mapThemeMusicSrc","THEME_VARIANTS","THEME_TARGET_VOLUME","THEME_FADE_IN_MS","THEME_FADE_OUT_MS","THEME_REVERB_WET","THEME_REVERB_DRY","pauseTimeouts","themeReverbReady","themeDryGain","themeWetGain","themeConvolver","isIOSDevice","shouldUseHtml5ThemeAudio","themeHowls","clearPauseTimeout","variant","timeoutId","createImpulseResponse","audioContext","durationSec","decay","sampleRate","length","impulse","channel","channelData","index","envelope","ensureThemeReverb","masterGain","dryGain","wetGain","convolver","applyThemeReverbRouting","sound","node","ensureThemeAudioReady","playThemeMusic","candidate","pauseThemeMusic","targetHowl","currentVolume","setupThemeMusicUnlock","canPlayTheme","unlockAndPlay","disposeThemeMusic","BandHub","__vitePreload","BandGame","App","currentScene","setCurrentScene","useState","activeBandId","isMusicEnabled","setMusicEnabled","sceneRef","musicEnabledRef","resumeThemeIfNeeded","handleVisibilityChange","handlePageShow","enforceThemeByScene","shouldPlayTheme","handleToggleMusic","renderScene","jsx","registerSW","options","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","Workbox","e","r","container","createRoot"],"ignoreList":[],"sources":["../../src/state/gameStore.ts","../../src/game/scenes/BootScene.ts","../../src/hooks/useGameLoop.ts","../../src/utils/clickAudio.ts","../../src/utils/themeAudio.ts","../../src/App.tsx","../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/main.tsx"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport type Instrument = 'guitar' | 'drums' | 'bass' | 'keys';\nexport type OnboardingStep = 'welcome' | 'logo' | 'name' | 'final';\nexport type HitQuality = 'perfect' | 'good' | 'miss';\n\ntype MusicianSlot = {\n  hired: boolean;\n  musicianId: number | null;\n  skillLevel: number;\n  instrumentLevel: number;\n};\n\nexport type Band = {\n  id: string;\n  name: string;\n  logoUrl: string;\n  createdAt: number;\n  coins: number;\n  fans: number;\n  reputation: number;\n  fameStars: number;\n  musicians: Record<Instrument, MusicianSlot>;\n  unlockedMusicianIds: number[];\n  autoplayUnlocked: boolean;\n};\n\ntype CreationState = {\n  isCreating: boolean;\n  step: OnboardingStep;\n  selectedLogoUrl: string | null;\n  draftName: string;\n};\n\ntype AudioSettings = {\n  musicEnabled: boolean;\n  sfxEnabled: boolean;\n  instrumentVolumes: Record<Instrument, number>;\n};\n\ninterface GameState {\n  isLoaded: boolean;\n  bands: Band[];\n  activeBandId: string | null;\n  currentStageId: number;\n  creation: CreationState;\n  audioSettings: AudioSettings;\n  cameraMotionEnabled: boolean;\n  showPerformance: boolean;\n  score: number;\n  combo: number;\n  lastHit: HitQuality | null;\n  setLoaded: (isLoaded: boolean) => void;\n  startBandCreation: () => void;\n  cancelBandCreation: () => void;\n  setCreationStep: (step: OnboardingStep) => void;\n  setCreationLogo: (logoUrl: string) => void;\n  setCreationName: (name: string) => void;\n  setMusicEnabled: (enabled: boolean) => void;\n  setSfxEnabled: (enabled: boolean) => void;\n  setInstrumentVolume: (instrument: Instrument, volume: number) => void;\n  setCameraMotionEnabled: (enabled: boolean) => void;\n  createBandFromDraft: () => void;\n  selectBand: (bandId: string) => void;\n  setCurrentStage: (stageId: number) => void;\n  deleteBand: (bandId: string) => void;\n  openPerformance: () => void;\n  closePerformance: () => void;\n  tapBeat: (quality: HitQuality, bonus: number) => void;\n  applyShowRewards: (fansGain: number, fameGain: number, coinsGain: number) => void;\n  addFameStars: (stars: number) => void;\n  hireMusician: (instrument: Instrument, hireCost?: number, musicianId?: number | null) => void;\n  setBandMusicianSelection: (instrument: Instrument, musicianId: number | null) => void;\n  upgradeInstrument: (instrument: Instrument) => void;\n}\n\nconst getDefaultMusicians = (): Record<Instrument, MusicianSlot> => ({\n  guitar: { hired: false, musicianId: null, skillLevel: 1, instrumentLevel: 1 },\n  drums: { hired: false, musicianId: null, skillLevel: 1, instrumentLevel: 1 },\n  bass: { hired: false, musicianId: null, skillLevel: 1, instrumentLevel: 1 },\n  keys: { hired: false, musicianId: null, skillLevel: 1, instrumentLevel: 1 },\n});\n\nconst getDefaultCreation = (): CreationState => ({\n  isCreating: false,\n  step: 'welcome',\n  selectedLogoUrl: null,\n  draftName: '',\n});\n\nconst getDefaultAudioSettings = (): AudioSettings => ({\n  musicEnabled: true,\n  sfxEnabled: true,\n  instrumentVolumes: {\n    guitar: 1,\n    drums: 1,\n    bass: 1,\n    keys: 1,\n  },\n});\n\nconst getBandUnlockedMusicianIds = (band: Band) => {\n  const persistedIds = band.unlockedMusicianIds ?? [];\n  const equippedIds = Object.values(band.musicians)\n    .map((slot) => slot.musicianId)\n    .filter((id): id is number => id !== null);\n\n  return Array.from(new Set([...persistedIds, ...equippedIds]));\n};\n\nexport const useGameStore = create<GameState>()(\n  persist(\n    (set, get) => ({\n      isLoaded: false,\n      bands: [],\n      activeBandId: null,\n      currentStageId: 1,\n      creation: getDefaultCreation(),\n      audioSettings: getDefaultAudioSettings(),\n      cameraMotionEnabled: true,\n      showPerformance: false,\n      score: 0,\n      combo: 0,\n      lastHit: null,\n      setLoaded: (isLoaded) => set({ isLoaded }),\n      startBandCreation: () =>\n        set({\n          creation: {\n            isCreating: true,\n            step: 'welcome',\n            selectedLogoUrl: null,\n            draftName: '',\n          },\n        }),\n      cancelBandCreation: () => set({ creation: getDefaultCreation() }),\n      setCreationStep: (step) =>\n        set((state) => ({\n          creation: {\n            ...state.creation,\n            isCreating: true,\n            step,\n          },\n        })),\n      setCreationLogo: (logoUrl) =>\n        set((state) => ({\n          creation: {\n            ...state.creation,\n            selectedLogoUrl: logoUrl,\n          },\n        })),\n      setCreationName: (name) =>\n        set((state) => ({\n          creation: {\n            ...state.creation,\n            draftName: name,\n          },\n        })),\n      setMusicEnabled: (enabled) =>\n        set((state) => ({\n          audioSettings: {\n            ...state.audioSettings,\n            musicEnabled: enabled,\n          },\n        })),\n      setSfxEnabled: (enabled) =>\n        set((state) => ({\n          audioSettings: {\n            ...state.audioSettings,\n            sfxEnabled: enabled,\n          },\n        })),\n      setCameraMotionEnabled: (enabled) => set({ cameraMotionEnabled: enabled }),\n      setInstrumentVolume: (instrument, volume) =>\n        set((state) => ({\n          audioSettings: {\n            ...state.audioSettings,\n            instrumentVolumes: {\n              ...state.audioSettings.instrumentVolumes,\n              [instrument]: Math.max(0, Math.min(1, Number.isFinite(volume) ? volume : 1)),\n            },\n          },\n        })),\n      createBandFromDraft: () => {\n        const { creation } = get();\n        const trimmedName = creation.draftName.trim();\n\n        if (!trimmedName || !creation.selectedLogoUrl) {\n          return;\n        }\n\n        const band: Band = {\n          id: `band-${Date.now()}`,\n          name: trimmedName,\n          logoUrl: creation.selectedLogoUrl,\n          createdAt: Date.now(),\n          coins: 2000,\n          fans: 0,\n          reputation: 0,\n          fameStars: 0,\n          musicians: getDefaultMusicians(),\n          unlockedMusicianIds: [],\n          autoplayUnlocked: false,\n        };\n\n        set((state) => ({\n          bands: [...state.bands, band],\n          activeBandId: band.id,\n          currentStageId: 1,\n          creation: getDefaultCreation(),\n          showPerformance: false,\n          score: 0,\n          combo: 0,\n          lastHit: null,\n        }));\n      },\n      selectBand: (bandId) => set({ activeBandId: bandId, showPerformance: false }),\n      setCurrentStage: (stageId) =>\n        set({\n          currentStageId: stageId,\n        }),\n      deleteBand: (bandId) =>\n        set((state) => {\n          const nextBands = state.bands.filter((band) => band.id !== bandId);\n          const nextActiveBandId =\n            state.activeBandId === bandId ? nextBands[0]?.id ?? null : state.activeBandId;\n\n          return {\n            bands: nextBands,\n            activeBandId: nextActiveBandId,\n            showPerformance: false,\n          };\n        }),\n      openPerformance: () => set({ showPerformance: true, score: 0, combo: 0, lastHit: null }),\n      closePerformance: () => set({ showPerformance: false }),\n      tapBeat: (quality, bonus) =>\n        set((state) => {\n          if (!state.activeBandId) {\n            return state;\n          }\n\n          const activeBand = state.bands.find((band) => band.id === state.activeBandId);\n          if (!activeBand) {\n            return state;\n          }\n\n          const activeMusicianCount = Object.values(activeBand.musicians).filter(\n            (slot) => slot.hired\n          ).length;\n\n          const scoreByQuality: Record<HitQuality, number> = {\n            perfect: 12,\n            good: 6,\n            miss: 0,\n          };\n          const fansByQuality: Record<HitQuality, number> = {\n            perfect: 3,\n            good: 1,\n            miss: 0,\n          };\n\n          const nextCombo = quality === 'miss' ? 0 : state.combo + 1;\n          const bandMultiplier = Math.max(1, activeMusicianCount);\n          const scoreGain = (scoreByQuality[quality] + bonus) * bandMultiplier;\n          const fanGain = fansByQuality[quality] * bandMultiplier;\n          const coinGain = quality === 'miss' ? 0 : 2 + activeMusicianCount;\n\n          const updatedBands = state.bands.map((band) => {\n            if (band.id !== state.activeBandId) {\n              return band;\n            }\n\n            return {\n              ...band,\n              fans: band.fans + fanGain,\n              coins: band.coins + coinGain,\n              reputation: band.reputation + (quality === 'perfect' ? 2 : quality === 'good' ? 1 : 0),\n              autoplayUnlocked: band.autoplayUnlocked || band.fans >= 300,\n            };\n          });\n\n          return {\n            bands: updatedBands,\n            score: state.score + scoreGain,\n            combo: nextCombo,\n            lastHit: quality,\n          };\n        }),\n      applyShowRewards: (fansGain, fameGain, coinsGain) =>\n        set((state) => {\n          if (!state.activeBandId) {\n            return state;\n          }\n\n          const updatedBands = state.bands.map((band) => {\n            if (band.id !== state.activeBandId) {\n              return band;\n            }\n\n            return {\n              ...band,\n              fans: band.fans + Math.max(0, fansGain),\n              reputation: band.reputation + Math.max(0, fameGain),\n              coins: band.coins + Math.max(0, coinsGain),\n            };\n          });\n\n          return { bands: updatedBands };\n        }),\n      addFameStars: (stars) =>\n        set((state) => {\n          if (!state.activeBandId) {\n            return state;\n          }\n\n          const starsToAdd = Math.max(0, Math.floor(stars));\n          if (starsToAdd <= 0) {\n            return state;\n          }\n\n          const updatedBands = state.bands.map((band) => {\n            if (band.id !== state.activeBandId) {\n              return band;\n            }\n\n            return {\n              ...band,\n              fameStars: Math.max(0, Math.floor(band.fameStars ?? 0)) + starsToAdd,\n            };\n          });\n\n          return { bands: updatedBands };\n        }),\n      hireMusician: (instrument, hireCostOverride, musicianId) =>\n        set((state) => {\n          if (!state.activeBandId) {\n            return state;\n          }\n\n          const hireCost = Math.max(0, Math.floor(hireCostOverride ?? 120));\n\n          const updatedBands = state.bands.map((band) => {\n            if (band.id !== state.activeBandId) {\n              return band;\n            }\n\n            const slot = band.musicians[instrument];\n            const unlockedMusicianIds = getBandUnlockedMusicianIds(band);\n            const incomingMusicianId = musicianId ?? slot.musicianId ?? null;\n            const isSameMusicianAlreadyHired = slot.hired && slot.musicianId === incomingMusicianId;\n\n            if (isSameMusicianAlreadyHired) {\n              return band;\n            }\n\n            if (incomingMusicianId === null) {\n              return band;\n            }\n\n            if (unlockedMusicianIds.includes(incomingMusicianId)) {\n              return band;\n            }\n\n            if (band.coins < hireCost) {\n              return band;\n            }\n\n            return {\n              ...band,\n              coins: band.coins - hireCost,\n              unlockedMusicianIds: [...unlockedMusicianIds, incomingMusicianId],\n              musicians: {\n                ...band.musicians,\n                [instrument]: {\n                  ...slot,\n                  hired: true,\n                  musicianId: incomingMusicianId,\n                },\n              },\n            };\n          });\n\n          return { bands: updatedBands };\n        }),\n      setBandMusicianSelection: (instrument, musicianId) =>\n        set((state) => {\n          if (!state.activeBandId) {\n            return state;\n          }\n\n          const updatedBands = state.bands.map((band) => {\n            if (band.id !== state.activeBandId) {\n              return band;\n            }\n\n            const slot = band.musicians[instrument];\n            const unlockedMusicianIds = getBandUnlockedMusicianIds(band);\n            const nextMusicianId = musicianId ?? null;\n\n            if (nextMusicianId !== null && !unlockedMusicianIds.includes(nextMusicianId)) {\n              return band;\n            }\n\n            if (slot.musicianId === nextMusicianId && slot.hired === (nextMusicianId !== null)) {\n              return band;\n            }\n\n            return {\n              ...band,\n              unlockedMusicianIds,\n              musicians: {\n                ...band.musicians,\n                [instrument]: {\n                  ...slot,\n                  hired: nextMusicianId !== null,\n                  musicianId: nextMusicianId,\n                },\n              },\n            };\n          });\n\n          return { bands: updatedBands };\n        }),\n      upgradeInstrument: (instrument) =>\n        set((state) => {\n          if (!state.activeBandId) {\n            return state;\n          }\n\n          const updatedBands = state.bands.map((band) => {\n            if (band.id !== state.activeBandId) {\n              return band;\n            }\n\n            const slot = band.musicians[instrument];\n            const upgradeCost = 60 + slot.instrumentLevel * 40;\n\n            if (!slot.hired || band.coins < upgradeCost) {\n              return band;\n            }\n\n            return {\n              ...band,\n              coins: band.coins - upgradeCost,\n              musicians: {\n                ...band.musicians,\n                [instrument]: {\n                  ...slot,\n                  instrumentLevel: slot.instrumentLevel + 1,\n                  skillLevel: slot.skillLevel + 1,\n                },\n              },\n            };\n          });\n\n          return { bands: updatedBands };\n        }),\n    }),\n    {\n      name: 'hero-music-save-v1',\n      version: 3,\n      migrate: (persistedState: unknown) => {\n        if (!persistedState || typeof persistedState !== 'object') {\n          return persistedState as GameState;\n        }\n\n        const state = persistedState as {\n          bands?: Array<Band & { fameStars?: number }>;\n          audioSettings?: Partial<AudioSettings>;\n        };\n\n        const defaultAudioSettings = getDefaultAudioSettings();\n        const rawInstrumentVolumes = state.audioSettings?.instrumentVolumes ?? {};\n        const migratedAudioSettings: AudioSettings = {\n          musicEnabled: state.audioSettings?.musicEnabled ?? defaultAudioSettings.musicEnabled,\n          sfxEnabled: state.audioSettings?.sfxEnabled ?? defaultAudioSettings.sfxEnabled,\n          instrumentVolumes: {\n            guitar: Math.max(0, Math.min(1, rawInstrumentVolumes.guitar ?? defaultAudioSettings.instrumentVolumes.guitar)),\n            drums: Math.max(0, Math.min(1, rawInstrumentVolumes.drums ?? defaultAudioSettings.instrumentVolumes.drums)),\n            bass: Math.max(0, Math.min(1, rawInstrumentVolumes.bass ?? defaultAudioSettings.instrumentVolumes.bass)),\n            keys: Math.max(0, Math.min(1, rawInstrumentVolumes.keys ?? defaultAudioSettings.instrumentVolumes.keys)),\n          },\n        };\n\n        if (!Array.isArray(state.bands)) {\n          return {\n            ...state,\n            audioSettings: migratedAudioSettings,\n          } as GameState;\n        }\n\n        return {\n          ...state,\n          audioSettings: migratedAudioSettings,\n          bands: state.bands.map((band) => ({\n            ...band,\n            fameStars: Math.max(0, Math.floor(band.fameStars ?? 0)),\n          })),\n        } as GameState;\n      },\n      partialize: (state) => ({\n        bands: state.bands.map((band) => ({\n          ...band,\n          fameStars: Math.max(0, Math.floor(band.fameStars ?? 0)),\n        })),\n        activeBandId: state.activeBandId,\n        currentStageId: state.currentStageId,\n        audioSettings: state.audioSettings,\n      }),\n    }\n  )\n);","import React, { useEffect } from 'react';\nimport { useGameStore } from '../../state/gameStore';\n\ntype BootSceneProps = {\n    onLoadComplete: () => void;\n};\n\nconst BootScene: React.FC<BootSceneProps> = ({ onLoadComplete }) => {\n    const setLoaded = useGameStore((state) => state.setLoaded);\n\n    useEffect(() => {\n        const timeout = setTimeout(() => {\n            setLoaded(true);\n            onLoadComplete();\n        }, 400);\n\n        return () => clearTimeout(timeout);\n    }, [onLoadComplete, setLoaded]);\n\n    return React.createElement('div', { className: 'boot-scene' }, 'Loading assets...');\n};\n\nexport default BootScene;","import { useEffect, useRef } from 'react';\n\nconst useGameLoop = (update: (deltaTime: number) => void = () => {}) => {\n    const requestRef = useRef<number | null>(null);\n    const previousTimeRef = useRef<number>(0);\n\n    const loop = (time: number) => {\n        if (previousTimeRef.current !== 0) {\n            const deltaTime = time - previousTimeRef.current;\n            update(deltaTime);\n        }\n        previousTimeRef.current = time;\n        requestRef.current = requestAnimationFrame(loop);\n    };\n\n    useEffect(() => {\n        requestRef.current = requestAnimationFrame(loop);\n        return () => {\n            if (requestRef.current !== null) {\n                cancelAnimationFrame(requestRef.current);\n            }\n        };\n    }, []);\n\n    return null;\n};\n\nexport default useGameLoop;","import { Howl, Howler } from 'howler';\r\nimport { useGameStore } from '../state/gameStore';\r\n\r\ntype ClickSoundType = 'open' | 'close' | 'default' | 'confirm' | 'cancel';\r\n\r\nconst clickInSrc = new URL('../rsc/audios/Clique_in.mp3', import.meta.url).href;\r\nconst clickOutSrc = new URL('../rsc/audios/Clique_Out.mp3', import.meta.url).href;\r\nconst clickConfirmSrc = new URL('../rsc/audios/Clique_confirm.mp3', import.meta.url).href;\r\nconst clickCancelSrc = new URL('../rsc/audios/Clique_cancelar.mp3', import.meta.url).href;\r\n\r\nconst interactiveSelector = [\r\n  'button',\r\n  'a',\r\n  'input',\r\n  'select',\r\n  'textarea',\r\n  'label',\r\n  '[role=\"button\"]',\r\n  '[role=\"menuitem\"]',\r\n  '[data-click-interactive=\"true\"]',\r\n].join(',');\r\n\r\nconst getClickType = (value?: string): ClickSoundType => {\r\n  if (value === 'confirm') {\r\n    return 'confirm';\r\n  }\r\n\r\n  if (value === 'cancel') {\r\n    return 'cancel';\r\n  }\r\n\r\n  if (value === 'close') {\r\n    return 'close';\r\n  }\r\n\r\n  if (value === 'open') {\r\n    return 'open';\r\n  }\r\n\r\n  return 'default';\r\n};\r\n\r\nconst clickInHowl = new Howl({\r\n  src: [clickInSrc],\r\n  preload: true,\r\n  volume: 1,\r\n  html5: false,\r\n  pool: 1,\r\n});\r\n\r\nconst clickOutHowl = new Howl({\r\n  src: [clickOutSrc],\r\n  preload: true,\r\n  volume: 1,\r\n  html5: false,\r\n  pool: 1,\r\n});\r\n\r\nconst clickConfirmHowl = new Howl({\r\n  src: [clickConfirmSrc],\r\n  preload: true,\r\n  volume: 1,\r\n  html5: false,\r\n  pool: 1,\r\n});\r\n\r\nconst clickCancelHowl = new Howl({\r\n  src: [clickCancelSrc],\r\n  preload: true,\r\n  volume: 1,\r\n  html5: false,\r\n  pool: 1,\r\n});\r\n\r\nlet activeHowl: Howl | null = null;\r\nlet activeSoundId: number | null = null;\r\n\r\nconst ensureClickAudioReady = () => {\r\n  if (typeof window === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  Howler.autoSuspend = false;\r\n  void Howler.ctx?.resume();\r\n};\r\n\r\nconst stopCurrentClick = () => {\r\n  if (!activeHowl || activeSoundId === null) {\r\n    return;\r\n  }\r\n\r\n  activeHowl.stop(activeSoundId);\r\n  activeHowl = null;\r\n  activeSoundId = null;\r\n};\r\n\r\nexport const playUiClickSound = (type: ClickSoundType = 'default') => {\r\n  if (typeof window === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  if (!useGameStore.getState().audioSettings.sfxEnabled) {\r\n    return;\r\n  }\r\n\r\n  ensureClickAudioReady();\r\n  const playNow = () => {\r\n    stopCurrentClick();\r\n\r\n    const howl = type === 'close'\r\n      ? clickOutHowl\r\n      : type === 'confirm'\r\n        ? clickConfirmHowl\r\n        : type === 'cancel'\r\n          ? clickCancelHowl\r\n          : clickInHowl;\r\n    const nextId = howl.play();\r\n\r\n    if (typeof nextId === 'number') {\r\n      activeHowl = howl;\r\n      activeSoundId = nextId;\r\n      howl.once('end', (id) => {\r\n        if (id === activeSoundId) {\r\n          activeHowl = null;\r\n          activeSoundId = null;\r\n        }\r\n      }, nextId);\r\n    }\r\n  };\r\n\r\n  const context = Howler.ctx;\r\n  if (context && context.state !== 'running') {\r\n    void context.resume().then(playNow).catch(playNow);\r\n    return;\r\n  }\r\n\r\n  playNow();\r\n};\r\n\r\nlet globalClickCleanup: (() => void) | null = null;\r\n\r\nexport const setupGlobalUiClickSound = () => {\r\n  if (typeof document === 'undefined') {\r\n    return () => undefined;\r\n  }\r\n\r\n  if (globalClickCleanup) {\r\n    return globalClickCleanup;\r\n  }\r\n\r\n  void ensureClickAudioReady();\r\n\r\n  const handleGlobalPointerDown = (event: PointerEvent) => {\r\n    const target = event.target;\r\n\r\n    if (!(target instanceof Element)) {\r\n      return;\r\n    }\r\n\r\n    if (target.closest('[data-click-sfx-ignore=\"true\"]')) {\r\n      return;\r\n    }\r\n\r\n    const explicitSoundElement = target.closest<HTMLElement>('[data-click-sfx]');\r\n    if (explicitSoundElement) {\r\n      playUiClickSound(getClickType(explicitSoundElement.dataset.clickSfx));\r\n      return;\r\n    }\r\n\r\n    const isInsideStageScreen = Boolean(target.closest('.stage-screen'));\r\n    const isInteractiveTarget = Boolean(target.closest(interactiveSelector));\r\n\r\n    if (isInsideStageScreen && !isInteractiveTarget) {\r\n      return;\r\n    }\r\n\r\n    if (!isInteractiveTarget) {\r\n      return;\r\n    }\r\n\r\n    playUiClickSound('default');\r\n  };\r\n\r\n  document.addEventListener('pointerdown', handleGlobalPointerDown, true);\r\n\r\n  globalClickCleanup = () => {\r\n    document.removeEventListener('pointerdown', handleGlobalPointerDown, true);\r\n    stopCurrentClick();\r\n    globalClickCleanup = null;\r\n  };\r\n\r\n  return globalClickCleanup;\r\n};\r\n","import { Howl, Howler } from 'howler';\r\n\r\ntype ThemeVariant = 'menu' | 'map';\r\n\r\nconst menuThemeMusicSrc = new URL('../rsc/audios/Musica_Tema.mp3', import.meta.url).href;\r\nconst mapThemeMusicSrc = new URL('../rsc/musics/Music_background_mapa.mp3', import.meta.url).href;\r\nconst THEME_VARIANTS: ThemeVariant[] = ['menu', 'map'];\r\nconst THEME_TARGET_VOLUME = 0.25;\r\nconst THEME_FADE_IN_MS = 900;\r\nconst THEME_FADE_OUT_MS = 520;\r\nconst THEME_REVERB_WET = 0.2;\r\nconst THEME_REVERB_DRY = 0.8;\r\nconst pauseTimeouts: Partial<Record<ThemeVariant, number>> = {};\r\nlet activeTheme: ThemeVariant | null = null;\r\nlet themeReverbReady = false;\r\nlet themeDryGain: GainNode | null = null;\r\nlet themeWetGain: GainNode | null = null;\r\nlet themeConvolver: ConvolverNode | null = null;\r\nconst isIOSDevice = typeof navigator !== 'undefined' && /iPad|iPhone|iPod/i.test(navigator.userAgent);\r\nconst shouldUseHtml5ThemeAudio = isIOSDevice;\r\n\r\nconst themeHowls: Record<ThemeVariant, Howl> = {\r\n  menu: new Howl({\r\n    src: [menuThemeMusicSrc],\r\n    preload: true,\r\n    loop: true,\r\n    volume: 0,\r\n    html5: shouldUseHtml5ThemeAudio,\r\n    pool: 1,\r\n  }),\r\n  map: new Howl({\r\n    src: [mapThemeMusicSrc],\r\n    preload: true,\r\n    loop: true,\r\n    volume: 0,\r\n    html5: shouldUseHtml5ThemeAudio,\r\n    pool: 1,\r\n  }),\r\n};\r\n\r\nconst clearPauseTimeout = (variant: ThemeVariant) => {\r\n  const timeoutId = pauseTimeouts[variant];\r\n  if (typeof window !== 'undefined' && timeoutId) {\r\n    window.clearTimeout(timeoutId);\r\n    pauseTimeouts[variant] = undefined;\r\n  }\r\n};\r\n\r\nconst createImpulseResponse = (audioContext: AudioContext, durationSec: number, decay: number) => {\r\n  const sampleRate = audioContext.sampleRate;\r\n  const length = Math.max(1, Math.floor(sampleRate * durationSec));\r\n  const impulse = audioContext.createBuffer(2, length, sampleRate);\r\n\r\n  for (let channel = 0; channel < impulse.numberOfChannels; channel += 1) {\r\n    const channelData = impulse.getChannelData(channel);\r\n    for (let index = 0; index < length; index += 1) {\r\n      const time = index / length;\r\n      const envelope = Math.pow(1 - time, decay);\r\n      channelData[index] = (Math.random() * 2 - 1) * envelope;\r\n    }\r\n  }\r\n\r\n  return impulse;\r\n};\r\n\r\nconst ensureThemeReverb = () => {\r\n  if (themeReverbReady || typeof window === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  const context = Howler.ctx;\r\n  const masterGain = Howler.masterGain;\r\n  if (!context || !masterGain) {\r\n    return;\r\n  }\r\n\r\n  const dryGain = context.createGain();\r\n  dryGain.gain.value = THEME_REVERB_DRY;\r\n  const wetGain = context.createGain();\r\n  wetGain.gain.value = THEME_REVERB_WET;\r\n  const convolver = context.createConvolver();\r\n  convolver.buffer = createImpulseResponse(context, 1.35, 2.2);\r\n\r\n  dryGain.connect(masterGain);\r\n  wetGain.connect(convolver);\r\n  convolver.connect(masterGain);\r\n\r\n  themeDryGain = dryGain;\r\n  themeWetGain = wetGain;\r\n  themeConvolver = convolver;\r\n  themeReverbReady = true;\r\n};\r\n\r\nconst applyThemeReverbRouting = (howl: Howl) => {\r\n  if (shouldUseHtml5ThemeAudio) {\r\n    return;\r\n  }\r\n\r\n  ensureThemeReverb();\r\n  if (!themeReverbReady || !themeDryGain || !themeWetGain || !themeConvolver) {\r\n    return;\r\n  }\r\n\r\n  const internalHowl = howl as unknown as {\r\n    _sounds?: Array<{ _node?: { disconnect?: () => void; connect?: (node: AudioNode) => void } }>;\r\n  };\r\n  const sounds = internalHowl._sounds ?? [];\r\n\r\n  sounds.forEach((sound) => {\r\n    const node = sound._node;\r\n    if (!node || typeof node.disconnect !== 'function' || typeof node.connect !== 'function') {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      node.disconnect();\r\n      node.connect(themeDryGain);\r\n      node.connect(themeWetGain);\r\n    } catch {\r\n      node.connect(Howler.masterGain);\r\n    }\r\n  });\r\n};\r\n\r\nconst ensureThemeAudioReady = () => {\r\n  if (typeof window === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  Howler.autoSuspend = false;\r\n  void Howler.ctx?.resume();\r\n};\r\n\r\nexport const playThemeMusic = (variant: ThemeVariant = 'menu') => {\r\n  if (typeof window === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  ensureThemeAudioReady();\r\n  clearPauseTimeout(variant);\r\n\r\n  THEME_VARIANTS.forEach((candidate) => {\r\n    if (candidate !== variant) {\r\n      pauseThemeMusic(candidate);\r\n    }\r\n  });\r\n\r\n  const targetHowl = themeHowls[variant];\r\n\r\n  const playNow = () => {\r\n    if (!targetHowl.playing()) {\r\n      targetHowl.volume(0);\r\n      targetHowl.play();\r\n    }\r\n\r\n    applyThemeReverbRouting(targetHowl);\r\n\r\n    const currentVolume = Number(targetHowl.volume()) || 0;\r\n    if (currentVolume >= THEME_TARGET_VOLUME) {\r\n      targetHowl.volume(THEME_TARGET_VOLUME);\r\n      activeTheme = variant;\r\n      return;\r\n    }\r\n\r\n    targetHowl.fade(currentVolume, THEME_TARGET_VOLUME, THEME_FADE_IN_MS);\r\n    activeTheme = variant;\r\n  };\r\n\r\n  const context = Howler.ctx;\r\n  if (context && context.state !== 'running') {\r\n    void context.resume().then(playNow).catch(playNow);\r\n    return;\r\n  }\r\n\r\n  playNow();\r\n};\r\n\r\nexport const pauseThemeMusic = (variant?: ThemeVariant) => {\r\n  if (typeof window === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  const targets = variant ? [variant] : THEME_VARIANTS;\r\n\r\n  targets.forEach((target) => {\r\n    clearPauseTimeout(target);\r\n\r\n    const targetHowl = themeHowls[target];\r\n    if (!targetHowl.playing()) {\r\n      targetHowl.volume(0);\r\n      if (activeTheme === target) {\r\n        activeTheme = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const currentVolume = Number(targetHowl.volume()) || 0;\r\n    targetHowl.fade(currentVolume, 0, THEME_FADE_OUT_MS);\r\n    pauseTimeouts[target] = window.setTimeout(() => {\r\n      targetHowl.pause();\r\n      targetHowl.volume(0);\r\n      if (activeTheme === target) {\r\n        activeTheme = null;\r\n      }\r\n      pauseTimeouts[target] = undefined;\r\n    }, THEME_FADE_OUT_MS + 40);\r\n  });\r\n};\r\n\r\nexport const setupThemeMusicUnlock = (canPlayTheme?: () => boolean, variant: ThemeVariant = 'menu') => {\r\n  if (typeof window === 'undefined') {\r\n    return () => undefined;\r\n  }\r\n\r\n  const unlockAndPlay = () => {\r\n    if (canPlayTheme && !canPlayTheme()) {\r\n      pauseThemeMusic(variant);\r\n      return;\r\n    }\r\n\r\n    playThemeMusic(variant);\r\n  };\r\n\r\n  window.addEventListener('pointerdown', unlockAndPlay, { once: true });\r\n  window.addEventListener('keydown', unlockAndPlay, { once: true });\r\n\r\n  return () => {\r\n    window.removeEventListener('pointerdown', unlockAndPlay);\r\n    window.removeEventListener('keydown', unlockAndPlay);\r\n  };\r\n};\r\n\r\nexport const disposeThemeMusic = () => {\r\n  if (typeof window !== 'undefined') {\r\n    THEME_VARIANTS.forEach(clearPauseTimeout);\r\n  }\r\n\r\n  THEME_VARIANTS.forEach((variant) => {\r\n    const targetHowl = themeHowls[variant];\r\n    targetHowl.stop();\r\n    targetHowl.unload();\r\n  });\r\n\r\n  themeConvolver?.disconnect();\r\n  themeWetGain?.disconnect();\r\n  themeDryGain?.disconnect();\r\n  themeConvolver = null;\r\n  themeWetGain = null;\r\n  themeDryGain = null;\r\n  themeReverbReady = false;\r\n  activeTheme = null;\r\n};\r\n","import React, { useEffect, useRef, useState } from 'react';\nimport BootScene from './game/scenes/BootScene';\nimport useGameLoop from './hooks/useGameLoop';\nimport { useGameStore } from './state/gameStore';\nimport { setupGlobalUiClickSound } from './utils/clickAudio';\nimport { disposeThemeMusic, pauseThemeMusic, playThemeMusic, setupThemeMusicUnlock } from './utils/themeAudio';\n\nconst BandHub = React.lazy(() => import('./components/BandHub'));\nconst BandGame = React.lazy(() => import('./components/BandGame'));\n\nconst App: React.FC = () => {\n    const [currentScene, setCurrentScene] = useState<'boot' | 'menu' | 'game'>('boot');\n    const isLoaded = useGameStore((state) => state.isLoaded);\n    const activeBandId = useGameStore((state) => state.activeBandId);\n    const isMusicEnabled = useGameStore((state) => state.audioSettings.musicEnabled);\n    const setMusicEnabled = useGameStore((state) => state.setMusicEnabled);\n    const sceneRef = useRef(currentScene);\n    const musicEnabledRef = useRef(isMusicEnabled);\n\n    useEffect(() => {\n        sceneRef.current = currentScene;\n    }, [currentScene]);\n\n    useEffect(() => {\n        musicEnabledRef.current = isMusicEnabled;\n    }, [isMusicEnabled]);\n\n    useEffect(() => {\n        if (isLoaded) {\n            setCurrentScene('menu');\n        }\n    }, [isLoaded]);\n\n    useGameLoop();\n\n    useEffect(() => {\n        const cleanup = setupGlobalUiClickSound();\n        return cleanup;\n    }, []);\n\n    useEffect(() => {\n        // S toca a msica tema se estiver no menu principal (BandHub),\n        // e no ao abrir o modal de msicos dentro do jogo.\n        const shouldPlayTheme = currentScene === 'menu' && isMusicEnabled;\n\n        if (shouldPlayTheme) {\n            playThemeMusic('menu');\n            const cleanupUnlock = setupThemeMusicUnlock(\n                () => sceneRef.current === 'menu' && musicEnabledRef.current,\n                'menu'\n            );\n            return cleanupUnlock;\n        }\n\n        // Corrigido: no pausar a msica tema ao abrir modais dentro do jogo,\n        // apenas ao sair do menu principal ou desabilitar msica.\n        if (!isMusicEnabled || currentScene !== 'menu') {\n            pauseThemeMusic('menu');\n        }\n    }, [currentScene, isMusicEnabled]);\n\n    useEffect(() => {\n        const resumeThemeIfNeeded = () => {\n            if (!isMusicEnabled) {\n                pauseThemeMusic();\n                return;\n            }\n\n            if (currentScene !== 'menu') {\n                return;\n            }\n\n            if (typeof document !== 'undefined' && document.visibilityState === 'hidden') {\n                return;\n            }\n\n            playThemeMusic('menu');\n        };\n\n        const handleVisibilityChange = () => {\n            if (document.visibilityState === 'visible') {\n                resumeThemeIfNeeded();\n            }\n        };\n\n        const handlePageShow = () => {\n            resumeThemeIfNeeded();\n        };\n\n        document.addEventListener('visibilitychange', handleVisibilityChange);\n        window.addEventListener('pageshow', handlePageShow);\n\n        return () => {\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\n            window.removeEventListener('pageshow', handlePageShow);\n        };\n    }, [currentScene, isMusicEnabled]);\n\n    useEffect(() => {\n        const enforceThemeByScene = () => {\n            const shouldPlayTheme = sceneRef.current === 'menu' && musicEnabledRef.current;\n\n            if (typeof document !== 'undefined' && document.visibilityState === 'hidden') {\n                return;\n            }\n\n            if (shouldPlayTheme) {\n                playThemeMusic('menu');\n                return;\n            }\n\n            if (!musicEnabledRef.current) {\n                pauseThemeMusic();\n            }\n        };\n\n        const handleVisibilityChange = () => {\n            if (document.visibilityState === 'visible') {\n                enforceThemeByScene();\n            }\n        };\n\n        const handlePageShow = () => {\n            enforceThemeByScene();\n        };\n\n        document.addEventListener('visibilitychange', handleVisibilityChange);\n        window.addEventListener('pageshow', handlePageShow);\n\n        return () => {\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\n            window.removeEventListener('pageshow', handlePageShow);\n        };\n    }, []);\n\n    useEffect(() => {\n        return () => {\n            disposeThemeMusic();\n        };\n    }, []);\n\n    const handleToggleMusic = () => {\n        setMusicEnabled(!isMusicEnabled);\n    };\n\n    const renderScene = () => {\n        switch (currentScene) {\n            case 'boot':\n                return <BootScene onLoadComplete={() => setCurrentScene('menu')} />;\n            case 'menu':\n                return (\n                    <BandHub\n                        onStartGame={() => setCurrentScene('game')}\n                        isMusicEnabled={isMusicEnabled}\n                        onToggleMusic={handleToggleMusic}\n                    />\n                );\n            case 'game':\n                return <BandGame onBackToMenu={() => setCurrentScene('menu')} />;\n            default:\n                return null;\n        }\n    };\n\n    useEffect(() => {\n        if (currentScene === 'game' && !activeBandId) {\n            setCurrentScene('menu');\n        }\n    }, [activeBandId, currentScene]);\n\n    return (\n        <div className=\"game-container\">\n            <React.Suspense fallback={<div className=\"boot-scene\">Loading assets...</div>}>\n                {renderScene()}\n            </React.Suspense>\n        </div>\n    );\n};\n\nexport default App;","// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App';\nimport { registerSW } from 'virtual:pwa-register';\nimport '@fontsource/orbitron';\nimport '@fontsource/press-start-2p';\nimport '@fontsource/rajdhani';\nimport './styles.css';\n\nregisterSW({\n  immediate: true,\n});\n\nconst container = document.getElementById('root');\n\nif (!container) {\n  throw new Error('Root element not found');\n}\n\ncreateRoot(container).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);"],"file":"index-DUhkdb1w.js"}