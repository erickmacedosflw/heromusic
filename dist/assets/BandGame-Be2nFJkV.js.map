{"version":3,"file":"BandGame-Be2nFJkV.js","sources":["../../src/components/band/BandConfigModal.tsx","../../src/components/band/BandInstrumentSelector.tsx","../../src/components/musicians/MusicianDetailModal.tsx","../../src/components/stage/StageVenueCacheCard.tsx","../../src/components/band/BandManagementScreen.tsx","../../src/components/musicians/MusiciansContractScreen.tsx","../../src/components/stage/StageTopValuesBar.tsx","../../src/components/stage/StageBottomNav.tsx","../../src/components/stage/StageProgressList.tsx","../../src/components/stage/StageCenterPanel.tsx","../../src/components/stage/StageCurrentSongBar.tsx","../../src/components/stage/StageVisualEffectsLayer.tsx","../../src/components/stage/Stage3DScene.tsx","../../src/rsc/images/icons/Icone_fechar.png","../../src/components/stage/StageBandSlotsGroup.tsx","../../src/components/stage/StageSofiaDialog.tsx","../../src/components/stage/StageMapModal.tsx","../../src/hooks/useBandScreensState.ts","../../src/assets/bandGameAssets.ts","../../src/constants/bandGame.ts","../../src/rsc/images/maps/Local_Badge_Arena_Central.png?url","../../src/rsc/images/maps/Local_Badge_Bar.png?url","../../src/rsc/images/maps/Local_Badge_Clube.png?url","../../src/rsc/images/maps/Local_Badge_Equipamentos.png?url","../../src/rsc/images/maps/Local_Badge_Estadio_Internacional.png?url","../../src/rsc/images/maps/Local_Badge_Festa_Aniversario.png?url","../../src/rsc/images/maps/Local_Badge_Festival_Escolar.png?url","../../src/rsc/images/maps/Local_Badge_Festival_da_Cidade.png?url","../../src/rsc/images/maps/Local_Badge_Garagem.png?url","../../src/rsc/images/maps/Local_Badge_Isntrumentos.png?url","../../src/rsc/images/maps/Local_Badge_Musicas.png?url","../../src/rsc/images/maps/Local_Badge_Musicos.png?url","../../src/rsc/images/maps/Local_Badge_Teatro.png?url","../../src/rsc/images/maps/Mapa_Mundo.jpeg?url","../../src/rsc/images/maps/Preview_cidade.png?url","../../src/rsc/images/maps/sdsd.png?url","../../src/rsc/videos/palcos/bar_video.mp4?url","../../src/rsc/videos/palcos/festa_aniversario_video.mp4?url","../../src/rsc/videos/palcos/garagem_video.mp4?url","../../src/rsc/videos/palcos/palco_aniversario_video.mp4?url","../../src/rsc/videos/palcos/palco_bar_video.mp4?url","../../src/rsc/videos/palcos/palco_feira_cidade_video.mp4?url","../../src/rsc/videos/palcos/palco_garagem_video.mp4?url","../../src/rsc/musics/Music_background_mapa.mp3?url","../../src/rsc/musics/blues_na_garagem/Musica_Blues_na_Garagem.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_Bass.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_Drums.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_ElectricGuitar.mp3?url","../../src/rsc/musics/blues_na_garagem/blues_na_garagem_Keys.mp3?url","../../src/rsc/musics/garage_music_01.mp3?url","../../src/rsc/images/facesets/9a0bc07b-6a85-418b-95cb-5896ed343429.png?url","../../src/rsc/images/facesets/9c402695-ebce-40ef-bff5-0f5826a90633.png?url","../../src/rsc/images/facesets/Faceset_1.png?url","../../src/rsc/images/facesets/Faceset_10.png?url","../../src/rsc/images/facesets/Faceset_11.png?url","../../src/rsc/images/facesets/Faceset_12.png?url","../../src/rsc/images/facesets/Faceset_13.png?url","../../src/rsc/images/facesets/Faceset_14.png?url","../../src/rsc/images/facesets/Faceset_15.png?url","../../src/rsc/images/facesets/Faceset_16.png?url","../../src/rsc/images/facesets/Faceset_17.png?url","../../src/rsc/images/facesets/Faceset_18.png?url","../../src/rsc/images/facesets/Faceset_19.png?url","../../src/rsc/images/facesets/Faceset_2.png?url","../../src/rsc/images/facesets/Faceset_20.png?url","../../src/rsc/images/facesets/Faceset_21.png?url","../../src/rsc/images/facesets/Faceset_22.png?url","../../src/rsc/images/facesets/Faceset_23.png?url","../../src/rsc/images/facesets/Faceset_24.png?url","../../src/rsc/images/facesets/Faceset_3.png?url","../../src/rsc/images/facesets/Faceset_4.png?url","../../src/rsc/images/facesets/Faceset_5.png?url","../../src/rsc/images/facesets/Faceset_6.png?url","../../src/rsc/images/facesets/Faceset_7.png?url","../../src/rsc/images/facesets/Faceset_8.png?url","../../src/rsc/images/facesets/Faceset_9.png?url","../../src/rsc/images/facesets/Sofia_FullBody.png?url","../../src/rsc/images/facesets/Sofia_ZoomFace.png?url","../../src/rsc/images/facesets/df2dfa63-de5c-4d23-8542-da26085daf37.png?url","../../src/rsc/images/facesets/velho_contratante_musicos.png?url","../../src/rsc/images/portraits/Portrait_1.png?url","../../src/rsc/images/portraits/Portrait_10.png?url","../../src/rsc/images/portraits/Portrait_11.png?url","../../src/rsc/images/portraits/Portrait_12.png?url","../../src/rsc/images/portraits/Portrait_13.png?url","../../src/rsc/images/portraits/Portrait_14.png?url","../../src/rsc/images/portraits/Portrait_15.png?url","../../src/rsc/images/portraits/Portrait_16.png?url","../../src/rsc/images/portraits/Portrait_17.png?url","../../src/rsc/images/portraits/Portrait_18.png?url","../../src/rsc/images/portraits/Portrait_19.png?url","../../src/rsc/images/portraits/Portrait_2.png?url","../../src/rsc/images/portraits/Portrait_20.png?url","../../src/rsc/images/portraits/Portrait_21.png?url","../../src/rsc/images/portraits/Portrait_22.png?url","../../src/rsc/images/portraits/Portrait_23.png?url","../../src/rsc/images/portraits/Portrait_24.png?url","../../src/rsc/images/portraits/Portrait_3.png?url","../../src/rsc/images/portraits/Portrait_4.png?url","../../src/rsc/images/portraits/Portrait_5.png?url","../../src/rsc/images/portraits/Portrait_6.png?url","../../src/rsc/images/portraits/Portrait_7.png?url","../../src/rsc/images/portraits/Portrait_8.png?url","../../src/rsc/images/portraits/Portrait_9.png?url","../../src/utils/assetResolvers.ts","../../src/hooks/useBandGameComputed.ts","../../src/components/BandGame.tsx"],"sourcesContent":["import React from 'react';\r\nimport './BandConfigModal.css';\r\nimport type { Instrument } from '../../state/gameStore';\r\n\r\ntype InstrumentVolumeControl = {\r\n  instrument: Instrument;\r\n  label: string;\r\n  icon: string;\r\n  value: number;\r\n};\r\n\r\ntype BandConfigModalProps = {\r\n  isVisible: boolean;\r\n  isClosing: boolean;\r\n  bandName: string;\r\n  bandLogoUrl: string;\r\n  isSfxEnabled: boolean;\r\n  isMusicEnabled: boolean;\r\n  isCameraMotionEnabled: boolean;\r\n  iconConfig: string;\r\n  iconFechar: string;\r\n  iconAudioOn: string;\r\n  iconCamera: string;\r\n  iconExitBand: string;\r\n  instrumentVolumeControls: InstrumentVolumeControl[];\r\n  onClose: () => void;\r\n  onToggleSfx: (enabled: boolean) => void;\r\n  onToggleMusic: (enabled: boolean) => void;\r\n  onToggleCameraMotion: (enabled: boolean) => void;\r\n  onChangeInstrumentVolume: (instrument: Instrument, value: number) => void;\r\n  onExitBand: () => void;\r\n};\r\n\r\nconst BandConfigModal: React.FC<BandConfigModalProps> = ({\r\n  isVisible,\r\n  isClosing,\r\n  bandName,\r\n  bandLogoUrl,\r\n  isSfxEnabled,\r\n  isMusicEnabled,\r\n  isCameraMotionEnabled,\r\n  iconConfig,\r\n  iconFechar,\r\n  iconAudioOn,\r\n  iconCamera,\r\n  iconExitBand,\r\n  instrumentVolumeControls,\r\n  onClose,\r\n  onToggleSfx,\r\n  onToggleMusic,\r\n  onToggleCameraMotion,\r\n  onChangeInstrumentVolume,\r\n  onExitBand,\r\n}) => {\r\n  if (!isVisible) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className={`band-config-overlay${isClosing ? ' closing' : ' show'}`} aria-hidden=\"true\" />\r\n      <article className={`band-config-card${isClosing ? ' closing' : ' show'}`}>\r\n        <header className=\"band-config-header\">\r\n          <h3>\r\n            <img src={iconConfig} alt=\"\" aria-hidden=\"true\" className=\"band-config-title-icon\" />\r\n            <span>Configurações</span>\r\n          </h3>\r\n          <button\r\n            type=\"button\"\r\n            className=\"band-config-close\"\r\n            onClick={onClose}\r\n            data-click-sfx=\"close\"\r\n            aria-label=\"Fechar configurações\"\r\n          >\r\n            <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"band-config-close-icon\" />\r\n          </button>\r\n        </header>\r\n        <div className=\"band-config-body\">\r\n          <img src={bandLogoUrl} alt={`Logo ${bandName}`} className=\"band-config-logo\" />\r\n          <strong className=\"band-config-name\">{bandName}</strong>\r\n          <div className=\"band-config-audio-title\">\r\n            <img src={iconAudioOn} alt=\"\" aria-hidden=\"true\" />\r\n            <span>Áudio</span>\r\n          </div>\r\n          <label className=\"band-config-option\">\r\n            <input type=\"checkbox\" checked={isSfxEnabled} onChange={(event) => onToggleSfx(event.target.checked)} />\r\n            <span>Efeitos Sonoros</span>\r\n          </label>\r\n          <label className=\"band-config-option\">\r\n            <input type=\"checkbox\" checked={isMusicEnabled} onChange={(event) => onToggleMusic(event.target.checked)} />\r\n            <span>Música</span>\r\n          </label>\r\n          <div className=\"band-config-instrument-volumes\">\r\n            {instrumentVolumeControls.map((control) => {\r\n              const sliderValue = Math.round(Math.max(0, Math.min(1, control.value)) * 100);\r\n              return (\r\n                <label className=\"band-config-volume-column\" key={control.instrument}>\r\n                  <img src={control.icon} alt=\"\" aria-hidden=\"true\" className=\"band-config-volume-icon\" />\r\n                  <span className=\"band-config-volume-label\">{control.label}</span>\r\n                  <input\r\n                    className=\"band-config-volume-slider-vertical\"\r\n                    type=\"range\"\r\n                    min={0}\r\n                    max={100}\r\n                    step={1}\r\n                    value={sliderValue}\r\n                    onInput={(event) => onChangeInstrumentVolume(control.instrument, Number((event.target as HTMLInputElement).value) / 100)}\r\n                    onChange={(event) => onChangeInstrumentVolume(control.instrument, Number(event.target.value) / 100)}\r\n                    disabled={!isMusicEnabled}\r\n                  />\r\n                  <strong className=\"band-config-volume-value\">{sliderValue}%</strong>\r\n                </label>\r\n              );\r\n            })}\r\n          </div>\r\n          <div className=\"band-config-audio-title\">\r\n            <img src={iconCamera} alt=\"\" aria-hidden=\"true\" />\r\n            <span>Câmera</span>\r\n          </div>\r\n          <label className=\"band-config-option\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={isCameraMotionEnabled}\r\n              onChange={(event) => onToggleCameraMotion(event.target.checked)}\r\n            />\r\n            <span>Movimento de câmera</span>\r\n          </label>\r\n          <button\r\n            type=\"button\"\r\n            className=\"band-config-exit\"\r\n            onClick={onExitBand}\r\n            data-click-sfx=\"close\"\r\n          >\r\n            <img src={iconExitBand} alt=\"\" aria-hidden=\"true\" className=\"band-config-exit-icon\" />\r\n            <span>Sair da banda</span>\r\n          </button>\r\n        </div>\r\n      </article>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BandConfigModal;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport type { Instrument } from '../../state/gameStore';\r\nimport './BandInstrumentSelector.css';\r\n\r\ntype BandInstrumentColumn = {\r\n  id: Instrument;\r\n  label: string;\r\n  icon: string;\r\n  emptyInstrumentIcon: string;\r\n  musicianId: number | null;\r\n  musicianFirstName: string;\r\n  musicianFace: string | null;\r\n  hasMusician: boolean;\r\n  rarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n};\r\n\r\ntype SelectorMusician = {\r\n  id: number;\r\n  name: string;\r\n  firstName: string;\r\n  face: string | null;\r\n  portrait: string | null;\r\n  rarityClass: 'bronze' | 'silver' | 'gold';\r\n  rarityLabel: string;\r\n  hype: number;\r\n  fans: number;\r\n  performance: number;\r\n  cache: number;\r\n};\r\n\r\ntype BandInstrumentSelectorProps = {\r\n  bandInstrumentColumns: BandInstrumentColumn[];\r\n  activeInstrument: Instrument | null;\r\n  isDetailOpen: boolean;\r\n  selectorMusicians: SelectorMusician[];\r\n  selectedMusicianId: number | null;\r\n  instrumentLabels: Record<Instrument, string>;\r\n  iconFechar: string;\r\n  iconMusicoVazio: string;\r\n  onOpenInstrument: (instrument: Instrument) => void;\r\n  onCloseSelector: () => void;\r\n  onSelectEmpty: (instrument: Instrument) => void;\r\n  onOpenMusicianDetail: (musician: SelectorMusician) => void;\r\n};\r\n\r\nconst BandInstrumentSelector: React.FC<BandInstrumentSelectorProps> = ({\r\n  bandInstrumentColumns,\r\n  activeInstrument,\r\n  isDetailOpen,\r\n  selectorMusicians,\r\n  selectedMusicianId,\r\n  instrumentLabels,\r\n  iconFechar,\r\n  iconMusicoVazio,\r\n  onOpenInstrument,\r\n  onCloseSelector,\r\n  onSelectEmpty,\r\n  onOpenMusicianDetail,\r\n}) => {\r\n  const SELECTOR_CLOSE_MS = 190;\r\n  const [isSelectorClosing, setIsSelectorClosing] = useState(false);\r\n  const selectorCloseTimeoutRef = useRef<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!activeInstrument) {\r\n      setIsSelectorClosing(false);\r\n    }\r\n  }, [activeInstrument]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (selectorCloseTimeoutRef.current) {\r\n        window.clearTimeout(selectorCloseTimeoutRef.current);\r\n        selectorCloseTimeoutRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const runSelectorCloseAnimation = (onClosed: () => void) => {\r\n    if (selectorCloseTimeoutRef.current) {\r\n      window.clearTimeout(selectorCloseTimeoutRef.current);\r\n      selectorCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setIsSelectorClosing(true);\r\n    selectorCloseTimeoutRef.current = window.setTimeout(() => {\r\n      onClosed();\r\n      setIsSelectorClosing(false);\r\n      selectorCloseTimeoutRef.current = null;\r\n    }, SELECTOR_CLOSE_MS);\r\n  };\r\n\r\n  const instrumentRoleByKey: Record<Instrument, string> = {\r\n    guitar: 'guitarrista',\r\n    bass: 'baixista',\r\n    drums: 'baterista',\r\n    keys: 'tecladista',\r\n  };\r\n\r\n  const activeColumn = activeInstrument\r\n    ? bandInstrumentColumns.find((column) => column.id === activeInstrument)\r\n    : null;\r\n  const activeInstrumentIcon = activeColumn?.icon ?? iconMusicoVazio;\r\n  const activeInstrumentRole = activeInstrument ? instrumentRoleByKey[activeInstrument] : 'músico';\r\n\r\n  const handleOpenInstrument = (instrument: Instrument, musicianId: number | null) => {\r\n    onOpenInstrument(instrument);\r\n    if (musicianId !== null && musicianId !== undefined) {\r\n      const detailMusician = selectorMusicians.find((item) => item.id === musicianId);\r\n      if (detailMusician) {\r\n        onOpenMusicianDetail(detailMusician);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n    <div className={`band-slot-columns${activeInstrument ? ' selector-open' : ''}${isDetailOpen ? ' detail-open' : ''}`}>\r\n      {bandInstrumentColumns.map((column) => (\r\n        <div\r\n          key={column.id}\r\n          className={`band-slot-column${activeInstrument === column.id ? ' active' : ''}${activeInstrument && activeInstrument !== column.id ? ' dimmed' : ''}`}\r\n        >\r\n          <div className=\"band-slot-header\">\r\n            <img src={column.icon} alt={column.label} />\r\n            <span>{column.label}</span>\r\n          </div>\r\n\r\n          <button\r\n            type=\"button\"\r\n            className={`band-slot-musician-card${column.rarityClass ? ` rarity-${column.rarityClass}` : ''}`}\r\n            onClick={() => handleOpenInstrument(column.id, column.musicianId)}\r\n          >\r\n            <div\r\n              key={`${column.id}-${column.musicianId ?? 'empty'}`}\r\n              className=\"band-slot-musician-swap\"\r\n            >\r\n              {column.hasMusician ? (\r\n                <div className=\"band-slot-musician-info\">\r\n                  {column.musicianFace ? (\r\n                    <img src={column.musicianFace} alt=\"\" className=\"band-slot-musician-face\" />\r\n                  ) : null}\r\n                  <span className=\"band-slot-musician-name\">{column.musicianFirstName}</span>\r\n                </div>\r\n              ) : (\r\n                <img src={iconMusicoVazio} alt=\"Músico vazio\" className=\"band-slot-empty-icon\" />\r\n              )}\r\n            </div>\r\n          </button>\r\n\r\n          <button type=\"button\" className=\"band-slot-instrument-card\">\r\n            <img src={column.emptyInstrumentIcon} alt={`Instrumento ${column.label}`} className=\"band-slot-empty-icon\" />\r\n          </button>\r\n        </div>\r\n      ))}\r\n    </div>\r\n\r\n      {activeInstrument ? (\r\n        <div className=\"band-selector-overlay\">\r\n          <div className={`band-selector-panel${isSelectorClosing ? ' closing' : ''}${isDetailOpen ? ' detail-open' : ''}`}>\r\n            <div className=\"band-selector-head\">\r\n              <strong className=\"band-selector-title\">\r\n                <img src={activeInstrumentIcon} alt=\"\" aria-hidden=\"true\" className=\"band-selector-title-icon\" />\r\n                <span>Selecionar {activeInstrumentRole}</span>\r\n              </strong>\r\n              <span className=\"band-selector-instrument-label\">{instrumentLabels[activeInstrument]}</span>\r\n              <button\r\n                type=\"button\"\r\n                className=\"band-selector-close\"\r\n                onClick={() => runSelectorCloseAnimation(onCloseSelector)}\r\n                data-click-sfx=\"close\"\r\n                aria-label=\"Fechar seletor de músicos\"\r\n              >\r\n                <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"band-selector-gallery\">\r\n              <button\r\n                type=\"button\"\r\n                className={`band-selector-item empty${selectedMusicianId === null ? ' selected' : ''}`}\r\n                data-click-sfx=\"cancel\"\r\n                onClick={() => runSelectorCloseAnimation(() => onSelectEmpty(activeInstrument))}\r\n              >\r\n                <div className=\"band-selector-face-empty\">\r\n                  <img src={iconMusicoVazio} alt=\"\" aria-hidden=\"true\" />\r\n                </div>\r\n                <span className=\"band-selector-name\">Vazio</span>\r\n              </button>\r\n              {selectorMusicians.map((musician) => (\r\n                <button\r\n                  key={musician.id}\r\n                  type=\"button\"\r\n                  className={`band-selector-item rarity-${musician.rarityClass}${selectedMusicianId === musician.id ? ' selected' : ''}`}\r\n                  onClick={() => onOpenMusicianDetail(musician)}\r\n                >\r\n                  {musician.face ? (\r\n                    <img src={musician.face} alt=\"\" className=\"band-selector-face\" />\r\n                  ) : (\r\n                    <div className=\"band-selector-face-empty\">\r\n                      <img src={iconMusicoVazio} alt=\"\" aria-hidden=\"true\" />\r\n                    </div>\r\n                  )}\r\n                  <span className=\"band-selector-name\">{musician.firstName}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BandInstrumentSelector;\r\n","import React from 'react';\r\n\r\ntype MusicianData = {\r\n  ID: number;\r\n  Instrumentista: string;\r\n  Instrumento: number;\r\n  Asset_Face: string;\r\n  Asset_Portrait?: string;\r\n  Asset: string;\r\n  Asset_Char?: string;\r\n  Hype: number;\r\n  Fans: number;\r\n  Apresentacao: number;\r\n  Sexo: string;\r\n  Custo: number;\r\n  Cache: number;\r\n  Nivel: number;\r\n  ID_Instrumento: number;\r\n  Contratado: boolean;\r\n  Historia: string;\r\n};\r\n\r\ntype MusicianDetailModalProps = {\r\n  musician: MusicianData | null;\r\n  selectedMusicianFace: string | null;\r\n  selectedMusicianPortrait?: string | null;\r\n  selectedMusicianInitials: string;\r\n  selectedMusicianRarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n  selectedInstrumentIcon: string;\r\n  isClosing: boolean;\r\n  isStoryOpen: boolean;\r\n  isSelectedMusicianHired: boolean;\r\n  isSelectedMusicianLockedByCoins: boolean;\r\n  canHireSelectedMusician: boolean;\r\n  selectedMusicianPrice: number;\r\n  iconFechar: string;\r\n  iconBloqueado: string;\r\n  iconDisponivel: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  instrumentNameById: Record<number, string>;\r\n  showStoryToggle?: boolean;\r\n  hideCloseButton?: boolean;\r\n  customAction?: {\r\n    label: string;\r\n    onClick: () => void;\r\n    variant?: 'select' | 'remove';\r\n    disabled?: boolean;\r\n  };\r\n  onCloseDetails: () => void;\r\n  onToggleStory: () => void;\r\n  onHireSelected: () => void;\r\n  displayMode?: 'card' | 'hero-stage';\r\n};\r\n\r\nconst MusicianDetailModal: React.FC<MusicianDetailModalProps> = ({\r\n  musician,\r\n  selectedMusicianFace,\r\n  selectedMusicianPortrait,\r\n  selectedMusicianInitials,\r\n  selectedMusicianRarityClass,\r\n  selectedInstrumentIcon,\r\n  isClosing,\r\n  isStoryOpen,\r\n  isSelectedMusicianHired,\r\n  isSelectedMusicianLockedByCoins,\r\n  canHireSelectedMusician,\r\n  selectedMusicianPrice,\r\n  iconFechar,\r\n  iconBloqueado,\r\n  iconDisponivel,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  instrumentNameById,\r\n  showStoryToggle = true,\r\n  hideCloseButton = false,\r\n  customAction,\r\n  onCloseDetails,\r\n  onToggleStory,\r\n  onHireSelected,\r\n  displayMode = 'card',\r\n}) => {\r\n  const [displayMusician, setDisplayMusician] = React.useState<MusicianData | null>(musician);\r\n  const [isContentLeaving, setIsContentLeaving] = React.useState(false);\r\n  const [isContentEntering, setIsContentEntering] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (!musician) {\r\n      setDisplayMusician(null);\r\n      setIsContentLeaving(false);\r\n      setIsContentEntering(false);\r\n      return;\r\n    }\r\n\r\n    if (!displayMusician || displayMusician.ID === musician.ID) {\r\n      setDisplayMusician(musician);\r\n      return;\r\n    }\r\n\r\n    setIsContentLeaving(true);\r\n\r\n    const switchTimer = window.setTimeout(() => {\r\n      setDisplayMusician(musician);\r\n      setIsContentLeaving(false);\r\n      setIsContentEntering(true);\r\n    }, 130);\r\n\r\n    const settleTimer = window.setTimeout(() => {\r\n      setIsContentEntering(false);\r\n    }, 340);\r\n\r\n    return () => {\r\n      window.clearTimeout(switchTimer);\r\n      window.clearTimeout(settleTimer);\r\n    };\r\n  }, [musician, displayMusician]);\r\n\r\n  const currentMusician = displayMusician;\r\n\r\n  if (!currentMusician) {\r\n    return null;\r\n  }\r\n\r\n  const rarityLabel = selectedMusicianRarityClass === 'gold'\r\n    ? 'Ouro'\r\n    : selectedMusicianRarityClass === 'silver'\r\n      ? 'Prata'\r\n      : 'Bronze';\r\n\r\n  const displayPortrait = selectedMusicianPortrait ?? selectedMusicianFace;\r\n  const transitionClass = `musician-detail-transition${isContentLeaving ? ' leaving' : ''}${isContentEntering ? ' entering' : ''}`;\r\n\r\n  return (\r\n    <article\r\n      className={`musician-detail-card${selectedMusicianRarityClass ? ` rarity-${selectedMusicianRarityClass}` : ''}${isClosing ? ' closing' : ' show'}${isStoryOpen ? ' story-open' : ''}${displayMode === 'hero-stage' ? ' hero-stage' : ''}${customAction ? ' has-custom-action' : ''}`}\r\n    >\r\n      {!hideCloseButton ? (\r\n        <button\r\n          type=\"button\"\r\n          className=\"musician-detail-close\"\r\n          onClick={onCloseDetails}\r\n          data-click-sfx=\"close\"\r\n          aria-label=\"Fechar detalhes do músico\"\r\n        >\r\n          <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n        </button>\r\n      ) : null}\r\n\r\n      {showStoryToggle ? (\r\n        <button\r\n          type=\"button\"\r\n          className=\"musician-detail-info-btn\"\r\n          onClick={onToggleStory}\r\n          data-click-sfx=\"open\"\r\n          aria-label=\"Mostrar detalhes da história do músico\"\r\n        >\r\n          <span className=\"musician-info-icon\" aria-hidden=\"true\">i</span>\r\n        </button>\r\n      ) : null}\r\n      {isStoryOpen ? (\r\n        <div className=\"musician-detail-story\">\r\n          <p>{currentMusician.Historia}</p>\r\n        </div>\r\n      ) : displayMode === 'hero-stage' ? (\r\n        <>\r\n          <header className={`musician-hero-header ${transitionClass}`}>\r\n            <strong>{currentMusician.Instrumentista}</strong>\r\n          </header>\r\n\r\n          <div className={`musician-hero-scene ${transitionClass}`}>\r\n            <span className=\"musician-hero-stat stat-hype\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFameWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Hype</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Hype)}</strong>\r\n            </span>\r\n            <span className=\"musician-hero-stat stat-fans\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFansWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Público</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Fans)}</strong>\r\n            </span>\r\n            <span className=\"musician-hero-stat stat-performance\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconRhythmWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Perf.</span>\r\n              </span>\r\n              <strong>{formatPerformancePercent(currentMusician.Apresentacao)}</strong>\r\n            </span>\r\n            <span className=\"musician-hero-stat stat-cache\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconCost} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Cachê</span>\r\n              </span>\r\n              <strong>- R$ {formatNumber(currentMusician.Cache).replace(/,00$/, '')}</strong>\r\n            </span>\r\n\r\n            <div className=\"musician-hero-floor\" aria-hidden=\"true\" />\r\n            <div className=\"musician-hero-shadow\" aria-hidden=\"true\" />\r\n            <div className={`musician-hero-portrait${currentMusician.Instrumento === 3 ? ' is-drummer' : ''}`} aria-hidden=\"true\">\r\n              {displayPortrait ? (\r\n                <img src={displayPortrait} alt=\"\" className=\"musician-hero-portrait-image\" />\r\n              ) : (\r\n                <div className=\"musician-hero-portrait-fallback\">{selectedMusicianInitials}</div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"musician-hero-cta-stack\">\r\n              <span className=\"musician-hero-instrument-badge\">\r\n                <img\r\n                  src={selectedInstrumentIcon}\r\n                  alt=\"\"\r\n                  aria-hidden=\"true\"\r\n                  className=\"musician-instrument-mini\"\r\n                />\r\n                <span>{instrumentNameById[currentMusician.Instrumento] ?? 'Instrumento'}</span>\r\n              </span>\r\n              {customAction ? (\r\n                <button\r\n                  type=\"button\"\r\n                  className={`musician-hero-hire-btn${customAction.variant === 'remove' ? ' is-remove' : ' is-select'}`}\r\n                  disabled={customAction.disabled}\r\n                  data-click-sfx={customAction.variant === 'remove' ? 'cancel' : 'confirm'}\r\n                  onClick={customAction.onClick}\r\n                >\r\n                  <span>{customAction.label}</span>\r\n                </button>\r\n              ) : !isSelectedMusicianHired && canHireSelectedMusician ? (\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"musician-hero-hire-btn\"\r\n                  onClick={onHireSelected}\r\n                >\r\n                  <img src={iconMoneyWhite} alt=\"\" aria-hidden=\"true\" />\r\n                  <span>R$ {formatNumber(selectedMusicianPrice)}</span>\r\n                </button>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <div className={`musician-detail-body ${transitionClass}`}>\r\n            <div className=\"musician-detail-photo\" aria-hidden=\"true\">\r\n              {selectedMusicianFace ? (\r\n                <img src={selectedMusicianFace} alt=\"\" className=\"musician-detail-face\" />\r\n              ) : (\r\n                selectedMusicianInitials\r\n              )}\r\n            </div>\r\n            <div className=\"musician-detail-side\">\r\n              <header className=\"musician-detail-header\">\r\n                <strong>{currentMusician.Instrumentista}</strong>\r\n                <span>Músico disponível</span>\r\n              </header>\r\n              <div className=\"musician-detail-badges\">\r\n                <span className=\"musician-detail-instrument\">\r\n                  <img\r\n                    src={selectedInstrumentIcon}\r\n                    alt=\"\"\r\n                    aria-hidden=\"true\"\r\n                    className=\"musician-instrument-mini\"\r\n                  />\r\n                  <span>{instrumentNameById[currentMusician.Instrumento] ?? 'Instrumento'}</span>\r\n                </span>\r\n                <span className={`musician-rarity ${selectedMusicianRarityClass ?? 'bronze'}`}>\r\n                  {rarityLabel}\r\n                </span>\r\n                {isSelectedMusicianHired ? <span className=\"musician-status-badge\">Contratado</span> : null}\r\n                {!isSelectedMusicianHired ? (\r\n                  <span className={`musician-detail-availability${isSelectedMusicianLockedByCoins ? ' locked' : ' available'}`}>\r\n                    <img\r\n                      src={isSelectedMusicianLockedByCoins ? iconBloqueado : iconDisponivel}\r\n                      alt={isSelectedMusicianLockedByCoins ? 'Bloqueado' : 'Disponível'}\r\n                      className=\"musician-detail-availability-icon\"\r\n                    />\r\n                    <span>{isSelectedMusicianLockedByCoins ? 'Bloqueado' : 'Disponível'}</span>\r\n                  </span>\r\n                ) : null}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className={`musician-attr-grid ${transitionClass}`}>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFameWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Hype</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Hype)}</strong>\r\n            </span>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconFansWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Público</span>\r\n              </span>\r\n              <strong>+{formatNumber(currentMusician.Fans)}</strong>\r\n            </span>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconRhythmWhite} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Perf.</span>\r\n              </span>\r\n              <strong>{formatPerformancePercent(currentMusician.Apresentacao)}</strong>\r\n            </span>\r\n            <span className=\"musician-attr-stat\">\r\n              <span className=\"musician-attr-stat-head\">\r\n                <img src={iconCost} alt=\"\" aria-hidden=\"true\" />\r\n                <span>Cachê</span>\r\n              </span>\r\n              <strong>- R$ {formatNumber(currentMusician.Cache).replace(/,00$/, '')}</strong>\r\n            </span>\r\n          </div>\r\n        </>\r\n      )}\r\n      {customAction && displayMode !== 'hero-stage' ? (\r\n        <button\r\n          type=\"button\"\r\n          className={`musician-detail-hire-btn${customAction.variant === 'remove' ? ' is-remove' : ' is-select'}`}\r\n          disabled={customAction.disabled}\r\n          data-click-sfx={customAction.variant === 'remove' ? 'cancel' : 'confirm'}\r\n          onClick={customAction.onClick}\r\n        >\r\n          <span>{customAction.label}</span>\r\n        </button>\r\n      ) : !isSelectedMusicianHired && displayMode !== 'hero-stage' ? (\r\n        <button\r\n          type=\"button\"\r\n          className=\"musician-detail-hire-btn\"\r\n          disabled={!canHireSelectedMusician}\r\n          onClick={onHireSelected}\r\n        >\r\n          <img src={iconMoneyWhite} alt=\"\" aria-hidden=\"true\" />\r\n          <span>R$ {formatNumber(selectedMusicianPrice)}</span>\r\n        </button>\r\n      ) : null}\r\n    </article>\r\n  );\r\n};\r\n\r\nexport default MusicianDetailModal;\r\n","import React from 'react';\r\nimport './StageVenueCacheCard.css';\r\n\r\ntype StageVenueCacheCardProps = {\r\n  maxRevenue: number;\r\n  bandTotalCache: number;\r\n  iconGainWhite: string;\r\n  iconCostWhite: string;\r\n  className?: string;\r\n  showCenterGainBadge?: boolean;\r\n  hideSideValues?: boolean;\r\n};\r\n\r\nconst StageVenueCacheCard: React.FC<StageVenueCacheCardProps> = ({\r\n  maxRevenue,\r\n  bandTotalCache,\r\n  iconGainWhite,\r\n  iconCostWhite,\r\n  className,\r\n  showCenterGainBadge = false,\r\n  hideSideValues = false,\r\n}) => {\r\n  const revenueValue = Math.max(0, maxRevenue);\r\n  const cacheValue = Math.max(0, bandTotalCache);\r\n  const gainValue = Math.max(0, revenueValue - cacheValue);\r\n  const cacheRatio = revenueValue > 0 ? Math.min(1, cacheValue / revenueValue) : 0;\r\n  const gainRatio = revenueValue > 0 ? Math.max(0, 1 - cacheRatio) : 0;\r\n  const isCacheOverLimit = cacheValue > revenueValue;\r\n  const formatCurrency = (value: number) => `R$ ${value.toLocaleString('pt-BR')}`;\r\n\r\n  return (\r\n    <div className={`stage-venue-cache-card${isCacheOverLimit ? ' is-over-limit' : ''}${className ? ` ${className}` : ''}`} aria-label=\"Indicador de cachê e lucro\">\r\n      {showCenterGainBadge ? (\r\n        <div className=\"stage-venue-cache-center-gain\" aria-label=\"Valor de ganho da banda\">\r\n          {formatCurrency(gainValue)}\r\n        </div>\r\n      ) : null}\r\n\r\n      <div className=\"stage-venue-cache-barline\">\r\n        <img src={iconGainWhite} alt=\"Ganho\" className=\"stage-venue-cache-side-icon\" />\r\n        <div className=\"stage-venue-cache-track\" role=\"presentation\">\r\n          <span className=\"stage-venue-cache-fill gain\" style={{ width: `${gainRatio * 100}%` }} />\r\n          <span className=\"stage-venue-cache-fill cost\" style={{ width: `${cacheRatio * 100}%` }} />\r\n        </div>\r\n        <img src={iconCostWhite} alt=\"Cachê\" className=\"stage-venue-cache-side-icon\" />\r\n      </div>\r\n\r\n      {!hideSideValues ? (\r\n        <div className=\"stage-venue-cache-values\">\r\n          <strong className=\"gain\">{formatCurrency(gainValue)}</strong>\r\n          <strong className=\"cost\">{formatCurrency(cacheValue)}</strong>\r\n        </div>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageVenueCacheCard;\r\n","import React from 'react';\r\nimport type { Instrument } from '../../state/gameStore';\r\nimport BandInstrumentSelector from './BandInstrumentSelector';\r\nimport MusicianDetailModal from '../musicians/MusicianDetailModal';\r\nimport StageVenueCacheCard from '../stage/StageVenueCacheCard';\r\nimport './BandManagementScreen.css';\r\n\r\ntype BandMenuView = 'band' | 'specials' | 'analysis';\r\n\r\ntype BandInstrumentColumn = {\r\n  id: Instrument;\r\n  label: string;\r\n  icon: string;\r\n  emptyInstrumentIcon: string;\r\n  musicianId: number | null;\r\n  musicianName: string;\r\n  musicianFirstName: string;\r\n  musicianFace: string | null;\r\n  hasMusician: boolean;\r\n  rarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n};\r\n\r\ntype SelectorMusician = {\r\n  id: number;\r\n  name: string;\r\n  firstName: string;\r\n  face: string | null;\r\n  portrait: string | null;\r\n  rarityClass: 'bronze' | 'silver' | 'gold';\r\n  rarityLabel: string;\r\n  hype: number;\r\n  fans: number;\r\n  performance: number;\r\n  cache: number;\r\n};\r\n\r\ntype BandManagementScreenProps = {\r\n  isVisible: boolean;\r\n  isClosing: boolean;\r\n  backgroundBackstage: string;\r\n  iconFechar: string;\r\n  iconBloqueado: string;\r\n  iconDisponivel: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  iconGainWhite: string;\r\n  iconCostWhite: string;\r\n  bandHypeValue: number;\r\n  bandFansValue: number;\r\n  bandPerformanceValue: number;\r\n  bandCostValue: number;\r\n  venueContext?: { name: string; maxRevenue: number } | null;\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  formatCurrency: (value: number) => string;\r\n  bandMenuView: BandMenuView;\r\n  bandMenuOptions: Array<{ id: BandMenuView; label: string; icon: string }>;\r\n  onChangeBandMenuView: (view: BandMenuView) => void;\r\n  activeBandSelectorInstrument: Instrument | null;\r\n  bandInstrumentColumns: BandInstrumentColumn[];\r\n  selectorMusicians: SelectorMusician[];\r\n  selectedSelectorMusicianId: number | null;\r\n  instrumentLabels: Record<Instrument, string>;\r\n  iconMusicoVazio: string;\r\n  onOpenInstrument: (instrument: Instrument) => void;\r\n  onCloseSelector: () => void;\r\n  onSelectEmpty: (instrument: Instrument) => void;\r\n  onSelectMusician: (instrument: Instrument, musicianId: number) => void;\r\n  onCloseScreen: () => void;\r\n};\r\n\r\nconst BandManagementScreen: React.FC<BandManagementScreenProps> = ({\r\n  isVisible,\r\n  isClosing,\r\n  backgroundBackstage,\r\n  iconFechar,\r\n  iconBloqueado,\r\n  iconDisponivel,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  iconGainWhite,\r\n  iconCostWhite,\r\n  bandHypeValue,\r\n  bandFansValue,\r\n  bandPerformanceValue,\r\n  bandCostValue,\r\n  venueContext = null,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  formatCurrency,\r\n  bandMenuView,\r\n  bandMenuOptions,\r\n  onChangeBandMenuView,\r\n  activeBandSelectorInstrument,\r\n  bandInstrumentColumns,\r\n  selectorMusicians,\r\n  selectedSelectorMusicianId,\r\n  instrumentLabels,\r\n  iconMusicoVazio,\r\n  onOpenInstrument,\r\n  onCloseSelector,\r\n  onSelectEmpty,\r\n  onSelectMusician,\r\n  onCloseScreen,\r\n}) => {\r\n  const DETAIL_CLOSE_MS = 180;\r\n  const [selectedSelectorDetail, setSelectedSelectorDetail] = React.useState<SelectorMusician | null>(null);\r\n  const [isDetailClosing, setIsDetailClosing] = React.useState(false);\r\n  const detailCloseTimeoutRef = React.useRef<number | null>(null);\r\n\r\n  const isSelectorDetailOpen = Boolean(selectedSelectorDetail);\r\n\r\n  const instrumentIdByKey: Record<Instrument, number> = {\r\n    guitar: 1,\r\n    bass: 2,\r\n    drums: 3,\r\n    keys: 4,\r\n  };\r\n\r\n  const instrumentRoleByKey: Record<Instrument, string> = {\r\n    guitar: 'guitarrista',\r\n    bass: 'baixista',\r\n    drums: 'baterista',\r\n    keys: 'tecladista',\r\n  };\r\n\r\n  const instrumentNameById: Record<number, string> = {\r\n    1: instrumentLabels.guitar,\r\n    2: instrumentLabels.bass,\r\n    3: instrumentLabels.drums,\r\n    4: instrumentLabels.keys,\r\n  };\r\n\r\n  const activeBandColumn = activeBandSelectorInstrument\r\n    ? bandInstrumentColumns.find((column) => column.id === activeBandSelectorInstrument)\r\n    : null;\r\n\r\n  const activeInstrumentIcon = activeBandColumn?.icon ?? iconMusicoVazio;\r\n  const activeInstrumentRole = activeBandSelectorInstrument ? instrumentRoleByKey[activeBandSelectorInstrument] : 'músico';\r\n\r\n  React.useEffect(() => {\r\n    if (!activeBandSelectorInstrument || selectedSelectorDetail) {\r\n      return;\r\n    }\r\n\r\n    const currentMusicianId = activeBandColumn?.musicianId;\r\n    if (currentMusicianId === null || currentMusicianId === undefined) {\r\n      return;\r\n    }\r\n\r\n    const currentMusician = selectorMusicians.find((item) => item.id === currentMusicianId);\r\n    if (currentMusician) {\r\n      openSelectorDetail(currentMusician);\r\n    }\r\n  }, [activeBandSelectorInstrument, activeBandColumn, selectorMusicians, selectedSelectorDetail]);\r\n\r\n  const openSelectorDetail = (musician: SelectorMusician) => {\r\n    if (detailCloseTimeoutRef.current) {\r\n      window.clearTimeout(detailCloseTimeoutRef.current);\r\n      detailCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setIsDetailClosing(false);\r\n    setSelectedSelectorDetail(musician);\r\n  };\r\n\r\n  const closeSelectorDetail = () => {\r\n    if (!selectedSelectorDetail) {\r\n      return;\r\n    }\r\n\r\n    if (detailCloseTimeoutRef.current) {\r\n      window.clearTimeout(detailCloseTimeoutRef.current);\r\n      detailCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setIsDetailClosing(true);\r\n    detailCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setSelectedSelectorDetail(null);\r\n      setIsDetailClosing(false);\r\n      detailCloseTimeoutRef.current = null;\r\n    }, DETAIL_CLOSE_MS);\r\n  };\r\n\r\n  const closeSelectorAndDetail = (action: () => void) => {\r\n    if (detailCloseTimeoutRef.current) {\r\n      window.clearTimeout(detailCloseTimeoutRef.current);\r\n      detailCloseTimeoutRef.current = null;\r\n    }\r\n\r\n    setSelectedSelectorDetail(null);\r\n    setIsDetailClosing(false);\r\n    action();\r\n    onCloseSelector();\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (!activeBandSelectorInstrument) {\r\n      setSelectedSelectorDetail(null);\r\n      setIsDetailClosing(false);\r\n    }\r\n  }, [activeBandSelectorInstrument]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (detailCloseTimeoutRef.current) {\r\n        window.clearTimeout(detailCloseTimeoutRef.current);\r\n        detailCloseTimeoutRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  if (!isVisible) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`band-management-screen${isClosing ? ' closing' : ''}`}\r\n      style={{ backgroundImage: `url(${backgroundBackstage})` }}\r\n    >\r\n      <div className={`band-management-content${isSelectorDetailOpen ? ' detail-open' : ''}`}>\r\n        <div className=\"band-management-top-hero\">\r\n          <div className=\"musicians-contract-overlay\" />\r\n          <div className={`band-management-header${isSelectorDetailOpen ? ' hidden' : ''}`}>\r\n            <h2>Banda</h2>\r\n            <p>Gerencie os músicos da sua banda</p>\r\n            {!isSelectorDetailOpen ? (\r\n              <button\r\n                type=\"button\"\r\n                className=\"musicians-close-btn\"\r\n                onClick={onCloseScreen}\r\n                data-click-sfx=\"close\"\r\n                aria-label=\"Fechar tela da banda\"\r\n              >\r\n                <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n              </button>\r\n            ) : null}\r\n          </div>\r\n\r\n          {venueContext && !isSelectorDetailOpen ? (\r\n            <div className=\"band-management-venue-cache-wrap\">\r\n              <StageVenueCacheCard\r\n                maxRevenue={Math.max(0, venueContext.maxRevenue)}\r\n                bandTotalCache={bandCostValue}\r\n                iconGainWhite={iconGainWhite}\r\n                iconCostWhite={iconCostWhite}\r\n                className=\"band-management-venue-cache-card\"\r\n                showCenterGainBadge\r\n                hideSideValues\r\n              />\r\n            </div>\r\n          ) : null}\r\n\r\n          {activeBandSelectorInstrument && selectedSelectorDetail ? (\r\n            <MusicianDetailModal\r\n              musician={{\r\n                ID: selectedSelectorDetail.id,\r\n                Instrumentista: selectedSelectorDetail.name,\r\n                Instrumento: instrumentIdByKey[activeBandSelectorInstrument],\r\n                Asset_Face: '',\r\n                Asset: '',\r\n                Hype: selectedSelectorDetail.hype,\r\n                Fans: selectedSelectorDetail.fans,\r\n                Apresentacao: selectedSelectorDetail.performance,\r\n                Sexo: '',\r\n                Custo: 0,\r\n                Cache: selectedSelectorDetail.cache,\r\n                Nivel: selectedSelectorDetail.rarityClass === 'gold' ? 3 : selectedSelectorDetail.rarityClass === 'silver' ? 2 : 1,\r\n                ID_Instrumento: instrumentIdByKey[activeBandSelectorInstrument],\r\n                Contratado: selectedSelectorMusicianId === selectedSelectorDetail.id,\r\n                Historia: '',\r\n              }}\r\n              selectedMusicianFace={selectedSelectorDetail.face}\r\n              selectedMusicianPortrait={selectedSelectorDetail.portrait}\r\n              selectedMusicianInitials={selectedSelectorDetail.firstName.slice(0, 2).toUpperCase()}\r\n              selectedMusicianRarityClass={selectedSelectorDetail.rarityClass}\r\n              selectedInstrumentIcon={activeInstrumentIcon}\r\n              isClosing={isDetailClosing}\r\n              isStoryOpen={false}\r\n              isSelectedMusicianHired={selectedSelectorMusicianId === selectedSelectorDetail.id}\r\n              isSelectedMusicianLockedByCoins={false}\r\n              canHireSelectedMusician={true}\r\n              selectedMusicianPrice={0}\r\n              iconFechar={iconFechar}\r\n              iconBloqueado={iconBloqueado}\r\n              iconDisponivel={iconDisponivel}\r\n              iconMoneyWhite={iconMoneyWhite}\r\n              iconFameWhite={iconFameWhite}\r\n              iconFansWhite={iconFansWhite}\r\n              iconRhythmWhite={iconRhythmWhite}\r\n              iconCost={iconCost}\r\n              formatNumber={formatNumber}\r\n              formatPerformancePercent={formatPerformancePercent}\r\n              instrumentNameById={instrumentNameById}\r\n              hideCloseButton\r\n              displayMode=\"hero-stage\"\r\n              showStoryToggle={false}\r\n              customAction={selectedSelectorMusicianId === selectedSelectorDetail.id\r\n                ? {\r\n                  label: `Remover ${activeInstrumentRole}`,\r\n                  variant: 'remove',\r\n                  onClick: () => closeSelectorAndDetail(() => onSelectEmpty(activeBandSelectorInstrument)),\r\n                }\r\n                : {\r\n                  label: `Selecionar ${activeInstrumentRole}`,\r\n                  variant: 'select',\r\n                  onClick: () => closeSelectorAndDetail(() => onSelectMusician(activeBandSelectorInstrument, selectedSelectorDetail.id)),\r\n                }}\r\n              onCloseDetails={closeSelectorDetail}\r\n              onToggleStory={() => undefined}\r\n              onHireSelected={() => undefined}\r\n            />\r\n          ) : null}\r\n        </div>\r\n\r\n        <div className={`band-management-bottom-panel${isSelectorDetailOpen ? ' detail-open' : ''}`}>\r\n          <div className=\"band-management-placeholder\">\r\n            <div className=\"band-menu-nav\">\r\n              {bandMenuOptions.map((option) => (\r\n                <button\r\n                  key={option.id}\r\n                  type=\"button\"\r\n                  className={`band-menu-tab${bandMenuView === option.id ? ' active' : ''}`}\r\n                  onClick={() => onChangeBandMenuView(option.id)}\r\n                >\r\n                  <img src={option.icon} alt={option.label} />\r\n                  <span>{option.label}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n\r\n            {bandMenuView === 'band' ? (\r\n              <>\r\n                <div className=\"band-gains-row\">\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconFameWhite} alt=\"Hype\" />\r\n                    <span>Hype</span>\r\n                    <strong>+{formatNumber(bandHypeValue)}</strong>\r\n                  </span>\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconFansWhite} alt=\"Público\" />\r\n                    <span>Fãs</span>\r\n                    <strong>+{formatNumber(bandFansValue)}</strong>\r\n                  </span>\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconRhythmWhite} alt=\"Performance\" />\r\n                    <span>Perfor.</span>\r\n                    <strong>{formatPerformancePercent(bandPerformanceValue)}</strong>\r\n                  </span>\r\n                  <span className=\"band-gain-item\">\r\n                    <img src={iconCost} alt=\"Cachê\" />\r\n                    <span>Cachê</span>\r\n                    <strong>-{formatCurrency(bandCostValue)}</strong>\r\n                  </span>\r\n                </div>\r\n\r\n                <BandInstrumentSelector\r\n                  bandInstrumentColumns={bandInstrumentColumns}\r\n                  activeInstrument={activeBandSelectorInstrument}\r\n                  isDetailOpen={isSelectorDetailOpen}\r\n                  selectorMusicians={selectorMusicians}\r\n                  selectedMusicianId={selectedSelectorMusicianId}\r\n                  instrumentLabels={instrumentLabels}\r\n                  iconFechar={iconFechar}\r\n                  iconMusicoVazio={iconMusicoVazio}\r\n                  onOpenInstrument={onOpenInstrument}\r\n                  onCloseSelector={onCloseSelector}\r\n                  onSelectEmpty={onSelectEmpty}\r\n                  onOpenMusicianDetail={openSelectorDetail}\r\n                />\r\n              </>\r\n            ) : (\r\n              <div className=\"band-menu-empty-view\">\r\n                <strong>{bandMenuView === 'specials' ? 'Especiais' : 'Análise'}</strong>\r\n                <span>Conteúdo desta seção será adicionado nas próximas etapas.</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BandManagementScreen;\r\n","import React from 'react';\r\nimport MusicianDetailModal from './MusicianDetailModal';\r\nimport type { Instrument } from '../../state/gameStore';\r\nimport './MusiciansContractScreen.css';\r\n\r\ntype HireFilter = 'all' | Instrument;\r\n\r\ntype MusicianData = {\r\n  ID: number;\r\n  Instrumentista: string;\r\n  Instrumento: number;\r\n  Asset_Face: string;\r\n  Asset_Portrait?: string;\r\n  Asset: string;\r\n  Asset_Char?: string;\r\n  Hype: number;\r\n  Fans: number;\r\n  Apresentacao: number;\r\n  Sexo: string;\r\n  Custo: number;\r\n  Cache: number;\r\n  Nivel: number;\r\n  ID_Instrumento: number;\r\n  Contratado: boolean;\r\n  Historia: string;\r\n};\r\n\r\ntype MusicianListItem = {\r\n  musician: MusicianData;\r\n  rarityClass: 'bronze' | 'silver' | 'gold';\r\n  rarityLabel: string;\r\n  instrumentIcon: string;\r\n  isMusicianHired: boolean;\r\n  isLockedByCoins: boolean;\r\n  musicianFaceSrc: string | null;\r\n  initials: string;\r\n};\r\n\r\ntype FilterOption = {\r\n  id: HireFilter;\r\n  label: string;\r\n  icon: string;\r\n};\r\n\r\ntype MusiciansContractScreenProps = {\r\n  isVisible: boolean;\r\n  isClosing: boolean;\r\n  backgroundAudicao: string;\r\n  portraitContratante: string;\r\n  iconFechar: string;\r\n  iconBloqueado: string;\r\n  iconDisponivel: string;\r\n  selectedInstrumentIcon: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  selectedMusicianDetails: MusicianData | null;\r\n  selectedMusicianFace: string | null;\r\n  selectedMusicianPortrait: string | null;\r\n  selectedMusicianInitials: string;\r\n  selectedMusicianRarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n  isClosingMusicianDetails: boolean;\r\n  isMusicianStoryOpen: boolean;\r\n  isSelectedMusicianHired: boolean;\r\n  isSelectedMusicianLockedByCoins: boolean;\r\n  canHireSelectedMusician: boolean;\r\n  selectedMusicianPrice: number;\r\n  hireFilter: HireFilter;\r\n  filterOptions: FilterOption[];\r\n  listedMusicianItems: MusicianListItem[];\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  instrumentNameById: Record<number, string>;\r\n  onCloseScreen: () => void;\r\n  onCloseDetails: () => void;\r\n  onToggleStory: () => void;\r\n  onChangeFilter: (filter: HireFilter) => void;\r\n  onOpenMusicianDetails: (musician: MusicianData) => void;\r\n  onHireSelected: () => void;\r\n};\r\n\r\nconst MusiciansContractScreen: React.FC<MusiciansContractScreenProps> = ({\r\n  isVisible,\r\n  isClosing,\r\n  backgroundAudicao,\r\n  portraitContratante,\r\n  iconFechar,\r\n  iconBloqueado,\r\n  iconDisponivel,\r\n  selectedInstrumentIcon,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  selectedMusicianDetails,\r\n  selectedMusicianFace,\r\n  selectedMusicianPortrait,\r\n  selectedMusicianInitials,\r\n  selectedMusicianRarityClass,\r\n  isClosingMusicianDetails,\r\n  isMusicianStoryOpen,\r\n  isSelectedMusicianHired,\r\n  isSelectedMusicianLockedByCoins,\r\n  canHireSelectedMusician,\r\n  selectedMusicianPrice,\r\n  hireFilter,\r\n  filterOptions,\r\n  listedMusicianItems,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  instrumentNameById,\r\n  onCloseScreen,\r\n  onCloseDetails,\r\n  onToggleStory,\r\n  onChangeFilter,\r\n  onOpenMusicianDetails,\r\n  onHireSelected,\r\n}) => {\r\n  const [collapsedGroups, setCollapsedGroups] = React.useState({\r\n    hired: false,\r\n    available: false,\r\n  });\r\n  const prevHireMapRef = React.useRef<Map<number, boolean>>(new Map());\r\n  const [recentlyHiredId, setRecentlyHiredId] = React.useState<number | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    let detectedHiredId: number | null = null;\r\n    const nextMap = new Map<number, boolean>();\r\n\r\n    listedMusicianItems.forEach((item) => {\r\n      const id = item.musician.ID;\r\n      const wasHired = prevHireMapRef.current.get(id);\r\n      if (wasHired === false && item.isMusicianHired) {\r\n        detectedHiredId = id;\r\n      }\r\n      nextMap.set(id, item.isMusicianHired);\r\n    });\r\n\r\n    prevHireMapRef.current = nextMap;\r\n\r\n    if (detectedHiredId !== null) {\r\n      setRecentlyHiredId(detectedHiredId);\r\n      window.setTimeout(() => {\r\n        setRecentlyHiredId((current) => (current === detectedHiredId ? null : current));\r\n      }, 650);\r\n    }\r\n  }, [listedMusicianItems]);\r\n\r\n  if (!isVisible) {\r\n    return null;\r\n  }\r\n\r\n  const rarityRank = {\r\n    bronze: 0,\r\n    silver: 1,\r\n    gold: 2,\r\n  } as const;\r\n\r\n  const hiredMusicianItems = listedMusicianItems\r\n    .filter((item) => item.isMusicianHired)\r\n    .sort((a, b) => {\r\n      const rarityDiff = rarityRank[a.rarityClass] - rarityRank[b.rarityClass];\r\n      if (rarityDiff !== 0) {\r\n        return rarityDiff;\r\n      }\r\n      // Keep purchase order: older first (stable by original order)\r\n      return listedMusicianItems.indexOf(a) - listedMusicianItems.indexOf(b);\r\n    });\r\n  const availableMusicianItems = listedMusicianItems.filter((item) => !item.isMusicianHired);\r\n\r\n  const toggleGroup = (group: 'hired' | 'available') => {\r\n    setCollapsedGroups((prev) => ({\r\n      ...prev,\r\n      [group]: !prev[group],\r\n    }));\r\n  };\r\n\r\n  const renderMusicianCard = (item: MusicianListItem) => (\r\n    <article\r\n      key={item.musician.ID}\r\n      className={`musician-contract-card rarity-${item.rarityClass}${item.isMusicianHired ? ' is-hired' : ' is-available'}${!item.isMusicianHired ? (item.isLockedByCoins ? ' is-locked-by-coins' : ' is-available-to-buy') : ''}${recentlyHiredId === item.musician.ID ? ' just-hired' : ''}`}\r\n      data-click-sfx=\"open\"\r\n      onClick={() => onOpenMusicianDetails(item.musician)}\r\n    >\r\n      <div className=\"musician-card-top\">\r\n        <div className=\"musician-avatar-column\">\r\n          {item.musicianFaceSrc ? (\r\n            <img src={item.musicianFaceSrc} alt=\"\" className=\"musician-avatar-face\" />\r\n          ) : (\r\n            <div className=\"musician-avatar-fallback\" aria-hidden=\"true\">\r\n              {item.initials}\r\n            </div>\r\n          )}\r\n          {!item.isMusicianHired ? (\r\n            <img\r\n              src={item.isLockedByCoins ? iconBloqueado : iconDisponivel}\r\n              alt={item.isLockedByCoins ? 'Bloqueado' : 'Disponível'}\r\n              className={`musician-card-status-icon ${item.isLockedByCoins ? 'locked' : 'available'}`}\r\n            />\r\n          ) : null}\r\n        </div>\r\n        <div className=\"musician-main-meta\">\r\n          <strong>{item.musician.Instrumentista}</strong>\r\n          <div className=\"musician-meta-badges\">\r\n            <span className=\"musician-card-instrument-badge\">\r\n              <img src={item.instrumentIcon} alt=\"\" aria-hidden=\"true\" className=\"musician-instrument-mini\" />\r\n              <span>{instrumentNameById[item.musician.Instrumento] ?? 'Instrumento'}</span>\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </article>\r\n  );\r\n\r\n  return (\r\n    <div className={`musicians-contract-screen${isClosing ? ' closing' : ''}`} style={{ backgroundImage: `url(${backgroundAudicao})` }}>\r\n      <div className=\"musicians-contract-content\">\r\n        <div className=\"musicians-top-hero\">\r\n          <div className=\"musicians-contract-overlay\" />\r\n          <div className={`musicians-contract-header${selectedMusicianDetails ? ' hidden' : ''}`}>\r\n            <h2>Músicos</h2>\r\n            <p>Contrate novos talentos para sua banda</p>\r\n            {!selectedMusicianDetails ? (\r\n              <button\r\n                type=\"button\"\r\n                className=\"musicians-close-btn\"\r\n                onClick={onCloseScreen}\r\n                data-click-sfx=\"close\"\r\n                aria-label=\"Fechar tela de músicos\"\r\n              >\r\n                <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"musicians-close-icon\" />\r\n              </button>\r\n            ) : null}\r\n          </div>\r\n\r\n          <MusicianDetailModal\r\n            musician={selectedMusicianDetails}\r\n            selectedMusicianFace={selectedMusicianFace}\r\n            selectedMusicianPortrait={selectedMusicianPortrait}\r\n            selectedMusicianInitials={selectedMusicianInitials}\r\n            selectedMusicianRarityClass={selectedMusicianRarityClass}\r\n            selectedInstrumentIcon={selectedInstrumentIcon}\r\n            isClosing={isClosingMusicianDetails}\r\n            isStoryOpen={isMusicianStoryOpen}\r\n            isSelectedMusicianHired={isSelectedMusicianHired}\r\n            isSelectedMusicianLockedByCoins={isSelectedMusicianLockedByCoins}\r\n            canHireSelectedMusician={canHireSelectedMusician}\r\n            selectedMusicianPrice={selectedMusicianPrice}\r\n            iconFechar={iconFechar}\r\n            iconBloqueado={iconBloqueado}\r\n            iconDisponivel={iconDisponivel}\r\n            iconMoneyWhite={iconMoneyWhite}\r\n            iconFameWhite={iconFameWhite}\r\n            iconFansWhite={iconFansWhite}\r\n            iconRhythmWhite={iconRhythmWhite}\r\n            iconCost={iconCost}\r\n            formatNumber={formatNumber}\r\n            formatPerformancePercent={formatPerformancePercent}\r\n            instrumentNameById={instrumentNameById}\r\n            displayMode=\"hero-stage\"\r\n            onCloseDetails={onCloseDetails}\r\n            onToggleStory={onToggleStory}\r\n            onHireSelected={onHireSelected}\r\n          />\r\n\r\n          <div className=\"musicians-hero-slot\">\r\n            <img\r\n              src={portraitContratante}\r\n              alt=\"Contratante\"\r\n              className={`musicians-contractor-portrait${selectedMusicianDetails && !isClosingMusicianDetails ? ' hide' : ' show'}`}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"musicians-bottom-panel\">\r\n          <div className=\"musicians-filter-row\">\r\n            {filterOptions.map((option) => (\r\n              <button\r\n                key={option.id}\r\n                type=\"button\"\r\n                className={`musicians-filter-btn${hireFilter === option.id ? ' active' : ''}`}\r\n                onClick={() => onChangeFilter(option.id)}\r\n              >\r\n                <img src={option.icon} alt={option.label} />\r\n                <span>{option.label}</span>\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"musicians-list-groups\">\r\n            {hiredMusicianItems.length > 0 ? (\r\n              <section className=\"musicians-list-group\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"musicians-group-toggle\"\r\n                  onClick={() => toggleGroup('hired')}\r\n                  aria-expanded={!collapsedGroups.hired}\r\n                >\r\n                  <span className=\"musicians-group-title-wrap\">\r\n                    <h3>Contratados</h3>\r\n                    <span className=\"musicians-group-count\">{hiredMusicianItems.length}</span>\r\n                  </span>\r\n                  <span className=\"musicians-group-arrow\" aria-hidden=\"true\">\r\n                    {collapsedGroups.hired ? '▸' : '▾'}\r\n                  </span>\r\n                </button>\r\n                {!collapsedGroups.hired ? <div className=\"musicians-list-grid\">{hiredMusicianItems.map(renderMusicianCard)}</div> : null}\r\n              </section>\r\n            ) : null}\r\n\r\n            {availableMusicianItems.length > 0 ? (\r\n              <section className=\"musicians-list-group\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"musicians-group-toggle\"\r\n                  onClick={() => toggleGroup('available')}\r\n                  aria-expanded={!collapsedGroups.available}\r\n                >\r\n                  <span className=\"musicians-group-title-wrap\">\r\n                    <h3>A contratar</h3>\r\n                    <span className=\"musicians-group-count\">{availableMusicianItems.length}</span>\r\n                  </span>\r\n                  <span className=\"musicians-group-arrow\" aria-hidden=\"true\">\r\n                    {collapsedGroups.available ? '▸' : '▾'}\r\n                  </span>\r\n                </button>\r\n                {!collapsedGroups.available ? (\r\n                  <div className=\"musicians-list-grid\">{availableMusicianItems.map(renderMusicianCard)}</div>\r\n                ) : null}\r\n              </section>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MusiciansContractScreen;\r\n","import React from 'react';\r\nimport './StageTopValuesBar.css';\r\n\r\ntype StageTopValuesBarProps = {\r\n  configIcon: string;\r\n  availableBandCoins: number;\r\n  fans: number;\r\n  fameStars: number;\r\n  iconMoneyBlack: string;\r\n  iconFansBlack: string;\r\n  iconFameBlack: string;\r\n  onOpenBandConfig: () => void;\r\n  formatCurrency: (value: number) => string;\r\n  formatNumber: (value: number) => string;\r\n  famePulseTick: number;\r\n  topMoneyRef: React.RefObject<HTMLDivElement | null>;\r\n  topFansRef: React.RefObject<HTMLDivElement | null>;\r\n  topFameRef: React.RefObject<HTMLDivElement | null>;\r\n  className?: string;\r\n  isConfigOpen?: boolean;\r\n};\r\n\r\nconst StageTopValuesBar: React.FC<StageTopValuesBarProps> = ({\r\n  configIcon,\r\n  availableBandCoins,\r\n  fans,\r\n  fameStars,\r\n  iconMoneyBlack,\r\n  iconFansBlack,\r\n  iconFameBlack,\r\n  onOpenBandConfig,\r\n  formatCurrency,\r\n  formatNumber,\r\n  famePulseTick,\r\n  topMoneyRef,\r\n  topFansRef,\r\n  topFameRef,\r\n  className = '',\r\n  isConfigOpen = false,\r\n}) => {\r\n  return (\r\n    <div className={`stage-top-values${className ? ` ${className}` : ''}`}>\r\n      <button\r\n        type=\"button\"\r\n        className={`band-config-trigger${isConfigOpen ? ' is-open' : ''}`}\r\n        onClick={onOpenBandConfig}\r\n        aria-label=\"Abrir configurações da banda\"\r\n      >\r\n        <img src={configIcon} alt=\"Configurações\" className=\"band-config-trigger-logo\" />\r\n      </button>\r\n      <div className=\"top-pill top-pill-money\" ref={topMoneyRef}>\r\n        <img src={iconMoneyBlack} alt=\"Dinheiro\" className=\"top-pill-icon\" />\r\n        <strong className=\"top-pill-value\">{formatCurrency(availableBandCoins)}</strong>\r\n      </div>\r\n      <div className=\"top-pill top-pill-fans\" ref={topFansRef}>\r\n        <img src={iconFansBlack} alt=\"Fãs\" className=\"top-pill-icon\" />\r\n        <strong className=\"top-pill-value\">{formatNumber(fans)}</strong>\r\n      </div>\r\n      <div className=\"top-pill top-pill-fame\" ref={topFameRef}>\r\n        <img src={iconFameBlack} alt=\"Fama\" className=\"top-pill-icon\" />\r\n        <strong key={famePulseTick} className=\"top-pill-value fame-pop\">{formatNumber(fameStars)}</strong>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageTopValuesBar;\r\n","import React from 'react';\r\nimport './StageBottomNav.css';\r\n\r\ntype StageBottomNavProps = {\r\n  variant?: 'bottom' | 'side';\r\n  isHiding?: boolean;\r\n  isBandManagementScreenVisible: boolean;\r\n  availableToHireCount: number;\r\n  className?: string;\r\n  navBand: string;\r\n  navHire: string;\r\n  navStore: string;\r\n  navStage: string;\r\n  navSongs: string;\r\n  onOpenBandManagementScreen: () => void;\r\n  onOpenMusiciansScreen: () => void;\r\n  onCycleStage: () => void;\r\n};\r\n\r\nconst StageBottomNav: React.FC<StageBottomNavProps> = ({\r\n  variant = 'bottom',\r\n  isHiding = false,\r\n  isBandManagementScreenVisible,\r\n  availableToHireCount,\r\n  className = '',\r\n  navBand,\r\n  navHire,\r\n  navStore,\r\n  navStage,\r\n  navSongs,\r\n  onOpenBandManagementScreen,\r\n  onOpenMusiciansScreen,\r\n  onCycleStage,\r\n}) => {\r\n  const resolvedClassName = !isHiding && className ? ` ${className}` : '';\r\n\r\n  return (\r\n    <div className={`game-bottom-nav${variant === 'side' ? ' game-side-nav' : ''}${isHiding ? ' is-hiding' : ''}${resolvedClassName}`}>\r\n      {variant !== 'side' ? (\r\n        <button\r\n          type=\"button\"\r\n          className={`bottom-item${isBandManagementScreenVisible ? ' active' : ''}`}\r\n          onClick={onOpenBandManagementScreen}\r\n        >\r\n          <img src={navBand} alt=\"Banda\" className=\"bottom-item-icon\" />\r\n          <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Banda</span>\r\n        </button>\r\n      ) : null}\r\n      <button type=\"button\" className={`bottom-item${availableToHireCount > 0 ? ' has-badge' : ''}`} onClick={onOpenMusiciansScreen}>\r\n        {availableToHireCount > 0 ? (\r\n          <span className=\"bottom-item-badge bottom-item-badge-green\">{availableToHireCount > 99 ? '99+' : availableToHireCount}</span>\r\n        ) : null}\r\n        <img src={navHire} alt=\"Músicos\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Músicos</span>\r\n      </button>\r\n      <button type=\"button\" className=\"bottom-item\">\r\n        <img src={navStore} alt=\"Loja\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Loja</span>\r\n      </button>\r\n      <button type=\"button\" className=\"bottom-item\" onClick={onCycleStage}>\r\n        <img src={navStage} alt=\"Palco\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Palco</span>\r\n      </button>\r\n      <button type=\"button\" className=\"bottom-item\">\r\n        <img src={navSongs} alt=\"Músicas\" className=\"bottom-item-icon\" />\r\n        <span className={variant === 'side' ? 'bottom-item-label-side' : ''}>Músicas</span>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageBottomNav;\r\n","import React from 'react';\r\nimport './StageProgressList.css';\r\n\r\ntype StageProgressListProps = {\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  famePct: number;\r\n  fameValue: number;\r\n  fameTarget: number;\r\n  lotacaoPct: number;\r\n  lotacaoValue: number;\r\n  lotacaoTarget: number;\r\n  formatNumber: (value: number) => string;\r\n  fameTrackRef: React.RefObject<HTMLDivElement | null>;\r\n  crowdTrackRef: React.RefObject<HTMLDivElement | null>;\r\n};\r\n\r\nconst StageProgressList: React.FC<StageProgressListProps> = ({\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  famePct,\r\n  fameValue,\r\n  fameTarget,\r\n  lotacaoPct,\r\n  lotacaoValue,\r\n  lotacaoTarget,\r\n  formatNumber,\r\n  fameTrackRef,\r\n  crowdTrackRef,\r\n}) => {\r\n  return (\r\n    <div className=\"stage-progress-list\">\r\n      <div className=\"stage-progress-item fame-track\" ref={fameTrackRef}>\r\n        <img src={iconFameWhite} alt=\"Fama\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${famePct}%` }} />\r\n          <div className=\"progress-text\">\r\n            <span>Fama</span>\r\n            <strong>{formatNumber(fameValue)} / {formatNumber(fameTarget)}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"stage-progress-item crowd-track\" ref={crowdTrackRef}>\r\n        <img src={iconFansWhite} alt=\"Fãs\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${lotacaoPct}%` }} />\r\n          <div className=\"progress-text\">\r\n            <span>Público / Lotação</span>\r\n            <strong>{formatNumber(lotacaoValue)} / {formatNumber(lotacaoTarget)}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageProgressList;\r\n","import React from 'react';\r\nimport './StageCenterPanel.css';\r\n\r\ntype StageCenterPanelProps = {\r\n  iconFameWhite: string;\r\n  iconFansWhite: string;\r\n  iconRhythmWhite: string;\r\n  iconCost: string;\r\n  iconIngresso: string;\r\n  iconValorCacheTotal: string;\r\n  iconCache: string;\r\n  bandHypeValue: number;\r\n  bandFansValue: number;\r\n  bandPerformanceValue: number;\r\n  selectedStageName: string;\r\n  onExitShow: () => void;\r\n  venueBadgeIcon: string;\r\n  stageTicketPrice: number;\r\n  lotacaoTotalValue: number;\r\n  costSharePct: number;\r\n  gainSharePct: number;\r\n  gainValue: number;\r\n  metronomeTick: boolean;\r\n  beatHitFeedback: boolean;\r\n  isMusicPlaying: boolean;\r\n  metronomeBeatMs: number;\r\n  rhythmBonus: number;\r\n  bonusFlash: boolean;\r\n  rhythmMeter: number;\r\n  musicStartThreshold: number;\r\n  rhythmTone: string;\r\n  bandCostValue: number;\r\n  formatNumber: (value: number) => string;\r\n  formatPerformancePercent: (value: number) => string;\r\n  formatCurrency: (value: number) => string;\r\n  gainMeterRef: React.RefObject<HTMLDivElement | null>;\r\n  wrapperRef?: React.RefObject<HTMLDivElement | null>;\r\n};\r\n\r\nconst StageCenterPanel: React.FC<StageCenterPanelProps> = ({\r\n  iconFameWhite,\r\n  iconFansWhite,\r\n  iconRhythmWhite,\r\n  iconCost,\r\n  iconIngresso,\r\n  iconValorCacheTotal,\r\n  iconCache,\r\n  bandHypeValue,\r\n  bandFansValue,\r\n  bandPerformanceValue,\r\n  selectedStageName,\r\n  onExitShow,\r\n  venueBadgeIcon,\r\n  stageTicketPrice,\r\n  lotacaoTotalValue,\r\n  costSharePct,\r\n  gainSharePct,\r\n  gainValue,\r\n  metronomeTick,\r\n  beatHitFeedback,\r\n  isMusicPlaying,\r\n  metronomeBeatMs,\r\n  rhythmBonus,\r\n  bonusFlash,\r\n  rhythmMeter,\r\n  musicStartThreshold,\r\n  rhythmTone,\r\n  bandCostValue,\r\n  formatNumber,\r\n  formatPerformancePercent,\r\n  formatCurrency,\r\n  gainMeterRef,\r\n  wrapperRef,\r\n}) => {\r\n  const POPOVER_CLOSE_MS = 180;\r\n  const popoverCloseTimeoutRef = React.useRef<number | null>(null);\r\n  const [shouldRenderVenuePopover, setShouldRenderVenuePopover] = React.useState(false);\r\n  const [isVenuePopoverClosing, setIsVenuePopoverClosing] = React.useState(false);\r\n  const isVenuePopoverOpen = shouldRenderVenuePopover && !isVenuePopoverClosing;\r\n\r\n  const handleVenueBadgeToggle = () => {\r\n    if (shouldRenderVenuePopover && !isVenuePopoverClosing) {\r\n      setIsVenuePopoverClosing(true);\r\n      if (popoverCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(popoverCloseTimeoutRef.current);\r\n      }\r\n      popoverCloseTimeoutRef.current = window.setTimeout(() => {\r\n        setShouldRenderVenuePopover(false);\r\n        setIsVenuePopoverClosing(false);\r\n        popoverCloseTimeoutRef.current = null;\r\n      }, POPOVER_CLOSE_MS);\r\n      return;\r\n    }\r\n\r\n    if (popoverCloseTimeoutRef.current !== null) {\r\n      window.clearTimeout(popoverCloseTimeoutRef.current);\r\n      popoverCloseTimeoutRef.current = null;\r\n    }\r\n    setShouldRenderVenuePopover(true);\r\n    setIsVenuePopoverClosing(false);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (popoverCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(popoverCloseTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"stage-center-panel\" ref={wrapperRef}>\r\n      <div className=\"venue-side-entry\">\r\n        <button type=\"button\" className=\"venue-badge-btn\" onClick={handleVenueBadgeToggle} aria-expanded={isVenuePopoverOpen} aria-label=\"Ver dados do local\">\r\n          <img src={venueBadgeIcon} alt=\"Badge do local\" className=\"venue-badge-icon\" />\r\n        </button>\r\n\r\n        {shouldRenderVenuePopover ? (\r\n          <div className={`venue-side-popover${isVenuePopoverClosing ? ' is-closing' : ''}`} role=\"status\" aria-live=\"polite\">\r\n            <h3>{selectedStageName}</h3>\r\n            <div className=\"venue-meta\">\r\n              <span><img src={iconIngresso} alt=\"Ingresso\" className=\"venue-meta-icon\" /> {formatCurrency(stageTicketPrice)}</span>\r\n              <span><img src={iconValorCacheTotal} alt=\"Valor total da lotação\" className=\"venue-meta-icon\" /> {formatCurrency(lotacaoTotalValue)}</span>\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n\r\n      <button type=\"button\" className=\"venue-exit-btn\" onClick={onExitShow} data-click-sfx=\"close\">\r\n        Voltar ao mapa\r\n      </button>\r\n\r\n      <div className=\"mini-kpis\">\r\n        <div className=\"kpi-box\">\r\n          <img src={iconFameWhite} alt=\"Fama\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Hype</span>\r\n            <strong>+{formatNumber(bandHypeValue)}</strong>\r\n          </div>\r\n        </div>\r\n        <div className=\"kpi-box\">\r\n          <img src={iconFansWhite} alt=\"Fãs\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Fãs</span>\r\n            <strong>+{formatNumber(bandFansValue)}</strong>\r\n          </div>\r\n        </div>\r\n        <div className=\"kpi-box\">\r\n          <img src={iconRhythmWhite} alt=\"Performance\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Perfor.</span>\r\n            <strong>{formatPerformancePercent(bandPerformanceValue)}</strong>\r\n          </div>\r\n        </div>\r\n        <div className=\"kpi-box kpi-box-cache\">\r\n          <img src={iconCost} alt=\"Cachê\" className=\"kpi-main-icon\" />\r\n          <div className=\"kpi-texts\">\r\n            <span className=\"kpi-name\">Cachê</span>\r\n            <strong>{formatCurrency(bandCostValue)}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"cost-gain-meter\" aria-label=\"Barra lateral de custo versus ganho\" ref={gainMeterRef}>\r\n        <img src={iconCost} alt=\"Custo\" className=\"cost-gain-icon\" />\r\n        <div className=\"cost-gain-core\">\r\n          <div className=\"cost-gain-track\">\r\n            <span className=\"cost-gain-fill-cost\" style={{ height: `${costSharePct}%` }} />\r\n            <span className=\"cost-gain-fill-gain\" style={{ height: `${gainSharePct}%` }} />\r\n          </div>\r\n          <div className=\"cost-gain-value\" style={{ top: `${costSharePct}%` }}>{formatCurrency(gainValue)}</div>\r\n        </div>\r\n        <img src={iconCache} alt=\"Ganho\" className=\"cost-gain-icon\" />\r\n      </div>\r\n\r\n      <div className=\"rhythm-side-meter\" aria-label=\"Barra lateral de ritmo\">\r\n        <div className={`rhythm-metronome${metronomeTick ? ' tick' : ''}${beatHitFeedback ? ' hit' : ''}`}>\r\n          <span className={`rhythm-metronome-arm${isMusicPlaying ? ' active' : ''}`} style={{ animationDuration: `${metronomeBeatMs}ms` }} />\r\n        </div>\r\n        <div className={`beat-hit-badge${beatHitFeedback ? ' show' : ''}`}>ACERTOU!</div>\r\n        <div className={`rhythm-bonus-tag${rhythmBonus > 1 ? ' active' : ''}${bonusFlash ? ' flash' : ''}`}>\r\n          {rhythmBonus > 1 ? `Bônus x${rhythmBonus.toFixed(1)}` : 'Sem bônus'}\r\n        </div>\r\n        <div className=\"rhythm-side-track\">\r\n          <span className=\"rhythm-start-marker\" style={{ bottom: `${musicStartThreshold}%` }} />\r\n          <span className=\"rhythm-side-fill\" style={{ height: `${rhythmMeter}%`, background: rhythmTone }} />\r\n        </div>\r\n        <img src={iconRhythmWhite} alt=\"Ritmo\" className=\"rhythm-side-icon\" />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageCenterPanel;\r\n","import React from 'react';\r\nimport './StageCurrentSongBar.css';\r\n\r\ntype StageCurrentSongBarProps = {\r\n  iconFansWhite: string;\r\n  iconMusicWhite: string;\r\n  fansGainBarPct: number;\r\n  fansGainRate: number;\r\n  fansStepFlash: boolean;\r\n  songProgressPct: number;\r\n  currentSongName: string;\r\n  wrapperRef?: React.RefObject<HTMLDivElement | null>;\r\n  fansTrackRef?: React.RefObject<HTMLDivElement | null>;\r\n};\r\n\r\nconst StageCurrentSongBar: React.FC<StageCurrentSongBarProps> = ({\r\n  iconFansWhite,\r\n  iconMusicWhite,\r\n  fansGainBarPct,\r\n  fansGainRate,\r\n  fansStepFlash,\r\n  songProgressPct,\r\n  currentSongName,\r\n  wrapperRef,\r\n  fansTrackRef,\r\n}) => {\r\n  return (\r\n    <div className=\"stage-current-song\" ref={wrapperRef}>\r\n      <div className=\"stage-progress-item song-track\">\r\n        <img src={iconMusicWhite} alt=\"Música\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${songProgressPct}%` }} />\r\n          <div className=\"progress-text song-progress-text\">\r\n            <strong>{currentSongName}</strong>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"stage-progress-item fans-gain-track\" ref={fansTrackRef}>\r\n        <img src={iconFansWhite} alt=\"Ganho de fãs\" className=\"progress-icon\" />\r\n        <div className=\"progress-bar-shell\">\r\n          <span className=\"progress-fill\" style={{ width: `${fansGainBarPct}%` }} />\r\n          <div className=\"progress-text fans-gain-text\">\r\n            <strong>{Math.round(fansGainRate * 100)}%</strong>\r\n          </div>\r\n          <span className={`fans-gain-step-burst${fansStepFlash ? ' show' : ''}`}>+5%</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageCurrentSongBar;\r\n","import React from 'react';\r\nimport './StageVisualEffectsLayer.css';\r\n\r\ntype TapEffect = {\r\n  id: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\ntype RewardParticle = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  x: number;\r\n  y: number;\r\n  dx: number;\r\n  dy: number;\r\n  delay: number;\r\n  duration: number;\r\n};\r\n\r\ntype RewardFloatText = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  value: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\ntype StageVisualEffectsLayerProps = {\r\n  tapEffects: TapEffect[];\r\n  rewardParticles: RewardParticle[];\r\n  rewardTexts: RewardFloatText[];\r\n  iconFansWhite: string;\r\n  iconMoneyWhite: string;\r\n  iconFameWhite: string;\r\n  formatNumber: (value: number) => string;\r\n};\r\n\r\nconst StageVisualEffectsLayer: React.FC<StageVisualEffectsLayerProps> = ({\r\n  tapEffects,\r\n  rewardParticles,\r\n  rewardTexts,\r\n  iconFansWhite,\r\n  iconMoneyWhite,\r\n  iconFameWhite,\r\n  formatNumber,\r\n}) => {\r\n  const getRewardIcon = (kind: RewardParticle['kind']) => {\r\n    if (kind === 'fans') {\r\n      return iconFansWhite;\r\n    }\r\n\r\n    if (kind === 'fame') {\r\n      return iconFameWhite;\r\n    }\r\n\r\n    return iconMoneyWhite;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"rhythm-tap-layer\" aria-hidden=\"true\">\r\n        {tapEffects.map((effect) => (\r\n          <span key={effect.id} className=\"rhythm-tap-pulse\" style={{ left: effect.x, top: effect.y }} />\r\n        ))}\r\n      </div>\r\n      <div className=\"reward-fly-layer\" aria-hidden=\"true\">\r\n        {rewardParticles.map((particle) => (\r\n          <img\r\n            key={particle.id}\r\n            src={getRewardIcon(particle.kind)}\r\n            alt=\"\"\r\n            className={`reward-fly-icon ${particle.kind}`}\r\n            style={{\r\n              left: particle.x,\r\n              top: particle.y,\r\n              ['--dx' as string]: `${particle.dx}px`,\r\n              ['--dy' as string]: `${particle.dy}px`,\r\n              ['--delay' as string]: `${particle.delay}ms`,\r\n              ['--duration' as string]: `${particle.duration}ms`,\r\n            }}\r\n          />\r\n        ))}\r\n        {rewardTexts.map((entry) => (\r\n          <span\r\n            key={entry.id}\r\n            className={`reward-rise-text ${entry.kind}`}\r\n            style={{ left: entry.x, top: entry.y }}\r\n          >\r\n            +{formatNumber(entry.value)}\r\n          </span>\r\n        ))}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default StageVisualEffectsLayer;\r\n","import React, { useEffect, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\r\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\r\nimport { BokehPass } from 'three/examples/jsm/postprocessing/BokehPass.js';\r\nimport './Stage3DScene.css';\r\n\r\ntype StagePerformerInstrument = 'drums' | 'guitar' | 'bass' | 'keys';\r\n\r\ntype StageMusicianSprite = {\r\n  instrument: StagePerformerInstrument;\r\n  id: number;\r\n  portraitSrc: string;\r\n};\r\n\r\ntype Stage3DSceneProps = {\r\n  textureUrl: string;\r\n  backgroundImageUrl?: string;\r\n  backgroundVideoUrl?: string | null;\r\n  isMusicPlaying: boolean;\r\n  activeMusicians: StageMusicianSprite[];\r\n  activeMusiciansSignature?: string;\r\n  isCameraMotionEnabled: boolean;\r\n};\r\n\r\nconst baseCameraPosition = new THREE.Vector3(0, 5.25, 14.45);\r\nconst baseLookAtPosition = new THREE.Vector3(0, 0.76, 0.42);\r\nconst stageVerticalOffset = -1.22;\r\n\r\nconst performerPositions: Record<StagePerformerInstrument, THREE.Vector3> = {\r\n  drums: new THREE.Vector3(0.95, 0.9 + stageVerticalOffset, -0.66),\r\n  guitar: new THREE.Vector3(-2.7, 1 + stageVerticalOffset, 0.42),\r\n  bass: new THREE.Vector3(2.7, 1 + stageVerticalOffset, 1.06),\r\n  keys: new THREE.Vector3(-0.72, 1 + stageVerticalOffset, 2.6),\r\n};\r\n\r\nconst performerSpriteScale: Record<StagePerformerInstrument, [number, number]> = {\r\n  drums: [2.1, 3.1],\r\n  guitar: [2.05, 3],\r\n  bass: [2.05, 3],\r\n  keys: [2.2, 3.15],\r\n};\r\n\r\nconst performerShadowScale: Record<StagePerformerInstrument, [number, number]> = {\r\n  drums: [1.9, 0.66],\r\n  guitar: [1.72, 0.58],\r\n  bass: [1.72, 0.58],\r\n  keys: [1.98, 0.7],\r\n};\r\n\r\ntype CameraShot = {\r\n  type: 'general' | 'focus' | 'sweep';\r\n  instrument: StagePerformerInstrument | null;\r\n  pos: THREE.Vector3;\r\n  look: THREE.Vector3;\r\n  fov: number;\r\n  duration: number;\r\n};\r\n\r\nconst generalShot: CameraShot = {\r\n  type: 'general',\r\n  instrument: null,\r\n  pos: new THREE.Vector3(0, 4.95, 14.8),\r\n  look: new THREE.Vector3(0, 0.35, 0.06),\r\n  fov: 67,\r\n  duration: 1.6,\r\n};\r\n\r\nconst sweepShotLeft: CameraShot = {\r\n  type: 'sweep',\r\n  instrument: null,\r\n  pos: new THREE.Vector3(-5.7, 4.38, 9.8),\r\n  look: new THREE.Vector3(0, 0.4, 0.12),\r\n  fov: 62,\r\n  duration: 8,\r\n};\r\n\r\nconst sweepShotRight: CameraShot = {\r\n  type: 'sweep',\r\n  instrument: null,\r\n  pos: new THREE.Vector3(5.7, 4.38, 9.8),\r\n  look: new THREE.Vector3(0, 0.4, 0.12),\r\n  fov: 62,\r\n  duration: 8,\r\n};\r\n\r\nconst focusShotByInstrument: Record<StagePerformerInstrument, CameraShot> = {\r\n  guitar: {\r\n    type: 'focus',\r\n    instrument: 'guitar',\r\n    pos: new THREE.Vector3(-2.5, 1.2, 3.95),\r\n    look: new THREE.Vector3(-2.6, 2.08, -0.2),\r\n    fov: 50,\r\n    duration: 5,\r\n  },\r\n  bass: {\r\n    type: 'focus',\r\n    instrument: 'bass',\r\n    pos: new THREE.Vector3(2.5, 1.2, 3.95),\r\n    look: new THREE.Vector3(2.6, 2.08, -0.2),\r\n    fov: 50,\r\n    duration: 5,\r\n  },\r\n  drums: {\r\n    type: 'focus',\r\n    instrument: 'drums',\r\n    pos: new THREE.Vector3(0.9, 1.82, 3.08),\r\n    look: new THREE.Vector3(0.95, 2.22, -0.9),\r\n    fov: 49,\r\n    duration: 5,\r\n  },\r\n  keys: {\r\n    type: 'focus',\r\n    instrument: 'keys',\r\n    pos: new THREE.Vector3(-0.82, 1.1, 3.46),\r\n    look: new THREE.Vector3(-0.96, 2.1, 1.74),\r\n    fov: 49,\r\n    duration: 5,\r\n  },\r\n};\r\n\r\nconst buildShotQueue = (activeInstruments: StagePerformerInstrument[], cycle: number) => {\r\n  const sequenceOrder: StagePerformerInstrument[] = ['guitar', 'drums', 'bass', 'keys'];\r\n  const availableOrder = sequenceOrder.filter((instrument) => activeInstruments.includes(instrument));\r\n  if (!availableOrder.length) {\r\n    return [generalShot];\r\n  }\r\n\r\n  const rotateBy = cycle % availableOrder.length;\r\n  const rotatedOrder = [...availableOrder.slice(rotateBy), ...availableOrder.slice(0, rotateBy)];\r\n  const focusOrder = cycle % 2 === 0 ? rotatedOrder : [...rotatedOrder].reverse();\r\n  const sweepStart = cycle % 2 === 0 ? sweepShotLeft : sweepShotRight;\r\n  const sweepEnd = cycle % 2 === 0 ? sweepShotRight : sweepShotLeft;\r\n\r\n  const queue: CameraShot[] = [sweepStart];\r\n  focusOrder.forEach((instrument, index) => {\r\n    queue.push(focusShotByInstrument[instrument]);\r\n    if ((index + 1) % 2 === 0) {\r\n      queue.push(generalShot);\r\n    }\r\n  });\r\n  queue.push(sweepEnd);\r\n  queue.push(generalShot);\r\n\r\n  return queue;\r\n};\r\n\r\nconst Stage3DScene: React.FC<Stage3DSceneProps> = ({\r\n  textureUrl,\r\n  backgroundImageUrl,\r\n  backgroundVideoUrl,\r\n  isMusicPlaying,\r\n  activeMusicians,\r\n  activeMusiciansSignature,\r\n  isCameraMotionEnabled,\r\n}) => {\r\n  const isMobile = typeof window !== 'undefined' && window.matchMedia?.('(pointer: coarse)').matches;\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const isMusicPlayingRef = useRef(isMusicPlaying);\r\n  const activeMusiciansRef = useRef(activeMusicians);\r\n  const isCameraMotionEnabledRef = useRef(isCameraMotionEnabled);\r\n\r\n  const currentFocusedInstrumentRef = useRef<StagePerformerInstrument | null>(null);\r\n  const shotQueueRef = useRef<CameraShot[]>([]);\r\n  const shotIndexRef = useRef(0);\r\n  const currentShotRef = useRef<CameraShot>(generalShot);\r\n  const fromShotPosRef = useRef(baseCameraPosition.clone());\r\n  const fromShotLookRef = useRef(baseLookAtPosition.clone());\r\n  const fromShotFovRef = useRef(60);\r\n  const currentLookRef = useRef(baseLookAtPosition.clone());\r\n  const currentFovRef = useRef(60);\r\n  const shotEndsAtRef = useRef(0);\r\n  const shotStartedAtRef = useRef(0);\r\n  const shotMoveDurationRef = useRef(1.15);\r\n  const shotQueueCycleRef = useRef(0);\r\n  const lastShadowFrameSentAtRef = useRef(0);\r\n  const wasMusicPlayingRef = useRef(false);\r\n  const randomMotionRefreshAtRef = useRef(0);\r\n  const randomPosOffsetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n  const randomPosOffsetTargetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n  const randomLookOffsetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n  const randomLookOffsetTargetRef = useRef(new THREE.Vector3(0, 0, 0));\r\n\r\n  useEffect(() => {\r\n    isMusicPlayingRef.current = isMusicPlaying;\r\n  }, [isMusicPlaying]);\r\n\r\n  useEffect(() => {\r\n    activeMusiciansRef.current = activeMusicians;\r\n  }, [activeMusicians]);\r\n\r\n  useEffect(() => {\r\n    isCameraMotionEnabledRef.current = isCameraMotionEnabled;\r\n  }, [isCameraMotionEnabled]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) {\r\n      return;\r\n    }\r\n\r\n    const renderer = new THREE.WebGLRenderer({\r\n      antialias: !isMobile,\r\n      alpha: true,\r\n      premultipliedAlpha: false,\r\n      powerPreference: isMobile ? 'low-power' : 'high-performance',\r\n    });\r\n    renderer.shadowMap.enabled = !isMobile;\r\n    renderer.shadowMap.type = isMobile ? THREE.BasicShadowMap : THREE.PCFSoftShadowMap;\r\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, isMobile ? 1.25 : 2));\r\n    renderer.setClearColor(0x000000, 0);\r\n    renderer.setClearAlpha(0);\r\n    renderer.outputColorSpace = THREE.SRGBColorSpace;\r\n    renderer.domElement.style.background = 'transparent';\r\n    container.appendChild(renderer.domElement);\r\n\r\n    const scene = new THREE.Scene();\r\n    scene.background = null;\r\n    scene.fog = null;\r\n\r\n    const camera = new THREE.PerspectiveCamera(38, 1, 0.1, 100);\r\n    camera.position.copy(baseCameraPosition);\r\n\r\n    const textureLoader = new THREE.TextureLoader();\r\n    let sceneBackgroundTexture: THREE.Texture | null = null;\r\n    let sceneBackgroundVideoElement: HTMLVideoElement | null = null;\r\n    let hasActiveVideoBackground = false;\r\n    const backgroundGeometry = new THREE.PlaneGeometry(1, 1, 1, 1);\r\n    const backgroundMaterial = new THREE.MeshBasicMaterial({\r\n      color: 0xffffff,\r\n      side: THREE.DoubleSide,\r\n      depthWrite: false,\r\n      depthTest: false,\r\n      toneMapped: false,\r\n    });\r\n    const backgroundPlane = new THREE.Mesh(backgroundGeometry, backgroundMaterial);\r\n    backgroundPlane.position.set(0, 12.8, -44);\r\n    backgroundPlane.renderOrder = -20;\r\n    scene.add(backgroundPlane);\r\n    const backgroundBaseY = 9.1;\r\n    const backgroundParallaxCurrent = new THREE.Vector2(0, 0);\r\n    const backgroundParallaxTarget = new THREE.Vector2(0, 0);\r\n    const backgroundParallaxLimits = new THREE.Vector2(0, 0);\r\n\r\n    const getBackgroundAspect = () => {\r\n      const bgMap = backgroundMaterial.map;\r\n      if (!bgMap) {\r\n        return 16 / 9;\r\n      }\r\n\r\n      const source = bgMap.image as {\r\n        videoWidth?: number;\r\n        videoHeight?: number;\r\n        width?: number;\r\n        height?: number;\r\n      } | null;\r\n\r\n      const width = source?.videoWidth ?? source?.width ?? 0;\r\n      const height = source?.videoHeight ?? source?.height ?? 0;\r\n      if (!width || !height) {\r\n        return 16 / 9;\r\n      }\r\n\r\n      return width / height;\r\n    };\r\n\r\n    const updateBackgroundPlaneScale = () => {\r\n      const fitScale = 4;\r\n      const distance = Math.abs(camera.position.z - backgroundPlane.position.z);\r\n      const frustumHeight = 2 * Math.tan(THREE.MathUtils.degToRad(camera.fov * 0.5)) * distance;\r\n      const frustumWidth = frustumHeight * camera.aspect;\r\n\r\n      const textureAspect = getBackgroundAspect();\r\n      let planeHeight = frustumHeight * fitScale;\r\n      let planeWidth = planeHeight * textureAspect;\r\n      if (planeWidth > frustumWidth * fitScale) {\r\n        planeWidth = frustumWidth * fitScale;\r\n        planeHeight = planeWidth / textureAspect;\r\n      }\r\n\r\n      const maxOffsetX = Math.max(0, (planeWidth - frustumWidth) * 0.5);\r\n      const maxOffsetY = Math.max(0, (planeHeight - frustumHeight) * 0.5);\r\n      backgroundParallaxLimits.set(maxOffsetX * 0.92, maxOffsetY * 0.92);\r\n      backgroundParallaxCurrent.x = THREE.MathUtils.clamp(\r\n        backgroundParallaxCurrent.x,\r\n        -backgroundParallaxLimits.x,\r\n        backgroundParallaxLimits.x\r\n      );\r\n      backgroundParallaxCurrent.y = THREE.MathUtils.clamp(\r\n        backgroundParallaxCurrent.y,\r\n        -backgroundParallaxLimits.y,\r\n        backgroundParallaxLimits.y\r\n      );\r\n\r\n      backgroundPlane.position.x = backgroundParallaxCurrent.x;\r\n      backgroundPlane.position.y = backgroundBaseY + backgroundParallaxCurrent.y;\r\n      backgroundPlane.scale.set(planeWidth, planeHeight, 1);\r\n    };\r\n\r\n    const applySceneBackground = () => {\r\n      if (backgroundImageUrl) {\r\n        const bgTexture = textureLoader.load(backgroundImageUrl);\r\n        bgTexture.colorSpace = THREE.SRGBColorSpace;\r\n        sceneBackgroundTexture = bgTexture;\r\n        backgroundMaterial.map = bgTexture;\r\n        backgroundMaterial.needsUpdate = true;\r\n      }\r\n\r\n      if (backgroundVideoUrl) {\r\n        const video = document.createElement('video');\r\n        video.src = backgroundVideoUrl;\r\n        video.muted = true;\r\n        video.loop = true;\r\n        video.autoplay = true;\r\n        video.playsInline = true;\r\n        video.preload = 'auto';\r\n\r\n        const videoTexture = new THREE.VideoTexture(video);\r\n        videoTexture.colorSpace = THREE.SRGBColorSpace;\r\n        videoTexture.minFilter = THREE.LinearFilter;\r\n        videoTexture.magFilter = THREE.LinearFilter;\r\n        videoTexture.generateMipmaps = false;\r\n\r\n        sceneBackgroundVideoElement = video;\r\n        const activateVideoTexture = () => {\r\n          if (!sceneBackgroundVideoElement || sceneBackgroundVideoElement.readyState < 2) {\r\n            return;\r\n          }\r\n          if (sceneBackgroundTexture && sceneBackgroundTexture !== videoTexture) {\r\n            sceneBackgroundTexture.dispose();\r\n          }\r\n          hasActiveVideoBackground = true;\r\n          sceneBackgroundTexture = videoTexture;\r\n          backgroundMaterial.map = videoTexture;\r\n          backgroundMaterial.needsUpdate = true;\r\n          updateBackgroundPlaneScale();\r\n        };\r\n\r\n        video.addEventListener('loadeddata', activateVideoTexture, { once: true });\r\n        video.addEventListener('canplay', activateVideoTexture, { once: true });\r\n\r\n        void video.play().catch(() => undefined);\r\n      }\r\n    };\r\n\r\n    applySceneBackground();\r\n\r\n    const ambientLight = new THREE.AmbientLight(0xffffff, 1.02);\r\n    scene.add(ambientLight);\r\n\r\n    const frontKeyLight = new THREE.SpotLight(0xfff3de, 2.42, 40, Math.PI * 0.24, 0.32, 1.05);\r\n    frontKeyLight.position.set(0, 7.1, 9.3);\r\n    frontKeyLight.castShadow = !isMobile;\r\n    frontKeyLight.shadow.mapSize.width = isMobile ? 512 : 1024;\r\n    frontKeyLight.shadow.mapSize.height = isMobile ? 512 : 1024;\r\n    frontKeyLight.shadow.bias = -0.00015;\r\n    frontKeyLight.shadow.radius = isMobile ? 1.5 : 4;\r\n    scene.add(frontKeyLight);\r\n    scene.add(frontKeyLight.target);\r\n\r\n    const fillLight = new THREE.DirectionalLight(0x93b7ff, 0.72);\r\n    fillLight.position.set(4.5, 5.5, -3.5);\r\n    scene.add(fillLight);\r\n\r\n    const backLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n    backLight.position.set(0, 6.4, -8);\r\n    scene.add(backLight);\r\n\r\n    const hemiLight = new THREE.HemisphereLight(0xe6efff, 0x7a5f4a, 0.62);\r\n    scene.add(hemiLight);\r\n\r\n    const floorTexture = new THREE.TextureLoader().load(textureUrl);\r\n    floorTexture.colorSpace = THREE.SRGBColorSpace;\r\n    floorTexture.wrapS = THREE.RepeatWrapping;\r\n    floorTexture.wrapT = THREE.RepeatWrapping;\r\n    floorTexture.repeat.set(8, 8);\r\n    floorTexture.anisotropy = Math.min(renderer.capabilities.getMaxAnisotropy(), isMobile ? 4 : 8);\r\n\r\n    const floorMaterial = new THREE.MeshStandardMaterial({\r\n      map: floorTexture,\r\n      roughness: 0.86,\r\n      metalness: 0.08,\r\n    });\r\n\r\n    const floorGeometry = new THREE.PlaneGeometry(19, 19, 1, 1);\r\n    const floor = new THREE.Mesh(floorGeometry, floorMaterial);\r\n    floor.rotation.x = -Math.PI / 2 + 0.055;\r\n    floor.position.y = stageVerticalOffset;\r\n    floor.receiveShadow = true;\r\n    scene.add(floor);\r\n\r\n    const frontEdgeGeometry = new THREE.BoxGeometry(19, 0.35, 0.85);\r\n    const frontEdgeMaterial = new THREE.MeshStandardMaterial({\r\n      color: 0x2a1b11,\r\n      roughness: 0.9,\r\n      metalness: 0,\r\n    });\r\n    const frontEdge = new THREE.Mesh(frontEdgeGeometry, frontEdgeMaterial);\r\n    frontEdge.position.set(0, -0.16 + stageVerticalOffset, 8.7);\r\n    frontEdge.receiveShadow = true;\r\n    scene.add(frontEdge);\r\n\r\n    const shadowCanvas = document.createElement('canvas');\r\n    shadowCanvas.width = 256;\r\n    shadowCanvas.height = 256;\r\n    const shadowCtx = shadowCanvas.getContext('2d');\r\n    if (shadowCtx) {\r\n      const gradient = shadowCtx.createRadialGradient(128, 128, 8, 128, 128, 118);\r\n      gradient.addColorStop(0, 'rgba(0, 0, 0, 0.72)');\r\n      gradient.addColorStop(0.62, 'rgba(0, 0, 0, 0.34)');\r\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\r\n      shadowCtx.fillStyle = gradient;\r\n      shadowCtx.fillRect(0, 0, 256, 256);\r\n    }\r\n\r\n    const shadowTexture = new THREE.CanvasTexture(shadowCanvas);\r\n    shadowTexture.colorSpace = THREE.SRGBColorSpace;\r\n    const shadowGeometry = new THREE.PlaneGeometry(1, 1);\r\n\r\n    const spriteTextureLoader = new THREE.TextureLoader();\r\n    const musicianSprites: Array<{\r\n      sprite: THREE.Sprite;\r\n      shadow: THREE.Mesh;\r\n      texture: THREE.Texture;\r\n      spriteMaterial: THREE.SpriteMaterial;\r\n      shadowMaterial: THREE.MeshBasicMaterial;\r\n    }> = [];\r\n\r\n    activeMusiciansRef.current.forEach((musician) => {\r\n      const basePosition = performerPositions[musician.instrument];\r\n      if (!basePosition) {\r\n        return;\r\n      }\r\n\r\n      const spriteTexture = spriteTextureLoader.load(musician.portraitSrc);\r\n      spriteTexture.colorSpace = THREE.SRGBColorSpace;\r\n\r\n      const spriteMaterial = new THREE.SpriteMaterial({\r\n        map: spriteTexture,\r\n        transparent: true,\r\n        depthWrite: false,\r\n        depthTest: false,\r\n      });\r\n\r\n      const sprite = new THREE.Sprite(spriteMaterial);\r\n      const [scaleX, scaleY] = performerSpriteScale[musician.instrument];\r\n      sprite.scale.set(scaleX, scaleY, 1);\r\n      sprite.center.set(0.5, 0.02);\r\n      sprite.position.set(basePosition.x, 0.11 + stageVerticalOffset, basePosition.z);\r\n      sprite.renderOrder = 5;\r\n      scene.add(sprite);\r\n\r\n      const shadowMaterial = new THREE.MeshBasicMaterial({\r\n        map: shadowTexture,\r\n        transparent: true,\r\n        opacity: 0.84,\r\n        depthWrite: false,\r\n        depthTest: false,\r\n      });\r\n      const shadow = new THREE.Mesh(shadowGeometry, shadowMaterial);\r\n      const [shadowWidth, shadowHeight] = performerShadowScale[musician.instrument];\r\n      shadow.scale.set(shadowWidth * 1.62, shadowHeight * 1.92, 1);\r\n      shadow.rotation.x = floor.rotation.x;\r\n      shadow.position.set(basePosition.x, 0.035 + stageVerticalOffset, basePosition.z - 0.2);\r\n      shadow.userData.baseX = shadow.position.x;\r\n      shadow.userData.baseZ = shadow.position.z;\r\n      shadow.renderOrder = 3;\r\n      scene.add(shadow);\r\n\r\n      musicianSprites.push({\r\n        sprite,\r\n        shadow,\r\n        texture: spriteTexture,\r\n        spriteMaterial,\r\n        shadowMaterial,\r\n      });\r\n    });\r\n\r\n    const standInGeometry = new THREE.CapsuleGeometry(0.35, 1.2, 2, 8);\r\n    const standInMaterial = new THREE.MeshStandardMaterial({\r\n      color: 0x1e1e1e,\r\n      transparent: true,\r\n      opacity: 0.04,\r\n      roughness: 1,\r\n      metalness: 0,\r\n    });\r\n\r\n    const performerStandIns: THREE.Mesh[] = [];\r\n    (Object.keys(performerPositions) as StagePerformerInstrument[]).forEach((instrument) => {\r\n      const position = performerPositions[instrument];\r\n      const standIn = new THREE.Mesh(standInGeometry, standInMaterial);\r\n      standIn.position.set(position.x, 1 + stageVerticalOffset, position.z);\r\n      standIn.castShadow = true;\r\n      standIn.receiveShadow = false;\r\n      performerStandIns.push(standIn);\r\n      scene.add(standIn);\r\n    });\r\n\r\n    const composerRenderTarget = !isMobile\r\n      ? new THREE.WebGLRenderTarget(1, 1, {\r\n          format: THREE.RGBAFormat,\r\n          depthBuffer: true,\r\n          stencilBuffer: false,\r\n        })\r\n      : null;\r\n\r\n    const composer = composerRenderTarget ? new EffectComposer(renderer, composerRenderTarget) : null;\r\n    const renderPass = composer ? new RenderPass(scene, camera) : null;\r\n    if (composer && renderPass) {\r\n      renderPass.clear = true;\r\n      renderPass.clearAlpha = 0;\r\n      composer.addPass(renderPass);\r\n    }\r\n    const bokehPass = composer\r\n      ? new BokehPass(scene, camera, {\r\n          focus: 8,\r\n          aperture: 0.000004,\r\n          maxblur: 0.00035,\r\n        })\r\n      : null;\r\n    if (composer && bokehPass) {\r\n      composer.addPass(bokehPass);\r\n    }\r\n\r\n    const resize = () => {\r\n      const { clientWidth, clientHeight } = container;\r\n      if (!clientWidth || !clientHeight) {\r\n        return;\r\n      }\r\n\r\n      renderer.setSize(clientWidth, clientHeight, false);\r\n      if (composer) {\r\n        composer.setSize(clientWidth, clientHeight);\r\n      }\r\n      camera.aspect = clientWidth / clientHeight;\r\n      camera.updateProjectionMatrix();\r\n      updateBackgroundPlaneScale();\r\n    };\r\n\r\n    resize();\r\n    const resizeObserver = new ResizeObserver(resize);\r\n    resizeObserver.observe(container);\r\n\r\n    const clock = new THREE.Clock();\r\n    let animationFrameId = 0;\r\n    const targetFps = isMobile ? 45 : 60;\r\n    let lastFrameTime = 0;\r\n    const cameraTarget = new THREE.Vector3();\r\n    const lookAtTarget = new THREE.Vector3();\r\n\r\n    const setFocusedInstrument = (instrument: StagePerformerInstrument | null) => {\r\n      currentFocusedInstrumentRef.current = instrument;\r\n    };\r\n\r\n    const rebuildShotQueue = () => {\r\n      shotQueueRef.current = buildShotQueue(\r\n        activeMusiciansRef.current.map((item) => item.instrument),\r\n        shotQueueCycleRef.current\r\n      );\r\n      shotQueueCycleRef.current += 1;\r\n      shotIndexRef.current = 0;\r\n    };\r\n\r\n    const applyNextShot = (elapsed: number, cameraObject: THREE.PerspectiveCamera) => {\r\n      const activeQueue = shotQueueRef.current;\r\n      if (!activeQueue.length) {\r\n        shotQueueRef.current = [generalShot];\r\n      }\r\n\r\n      const queue = shotQueueRef.current;\r\n      const nextIndex = shotIndexRef.current % queue.length;\r\n      const nextShot = queue[nextIndex];\r\n      shotIndexRef.current = (nextIndex + 1) % queue.length;\r\n\r\n      fromShotPosRef.current.copy(cameraObject.position);\r\n      fromShotLookRef.current.copy(currentLookRef.current);\r\n      fromShotFovRef.current = currentFovRef.current;\r\n\r\n      currentShotRef.current = nextShot;\r\n      setFocusedInstrument(nextShot.instrument);\r\n\r\n      shotStartedAtRef.current = elapsed;\r\n      if (nextShot.type === 'sweep') {\r\n        shotMoveDurationRef.current = 7.6;\r\n      } else if (nextShot.type === 'focus') {\r\n        shotMoveDurationRef.current = 3;\r\n      } else {\r\n        shotMoveDurationRef.current = 1.35;\r\n      }\r\n      shotEndsAtRef.current = elapsed + nextShot.duration;\r\n    };\r\n\r\n    const animate = () => {\r\n      const now = performance.now();\r\n      if (now - lastFrameTime < 1000 / targetFps) {\r\n        animationFrameId = window.requestAnimationFrame(animate);\r\n        return;\r\n      }\r\n      lastFrameTime = now;\r\n      const elapsed = clock.getElapsedTime();\r\n      const playing = isMusicPlayingRef.current;\r\n\r\n      frontKeyLight.position.x = Math.sin(elapsed * (playing ? 1.2 : 0.36)) * (playing ? 2.8 : 1.2);\r\n      frontKeyLight.position.y = 7 + Math.cos(elapsed * (playing ? 0.76 : 0.24)) * 0.45;\r\n      frontKeyLight.position.z = 9.1 + Math.sin(elapsed * (playing ? 0.54 : 0.18)) * 0.48;\r\n      frontKeyLight.target.position.set(frontKeyLight.position.x * 0.18, 1.1, -1.6);\r\n      frontKeyLight.target.updateMatrixWorld();\r\n\r\n      if (!isCameraMotionEnabledRef.current) {\r\n        camera.position.copy(generalShot.pos);\r\n        currentLookRef.current.copy(generalShot.look);\r\n        camera.up.set(0, 1, 0);\r\n        camera.lookAt(currentLookRef.current);\r\n        camera.fov = generalShot.fov;\r\n        camera.updateProjectionMatrix();\r\n        backgroundParallaxTarget.set(0, 0);\r\n        backgroundParallaxCurrent.set(0, 0);\r\n        updateBackgroundPlaneScale();\r\n        renderer.render(scene, camera);\r\n        animationFrameId = window.requestAnimationFrame(animate);\r\n        wasMusicPlayingRef.current = playing;\r\n        return;\r\n      }\r\n\r\n      if (!playing) {\r\n        if (wasMusicPlayingRef.current || currentShotRef.current.instrument !== null) {\r\n          fromShotPosRef.current.copy(camera.position);\r\n          fromShotLookRef.current.copy(currentLookRef.current);\r\n          fromShotFovRef.current = currentFovRef.current;\r\n          currentShotRef.current = generalShot;\r\n          setFocusedInstrument(null);\r\n          shotStartedAtRef.current = elapsed;\r\n          shotMoveDurationRef.current = 1.2;\r\n          shotEndsAtRef.current = elapsed + 1.2;\r\n          rebuildShotQueue();\r\n        }\r\n      } else if (!shotEndsAtRef.current || elapsed >= shotEndsAtRef.current) {\r\n        if (!shotQueueRef.current.length || shotIndexRef.current === 0) {\r\n          rebuildShotQueue();\r\n        }\r\n        applyNextShot(elapsed, camera);\r\n      }\r\n\r\n      const shot = currentShotRef.current;\r\n      const shotElapsed = Math.max(0, elapsed - shotStartedAtRef.current);\r\n      const moveDuration = Math.max(0.1, shotMoveDurationRef.current);\r\n      const moveProgress = Math.min(1, shotElapsed / moveDuration);\r\n      const easeProgress = moveProgress * moveProgress * (3 - 2 * moveProgress);\r\n      const isCloseShot = Boolean(shot.instrument);\r\n\r\n      if (playing && elapsed >= randomMotionRefreshAtRef.current) {\r\n        const nextWindow = isCloseShot\r\n          ? 1.6 + Math.random() * 1.8\r\n          : 2.4 + Math.random() * 2.6;\r\n        randomMotionRefreshAtRef.current = elapsed + nextWindow;\r\n\r\n        randomPosOffsetTargetRef.current.set(\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.2 : 0.4),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.08 : 0.16),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.18 : 0.34)\r\n        );\r\n\r\n        randomLookOffsetTargetRef.current.set(\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.12 : 0.24),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.05 : 0.1),\r\n          (Math.random() - 0.5) * (isCloseShot ? 0.1 : 0.16)\r\n        );\r\n\r\n      }\r\n\r\n      if (!playing || !isCloseShot) {\r\n        randomPosOffsetTargetRef.current.set(0, 0, 0);\r\n        randomLookOffsetTargetRef.current.set(0, 0, 0);\r\n      }\r\n\r\n      randomPosOffsetRef.current.lerp(randomPosOffsetTargetRef.current, isCloseShot ? 0.055 : 0.04);\r\n      randomLookOffsetRef.current.lerp(randomLookOffsetTargetRef.current, isCloseShot ? 0.065 : 0.05);\r\n\r\n      const handAmount = isCloseShot ? 0.024 : 0.015;\r\n\r\n      const targetPos = new THREE.Vector3(\r\n        shot.pos.x,\r\n        shot.pos.y,\r\n        shot.pos.z\r\n      );\r\n      const focusPosition = shot.instrument\r\n        ? performerPositions[shot.instrument]\r\n        : null;\r\n\r\n      const focusAnchor = focusPosition\r\n        ? new THREE.Vector3(\r\n          focusPosition.x,\r\n          focusPosition.y + 1.42,\r\n          focusPosition.z + 0.04\r\n        )\r\n        : null;\r\n\r\n      if (isCloseShot && focusAnchor) {\r\n        const shotDistanceToPortrait = Math.max(5.2, Math.min(6.7, shot.pos.distanceTo(focusAnchor)));\r\n        const closeDistance = shotDistanceToPortrait;\r\n        const shotDirection = new THREE.Vector3().subVectors(shot.pos, focusAnchor);\r\n        if (shotDirection.lengthSq() < 0.0001) {\r\n          shotDirection.set(0, 0.24, 1);\r\n        }\r\n        shotDirection.normalize();\r\n        targetPos.copy(focusAnchor).addScaledVector(shotDirection, closeDistance);\r\n        targetPos.y -= 0.72;\r\n      }\r\n\r\n      targetPos.x += Math.sin(elapsed * (isCloseShot ? 0.92 : 0.52)) * handAmount\r\n        + Math.sin(elapsed * 0.16) * (isCloseShot ? 0.12 : 0.16)\r\n        + (isCloseShot ? Math.sin(elapsed * 1.48) * 0.022 : 0)\r\n        + randomPosOffsetRef.current.x;\r\n      targetPos.y += Math.cos(elapsed * (isCloseShot ? 0.72 : 0.46)) * handAmount\r\n        + Math.cos(elapsed * 0.14) * (isCloseShot ? 0.06 : 0.07)\r\n        + randomPosOffsetRef.current.y;\r\n      targetPos.z += Math.sin(elapsed * (isCloseShot ? 0.62 : 0.4)) * handAmount\r\n        + Math.sin(elapsed * 0.11) * (isCloseShot ? 0.09 : 0.14)\r\n        + (isCloseShot ? Math.cos(elapsed * 1.22) * 0.018 : 0)\r\n        + randomPosOffsetRef.current.z;\r\n\r\n      const sideSway = Math.sin(elapsed * 0.42) * (isCloseShot ? 0.035 : 0.11);\r\n      const frontBackSway = Math.cos(elapsed * 0.31) * (isCloseShot ? 0.018 : 0.05);\r\n      targetPos.x += sideSway;\r\n      targetPos.z += frontBackSway;\r\n\r\n      if (!playing) {\r\n        const idleSwayX = Math.sin(elapsed * 0.24) * 0.06 + Math.sin(elapsed * 0.11) * 0.03;\r\n        const idleSwayY = Math.cos(elapsed * 0.2) * 0.028;\r\n        const idleSwayZ = Math.sin(elapsed * 0.18) * 0.04;\r\n        targetPos.x += idleSwayX;\r\n        targetPos.y += idleSwayY;\r\n        targetPos.z += idleSwayZ;\r\n      }\r\n\r\n      const targetLook = new THREE.Vector3(\r\n        (focusAnchor ? focusAnchor.x : shot.look.x)\r\n          + Math.sin(elapsed * 0.62) * (isCloseShot ? 0.009 : 0.005)\r\n          + Math.sin(elapsed * 0.42) * (isCloseShot ? 0.01 : 0.03)\r\n          + randomLookOffsetRef.current.x,\r\n        (focusAnchor ? focusAnchor.y - 0.2 : shot.look.y)\r\n          + Math.cos(elapsed * 0.41) * (isCloseShot ? 0.007 : 0.003)\r\n          + randomLookOffsetRef.current.y,\r\n        (focusAnchor ? focusAnchor.z : shot.look.z) + randomLookOffsetRef.current.z\r\n      );\r\n\r\n      if (!playing) {\r\n        targetLook.x += Math.sin(elapsed * 0.24) * 0.012;\r\n        targetLook.y += Math.cos(elapsed * 0.2) * 0.009;\r\n      }\r\n\r\n      targetLook.y += isCloseShot ? -0.14 : 0.3;\r\n\r\n      cameraTarget.lerpVectors(fromShotPosRef.current, targetPos, easeProgress);\r\n      lookAtTarget.lerpVectors(fromShotLookRef.current, targetLook, easeProgress);\r\n\r\n      camera.position.copy(cameraTarget);\r\n      currentLookRef.current.copy(lookAtTarget);\r\n      camera.up.set(0, 1, 0);\r\n      camera.lookAt(currentLookRef.current);\r\n\r\n      const sweepZoomBreath = shot.type === 'sweep'\r\n        ? Math.sin(elapsed * 0.34) * 0.9\r\n        : 0;\r\n      const targetFov = fromShotFovRef.current + ((shot.fov + sweepZoomBreath) - fromShotFovRef.current) * easeProgress;\r\n      currentFovRef.current += (targetFov - currentFovRef.current) * 0.12;\r\n      camera.fov = currentFovRef.current;\r\n      camera.updateProjectionMatrix();\r\n\r\n      backgroundParallaxTarget.set(\r\n        (camera.position.x - baseCameraPosition.x) * 0.2\r\n          + (currentLookRef.current.x - baseLookAtPosition.x) * 0.12,\r\n        (camera.position.y - baseCameraPosition.y) * 0.28\r\n          + (currentLookRef.current.y - baseLookAtPosition.y) * 0.08\r\n      );\r\n      backgroundParallaxTarget.x = THREE.MathUtils.clamp(\r\n        backgroundParallaxTarget.x,\r\n        -backgroundParallaxLimits.x,\r\n        backgroundParallaxLimits.x\r\n      );\r\n      backgroundParallaxTarget.y = THREE.MathUtils.clamp(\r\n        backgroundParallaxTarget.y,\r\n        -backgroundParallaxLimits.y,\r\n        backgroundParallaxLimits.y\r\n      );\r\n      backgroundParallaxCurrent.lerp(backgroundParallaxTarget, 0.045);\r\n      updateBackgroundPlaneScale();\r\n\r\n      if (bokehPass) {\r\n        const focusDistance = Math.max(1.2, Math.min(16, camera.position.distanceTo(currentLookRef.current)));\r\n        const closeStrengthRaw = isCloseShot ? 1 - (focusDistance - 2.3) / 5.8 : 0;\r\n        const closeStrength = Math.max(0, Math.min(1, closeStrengthRaw));\r\n        bokehPass.materialBokeh.uniforms.focus.value = focusDistance;\r\n        const smoothClose = closeStrength * closeStrength * (3 - 2 * closeStrength);\r\n        bokehPass.materialBokeh.uniforms.aperture.value = 0.0000013 + smoothClose * 0.0000022;\r\n        bokehPass.materialBokeh.uniforms.maxblur.value = 0.00008 + smoothClose * 0.00018;\r\n      }\r\n\r\n      if (elapsed - lastShadowFrameSentAtRef.current > 0.06) {\r\n        lastShadowFrameSentAtRef.current = elapsed;\r\n        const shadowDrift = frontKeyLight.position.x / 3.4;\r\n        musicianSprites.forEach(({ shadow, shadowMaterial }) => {\r\n          const baseShadowX = (shadow.userData.baseX as number) ?? shadow.position.x;\r\n          const baseShadowZ = (shadow.userData.baseZ as number) ?? shadow.position.z;\r\n          shadow.position.x = baseShadowX;\r\n          shadow.position.z = baseShadowZ;\r\n          shadowMaterial.opacity = 0.76 + Math.abs(shadowDrift) * 0.12;\r\n        });\r\n      }\r\n\r\n      renderer.render(scene, camera);\r\n      animationFrameId = window.requestAnimationFrame(animate);\r\n      wasMusicPlayingRef.current = playing;\r\n    };\r\n\r\n    animationFrameId = window.requestAnimationFrame(animate);\r\n\r\n    return () => {\r\n      window.cancelAnimationFrame(animationFrameId);\r\n      resizeObserver.disconnect();\r\n\r\n      floorGeometry.dispose();\r\n      floorMaterial.dispose();\r\n      floorTexture.dispose();\r\n      backgroundGeometry.dispose();\r\n      backgroundMaterial.dispose();\r\n      scene.remove(backgroundPlane);\r\n      standInGeometry.dispose();\r\n      standInMaterial.dispose();\r\n      frontEdgeGeometry.dispose();\r\n      frontEdgeMaterial.dispose();\r\n      shadowGeometry.dispose();\r\n      shadowTexture.dispose();\r\n      performerStandIns.forEach((standIn) => {\r\n        scene.remove(standIn);\r\n      });\r\n      musicianSprites.forEach(({ sprite, shadow, texture, spriteMaterial, shadowMaterial }) => {\r\n        scene.remove(sprite);\r\n        scene.remove(shadow);\r\n        texture.dispose();\r\n        spriteMaterial.dispose();\r\n        shadowMaterial.dispose();\r\n      });\r\n\r\n      setFocusedInstrument(null);\r\n      currentShotRef.current = generalShot;\r\n\r\n      composer?.dispose();\r\n      composerRenderTarget?.dispose();\r\n      if (sceneBackgroundVideoElement) {\r\n        sceneBackgroundVideoElement.pause();\r\n        sceneBackgroundVideoElement.src = '';\r\n        sceneBackgroundVideoElement.load();\r\n      }\r\n      if (sceneBackgroundTexture) {\r\n        sceneBackgroundTexture.dispose();\r\n      }\r\n\r\n      renderer.dispose();\r\n      renderer.forceContextLoss();\r\n      if (renderer.domElement.parentNode === container) {\r\n        container.removeChild(renderer.domElement);\r\n      }\r\n    };\r\n  }, [textureUrl, backgroundImageUrl, backgroundVideoUrl, activeMusiciansSignature]);\r\n\r\n  return <div className=\"stage-3d-layer\" ref={containerRef} aria-hidden=\"true\" />;\r\n};\r\n\r\nexport default Stage3DScene;\r\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFRElEQVR4nO2d3XLiNhiGuZhuzz3DcH1dSnbTNtlpUjbZDjJJzrJgHP7/HGwZY8A2JDnoLTTpicC9AnXkQJfNpN38WLZk9M5848zkJH4ekKXPjpxKiYiIiIiIiIiIiIiIiIiIvDDD4fB70zTLlmXdWZZ1a1lWGUL4hufzgRCSc7jTdf12MBiU+/0+m+czGo3SpmkuLMvC6xqNRqQW5HcpzmIYRtowjAWEEBuGgXVdx4PBAGuatuj3+2ydD4RQMk0TPQJ/Xf54PM6kOAmEUDIMAz2Ef3l5GZSmaX63281wAd+27aB4kQC/DR/3+33c7Xbjl/BU+KTG4zE5Mi0BPhF+r9cLqtPpxCfhufA3ikkJ8Jnwu90uEYBbrZbfaDQyXMCfTCZBsSYBvhB+u90mAnCz2YxOwmvhk5pOp+TosyDhtfBXAnC9XqcvISz4G+V7npfhHX6j0SACcK1W81VVzdBcZC3Cgu84TlDT6XTpOE46jnk+hHAZIvygLi4uFoqihL9YW61wQ4XvOA52XZccI5VAC361WiUCcKVS+Rz6H71qL4QO3/1SkQxHFIadr+CrqkoE/EVNAA34nucFRVtCFPBJKYryZ+h/vGVZJZrwPc/Ds9mMHJfz+TzN27Czhl+pVHC5XD6n8el5s2qsUYM/+1KhSogSvqIoi1Kp9F2KRmzblkajEaIJfz6fr8u/vr7O8DLsrOD7pVKJ7nVsLYEyfHx1dUXqVdeExMHflGDbNqIMH5OfZ7PZiyQkFv6mhMlkgijDxy+ZHSUe/kMJNOF79wKCtsVTekdbA39TwnQ6RTThO/cti292UbcO/qYEx3EQTfiT1VD3Xzd1thb+Oq7rBhJowh/f31Uj7ZCvJGw9/E0JrusimvBHq5U4kWCaZkbAfxDS1XRdd0kZPh4Oh9g0zWWE7YVluVxm63GU//smeJ6HKMPHBPzWjvlPkTCbzQIJAn6MEubzORKffAYkiGEnxtzc3Pz7TRBjfszXBHHBZWB2JGY7DKyYxVQzxmy2ssdinh+fBNu2g9ubYpEVowTLspBY4cYsYTgcItFeiDEQQglCGPTyRW8nJgFGRDdTzs/P//7xbdbJ5XJ8NdeSAj/3w9s/ctks3s3t+Lu7u9stAcYFf+cd/uWnn/GH/X3/cP9wOyUwAB8f/nqA87/l/ePj4+2SwAr8j/mP+PdPnzAAwD89Pd0OCQzCxycnJ7hYLPqFQiHZEhiGj0nJspxcCRzAx6tKngSO4OPESeAQPk6MBI7hY+4lJAA+5lZCguBj7iRE/azmDmms0YUfFABgCQBg+9HEOB6UzWaz0vudd4gmfC6+CXE+pbz3fk/6sLeHKMNnVwILj4gfHBxI+XweUYbPngQW4K9zdHQkAQAQZfjsSGAJ/jpnZ2dSsVhElOHHL4FF+OsAACRZllEEAuKRwDL8xEvgAX5iJfAEP3ESyJ5xj+2lzMM/xAEA0mQlG5GERbFYDH/PuNUu4tzBj0MCACD8PePIFu68DDsMDEfh7xmn6/odz/AjlhD+nnG6rpd4G3biGo4AAOHvGUfeHEFeXsA7/AgkLAqFAp094zRNkzRNQ7wNOxEOR/TXAkRCr9dDvMOnICG61TCR0Ol0EO/wQ5QQfT+o3W5LrVYL8Q4/BAnxdUSJhGaziXiH/woJ8d8TIBLq9TriHf4LJMQPf51qtSrVajXEO/xnSGAH/jrVajVNXl7w2F7K3Ow09WCdQOb0j83zmX08hbw5QlXVkqqqt4qikPpMbSPrCEK6mrIsl2RZviVFmmzUFlkiIiIiIiIiIiIiIiIiIqltyD83ZUIdSGxX9gAAAABJRU5ErkJggg==\"","import React from 'react';\r\n\r\nexport type StageBandSlot = {\r\n  id: 'guitar' | 'bass' | 'drums' | 'keys';\r\n  instrumentLabel: string;\r\n  instrumentIcon: string;\r\n  musicianFace: string | null;\r\n  hasMusician: boolean;\r\n  rarityClass: 'bronze' | 'silver' | 'gold' | null;\r\n};\r\n\r\ntype StageBandSlotsGroupProps = {\r\n  slots: StageBandSlot[];\r\n  emptyMusicianIcon?: string;\r\n  className?: string;\r\n  onClick?: () => void;\r\n  ariaLabel?: string;\r\n};\r\n\r\nconst StageBandSlotsGroup: React.FC<StageBandSlotsGroupProps> = ({\r\n  slots,\r\n  emptyMusicianIcon,\r\n  className,\r\n  onClick,\r\n  ariaLabel = 'Músicos da banda',\r\n}) => {\r\n  const mergedClassName = `stage-map-preview-band${className ? ` ${className}` : ''}`;\r\n\r\n  const content = (\r\n    <>\r\n      {slots.map((slot) => (\r\n        <div key={slot.id} className=\"stage-map-preview-band-slot\">\r\n          <span className=\"stage-map-preview-band-label\">\r\n            <img src={slot.instrumentIcon} alt=\"\" aria-hidden=\"true\" />\r\n            <strong>{slot.instrumentLabel}</strong>\r\n          </span>\r\n          <div className={`stage-map-preview-band-card${slot.rarityClass ? ` rarity-${slot.rarityClass}` : ''}`}>\r\n            {slot.hasMusician && slot.musicianFace ? (\r\n              <img src={slot.musicianFace} alt={slot.instrumentLabel} className=\"stage-map-preview-band-face\" />\r\n            ) : (\r\n              <div className=\"stage-map-preview-band-empty\" aria-label={`${slot.instrumentLabel} vazio`}>\r\n                {emptyMusicianIcon ? <img src={emptyMusicianIcon} alt=\"\" aria-hidden=\"true\" /> : null}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n\r\n  if (onClick) {\r\n    return (\r\n      <button\r\n        type=\"button\"\r\n        className={mergedClassName}\r\n        aria-label={ariaLabel}\r\n        onClick={onClick}\r\n        data-click-sfx=\"open\"\r\n      >\r\n        {content}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={mergedClassName} aria-label={ariaLabel}>\r\n      {content}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StageBandSlotsGroup;\r\n","import React from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport './StageSofiaDialog.css';\r\n\r\nconst sofiaPortrait = new URL('../../rsc/images/facesets/Sofia_ZoomFace.png', import.meta.url).href;\r\n\r\ntype StageSofiaDialogProps = {\r\n  isVisible: boolean;\r\n  message: string;\r\n  confirmLabel?: string;\r\n  cancelLabel?: string;\r\n  onConfirm: () => void;\r\n  onCancel?: () => void;\r\n};\r\n\r\nconst StageSofiaDialog: React.FC<StageSofiaDialogProps> = ({\r\n  isVisible,\r\n  message,\r\n  confirmLabel = 'Entendi',\r\n  cancelLabel,\r\n  onConfirm,\r\n  onCancel,\r\n}) => {\r\n  const DIALOG_CLOSE_MS = 220;\r\n  const closeTimeoutRef = React.useRef<number | null>(null);\r\n  const [shouldRender, setShouldRender] = React.useState(isVisible);\r\n  const [isClosing, setIsClosing] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (isVisible) {\r\n      if (closeTimeoutRef.current !== null) {\r\n        window.clearTimeout(closeTimeoutRef.current);\r\n        closeTimeoutRef.current = null;\r\n      }\r\n      setShouldRender(true);\r\n      setIsClosing(false);\r\n      return;\r\n    }\r\n\r\n    if (!shouldRender) {\r\n      return;\r\n    }\r\n\r\n    setIsClosing(true);\r\n    closeTimeoutRef.current = window.setTimeout(() => {\r\n      setShouldRender(false);\r\n      setIsClosing(false);\r\n      closeTimeoutRef.current = null;\r\n    }, DIALOG_CLOSE_MS);\r\n  }, [isVisible, shouldRender]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (closeTimeoutRef.current !== null) {\r\n        window.clearTimeout(closeTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  if (!shouldRender) {\r\n    return null;\r\n  }\r\n\r\n  const dialogNode = (\r\n    <div className={`stage-sofia-dialog${isClosing ? ' is-closing' : ''}`} role=\"dialog\" aria-modal=\"true\" aria-label=\"Mensagem da Sofia\">\r\n      <div className=\"stage-sofia-dialog-backdrop\" />\r\n      <div className=\"stage-sofia-dialog-card\">\r\n        <div className=\"stage-sofia-guide\">\r\n          <img src={sofiaPortrait} alt=\"Sofia\" className=\"stage-sofia-guide-portrait\" />\r\n          <div className=\"stage-sofia-speech-bubble\">\r\n            <div className=\"stage-sofia-speech-head\">\r\n              <h3>Sofia</h3>\r\n              <span>Produtora da Hero Music</span>\r\n            </div>\r\n            <p>{message}</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"stage-sofia-dialog-actions\">\r\n          {cancelLabel && onCancel ? (\r\n            <button\r\n              type=\"button\"\r\n              className=\"stage-sofia-dialog-btn secondary\"\r\n              onClick={onCancel}\r\n              data-click-sfx=\"cancel\"\r\n            >\r\n              {cancelLabel}\r\n            </button>\r\n          ) : null}\r\n          <button\r\n            type=\"button\"\r\n            className=\"stage-sofia-dialog-btn primary\"\r\n            onClick={onConfirm}\r\n          >\r\n            {confirmLabel}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (typeof document === 'undefined') {\r\n    return dialogNode;\r\n  }\r\n\r\n  return createPortal(dialogNode, document.body);\r\n};\r\n\r\nexport default StageSofiaDialog;\r\n","import React from 'react';\r\nimport './StageMapModal.css';\r\nimport iconFechar from '../../rsc/images/icons/Icone_fechar.png';\r\nimport StageBandSlotsGroup, { type StageBandSlot } from './StageBandSlotsGroup';\r\nimport StageSofiaDialog from './StageSofiaDialog';\r\nimport StageVenueCacheCard from './StageVenueCacheCard';\r\n\r\ntype StageMapEntry = {\r\n  id: number;\r\n  name: string;\r\n  badgeUrl: string;\r\n  bannerUrl: string | null;\r\n  backgroundUrl: string | null;\r\n  ticketPrice: number;\r\n  capacity: number;\r\n  maxRevenue: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\ntype StageMapModalProps = {\r\n  isVisible: boolean;\r\n  mapImageUrl: string;\r\n  iconFansWhite: string;\r\n  iconIngressoWhite: string;\r\n  iconGainWhite: string;\r\n  iconCostWhite: string;\r\n  iconValorCacheTotal: string;\r\n  bandSlots?: StageBandSlot[];\r\n  bandTotalCache?: number;\r\n  emptyMusicianIcon?: string;\r\n  onOpenBandManagement?: (stageContext?: { name: string; maxRevenue: number } | null) => void;\r\n  isBandQuickAccessVisible?: boolean;\r\n  isBandQuickAccessHiding?: boolean;\r\n  stages: StageMapEntry[];\r\n  currentStageId: number;\r\n  isEmbedded?: boolean;\r\n  introImageUrl?: string;\r\n  bandName?: string;\r\n  bandLogoUrl?: string;\r\n  introPlayId?: number;\r\n  resetViewToken?: number;\r\n  onIntroVisibilityChange?: (isVisible: boolean) => void;\r\n  onPreviewStageBannerChange?: (bannerUrl: string | null) => void;\r\n  onStageTransitionStart?: () => void;\r\n  onClose: () => void;\r\n  onSelectStage: (stageId: number) => void;\r\n};\r\nconst STAGE_SELECT_TRANSITION_MS = 1800;\r\nconst STAGE_MAP_CLOSE_FADE_MS = 620;\r\nconst STAGE_BLACKOUT_START_PROGRESS = 0.68;\r\nconst STAGE_SELECT_ZOOM_MULTIPLIER = 1.75;\r\nconst STAGE_SELECT_FINAL_BLACK_HOLD_MS = 120;\r\nconst STAGE_PREVIEW_EXIT_MS = 260;\r\nconst TOUCH_SCROLL_DAMPING = 0.52;\r\n\r\nconst StageMapModal: React.FC<StageMapModalProps> = ({\r\n  isVisible,\r\n  mapImageUrl,\r\n  iconFansWhite,\r\n  iconIngressoWhite,\r\n  iconGainWhite,\r\n  iconCostWhite,\r\n  iconValorCacheTotal,\r\n  bandSlots = [],\r\n  bandTotalCache = 0,\r\n  emptyMusicianIcon,\r\n  onOpenBandManagement,\r\n  isBandQuickAccessVisible = true,\r\n  isBandQuickAccessHiding = false,\r\n  stages,\r\n  currentStageId,\r\n  isEmbedded = false,\r\n  introImageUrl,\r\n  bandName,\r\n  bandLogoUrl,\r\n  introPlayId,\r\n  resetViewToken,\r\n  onIntroVisibilityChange,\r\n  onPreviewStageBannerChange,\r\n  onStageTransitionStart,\r\n  onClose,\r\n  onSelectStage,\r\n}) => {\r\n  const initialScaleMultiplier = 1.4;\r\n  const mapImageRef = React.useRef<HTMLImageElement | null>(null);\r\n  const mapScrollRef = React.useRef<HTMLDivElement | null>(null);\r\n  const hasInitializedOpenViewRef = React.useRef(false);\r\n  const [imageSize, setImageSize] = React.useState({ width: 0, height: 0 });\r\n  const [mapScale, setMapScale] = React.useState(1);\r\n  const mapScaleRef = React.useRef(1);\r\n  const pinchStartDistanceRef = React.useRef<number | null>(null);\r\n  const pinchStartScaleRef = React.useRef(1);\r\n  const touchPanLastPointRef = React.useRef<{ x: number; y: number } | null>(null);\r\n  const [shouldRender, setShouldRender] = React.useState(isVisible);\r\n  const [isClosing, setIsClosing] = React.useState(false);\r\n  const [isStageTransitioning, setIsStageTransitioning] = React.useState(false);\r\n  const [transitionOverlayOpacity, setTransitionOverlayOpacity] = React.useState(0);\r\n  const [previewStage, setPreviewStage] = React.useState<StageMapEntry | null>(null);\r\n  const [isPreviewClosing, setIsPreviewClosing] = React.useState(false);\r\n  const [sofiaDialog, setSofiaDialog] = React.useState<{ message: string; confirmLabel: string } | null>(null);\r\n  const previewCloseTimeoutRef = React.useRef<number | null>(null);\r\n  const transitionFrameRef = React.useRef<number | null>(null);\r\n  const transitionTimeoutRef = React.useRef<number | null>(null);\r\n  const introHoldTimeoutRef = React.useRef<number | null>(null);\r\n  const introHideTimeoutRef = React.useRef<number | null>(null);\r\n  const lastIntroPlayIdRef = React.useRef<number | null>(null);\r\n  const [introPhase, setIntroPhase] = React.useState<'hidden' | 'show' | 'leaving'>(() =>\r\n    isVisible && introImageUrl && introPlayId && introPlayId > 0 ? 'show' : 'hidden',\r\n  );\r\n\r\n  const getClampedScrollPosition = React.useCallback((\r\n    scrollContainer: HTMLDivElement,\r\n    left: number,\r\n    top: number,\r\n    scale = mapScaleRef.current,\r\n  ) => {\r\n    const renderedWidth = imageSize.width > 0 ? imageSize.width * scale : scrollContainer.scrollWidth;\r\n    const renderedHeight = imageSize.height > 0 ? imageSize.height * scale : scrollContainer.scrollHeight;\r\n    const maxScrollLeft = Math.max(0, renderedWidth - scrollContainer.clientWidth);\r\n    const maxScrollTop = Math.max(0, renderedHeight - scrollContainer.clientHeight);\r\n\r\n    return {\r\n      left: Math.max(0, Math.min(maxScrollLeft, left)),\r\n      top: Math.max(0, Math.min(maxScrollTop, top)),\r\n    };\r\n  }, [imageSize]);\r\n\r\n  React.useEffect(() => {\r\n    mapScaleRef.current = mapScale;\r\n  }, [mapScale]);\r\n\r\n  React.useEffect(() => {\r\n    if (!isVisible) {\r\n      if (previewCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(previewCloseTimeoutRef.current);\r\n        previewCloseTimeoutRef.current = null;\r\n      }\r\n      setPreviewStage(null);\r\n      setIsPreviewClosing(false);\r\n    }\r\n  }, [isVisible]);\r\n\r\n  React.useEffect(() => {\r\n    onPreviewStageBannerChange?.(previewStage?.backgroundUrl ?? null);\r\n  }, [previewStage, onPreviewStageBannerChange]);\r\n\r\n  const closePreviewWithAnimation = React.useCallback(\r\n    (afterClose?: () => void) => {\r\n      if (!previewStage) {\r\n        return;\r\n      }\r\n\r\n      if (previewCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(previewCloseTimeoutRef.current);\r\n        previewCloseTimeoutRef.current = null;\r\n      }\r\n\r\n      setIsPreviewClosing(true);\r\n      previewCloseTimeoutRef.current = window.setTimeout(() => {\r\n        previewCloseTimeoutRef.current = null;\r\n        setPreviewStage(null);\r\n        setIsPreviewClosing(false);\r\n        afterClose?.();\r\n      }, STAGE_PREVIEW_EXIT_MS);\r\n    },\r\n    [previewStage]\r\n  );\r\n\r\n  const closeSofiaDialog = React.useCallback(() => {\r\n    setSofiaDialog(null);\r\n  }, []);\r\n\r\n  const allocatedMusiciansCount = React.useMemo(\r\n    () => bandSlots.filter((slot) => slot.hasMusician).length,\r\n    [bandSlots]\r\n  );\r\n\r\n  const getStageValidationMessage = React.useCallback((stage: StageMapEntry) => {\r\n    if (allocatedMusiciansCount <= 0) {\r\n      return 'A banda precisa ter pelo menos 1 músico alocado para poder ir para o palco.';\r\n    }\r\n\r\n    if (Math.max(0, bandTotalCache) > Math.max(0, stage.maxRevenue)) {\r\n      return 'O cachê total da banda está acima da receita máxima deste local. Ajuste os músicos para ficar dentro do valor do local.';\r\n    }\r\n\r\n    return null;\r\n  }, [allocatedMusiciansCount, bandTotalCache]);\r\n\r\n  const minScale = React.useMemo(() => {\r\n    if (imageSize.height <= 0 || imageSize.width <= 0 || !mapScrollRef.current) {\r\n      return 0.2;\r\n    }\r\n\r\n    const containerWidth = mapScrollRef.current.clientWidth;\r\n    const containerHeight = mapScrollRef.current.clientHeight;\r\n    if (!containerWidth || !containerHeight) {\r\n      return 0.2;\r\n    }\r\n\r\n    const fitHeightScale = containerHeight / imageSize.height;\r\n    const fitWidthScale = containerWidth / imageSize.width;\r\n    const coverScale = Math.max(fitHeightScale, fitWidthScale);\r\n\r\n    return Math.max(0.2, coverScale);\r\n  }, [imageSize]);\r\n\r\n  React.useLayoutEffect(() => {\r\n    setMapScale((current) => Math.max(minScale, Math.min(4, current)));\r\n  }, [minScale]);\r\n\r\n  const getTouchDistance = (touches: React.TouchList) => {\r\n    if (touches.length < 2) {\r\n      return null;\r\n    }\r\n\r\n    const first = touches[0];\r\n    const second = touches[1];\r\n    const dx = second.clientX - first.clientX;\r\n    const dy = second.clientY - first.clientY;\r\n    return Math.hypot(dx, dy);\r\n  };\r\n\r\n  const handleTouchStart = (event: React.TouchEvent<HTMLDivElement>) => {\r\n    if (event.touches.length === 1) {\r\n      const touch = event.touches[0];\r\n      touchPanLastPointRef.current = { x: touch.clientX, y: touch.clientY };\r\n    }\r\n\r\n    const distance = getTouchDistance(event.touches);\r\n    if (!distance) {\r\n      return;\r\n    }\r\n\r\n    pinchStartDistanceRef.current = distance;\r\n    pinchStartScaleRef.current = mapScale;\r\n  };\r\n\r\n  const handleTouchMove = (event: React.TouchEvent<HTMLDivElement>) => {\r\n    const scrollContainer = mapScrollRef.current;\r\n    if (event.touches.length === 1 && pinchStartDistanceRef.current === null && scrollContainer) {\r\n      const touch = event.touches[0];\r\n      const previousTouch = touchPanLastPointRef.current;\r\n      if (previousTouch) {\r\n        const deltaX = (touch.clientX - previousTouch.x) * TOUCH_SCROLL_DAMPING;\r\n        const deltaY = (touch.clientY - previousTouch.y) * TOUCH_SCROLL_DAMPING;\r\n\r\n        const targetLeft = scrollContainer.scrollLeft - deltaX;\r\n        const targetTop = scrollContainer.scrollTop - deltaY;\r\n        const clampedPosition = getClampedScrollPosition(scrollContainer, targetLeft, targetTop);\r\n\r\n        if (event.cancelable) {\r\n          event.preventDefault();\r\n        }\r\n        scrollContainer.scrollLeft = clampedPosition.left;\r\n        scrollContainer.scrollTop = clampedPosition.top;\r\n      }\r\n\r\n      touchPanLastPointRef.current = { x: touch.clientX, y: touch.clientY };\r\n      return;\r\n    }\r\n\r\n    const distance = getTouchDistance(event.touches);\r\n    const startDistance = pinchStartDistanceRef.current;\r\n    if (!distance || !startDistance) {\r\n      return;\r\n    }\r\n\r\n    if (event.cancelable) {\r\n      event.preventDefault();\r\n    }\r\n    const pinchRatio = distance / startDistance;\r\n    const nextScale = pinchStartScaleRef.current * pinchRatio;\r\n    setMapScale(Math.max(minScale, Math.min(4, nextScale)));\r\n  };\r\n\r\n  const handleTouchEnd = (event: React.TouchEvent<HTMLDivElement>) => {\r\n    if (event.touches.length === 0) {\r\n      touchPanLastPointRef.current = null;\r\n    }\r\n\r\n    if (event.touches.length < 2) {\r\n      pinchStartDistanceRef.current = null;\r\n      return;\r\n    }\r\n\r\n    const distance = getTouchDistance(event.touches);\r\n    if (!distance) {\r\n      return;\r\n    }\r\n\r\n    pinchStartDistanceRef.current = distance;\r\n    pinchStartScaleRef.current = mapScale;\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (isVisible) {\r\n      setShouldRender(true);\r\n      setIsClosing(false);\r\n      setIsStageTransitioning(false);\r\n      setTransitionOverlayOpacity(0);\r\n      hasInitializedOpenViewRef.current = false;\r\n      return;\r\n    }\r\n\r\n    if (!shouldRender) {\r\n      return;\r\n    }\r\n\r\n    setIsClosing(true);\r\n    const timeoutId = window.setTimeout(() => {\r\n      setShouldRender(false);\r\n      setIsClosing(false);\r\n    }, STAGE_MAP_CLOSE_FADE_MS);\r\n\r\n    return () => {\r\n      window.clearTimeout(timeoutId);\r\n    };\r\n  }, [isVisible, shouldRender]);\r\n\r\n  React.useEffect(() => {\r\n    const clearIntroTimers = () => {\r\n      if (introHoldTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHoldTimeoutRef.current);\r\n        introHoldTimeoutRef.current = null;\r\n      }\r\n      if (introHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHideTimeoutRef.current);\r\n        introHideTimeoutRef.current = null;\r\n      }\r\n    };\r\n\r\n    if (\r\n      isVisible &&\r\n      introImageUrl &&\r\n      introPlayId &&\r\n      introPlayId > 0 &&\r\n      introPlayId !== lastIntroPlayIdRef.current\r\n    ) {\r\n      lastIntroPlayIdRef.current = introPlayId;\r\n      clearIntroTimers();\r\n      setIntroPhase('show');\r\n      introHoldTimeoutRef.current = window.setTimeout(() => {\r\n        setIntroPhase('leaving');\r\n        introHideTimeoutRef.current = window.setTimeout(() => {\r\n          setIntroPhase('hidden');\r\n        }, 1000); // out animation\r\n      }, 2000); // steady hold after 1s in\r\n    } else {\r\n      clearIntroTimers();\r\n      setIntroPhase('hidden');\r\n    }\r\n  }, [isVisible, introImageUrl, introPlayId]);\r\n\r\n  React.useEffect(() => {\r\n    onIntroVisibilityChange?.(introPhase !== 'hidden');\r\n  }, [introPhase, onIntroVisibilityChange]);\r\n\r\n  React.useEffect(() => {\r\n    if (!isVisible || imageSize.width <= 0 || imageSize.height <= 0 || !mapScrollRef.current) {\r\n      return;\r\n    }\r\n\r\n    hasInitializedOpenViewRef.current = false;\r\n\r\n    const scrollContainer = mapScrollRef.current;\r\n    const defaultScale = Math.max(minScale, Math.min(4, minScale * initialScaleMultiplier));\r\n    setMapScale(defaultScale);\r\n\r\n    const renderedWidth = imageSize.width * defaultScale;\r\n    const renderedHeight = imageSize.height * defaultScale;\r\n    const defaultLeft = Math.max(0, (renderedWidth - scrollContainer.clientWidth) / 2);\r\n    const defaultTop = Math.max(0, (renderedHeight - scrollContainer.clientHeight) / 2);\r\n    const clampedPosition = getClampedScrollPosition(scrollContainer, defaultLeft, defaultTop, defaultScale);\r\n\r\n    scrollContainer.scrollTo({\r\n      left: clampedPosition.left,\r\n      top: clampedPosition.top,\r\n      behavior: 'auto',\r\n    });\r\n    touchPanLastPointRef.current = null;\r\n    pinchStartDistanceRef.current = null;\r\n    pinchStartScaleRef.current = defaultScale;\r\n  }, [resetViewToken, isVisible, imageSize, minScale, getClampedScrollPosition]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (transitionFrameRef.current !== null) {\r\n        window.cancelAnimationFrame(transitionFrameRef.current);\r\n      }\r\n      if (transitionTimeoutRef.current !== null) {\r\n        window.clearTimeout(transitionTimeoutRef.current);\r\n      }\r\n      if (previewCloseTimeoutRef.current !== null) {\r\n        window.clearTimeout(previewCloseTimeoutRef.current);\r\n      }\r\n      if (introHoldTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHoldTimeoutRef.current);\r\n      }\r\n      if (introHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(introHideTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (\r\n      !isVisible ||\r\n      !shouldRender ||\r\n      hasInitializedOpenViewRef.current ||\r\n      imageSize.width <= 0 ||\r\n      imageSize.height <= 0\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const scrollContainer = mapScrollRef.current;\r\n    if (!scrollContainer) {\r\n      return;\r\n    }\r\n\r\n    const defaultScale = Math.max(minScale, Math.min(4, minScale * initialScaleMultiplier));\r\n    const targetScale = defaultScale;\r\n\r\n    if (Math.abs(mapScale - targetScale) > 0.001) {\r\n      setMapScale(targetScale);\r\n      return;\r\n    }\r\n\r\n    const frameId = window.requestAnimationFrame(() => {\r\n      const renderedWidth = imageSize.width * mapScale;\r\n      const renderedHeight = imageSize.height * mapScale;\r\n\r\n      const defaultLeft = Math.max(0, (renderedWidth - scrollContainer.clientWidth) / 2);\r\n      const defaultTop = Math.max(0, (renderedHeight - scrollContainer.clientHeight) / 2);\r\n      const clampedPosition = getClampedScrollPosition(scrollContainer, defaultLeft, defaultTop);\r\n\r\n      scrollContainer.scrollTo({\r\n        left: clampedPosition.left,\r\n        top: clampedPosition.top,\r\n        behavior: 'auto',\r\n      });\r\n      hasInitializedOpenViewRef.current = true;\r\n    });\r\n\r\n    return () => {\r\n      window.cancelAnimationFrame(frameId);\r\n    };\r\n  }, [isVisible, shouldRender, imageSize, minScale, mapScale, getClampedScrollPosition]);\r\n\r\n  const handleMapScroll = (event: React.UIEvent<HTMLDivElement>) => {\r\n    if (isStageTransitioning) {\r\n      return;\r\n    }\r\n\r\n    const scrollContainer = event.currentTarget;\r\n    const clampedPosition = getClampedScrollPosition(scrollContainer, scrollContainer.scrollLeft, scrollContainer.scrollTop);\r\n\r\n    if (Math.abs(clampedPosition.left - scrollContainer.scrollLeft) > 0.5) {\r\n      scrollContainer.scrollLeft = clampedPosition.left;\r\n    }\r\n    if (Math.abs(clampedPosition.top - scrollContainer.scrollTop) > 0.5) {\r\n      scrollContainer.scrollTop = clampedPosition.top;\r\n    }\r\n\r\n  };\r\n\r\n  const handleCloseModal = React.useCallback(() => {\r\n    if (previewCloseTimeoutRef.current !== null) {\r\n      window.clearTimeout(previewCloseTimeoutRef.current);\r\n      previewCloseTimeoutRef.current = null;\r\n    }\r\n    setPreviewStage(null);\r\n    setIsPreviewClosing(false);\r\n    onClose();\r\n  }, [onClose]);\r\n\r\n  const handleSelectStageWithTransition = (stage: StageMapEntry) => {\r\n    if (isStageTransitioning) {\r\n      return;\r\n    }\r\n\r\n    const scrollContainer = mapScrollRef.current;\r\n    if (!scrollContainer || imageSize.width <= 0 || imageSize.height <= 0) {\r\n      onStageTransitionStart?.();\r\n      setIsPreviewClosing(false);\r\n      setPreviewStage(null);\r\n      onSelectStage(stage.id);\r\n      if (!isEmbedded) {\r\n        onClose();\r\n      }\r\n      setIsStageTransitioning(false);\r\n      setTransitionOverlayOpacity(0);\r\n      return;\r\n    }\r\n\r\n    if (transitionFrameRef.current !== null) {\r\n      window.cancelAnimationFrame(transitionFrameRef.current);\r\n      transitionFrameRef.current = null;\r\n    }\r\n    if (transitionTimeoutRef.current !== null) {\r\n      window.clearTimeout(transitionTimeoutRef.current);\r\n      transitionTimeoutRef.current = null;\r\n    }\r\n\r\n    onStageTransitionStart?.();\r\n    setIsStageTransitioning(true);\r\n    setTransitionOverlayOpacity(0);\r\n\r\n    const startScale = mapScale;\r\n    const startLeft = scrollContainer.scrollLeft;\r\n    const startTop = scrollContainer.scrollTop;\r\n    const targetScale = Math.max(minScale, Math.min(4, Math.max(mapScale * STAGE_SELECT_ZOOM_MULTIPLIER, minScale * 2.05)));\r\n\r\n    const targetPointX = (stage.x / 100) * imageSize.width * targetScale;\r\n    const targetPointY = (stage.y / 100) * imageSize.height * targetScale;\r\n    const requestedLeft = targetPointX - scrollContainer.clientWidth / 2;\r\n    const requestedTop = targetPointY - scrollContainer.clientHeight / 2;\r\n    const targetPosition = getClampedScrollPosition(scrollContainer, requestedLeft, requestedTop, targetScale);\r\n\r\n    const animationStart = performance.now();\r\n    const easeInOutCubic = (value: number) => (value < 0.5 ? 4 * value * value * value : 1 - Math.pow(-2 * value + 2, 3) / 2);\r\n\r\n    const animate = (now: number) => {\r\n      const elapsed = now - animationStart;\r\n      const progress = Math.min(1, elapsed / STAGE_SELECT_TRANSITION_MS);\r\n      const easedProgress = easeInOutCubic(progress);\r\n      const blackoutProgress = Math.max(0, (easedProgress - STAGE_BLACKOUT_START_PROGRESS) / (1 - STAGE_BLACKOUT_START_PROGRESS));\r\n\r\n      const nextScale = startScale + (targetScale - startScale) * easedProgress;\r\n      const nextLeft = startLeft + (targetPosition.left - startLeft) * easedProgress;\r\n      const nextTop = startTop + (targetPosition.top - startTop) * easedProgress;\r\n      const nextOverlayOpacity = Math.max(0, Math.min(1, blackoutProgress));\r\n\r\n      mapScaleRef.current = nextScale;\r\n      setMapScale(nextScale);\r\n      setTransitionOverlayOpacity(nextOverlayOpacity);\r\n      scrollContainer.scrollTo({\r\n        left: nextLeft,\r\n        top: nextTop,\r\n        behavior: 'auto',\r\n      });\r\n\r\n      if (progress < 1) {\r\n        transitionFrameRef.current = window.requestAnimationFrame(animate);\r\n        return;\r\n      }\r\n\r\n      transitionFrameRef.current = null;\r\n      setTransitionOverlayOpacity(1);\r\n      transitionTimeoutRef.current = window.setTimeout(() => {\r\n        setPreviewStage(null);\r\n        setIsPreviewClosing(false);\r\n        onSelectStage(stage.id);\r\n        if (!isEmbedded) {\r\n          onClose();\r\n        }\r\n        setIsStageTransitioning(false);\r\n        setTransitionOverlayOpacity(0);\r\n      }, STAGE_SELECT_FINAL_BLACK_HOLD_MS);\r\n    };\r\n\r\n    transitionFrameRef.current = window.requestAnimationFrame(animate);\r\n  };\r\n\r\n  const markersToRender = stages.map((stage) => ({\r\n    ...stage,\r\n    renderX: imageSize.width > 0 ? ((stage.x / 100) * imageSize.width) * mapScale : 0,\r\n    renderY: imageSize.height > 0 ? ((stage.y / 100) * imageSize.height) * mapScale : 0,\r\n  }));\r\n\r\n  const handleOpenBandFromMap = React.useCallback(() => {\r\n    onOpenBandManagement?.(null);\r\n  }, [onOpenBandManagement]);\r\n\r\n  const handleOpenBandFromPreview = React.useCallback(() => {\r\n    if (!previewStage) {\r\n      onOpenBandManagement?.(null);\r\n      return;\r\n    }\r\n\r\n    onOpenBandManagement?.({\r\n      name: previewStage.name,\r\n      maxRevenue: Math.max(0, previewStage.maxRevenue),\r\n    });\r\n  }, [onOpenBandManagement, previewStage]);\r\n\r\n  if (!shouldRender) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <aside\r\n      className={`stage-map-modal${introPhase !== 'hidden' ? ' has-intro' : ''}${isClosing ? ' is-closing' : ''}${isStageTransitioning ? ' is-stage-transitioning' : ''}${isEmbedded ? ' is-embedded' : ''}`}\r\n      role={isEmbedded ? undefined : 'dialog'}\r\n      aria-modal={isEmbedded ? undefined : true}\r\n      aria-label=\"Mapa da cidade\"\r\n    >\r\n      {!isEmbedded ? (\r\n        <button type=\"button\" className=\"stage-map-backdrop\" onClick={handleCloseModal} aria-label=\"Fechar mapa\" disabled={isStageTransitioning} />\r\n      ) : null}\r\n      <div className=\"stage-map-card\">\r\n        {introPhase !== 'hidden' && introImageUrl ? (\r\n          <div className={`stage-map-intro${introPhase === 'leaving' ? ' leaving' : ''}`} style={{ backgroundImage: `url(${introImageUrl})` }} aria-hidden=\"true\">\r\n            <div className=\"stage-map-intro-scrim\" />\r\n            <div className={`stage-map-intro-card${introPhase === 'leaving' ? ' leaving' : ''}`}>\r\n              {bandLogoUrl ? <img src={bandLogoUrl} alt=\"Logo da banda\" className=\"stage-map-intro-logo\" /> : null}\r\n              {bandName ? <strong className=\"stage-map-intro-name\">{bandName}</strong> : null}\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n        {!isEmbedded ? (\r\n          <button type=\"button\" className=\"stage-map-close\" onClick={handleCloseModal} aria-label=\"Fechar mapa\" disabled={isStageTransitioning}>\r\n            Fechar mapa\r\n          </button>\r\n        ) : null}\r\n        <div className=\"stage-map-transition-overlay\" style={{ opacity: transitionOverlayOpacity }} aria-hidden=\"true\" />\r\n\r\n        <div\r\n          ref={mapScrollRef}\r\n          className=\"stage-map-scroll\"\r\n          onScroll={handleMapScroll}\r\n          onTouchStart={handleTouchStart}\r\n          onTouchMove={handleTouchMove}\r\n          onTouchEnd={handleTouchEnd}\r\n          onTouchCancel={handleTouchEnd}\r\n        >\r\n          <div\r\n            className=\"stage-map-world\"\r\n            style={{\r\n              width: imageSize.width > 0 ? `${imageSize.width * mapScale}px` : 'max-content',\r\n              height: imageSize.height > 0 ? `${imageSize.height * mapScale}px` : 'auto',\r\n            }}\r\n          >\r\n            <img\r\n              ref={mapImageRef}\r\n              src={mapImageUrl}\r\n              alt=\"Mapa da cidade\"\r\n              className=\"stage-map-image\"\r\n              style={{\r\n                width: imageSize.width > 0 ? `${imageSize.width * mapScale}px` : 'auto',\r\n                height: imageSize.height > 0 ? `${imageSize.height * mapScale}px` : 'auto',\r\n              }}\r\n              onLoad={(event) => {\r\n                const image = event.currentTarget;\r\n                setImageSize({ width: image.naturalWidth, height: image.naturalHeight });\r\n              }}\r\n            />\r\n          {markersToRender.map((marker) => {\r\n            const isActive = marker.id === currentStageId;\r\n            return (\r\n              <button\r\n                key={marker.id}\r\n                type=\"button\"\r\n                className={`stage-map-point${isActive ? ' is-active' : ''}`}\r\n                style={{ left: `${marker.renderX}px`, top: `${marker.renderY}px` }}\r\n                onClick={(event) => {\r\n                  event.stopPropagation();\r\n                  if (previewCloseTimeoutRef.current !== null) {\r\n                    window.clearTimeout(previewCloseTimeoutRef.current);\r\n                    previewCloseTimeoutRef.current = null;\r\n                  }\r\n                  setIsPreviewClosing(false);\r\n                  setPreviewStage(marker);\r\n                }}\r\n                title={marker.name}\r\n                aria-label={`Ir para ${marker.name}`}\r\n                disabled={isStageTransitioning}\r\n              >\r\n                <img src={marker.badgeUrl} alt={marker.name} />\r\n                <span>{marker.name}</span>\r\n              </button>\r\n            );\r\n          })}\r\n          </div>\r\n        </div>\r\n        {onOpenBandManagement && isBandQuickAccessVisible ? (\r\n          <div className={`stage-map-band-quick-access${isBandQuickAccessHiding ? ' is-hiding' : ' map-ui-reveal'}`}>\r\n            <StageBandSlotsGroup\r\n              slots={bandSlots}\r\n              emptyMusicianIcon={emptyMusicianIcon}\r\n              className=\"is-clickable\"\r\n              onClick={handleOpenBandFromMap}\r\n              ariaLabel=\"Abrir edição da banda\"\r\n            />\r\n          </div>\r\n        ) : null}\r\n        {previewStage && !isStageTransitioning ? (\r\n          <div className={`stage-map-preview${isStageTransitioning ? ' is-transitioning' : ''}${isPreviewClosing ? ' is-closing' : ''}`}>\r\n            <div\r\n              className=\"stage-map-preview-card\"\r\n              style={(previewStage.backgroundUrl ?? previewStage.bannerUrl)\r\n                ? { backgroundImage: `linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.35) 60%), url(${previewStage.backgroundUrl ?? previewStage.bannerUrl})` }\r\n                : undefined}\r\n            >\r\n              <div className=\"stage-map-preview-top\">\r\n                <div className=\"stage-map-preview-identity\">\r\n                  {previewStage.badgeUrl ? (\r\n                    <div className=\"stage-map-preview-badge\" aria-hidden=\"true\">\r\n                      <img src={previewStage.badgeUrl} alt=\"\" />\r\n                    </div>\r\n                  ) : null}\r\n                  <div className=\"stage-map-preview-title\">\r\n                    <span>{previewStage.name}</span>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"stage-map-preview-close\"\r\n                  onClick={() => closePreviewWithAnimation()}\r\n                  aria-label=\"Fechar\"\r\n                  disabled={isStageTransitioning}\r\n                >\r\n                  <img src={iconFechar} alt=\"\" aria-hidden=\"true\" className=\"stage-map-preview-close-icon\" />\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"stage-map-preview-stats\">\r\n                <div className=\"stage-map-preview-band-row\">\r\n                  <StageVenueCacheCard\r\n                    maxRevenue={Math.max(0, previewStage.maxRevenue)}\r\n                    bandTotalCache={bandTotalCache}\r\n                    iconGainWhite={iconGainWhite}\r\n                    iconCostWhite={iconCostWhite}\r\n                    className=\"stage-map-preview-cache-meter\"\r\n                    showCenterGainBadge\r\n                    hideSideValues\r\n                  />\r\n\r\n                  <StageBandSlotsGroup\r\n                    slots={bandSlots}\r\n                    emptyMusicianIcon={emptyMusicianIcon}\r\n                    className={onOpenBandManagement ? 'is-clickable' : undefined}\r\n                    onClick={onOpenBandManagement ? handleOpenBandFromPreview : undefined}\r\n                    ariaLabel=\"Abrir edição da banda\"\r\n                  />\r\n                </div>\r\n                <div className=\"stage-map-preview-stat\">\r\n                  <img src={iconFansWhite} alt=\"Público\" className=\"stage-map-preview-stat-icon\" />\r\n                  <div>\r\n                    <span>Lotação</span>\r\n                    <strong>{previewStage.capacity.toLocaleString('pt-BR')}</strong>\r\n                  </div>\r\n                </div>\r\n                <div className=\"stage-map-preview-stat\">\r\n                  <img src={iconIngressoWhite} alt=\"Ingresso\" className=\"stage-map-preview-stat-icon\" />\r\n                  <div>\r\n                    <span>Ingresso</span>\r\n                    <strong>R$ {previewStage.ticketPrice.toLocaleString('pt-BR')}</strong>\r\n                  </div>\r\n                </div>\r\n                <div className=\"stage-map-preview-stat\">\r\n                  <img src={iconValorCacheTotal} alt=\"Receita\" className=\"stage-map-preview-stat-icon\" />\r\n                  <div>\r\n                    <span>Receita máx.</span>\r\n                    <strong>R$ {previewStage.maxRevenue.toLocaleString('pt-BR')}</strong>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"stage-map-preview-actions\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"stage-map-preview-go\"\r\n                  onClick={() => {\r\n                    if (!previewStage || isStageTransitioning) return;\r\n                    const stageToGo = previewStage;\r\n                    const validationMessage = getStageValidationMessage(stageToGo);\r\n                    if (validationMessage) {\r\n                      setSofiaDialog({ message: validationMessage, confirmLabel: 'Entendi' });\r\n                      return;\r\n                    }\r\n                    closePreviewWithAnimation(() => handleSelectStageWithTransition(stageToGo));\r\n                  }}\r\n                  disabled={isStageTransitioning}\r\n                  aria-label={`Ir para ${previewStage.name}`}\r\n                >\r\n                  Ir para o palco\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n        <StageSofiaDialog\r\n          isVisible={Boolean(sofiaDialog)}\r\n          message={sofiaDialog?.message ?? ''}\r\n          confirmLabel={sofiaDialog?.confirmLabel ?? 'Entendi'}\r\n          onConfirm={closeSofiaDialog}\r\n        />\r\n        </div>\r\n    </aside>\r\n  );\r\n};\r\n\r\nexport default StageMapModal;\r\n","import { useCallback, useEffect, useRef, useState, type MutableRefObject } from 'react';\r\nimport type { Instrument } from '../state/gameStore';\r\n\r\ntype ActiveScreen = 'band' | 'musicians';\r\n\r\ntype UseBandScreensStateOptions<TMusician> = {\r\n  musiciansModalCloseMs: number;\r\n  musicianDetailsCloseMs: number;\r\n  bandModalCloseMs: number;\r\n  bandConfigCloseMs: number;\r\n  onStoryToggleSound?: (isOpening: boolean) => void;\r\n};\r\n\r\nconst useBandScreensState = <TMusician,>({\r\n  musiciansModalCloseMs,\r\n  musicianDetailsCloseMs,\r\n  bandModalCloseMs,\r\n  bandConfigCloseMs,\r\n  onStoryToggleSound,\r\n}: UseBandScreensStateOptions<TMusician>) => {\r\n  const [activeScreen, setActiveScreen] = useState<ActiveScreen>('band');\r\n  const [isClosingMusiciansScreen, setIsClosingMusiciansScreen] = useState(false);\r\n  const [selectedMusicianDetails, setSelectedMusicianDetails] = useState<TMusician | null>(null);\r\n  const [isMusicianStoryOpen, setIsMusicianStoryOpen] = useState(false);\r\n  const [isClosingMusicianDetails, setIsClosingMusicianDetails] = useState(false);\r\n  const [isBandConfigOpen, setIsBandConfigOpen] = useState(false);\r\n  const [isClosingBandConfig, setIsClosingBandConfig] = useState(false);\r\n  const [isBandManagementOpen, setIsBandManagementOpen] = useState(false);\r\n  const [isClosingBandManagement, setIsClosingBandManagement] = useState(false);\r\n  const [activeBandSelectorInstrument, setActiveBandSelectorInstrument] = useState<Instrument | null>(null);\r\n\r\n  const musiciansCloseTimeoutRef = useRef<number | null>(null);\r\n  const musicianDetailsCloseTimeoutRef = useRef<number | null>(null);\r\n  const bandManagementCloseTimeoutRef = useRef<number | null>(null);\r\n  const bandConfigCloseTimeoutRef = useRef<number | null>(null);\r\n\r\n  const clearTimeoutRef = (timeoutRef: MutableRefObject<number | null>) => {\r\n    if (timeoutRef.current) {\r\n      window.clearTimeout(timeoutRef.current);\r\n      timeoutRef.current = null;\r\n    }\r\n  };\r\n\r\n  const openBandConfig = useCallback(() => {\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n    setIsClosingBandConfig(false);\r\n    setIsBandConfigOpen(true);\r\n  }, []);\r\n\r\n  const closeBandConfig = useCallback(() => {\r\n    if (!isBandConfigOpen) {\r\n      return;\r\n    }\r\n\r\n    setIsClosingBandConfig(true);\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n\r\n    bandConfigCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setIsBandConfigOpen(false);\r\n      setIsClosingBandConfig(false);\r\n      bandConfigCloseTimeoutRef.current = null;\r\n    }, bandConfigCloseMs);\r\n  }, [bandConfigCloseMs, isBandConfigOpen]);\r\n\r\n  const openBandManagementScreen = useCallback(() => {\r\n    clearTimeoutRef(musiciansCloseTimeoutRef);\r\n    clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n\r\n    setActiveScreen('band');\r\n    setIsClosingMusiciansScreen(false);\r\n    setIsBandConfigOpen(false);\r\n    setIsClosingBandConfig(false);\r\n    setIsClosingBandManagement(false);\r\n    setActiveBandSelectorInstrument(null);\r\n    setIsBandManagementOpen(true);\r\n  }, []);\r\n\r\n  const closeBandManagementScreen = useCallback(() => {\r\n    if (!isBandManagementOpen) {\r\n      return;\r\n    }\r\n\r\n    setIsClosingBandManagement(true);\r\n    clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n\r\n    bandManagementCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setIsBandManagementOpen(false);\r\n      setIsClosingBandManagement(false);\r\n      setActiveBandSelectorInstrument(null);\r\n      bandManagementCloseTimeoutRef.current = null;\r\n    }, bandModalCloseMs);\r\n  }, [bandModalCloseMs, isBandManagementOpen]);\r\n\r\n  const openMusiciansScreen = useCallback(() => {\r\n    clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n    clearTimeoutRef(musiciansCloseTimeoutRef);\r\n    clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n\r\n    setIsBandManagementOpen(false);\r\n    setIsClosingBandManagement(false);\r\n    setIsClosingMusiciansScreen(false);\r\n    setSelectedMusicianDetails(null);\r\n    setIsMusicianStoryOpen(false);\r\n    setIsClosingMusicianDetails(false);\r\n    setActiveBandSelectorInstrument(null);\r\n    setIsBandConfigOpen(false);\r\n    setIsClosingBandConfig(false);\r\n    setActiveScreen('musicians');\r\n  }, []);\r\n\r\n  const openMusicianDetails = useCallback((musician: TMusician) => {\r\n    clearTimeoutRef(musicianDetailsCloseTimeoutRef);\r\n    setIsClosingMusicianDetails(false);\r\n    setSelectedMusicianDetails(musician);\r\n    setIsMusicianStoryOpen(false);\r\n  }, []);\r\n\r\n  const closeMusicianDetails = useCallback(() => {\r\n    if (!selectedMusicianDetails) {\r\n      return;\r\n    }\r\n\r\n    setIsClosingMusicianDetails(true);\r\n    clearTimeoutRef(musicianDetailsCloseTimeoutRef);\r\n\r\n    musicianDetailsCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setSelectedMusicianDetails(null);\r\n      setIsMusicianStoryOpen(false);\r\n      setIsClosingMusicianDetails(false);\r\n      musicianDetailsCloseTimeoutRef.current = null;\r\n    }, musicianDetailsCloseMs);\r\n  }, [musicianDetailsCloseMs, selectedMusicianDetails]);\r\n\r\n  const closeMusiciansScreen = useCallback(() => {\r\n    if (activeScreen !== 'musicians') {\r\n      return;\r\n    }\r\n\r\n    setIsClosingMusiciansScreen(true);\r\n    clearTimeoutRef(musiciansCloseTimeoutRef);\r\n\r\n    musiciansCloseTimeoutRef.current = window.setTimeout(() => {\r\n      setActiveScreen('band');\r\n      setIsClosingMusiciansScreen(false);\r\n      setSelectedMusicianDetails(null);\r\n      setIsMusicianStoryOpen(false);\r\n      setIsClosingMusicianDetails(false);\r\n      musiciansCloseTimeoutRef.current = null;\r\n    }, musiciansModalCloseMs);\r\n  }, [activeScreen, musiciansModalCloseMs]);\r\n\r\n  const toggleMusicianStory = useCallback(() => {\r\n    setIsMusicianStoryOpen((current) => {\r\n      const next = !current;\r\n      if (onStoryToggleSound) {\r\n        onStoryToggleSound(next);\r\n      }\r\n      return next;\r\n    });\r\n  }, [onStoryToggleSound]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      clearTimeoutRef(musiciansCloseTimeoutRef);\r\n      clearTimeoutRef(musicianDetailsCloseTimeoutRef);\r\n      clearTimeoutRef(bandManagementCloseTimeoutRef);\r\n      clearTimeoutRef(bandConfigCloseTimeoutRef);\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    activeScreen,\r\n    isClosingMusiciansScreen,\r\n    selectedMusicianDetails,\r\n    isMusicianStoryOpen,\r\n    isClosingMusicianDetails,\r\n    isBandConfigOpen,\r\n    isClosingBandConfig,\r\n    isBandManagementOpen,\r\n    isClosingBandManagement,\r\n    activeBandSelectorInstrument,\r\n    setActiveBandSelectorInstrument,\r\n    setSelectedMusicianDetails,\r\n    openBandConfig,\r\n    closeBandConfig,\r\n    openBandManagementScreen,\r\n    closeBandManagementScreen,\r\n    openMusiciansScreen,\r\n    openMusicianDetails,\r\n    closeMusicianDetails,\r\n    closeMusiciansScreen,\r\n    toggleMusicianStory,\r\n  };\r\n};\r\n\r\nexport default useBandScreensState;\r\n","export const defaultStageBackground = new URL('../rsc/images/palcos/palco_garagem.png', import.meta.url).href;\r\nexport const defaultStageFloorTexture = new URL('../rsc/images/textura/3343397-madeira-textura-fundo-vetor.jpg', import.meta.url).href;\r\nexport const iconCache = new URL('../rsc/images/icons/cache_borda_brnca.png', import.meta.url).href;\r\nexport const iconCost = new URL('../rsc/images/icons/Custo_borda_branca.png', import.meta.url).href;\r\nexport const iconMoneyWhite = new URL('../rsc/images/icons/Dinheiro_Borda_branca.png', import.meta.url).href;\r\nexport const iconMoneyBlack = new URL('../rsc/images/icons/Dinheiro_borda_preta.png', import.meta.url).href;\r\nexport const iconFameWhite = new URL('../rsc/images/icons/fama_borda_branca.png', import.meta.url).href;\r\nexport const iconFameBlack = new URL('../rsc/images/icons/Fama_borda_preta.png', import.meta.url).href;\r\nexport const iconFansWhite = new URL('../rsc/images/icons/Fans_borda_branca.png', import.meta.url).href;\r\nexport const iconFansBlack = new URL('../rsc/images/icons/Fans_Borda_Preta.png', import.meta.url).href;\r\nexport const iconIngresso = new URL('../rsc/images/icons/Ingrresso.png', import.meta.url).href;\r\nexport const iconIngressoBranco = new URL('../rsc/images/icons/Icone_ingresso_branco.png', import.meta.url).href;\r\nexport const iconValorCacheTotal = new URL('../rsc/images/icons/valor_de_cache.png', import.meta.url).href;\r\nexport const iconMusicWhite = new URL('../rsc/images/icons/musica_branco.png', import.meta.url).href;\r\nexport const iconRhythmWhite = new URL('../rsc/images/icons/Ritmo_Borda_branca.png', import.meta.url).href;\r\nexport const navBand = new URL('../rsc/images/icons/banda.jpg', import.meta.url).href;\r\nexport const navHire = new URL('../rsc/images/icons/contratar.jpg', import.meta.url).href;\r\nexport const navStore = new URL('../rsc/images/icons/loja.jpg', import.meta.url).href;\r\nexport const navStage = new URL('../rsc/images/icons/palcos.jpg', import.meta.url).href;\r\nexport const navSongs = new URL('../rsc/images/icons/musicas.png', import.meta.url).href;\r\nexport const stageWorldMap = new URL('../rsc/images/maps/Mapa_Mundo.jpeg', import.meta.url).href;\r\nexport const stageWorldPreview = new URL('../rsc/images/maps/Preview_cidade.png', import.meta.url).href;\r\nexport const backgroundAudicao = new URL('../rsc/images/backgrounds/audicao.jpg', import.meta.url).href;\r\nexport const backgroundBackstage = new URL('../rsc/images/backgrounds/Backstage.jpg', import.meta.url).href;\r\nexport const portraitContratante = new URL('../rsc/images/facesets/velho_contratante_musicos.png', import.meta.url).href;\r\nexport const iconTodos = new URL('../rsc/images/icons/Icone_Todos.png', import.meta.url).href;\r\nexport const iconGuitarra = new URL('../rsc/images/icons/Icone_guitarra.png', import.meta.url).href;\r\nexport const iconBaixo = new URL('../rsc/images/icons/Icone_Baixo.png', import.meta.url).href;\r\nexport const iconBateria = new URL('../rsc/images/icons/Icone_Bateria.png', import.meta.url).href;\r\nexport const iconTeclado = new URL('../rsc/images/icons/Icone_Teclado.png', import.meta.url).href;\r\nexport const iconBandaMenu = new URL('../rsc/images/icons/Icone_Banda.png', import.meta.url).href;\r\nexport const iconEspeciaisMenu = new URL('../rsc/images/icons/Icone_Especiais.png', import.meta.url).href;\r\nexport const iconAnaliseMenu = new URL('../rsc/images/icons/icone_Analise.png', import.meta.url).href;\r\nexport const iconFechar = new URL('../rsc/images/icons/Icone_fechar.png', import.meta.url).href;\r\nexport const iconConfigBlack = new URL('../rsc/images/icons/Icone_config_preto.png', import.meta.url).href;\r\nexport const iconConfigWhite = new URL('../rsc/images/icons/Icone_config_branco.png', import.meta.url).href;\r\nexport const iconExitBand = new URL('../rsc/images/icons/Icone_Sair.png', import.meta.url).href;\r\nexport const iconBloqueado = new URL('../rsc/images/icons/Icone_bloquado.png', import.meta.url).href;\r\nexport const iconDisponivel = new URL('../rsc/images/icons/icone_disponivel.png', import.meta.url).href;\r\nexport const iconMusicoVazio = new URL('../rsc/images/icons/icone_musico.png', import.meta.url).href;\r\nexport const iconGuitarraVazia = new URL('../rsc/images/icons/Icone_guitarra_vazia.png', import.meta.url).href;\r\nexport const iconBaixoVazio = new URL('../rsc/images/icons/Icone_baixo_vazio.png', import.meta.url).href;\r\nexport const iconBateriaVazio = new URL('../rsc/images/icons/Icone_bateria_vazio.png', import.meta.url).href;\r\nexport const iconTecladoVazio = new URL('../rsc/images/icons/Icone_teclado_vazio.png', import.meta.url).href;\r\nexport const iconAudioOn = new URL('../rsc/images/icons/Icone_Audio_Ligado.png', import.meta.url).href;\r\nexport const iconCamera = new URL('../rsc/images/icons/Icone_camera.png', import.meta.url).href;\r\nexport const sfxMoneyReward = new URL('../rsc/audios/Dinheiro_Entrando_2.mp3', import.meta.url).href;\r\nexport const sfxCrowdApplause = new URL('../rsc/audios/Aplausos.mp3', import.meta.url).href;\r\nexport const sfxPurchased = new URL('../rsc/audios/Comprado.mp3', import.meta.url).href;\r\nexport const sfxStarReward = new URL('../rsc/audios/efeito_estrela.mp3', import.meta.url).href;\r\nexport const ambienceMapAudio = new URL('../rsc/audios/Ambience_Soud_Mapa.mp3', import.meta.url).href;\r\nexport const ambienceStageCrowdAudio = new URL('../rsc/audios/Ambiance_Pessoas_palco.mp3', import.meta.url).href;\r\n","import { iconAnaliseMenu, iconBaixo, iconBandaMenu, iconBateria, iconEspeciaisMenu, iconGuitarra, iconTeclado, iconTodos } from '../assets/bandGameAssets';\r\nimport type { Instrument } from '../state/gameStore';\r\nimport type { HireFilter } from '../types/bandGame.ts';\r\n\r\nexport const instrumentLabels: Record<Instrument, string> = {\r\n  guitar: 'Guitarra',\r\n  drums: 'Bateria',\r\n  bass: 'Baixo',\r\n  keys: 'Teclado',\r\n};\r\n\r\nexport const INITIAL_BPM = 220;\r\nexport const METRONOME_BEAT_MS = 60000 / INITIAL_BPM;\r\nexport const METRONOME_HIT_WINDOW_MS = METRONOME_BEAT_MS * 0.28;\r\nexport const RHYTHM_PLAY_THRESHOLD = 18;\r\nexport const SHOW_FAME_REWARD = 5;\r\nexport const FANS_GAIN_BASE_RATE = 0.05;\r\nexport const FANS_GAIN_MAX_RATE = 0.3;\r\nexport const FANS_GAIN_STEP_RATE = 0.05;\r\nexport const FANS_GAIN_STEP_MS = 20000;\r\nexport const DEFAULT_MUSIC_BPM = 120;\r\nexport const PRE_MUSIC_TAP_GAIN = 6.2;\r\nexport const PRE_MUSIC_DECAY = 0.9;\r\nexport const POST_MUSIC_DECAY = 1.3;\r\nexport const CROWD_DECAY_EVERY_STEPS = 1;\r\nexport const TAP_EFFECT_LIFETIME_MS = 140;\r\nexport const MAX_TAP_EFFECTS = 12;\r\nexport const MUSICIANS_MODAL_CLOSE_MS = 260;\r\nexport const MUSICIANS_DETAIL_CLOSE_MS = 220;\r\nexport const BAND_MODAL_CLOSE_MS = 240;\r\nexport const BAND_CONFIG_CLOSE_MS = 220;\r\nexport const MAP_RETURN_FADE_OUT_MS = 520;\r\nexport const MAP_RETURN_FADE_IN_MS = 420;\r\nexport const AMBIENCE_FADE_IN_MS = 900;\r\nexport const AMBIENCE_FADE_OUT_MS = 520;\r\nexport const STAGE_STEM_FADE_IN_MS = 700;\r\nexport const STAGE_STEM_FADE_OUT_MS = 420;\r\nexport const MAP_AMBIENCE_VOLUME = 0.04;\r\nexport const STAGE_AMBIENCE_VOLUME = 1.70;\r\n\r\nexport const instrumentById: Record<number, Instrument> = {\r\n  1: 'guitar',\r\n  2: 'bass',\r\n  3: 'drums',\r\n  4: 'keys',\r\n};\r\n\r\nexport const instrumentIconById: Record<number, string> = {\r\n  1: iconGuitarra,\r\n  2: iconBaixo,\r\n  3: iconBateria,\r\n  4: iconTeclado,\r\n};\r\n\r\nexport const instrumentNameById: Record<number, string> = {\r\n  1: 'Guitarra',\r\n  2: 'Baixo',\r\n  3: 'Bateria',\r\n  4: 'Teclado',\r\n};\r\n\r\nexport const instrumentPlaybackOrder: Instrument[] = ['drums', 'bass', 'guitar', 'keys'];\r\nexport const instrumentConfigOrder: Instrument[] = ['guitar', 'bass', 'drums', 'keys'];\r\nexport const instrumentIconByInstrument: Record<Instrument, string> = {\r\n  guitar: iconGuitarra,\r\n  drums: iconBateria,\r\n  bass: iconBaixo,\r\n  keys: iconTeclado,\r\n};\r\n\r\nexport const filterOptions: Array<{ id: HireFilter; label: string; icon: string }> = [\r\n  { id: 'all', label: 'Todos', icon: iconTodos },\r\n  { id: 'guitar', label: 'Guitarra', icon: iconGuitarra },\r\n  { id: 'bass', label: 'Baixo', icon: iconBaixo },\r\n  { id: 'drums', label: 'Bateria', icon: iconBateria },\r\n  { id: 'keys', label: 'Teclado', icon: iconTeclado },\r\n];\r\n\r\nexport const bandMenuOptions: Array<{ id: 'band' | 'specials' | 'analysis'; label: string; icon: string }> = [\r\n  { id: 'band', label: 'Banda', icon: iconBandaMenu },\r\n  { id: 'specials', label: 'Especiais', icon: iconEspeciaisMenu },\r\n  { id: 'analysis', label: 'Análise', icon: iconAnaliseMenu },\r\n];\r\n\r\nexport const stageMapPositionById: Record<number, { x: number; y: number }> = {\r\n  1: { x: 94.3, y: 82.27 },\r\n  2: { x: 22.81, y: 48.59 },\r\n  3: { x: 82.42, y: 59.61 },\r\n  4: { x: 46.56, y: 37.89 },\r\n  5: { x: 40.55, y: 52.11 },\r\n  6: { x: 75.08, y: 67.19 },\r\n  7: { x: 50.63, y: 71.88 },\r\n  8: { x: 59.3, y: 25.47 },\r\n  9: { x: 90.63, y: 30.86 },\r\n  10: { x: 49.84, y: 8.28 },\r\n};\r\n\r\nexport const getRhythmTone = (value: number) => {\r\n  if (value <= 15) {\r\n    return '#e13d35';\r\n  }\r\n  if (value <= 30) {\r\n    return '#ec8a2f';\r\n  }\r\n  if (value <= 50) {\r\n    return '#e7d34b';\r\n  }\r\n  if (value <= 75) {\r\n    return '#94e062';\r\n  }\r\n  return '#39c453';\r\n};\r\n\r\nexport const getRarity = (level: number) => {\r\n  if (level >= 3) {\r\n    return { label: 'Ouro', className: 'gold' as const };\r\n  }\r\n\r\n  if (level === 2) {\r\n    return { label: 'Prata', className: 'silver' as const };\r\n  }\r\n\r\n  return { label: 'Bronze', className: 'bronze' as const };\r\n};\r\n","export default \"__VITE_ASSET__CMRGMaOA__\"","export default \"__VITE_ASSET__DCRl27l___\"","export default \"__VITE_ASSET__BqIUf39S__\"","export default \"__VITE_ASSET__Cq_XVXU8__\"","export default \"__VITE_ASSET__Cni4HOSU__\"","export default \"__VITE_ASSET__Cv8hN5FR__\"","export default \"__VITE_ASSET__Y$5qmUhO__\"","export default \"__VITE_ASSET__CU53hyal__\"","export default \"__VITE_ASSET__7CxkXbu0__\"","export default \"__VITE_ASSET__w1nMzC7H__\"","export default \"__VITE_ASSET__CMzk59fj__\"","export default \"__VITE_ASSET__CaOz8BjV__\"","export default \"__VITE_ASSET__BJCM6Rql__\"","export default \"__VITE_ASSET__C7mUOnJF__\"","export default \"__VITE_ASSET__sVVvGHk7__\"","export default \"__VITE_ASSET__C3qIHsST__\"","export default \"__VITE_ASSET___efjDLCT__\"","export default \"__VITE_ASSET__C756J1OD__\"","export default \"__VITE_ASSET__2AelYROg__\"","export default \"__VITE_ASSET__BC5tcVY5__\"","export default \"__VITE_ASSET__CXgU3HsR__\"","export default \"__VITE_ASSET__BCC9EG6s__\"","export default \"__VITE_ASSET__DWbwp$Go__\"","export default \"__VITE_ASSET__CR_ohV98__\"","export default \"__VITE_ASSET__CSLnFAEy__\"","export default \"__VITE_ASSET__CpqiVIgp__\"","export default \"__VITE_ASSET__Bu4PUo$b__\"","export default \"__VITE_ASSET__oJNwHflO__\"","export default \"__VITE_ASSET__CJJvjDSM__\"","export default \"__VITE_ASSET__dctE0HMS__\"","export default \"__VITE_ASSET__lBVBiJ86__\"","export default \"__VITE_ASSET__B621p8Fn__\"","export default \"__VITE_ASSET__BhhO8YWV__\"","export default \"__VITE_ASSET__CVWGLKyJ__\"","export default \"__VITE_ASSET__Bui4yiLO__\"","export default \"__VITE_ASSET__Bgw6Xvxb__\"","export default \"__VITE_ASSET__B2Q3UZQI__\"","export default \"__VITE_ASSET__B2owDi3V__\"","export default \"__VITE_ASSET__BYTIyEu4__\"","export default \"__VITE_ASSET__DcbKch3p__\"","export default \"__VITE_ASSET__DbOgxMki__\"","export default \"__VITE_ASSET__Bp_kUgwP__\"","export default \"__VITE_ASSET__BzvfMTyy__\"","export default \"__VITE_ASSET__DfW19FGt__\"","export default \"__VITE_ASSET__DvRj7Jnm__\"","export default \"__VITE_ASSET__QmOWa5N9__\"","export default \"__VITE_ASSET__CErM0wHU__\"","export default \"__VITE_ASSET__07nf4Tmj__\"","export default \"__VITE_ASSET__CLnwY0lj__\"","export default \"__VITE_ASSET__CDmjKpwD__\"","export default \"__VITE_ASSET__Bh0XvO6X__\"","export default \"__VITE_ASSET__C9sCJ7Jk__\"","export default \"__VITE_ASSET__DmBu$lBs__\"","export default \"__VITE_ASSET__C_8pi9Q8__\"","export default \"__VITE_ASSET__iTbD2AZ$__\"","export default \"__VITE_ASSET__CTjgd9PD__\"","export default \"__VITE_ASSET__Zu0CPBt6__\"","export default \"__VITE_ASSET__D4emD9Us__\"","export default \"__VITE_ASSET__B9jUX0YK__\"","export default \"__VITE_ASSET__DCtxs4sl__\"","export default \"__VITE_ASSET__Be6tXjGB__\"","export default \"__VITE_ASSET__DtGNK5x5__\"","export default \"__VITE_ASSET__ldK0Uu_R__\"","export default \"__VITE_ASSET__CJNQZaKt__\"","export default \"__VITE_ASSET__Dc8Iv_of__\"","export default \"__VITE_ASSET__BrihPwup__\"","export default \"__VITE_ASSET__DWr8wLzD__\"","export default \"__VITE_ASSET__DQ5qrn0o__\"","export default \"__VITE_ASSET__BQeam8NP__\"","export default \"__VITE_ASSET__CEEYWRX8__\"","export default \"__VITE_ASSET__DUclY5v7__\"","export default \"__VITE_ASSET__DdxJiBhV__\"","export default \"__VITE_ASSET__DUnNBJvm__\"","export default \"__VITE_ASSET__DMTZTm6t__\"","export default \"__VITE_ASSET__CP0Xv6xR__\"","export default \"__VITE_ASSET__lFUQ2oQE__\"","export default \"__VITE_ASSET__D$4_mzuD__\"","export default \"__VITE_ASSET__C$XP5jgr__\"","export default \"__VITE_ASSET__sa2SNJ2f__\"","export default \"__VITE_ASSET__C4cW1Lj___\"","export default \"__VITE_ASSET__Q3kb3Tc7__\"","export default \"__VITE_ASSET__BAGgNNWs__\"","export default \"__VITE_ASSET__DDQdi6M3__\"","export default \"__VITE_ASSET__Crfki0Bp__\"","import { defaultStageBackground, navStage } from '../assets/bandGameAssets';\r\n\r\nconst stageImageAssetMap = import.meta.glob('../rsc/images/palcos/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst stageMapBadgeAssetMap = import.meta.glob('../rsc/images/maps/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst stageVideoAssetMap = import.meta.glob('../rsc/videos/palcos/*.{mp4,webm}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst musicStreamAssetMap = import.meta.glob('../rsc/musics/**/*.mp3', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst musicianFaceAssetMap = import.meta.glob('../rsc/images/facesets/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nconst musicianPortraitAssetMap = import.meta.glob('../rsc/images/portraits/*.{png,jpg,jpeg,webp}', {\r\n  eager: true,\r\n  query: '?url',\r\n  import: 'default',\r\n}) as Record<string, string>;\r\n\r\nexport const resolveStageAsset = (assetPath: string) => {\r\n  if (!assetPath || !assetPath.startsWith('src/')) {\r\n    return defaultStageBackground;\r\n  }\r\n\r\n  const viteAssetPath = `../${assetPath.replace(/^src\\//, '')}`;\r\n  return stageImageAssetMap[viteAssetPath] ?? defaultStageBackground;\r\n};\r\n\r\nexport const resolveStageAnimatedAsset = (animatedPath: string) => {\r\n  if (!animatedPath || !animatedPath.startsWith('src/')) {\r\n    return null;\r\n  }\r\n\r\n  const viteAssetPath = `../${animatedPath.replace(/^src\\//, '')}`;\r\n  return stageVideoAssetMap[viteAssetPath] ?? null;\r\n};\r\n\r\nexport const resolveStageMapBadgeAsset = (badgePath: string) => {\r\n  if (!badgePath || !badgePath.startsWith('src/')) {\r\n    return navStage;\r\n  }\r\n\r\n  const viteAssetPath = `../${badgePath.replace(/^src\\//, '')}`;\r\n  return stageMapBadgeAssetMap[viteAssetPath] ?? navStage;\r\n};\r\n\r\nexport const resolveMusicStreamAsset = (streamPath: string) => {\r\n  if (!streamPath || !streamPath.startsWith('src/')) {\r\n    return null;\r\n  }\r\n\r\n  const viteAssetPath = `../${streamPath.replace(/^src\\//, '')}`;\r\n  return musicStreamAssetMap[viteAssetPath] ?? null;\r\n};\r\n\r\nexport const resolveMusicianFaceAsset = (faceAsset: string) => {\r\n  if (!faceAsset) {\r\n    return null;\r\n  }\r\n\r\n  if (faceAsset.startsWith('src/')) {\r\n    const viteAssetPath = `../${faceAsset.replace(/^src\\//, '')}`;\r\n    return musicianFaceAssetMap[viteAssetPath] ?? null;\r\n  }\r\n\r\n  const directFacePath = `../rsc/images/facesets/${faceAsset}`;\r\n  if (musicianFaceAssetMap[directFacePath]) {\r\n    return musicianFaceAssetMap[directFacePath];\r\n  }\r\n\r\n  const legacyFaceMatch = faceAsset.match(/^Face_(\\d+)$/i);\r\n  if (legacyFaceMatch) {\r\n    const parsedFaceNumber = Number.parseInt(legacyFaceMatch[1], 10);\r\n    if (Number.isFinite(parsedFaceNumber) && parsedFaceNumber > 0) {\r\n      const migratedFacePath = `../rsc/images/facesets/Faceset_${parsedFaceNumber}.png`;\r\n      return musicianFaceAssetMap[migratedFacePath] ?? null;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const resolveMusicianPortraitAsset = (portraitAsset: string) => {\r\n  if (!portraitAsset) {\r\n    return null;\r\n  }\r\n\r\n  if (portraitAsset.startsWith('src/')) {\r\n    const viteAssetPath = `../${portraitAsset.replace(/^src\\//, '')}`;\r\n    return musicianPortraitAssetMap[viteAssetPath] ?? null;\r\n  }\r\n\r\n  const directPortraitPath = `../rsc/images/portraits/${portraitAsset}`;\r\n  return musicianPortraitAssetMap[directPortraitPath] ?? null;\r\n};\r\n","import { useMemo } from 'react';\r\nimport palcosData from '../locals/palcos.json';\r\nimport musicsData from '../locals/musics.json';\r\nimport musicosData from '../locals/musicos.json';\r\nimport { instrumentLabels, instrumentById, instrumentIconById, instrumentNameById, instrumentPlaybackOrder, instrumentConfigOrder, instrumentIconByInstrument, stageMapPositionById, getRarity } from '../constants/bandGame';\r\nimport type { Band, Instrument } from '../state/gameStore';\r\nimport type { HireFilter, MusicData, MusicianData, StageData, StagePerformerInstrument } from '../types/bandGame';\r\nimport { resolveMusicStreamAsset, resolveMusicianFaceAsset, resolveMusicianPortraitAsset, resolveStageAnimatedAsset, resolveStageAsset, resolveStageMapBadgeAsset } from '../utils/assetResolvers';\r\nimport { iconBaixoVazio, iconBateriaVazio, iconGuitarraVazia, iconTecladoVazio, iconTodos } from '../assets/bandGameAssets';\r\n\r\nexport type UseBandGameComputedParams = {\r\n  bands: Band[];\r\n  activeBandId: string | null;\r\n  currentStageId: number;\r\n  hireFilter: HireFilter;\r\n  instrumentVolumes: Record<Instrument, number>;\r\n  activeBandSelectorInstrument: Instrument | null;\r\n  selectedMusicianDetails: MusicianData | null;\r\n};\r\n\r\nexport const useBandGameComputed = ({\r\n  bands,\r\n  activeBandId,\r\n  currentStageId,\r\n  hireFilter,\r\n  instrumentVolumes,\r\n  activeBandSelectorInstrument,\r\n  selectedMusicianDetails,\r\n}: UseBandGameComputedParams) => {\r\n  const availableMusics = useMemo(() => musicsData.musicas as MusicData[], []);\r\n  const musicians = useMemo(() => musicosData.musicos as MusicianData[], []);\r\n  const stages = useMemo(() => palcosData.palcos as StageData[], []);\r\n\r\n  const selectedMusic = useMemo(\r\n    () => availableMusics.find((music) => music.id === 'blues_na_garagem') ?? availableMusics[0] ?? null,\r\n    [availableMusics]\r\n  );\r\n\r\n  const activeBand = useMemo(\r\n    () => bands.find((band) => band.id === activeBandId) ?? null,\r\n    [bands, activeBandId]\r\n  );\r\n\r\n  const activeBandMusicians = useMemo(() => {\r\n    if (!activeBand) {\r\n      return [] as MusicianData[];\r\n    }\r\n\r\n    return Object.values(activeBand.musicians)\r\n      .filter((slot) => slot.hired && slot.musicianId !== null)\r\n      .map((slot) => musicians.find((musician) => musician.ID === slot.musicianId))\r\n      .filter((musician): musician is MusicianData => musician !== undefined);\r\n  }, [activeBand, musicians]);\r\n\r\n  const bandHypeValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Hype, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const bandFansValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Fans, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const bandPerformanceValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Apresentacao, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const bandCacheValue = useMemo(\r\n    () => activeBandMusicians.reduce((total, musician) => total + musician.Cache, 0),\r\n    [activeBandMusicians]\r\n  );\r\n\r\n  const selectedStage = useMemo(\r\n    () => stages.find((stage) => stage.IDPalco === currentStageId) ?? stages.find((stage) => stage.IDPalco === 1) ?? stages[0],\r\n    [currentStageId, stages]\r\n  );\r\n\r\n  const stageMapEntries = useMemo(\r\n    () => stages.map((stage) => {\r\n      const position = stageMapPositionById[stage.IDPalco] ?? { x: 50, y: 50 };\r\n      return {\r\n        id: stage.IDPalco,\r\n        name: stage.Palco,\r\n        badgeUrl: resolveStageMapBadgeAsset(stage.map_badge ?? ''),\r\n        bannerUrl: resolveStageAsset(stage.asset_horizontal ?? stage.Asset ?? ''),\r\n        backgroundUrl: resolveStageAsset(stage.Asset ?? stage.asset_horizontal ?? ''),\r\n        ticketPrice: Math.max(0, stage.Ingresso),\r\n        capacity: Math.max(0, stage.Lotacao),\r\n        maxRevenue: Math.max(0, stage.Ingresso * stage.Lotacao),\r\n        x: position.x,\r\n        y: position.y,\r\n      };\r\n    }),\r\n    [stages]\r\n  );\r\n\r\n  const stageBackground = useMemo(\r\n    () => resolveStageAsset(selectedStage?.Asset ?? ''),\r\n    [selectedStage]\r\n  );\r\n\r\n  const stage3DBackground = useMemo(\r\n    () => resolveStageAsset(selectedStage?.asset_parallax ?? selectedStage?.asset_horizontal ?? selectedStage?.Asset ?? ''),\r\n    [selectedStage]\r\n  );\r\n\r\n  const selectedStageBadge = useMemo(\r\n    () => resolveStageMapBadgeAsset(selectedStage?.map_badge ?? ''),\r\n    [selectedStage]\r\n  );\r\n\r\n  const stageAnimatedBackground = useMemo(\r\n    () => (selectedStage?.asset_parallax || selectedStage?.asset_horizontal\r\n      ? null\r\n      : resolveStageAnimatedAsset(selectedStage?.animated ?? '')),\r\n    [selectedStage]\r\n  );\r\n\r\n  const filteredMusicians = useMemo(() => {\r\n    if (hireFilter === 'all') {\r\n      return musicians;\r\n    }\r\n\r\n    return musicians.filter((musician) => instrumentById[musician.Instrumento] === hireFilter);\r\n  }, [musicians, hireFilter]);\r\n\r\n  const listedMusicians = useMemo(() => {\r\n    return [...filteredMusicians].sort((left, right) => {\r\n      const leftInstrument = instrumentById[left.Instrumento];\r\n      const rightInstrument = instrumentById[right.Instrumento];\r\n      const leftSlot = leftInstrument ? activeBand?.musicians[leftInstrument] : null;\r\n      const rightSlot = rightInstrument ? activeBand?.musicians[rightInstrument] : null;\r\n      const leftHired = Boolean(leftSlot?.hired && leftSlot.musicianId === left.ID);\r\n      const rightHired = Boolean(rightSlot?.hired && rightSlot.musicianId === right.ID);\r\n\r\n      if (leftHired === rightHired) {\r\n        return left.ID - right.ID;\r\n      }\r\n\r\n      return leftHired ? -1 : 1;\r\n    });\r\n  }, [filteredMusicians, activeBand]);\r\n\r\n  const availableBandCoins = activeBand?.coins ?? 0;\r\n  const selectedMusicianPrice = selectedMusicianDetails?.Custo ?? 0;\r\n\r\n  const selectedInstrument = selectedMusicianDetails\r\n    ? instrumentById[selectedMusicianDetails.Instrumento]\r\n    : null;\r\n\r\n  const unlockedMusicianIdSet = useMemo(() => {\r\n    if (!activeBand) {\r\n      return new Set<number>();\r\n    }\r\n\r\n    const persistedIds = activeBand.unlockedMusicianIds ?? [];\r\n    const equippedIds = Object.values(activeBand.musicians)\r\n      .map((slot) => slot.musicianId)\r\n      .filter((id): id is number => id !== null);\r\n\r\n    return new Set<number>([...persistedIds, ...equippedIds]);\r\n  }, [activeBand]);\r\n\r\n  const isSelectedMusicianHired = Boolean(\r\n    selectedMusicianDetails\r\n      && unlockedMusicianIdSet.has(selectedMusicianDetails.ID)\r\n  );\r\n\r\n  const hasEnoughCoinsForSelected = selectedMusicianPrice > 0 && availableBandCoins >= selectedMusicianPrice;\r\n\r\n  const canHireSelectedMusician = Boolean(\r\n    selectedInstrument\r\n      && activeBand\r\n      && !isSelectedMusicianHired\r\n      && hasEnoughCoinsForSelected\r\n  );\r\n\r\n  const isSelectedMusicianLockedByCoins = !isSelectedMusicianHired && !hasEnoughCoinsForSelected;\r\n\r\n  const selectedMusicianRarityClass = selectedMusicianDetails\r\n    ? getRarity(selectedMusicianDetails.Nivel).className\r\n    : null;\r\n  const selectedMusicianFace = selectedMusicianDetails\r\n    ? resolveMusicianFaceAsset(selectedMusicianDetails.Asset_Face)\r\n    : null;\r\n  const selectedMusicianPortrait = selectedMusicianDetails\r\n    ? resolveMusicianPortraitAsset(selectedMusicianDetails.Asset_Portrait ?? '')\r\n    : null;\r\n  const selectedMusicianInitials = selectedMusicianDetails\r\n    ? selectedMusicianDetails.Instrumentista\r\n      .split(' ')\r\n      .slice(0, 2)\r\n      .map((part) => part[0]?.toUpperCase() ?? '')\r\n      .join('')\r\n    : '';\r\n  const selectedMusicianInstrumentIcon = selectedMusicianDetails\r\n    ? instrumentIconById[selectedMusicianDetails.Instrumento] ?? iconTodos\r\n    : iconTodos;\r\n\r\n  const listedMusicianItems = useMemo(() => {\r\n    return listedMusicians.map((musician) => {\r\n      const rarity = getRarity(musician.Nivel);\r\n      const instrument = instrumentById[musician.Instrumento];\r\n      const isMusicianHired = unlockedMusicianIdSet.has(musician.ID);\r\n      const isLockedByCoins = !isMusicianHired && availableBandCoins < musician.Custo;\r\n      const instrumentIcon = instrumentIconById[musician.Instrumento] ?? iconTodos;\r\n      const initials = musician.Instrumentista\r\n        .split(' ')\r\n        .slice(0, 2)\r\n        .map((part) => part[0]?.toUpperCase() ?? '')\r\n        .join('');\r\n\r\n      return {\r\n        musician,\r\n        rarityClass: rarity.className,\r\n        rarityLabel: rarity.label,\r\n        instrumentIcon,\r\n        isMusicianHired,\r\n        isLockedByCoins,\r\n        musicianFaceSrc: resolveMusicianFaceAsset(musician.Asset_Face),\r\n        initials,\r\n      };\r\n    });\r\n  }, [listedMusicians, availableBandCoins, unlockedMusicianIdSet]);\r\n\r\n  const availableToHireCount = useMemo(() => {\r\n    return musicians.filter((musician) => {\r\n      if (unlockedMusicianIdSet.has(musician.ID)) {\r\n        return false;\r\n      }\r\n\r\n      return availableBandCoins >= musician.Custo;\r\n    }).length;\r\n  }, [musicians, unlockedMusicianIdSet, availableBandCoins]);\r\n\r\n  const selectedMusicStems = useMemo(() => {\r\n    return {\r\n      guitar: resolveMusicStreamAsset(selectedMusic?.eletricguitar ?? ''),\r\n      bass: resolveMusicStreamAsset(selectedMusic?.bass ?? ''),\r\n      drums: resolveMusicStreamAsset(selectedMusic?.drums ?? ''),\r\n      keys: resolveMusicStreamAsset(selectedMusic?.keys ?? ''),\r\n    } as Record<Instrument, string | null>;\r\n  }, [selectedMusic]);\r\n\r\n  const activeBandInstruments = useMemo(() => {\r\n    if (!activeBand) {\r\n      return [] as Instrument[];\r\n    }\r\n\r\n    return instrumentPlaybackOrder.filter((instrument) => {\r\n      const slot = activeBand.musicians[instrument];\r\n      return slot.hired && slot.musicianId !== null;\r\n    });\r\n  }, [\r\n    activeBand?.musicians.guitar.hired,\r\n    activeBand?.musicians.guitar.musicianId,\r\n    activeBand?.musicians.bass.hired,\r\n    activeBand?.musicians.bass.musicianId,\r\n    activeBand?.musicians.drums.hired,\r\n    activeBand?.musicians.drums.musicianId,\r\n    activeBand?.musicians.keys.hired,\r\n    activeBand?.musicians.keys.musicianId,\r\n  ]);\r\n\r\n  const instrumentVolumeControls = useMemo(() => {\r\n    return instrumentConfigOrder.map((instrument) => ({\r\n      instrument,\r\n      label: instrumentLabels[instrument],\r\n      icon: instrumentIconByInstrument[instrument],\r\n      value: instrumentVolumes[instrument] ?? 1,\r\n    }));\r\n  }, [instrumentVolumes]);\r\n\r\n  const guitarMusician = musicians.find((item) => item.ID === activeBand?.musicians.guitar.musicianId);\r\n  const bassMusician = musicians.find((item) => item.ID === activeBand?.musicians.bass.musicianId);\r\n  const drumsMusician = musicians.find((item) => item.ID === activeBand?.musicians.drums.musicianId);\r\n  const keysMusician = musicians.find((item) => item.ID === activeBand?.musicians.keys.musicianId);\r\n\r\n  const bandInstrumentColumns = [\r\n    {\r\n      id: 'guitar' as const,\r\n      label: 'Guitarra',\r\n      icon: instrumentIconByInstrument.guitar,\r\n      emptyInstrumentIcon: iconGuitarraVazia,\r\n      musicianId: guitarMusician?.ID ?? null,\r\n      musicianName: guitarMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: guitarMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(guitarMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.guitar.hired),\r\n      rarityClass: activeBand?.musicians.guitar.hired\r\n        ? getRarity(guitarMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n    {\r\n      id: 'bass' as const,\r\n      label: 'Baixo',\r\n      icon: instrumentIconByInstrument.bass,\r\n      emptyInstrumentIcon: iconBaixoVazio,\r\n      musicianId: bassMusician?.ID ?? null,\r\n      musicianName: bassMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: bassMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(bassMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.bass.hired),\r\n      rarityClass: activeBand?.musicians.bass.hired\r\n        ? getRarity(bassMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n    {\r\n      id: 'drums' as const,\r\n      label: 'Bateria',\r\n      icon: instrumentIconByInstrument.drums,\r\n      emptyInstrumentIcon: iconBateriaVazio,\r\n      musicianId: drumsMusician?.ID ?? null,\r\n      musicianName: drumsMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: drumsMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(drumsMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.drums.hired),\r\n      rarityClass: activeBand?.musicians.drums.hired\r\n        ? getRarity(drumsMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n    {\r\n      id: 'keys' as const,\r\n      label: 'Teclado',\r\n      icon: instrumentIconByInstrument.keys,\r\n      emptyInstrumentIcon: iconTecladoVazio,\r\n      musicianId: keysMusician?.ID ?? null,\r\n      musicianName: keysMusician?.Instrumentista ?? 'Selecionar',\r\n      musicianFirstName: keysMusician?.Instrumentista?.split(' ')[0] ?? 'Selecionar',\r\n      musicianFace: resolveMusicianFaceAsset(keysMusician?.Asset_Face ?? ''),\r\n      hasMusician: Boolean(activeBand?.musicians.keys.hired),\r\n      rarityClass: activeBand?.musicians.keys.hired\r\n        ? getRarity(keysMusician?.Nivel ?? 1).className\r\n        : null,\r\n    },\r\n  ];\r\n\r\n  const selectorMusicians = useMemo(() => {\r\n    if (!activeBandSelectorInstrument) {\r\n      return [] as Array<{\r\n        id: number;\r\n        name: string;\r\n        firstName: string;\r\n        face: string | null;\r\n        portrait: string | null;\r\n        rarityClass: 'bronze' | 'silver' | 'gold';\r\n        rarityLabel: string;\r\n        hype: number;\r\n        fans: number;\r\n        performance: number;\r\n        cache: number;\r\n      }>;\r\n    }\r\n\r\n    return musicians\r\n      .filter((musician) => instrumentById[musician.Instrumento] === activeBandSelectorInstrument)\r\n      .filter((musician) => unlockedMusicianIdSet.has(musician.ID))\r\n      .map((musician) => {\r\n        const rarity = getRarity(musician.Nivel);\r\n        return {\r\n          id: musician.ID,\r\n          name: musician.Instrumentista,\r\n          firstName: musician.Instrumentista.split(' ')[0] ?? 'Músico',\r\n          face: resolveMusicianFaceAsset(musician.Asset_Face),\r\n          portrait: resolveMusicianPortraitAsset(musician.Asset_Portrait ?? ''),\r\n          rarityClass: rarity.className,\r\n          rarityLabel: rarity.label,\r\n          hype: musician.Hype,\r\n          fans: musician.Fans,\r\n          performance: musician.Apresentacao,\r\n          cache: musician.Cache,\r\n        };\r\n      });\r\n  }, [activeBandSelectorInstrument, musicians, unlockedMusicianIdSet]);\r\n\r\n  const selectedSelectorMusicianId = activeBandSelectorInstrument\r\n    ? activeBand?.musicians[activeBandSelectorInstrument].musicianId ?? null\r\n    : null;\r\n\r\n  const stageBandPerformers = useMemo(() => {\r\n    const performerEntries = [\r\n      {\r\n        instrument: 'drums' as const,\r\n        musician: drumsMusician,\r\n        isHired: Boolean(activeBand?.musicians.drums.hired),\r\n      },\r\n      {\r\n        instrument: 'guitar' as const,\r\n        musician: guitarMusician,\r\n        isHired: Boolean(activeBand?.musicians.guitar.hired),\r\n      },\r\n      {\r\n        instrument: 'bass' as const,\r\n        musician: bassMusician,\r\n        isHired: Boolean(activeBand?.musicians.bass.hired),\r\n      },\r\n      {\r\n        instrument: 'keys' as const,\r\n        musician: keysMusician,\r\n        isHired: Boolean(activeBand?.musicians.keys.hired),\r\n      },\r\n    ];\r\n\r\n    return performerEntries\r\n      .map((entry) => {\r\n        if (!entry.isHired || !entry.musician) {\r\n          return null;\r\n        }\r\n\r\n        const portraitSrc = resolveMusicianPortraitAsset(entry.musician.Asset_Portrait ?? '');\r\n        if (!portraitSrc) {\r\n          return null;\r\n        }\r\n\r\n        return {\r\n          instrument: entry.instrument,\r\n          id: entry.musician.ID,\r\n          name: entry.musician.Instrumentista,\r\n          portraitSrc,\r\n        };\r\n      })\r\n      .filter((entry): entry is { instrument: Instrument; id: number; name: string; portraitSrc: string } => Boolean(entry));\r\n  }, [\r\n    activeBand?.musicians.bass.hired,\r\n    activeBand?.musicians.drums.hired,\r\n    activeBand?.musicians.guitar.hired,\r\n    activeBand?.musicians.keys.hired,\r\n    bassMusician,\r\n    drumsMusician,\r\n    guitarMusician,\r\n    keysMusician,\r\n  ]);\r\n\r\n  const stage3DActiveMusicians = useMemo(\r\n    () => stageBandPerformers.map((performer) => ({\r\n      instrument: performer.instrument as StagePerformerInstrument,\r\n      id: performer.id,\r\n      portraitSrc: performer.portraitSrc,\r\n    })),\r\n    [stageBandPerformers]\r\n  );\r\n\r\n  const stage3DActiveMusiciansSignature = useMemo(\r\n    () => stage3DActiveMusicians\r\n      .map((performer) => `${performer.instrument}:${performer.id}:${performer.portraitSrc}`)\r\n      .join('|'),\r\n    [stage3DActiveMusicians]\r\n  );\r\n\r\n  return {\r\n    stages,\r\n    availableMusics,\r\n    musicians,\r\n    selectedMusic,\r\n    activeBand,\r\n    activeBandMusicians,\r\n    bandHypeValue,\r\n    bandFansValue,\r\n    bandPerformanceValue,\r\n    bandCacheValue,\r\n    selectedStage,\r\n    stageMapEntries,\r\n    stageBackground,\r\n    stage3DBackground,\r\n    selectedStageBadge,\r\n    stageAnimatedBackground,\r\n    filteredMusicians,\r\n    listedMusicians,\r\n    availableBandCoins,\r\n    selectedInstrument,\r\n    unlockedMusicianIdSet,\r\n    isSelectedMusicianHired,\r\n    hasEnoughCoinsForSelected,\r\n    canHireSelectedMusician,\r\n    isSelectedMusicianLockedByCoins,\r\n    selectedMusicianRarityClass,\r\n    selectedMusicianFace,\r\n    selectedMusicianPortrait,\r\n    selectedMusicianInitials,\r\n    selectedMusicianInstrumentIcon,\r\n    selectedMusicianPrice,\r\n    listedMusicianItems,\r\n    availableToHireCount,\r\n    selectedMusicStems,\r\n    activeBandInstruments,\r\n    instrumentVolumeControls,\r\n    bandInstrumentColumns,\r\n    selectorMusicians,\r\n    selectedSelectorMusicianId,\r\n    stageBandPerformers,\r\n    stage3DActiveMusicians,\r\n    stage3DActiveMusiciansSignature,\r\n  };\r\n};\r\n","import React, { useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\r\nimport { Howl, Howler } from 'howler';\r\nimport { useGameStore, type Instrument } from '../state/gameStore';\r\nimport BandConfigModal from './band/BandConfigModal';\r\nimport BandManagementScreen from './band/BandManagementScreen';\r\nimport MusiciansContractScreen from './musicians/MusiciansContractScreen';\r\nimport StageTopValuesBar from './stage/StageTopValuesBar';\r\nimport StageBottomNav from './stage/StageBottomNav';\r\nimport StageProgressList from './stage/StageProgressList';\r\nimport StageCenterPanel from './stage/StageCenterPanel';\r\nimport StageCurrentSongBar from './stage/StageCurrentSongBar';\r\nimport StageVisualEffectsLayer from './stage/StageVisualEffectsLayer';\r\nimport Stage3DScene from './stage/Stage3DScene';\r\nimport StageMapModal from './stage/StageMapModal';\r\nimport useBandScreensState from '../hooks/useBandScreensState';\r\nimport { playUiClickSound } from '../utils/clickAudio';\r\nimport { pauseThemeMusic, playThemeMusic } from '../utils/themeAudio';\r\nimport { useBandGameComputed } from '../hooks/useBandGameComputed';\r\nimport { resolveStageAsset, resolveStageMapBadgeAsset } from '../utils/assetResolvers';\r\nimport {\r\n  AMBIENCE_FADE_IN_MS,\r\n  AMBIENCE_FADE_OUT_MS,\r\n  BAND_CONFIG_CLOSE_MS,\r\n  BAND_MODAL_CLOSE_MS,\r\n  CROWD_DECAY_EVERY_STEPS,\r\n  DEFAULT_MUSIC_BPM,\r\n  FANS_GAIN_BASE_RATE,\r\n  FANS_GAIN_MAX_RATE,\r\n  FANS_GAIN_STEP_MS,\r\n  FANS_GAIN_STEP_RATE,\r\n  MAP_AMBIENCE_VOLUME,\r\n  MAP_RETURN_FADE_IN_MS,\r\n  MAP_RETURN_FADE_OUT_MS,\r\n  MAX_TAP_EFFECTS,\r\n  MUSICIANS_DETAIL_CLOSE_MS,\r\n  MUSICIANS_MODAL_CLOSE_MS,\r\n  POST_MUSIC_DECAY,\r\n  PRE_MUSIC_DECAY,\r\n  PRE_MUSIC_TAP_GAIN,\r\n  RHYTHM_PLAY_THRESHOLD,\r\n  SHOW_FAME_REWARD,\r\n  STAGE_AMBIENCE_VOLUME,\r\n  STAGE_STEM_FADE_IN_MS,\r\n  STAGE_STEM_FADE_OUT_MS,\r\n  TAP_EFFECT_LIFETIME_MS,\r\n  instrumentPlaybackOrder,\r\n  bandMenuOptions,\r\n  instrumentLabels,\r\n  filterOptions,\r\n  instrumentNameById,\r\n  getRhythmTone,\r\n} from '../constants/bandGame';\r\nimport {\r\n  ambienceMapAudio,\r\n  ambienceStageCrowdAudio,\r\n  backgroundAudicao,\r\n  backgroundBackstage,\r\n  defaultStageFloorTexture,\r\n  iconAudioOn,\r\n  iconCamera,\r\n  iconBloqueado,\r\n  iconCache,\r\n  iconConfigBlack,\r\n  iconConfigWhite,\r\n  iconCost,\r\n  iconDisponivel,\r\n  iconExitBand,\r\n  iconFameBlack,\r\n  iconFameWhite,\r\n  iconFansBlack,\r\n  iconFansWhite,\r\n  iconFechar,\r\n  iconIngresso,\r\n  iconIngressoBranco,\r\n  iconMoneyBlack,\r\n  iconMoneyWhite,\r\n  iconMusicWhite,\r\n  iconRhythmWhite,\r\n  iconValorCacheTotal,\r\n  iconMusicoVazio,\r\n  navBand,\r\n  navHire,\r\n  navSongs,\r\n  navStage,\r\n  navStore,\r\n  portraitContratante,\r\n  sfxCrowdApplause,\r\n  sfxMoneyReward,\r\n  sfxPurchased,\r\n  sfxStarReward,\r\n  stageWorldMap,\r\n  stageWorldPreview,\r\n} from '../assets/bandGameAssets';\r\nimport type { BandMenuView, HireFilter, MusicianData } from '../types/bandGame';\r\n\r\ntype BandGameProps = {\r\n  onBackToMenu: () => void;\r\n};\r\n\r\ntype RewardParticle = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  x: number;\r\n  y: number;\r\n  dx: number;\r\n  dy: number;\r\n  delay: number;\r\n  duration: number;\r\n};\r\n\r\ntype RewardFloatText = {\r\n  id: number;\r\n  kind: 'fans' | 'money' | 'fame';\r\n  value: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\nconst formatCurrency = (value: number) =>\r\n  value.toLocaleString('pt-BR', {\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2,\r\n  });\r\n\r\nconst formatNumber = (value: number) => value.toLocaleString('pt-BR');\r\n\r\nconst formatPerformancePercent = (value: number) => {\r\n  const normalized = value <= 10 ? value * 10 : value;\r\n  const clamped = Math.max(0, Math.min(100, normalized));\r\n  return `+${Math.round(clamped)}%`;\r\n};\r\n\r\nconst getHowlCurrentTime = (audio: Howl | null) => {\r\n  if (!audio) {\r\n    return 0;\r\n  }\r\n\r\n  const seekValue = audio.seek();\r\n  if (typeof seekValue !== 'number' || !Number.isFinite(seekValue)) {\r\n    return 0;\r\n  }\r\n\r\n  return Math.max(0, seekValue);\r\n};\r\n\r\nconst isAudioActuallyPlaying = (audio: Howl | null) =>\r\n  Boolean(audio && audio.playing() && getHowlCurrentTime(audio) > 0);\r\n\r\n\r\nconst BandGame: React.FC<BandGameProps> = ({ onBackToMenu }) => {\r\n  const bands = useGameStore((state) => state.bands);\r\n  const activeBandId = useGameStore((state) => state.activeBandId);\r\n  const currentStageId = useGameStore((state) => state.currentStageId);\r\n  const setCurrentStage = useGameStore((state) => state.setCurrentStage);\r\n  const applyShowRewards = useGameStore((state) => state.applyShowRewards);\r\n  const addFameStars = useGameStore((state) => state.addFameStars);\r\n  const hireMusician = useGameStore((state) => state.hireMusician);\r\n  const setBandMusicianSelection = useGameStore((state) => state.setBandMusicianSelection);\r\n  const showPerformance = useGameStore((state) => state.showPerformance);\r\n  const score = useGameStore((state) => state.score);\r\n  const isMusicEnabled = useGameStore((state) => state.audioSettings.musicEnabled);\r\n  const isSfxEnabled = useGameStore((state) => state.audioSettings.sfxEnabled);\r\n  const instrumentVolumes = useGameStore((state) => state.audioSettings.instrumentVolumes);\r\n  const isCameraMotionEnabled = useGameStore((state) => state.cameraMotionEnabled);\r\n  const setMusicEnabled = useGameStore((state) => state.setMusicEnabled);\r\n  const setSfxEnabled = useGameStore((state) => state.setSfxEnabled);\r\n  const setCameraMotionEnabled = useGameStore((state) => state.setCameraMotionEnabled);\r\n  const setInstrumentVolume = useGameStore((state) => state.setInstrumentVolume);\r\n  const [hireFilter, setHireFilter] = useState<HireFilter>('all');\r\n  const [rhythmMeter, setRhythmMeter] = useState(0);\r\n  const [showCrowd, setShowCrowd] = useState(0);\r\n  const [sessionNetGain, setSessionNetGain] = useState(0);\r\n  const [isMusicPlaying, setIsMusicPlaying] = useState(false);\r\n  const [fansGainRate, setFansGainRate] = useState(0);\r\n  const [musicStreakMs, setMusicStreakMs] = useState(0);\r\n  const [fansStepFlash, setFansStepFlash] = useState(false);\r\n  const [rhythmBonus, setRhythmBonus] = useState(1);\r\n  const [bonusFlash, setBonusFlash] = useState(false);\r\n  const [metronomeTick, setMetronomeTick] = useState(false);\r\n  const [beatHitFeedback, setBeatHitFeedback] = useState(false);\r\n  const [songDurationSec, setSongDurationSec] = useState(0);\r\n  const [songCurrentSec, setSongCurrentSec] = useState(0);\r\n  const lastPulseAtRef = useRef<number | null>(null);\r\n  const metronomeStartAtRef = useRef(Date.now());\r\n  const garageAudioRef = useRef<Howl | null>(null);\r\n  const stageStemAudiosRef = useRef<Partial<Record<Instrument, Howl>>>({});\r\n  const stagePlaybackSecRef = useRef(0);\r\n  const stageStemFadeTimeoutsRef = useRef<Partial<Record<Instrument, number>>>({});\r\n  const isMusicPlayingRef = useRef(false);\r\n  const rhythmStreakRef = useRef(0);\r\n  const rhythmBonusRef = useRef(1);\r\n  const bonusFlashTimeoutRef = useRef<number | null>(null);\r\n  const metronomeFlashTimeoutRef = useRef<number | null>(null);\r\n  const metronomeAnimationFrameRef = useRef<number | null>(null);\r\n  const metronomeBeatIndexRef = useRef(-1);\r\n  const beatHitTimeoutRef = useRef<number | null>(null);\r\n  const loopTransitionTimeoutRef = useRef<number | null>(null);\r\n  const stagePlayPendingRef = useRef(false);\r\n  const rhythmMeterRef = useRef(0);\r\n  const hasActiveMusiciansRef = useRef(false);\r\n  const stageVideoRef = useRef<HTMLVideoElement | null>(null);\r\n  const stageRef = useRef<HTMLElement | null>(null);\r\n  const topFansRef = useRef<HTMLDivElement | null>(null);\r\n  const topMoneyRef = useRef<HTMLDivElement | null>(null);\r\n  const topFameRef = useRef<HTMLDivElement | null>(null);\r\n  const fameTrackRef = useRef<HTMLDivElement | null>(null);\r\n  const crowdTrackRef = useRef<HTMLDivElement | null>(null);\r\n  const gainMeterRef = useRef<HTMLDivElement | null>(null);\r\n  const centerPanelRef = useRef<HTMLDivElement | null>(null);\r\n  const currentSongBarRef = useRef<HTMLDivElement | null>(null);\r\n  const fansGainTrackRef = useRef<HTMLDivElement | null>(null);\r\n  const tapEffectIdRef = useRef(0);\r\n  const rewardAnimationIdRef = useRef(0);\r\n  const soldOutHandledRef = useRef(false);\r\n  const fameProgressRef = useRef(0);\r\n  const crowdDecayStepRef = useRef(0);\r\n  const crowdDecayAmountRef = useRef(0);\r\n  const fansStepIndexRef = useRef(0);\r\n  const fansStepFlashTimeoutRef = useRef<number | null>(null);\r\n  const mapReturnTransitionTimeoutRef = useRef<number | null>(null);\r\n  const [tapEffects, setTapEffects] = useState<Array<{ id: number; x: number; y: number }>>([]);\r\n  const [rewardParticles, setRewardParticles] = useState<RewardParticle[]>([]);\r\n  const [rewardTexts, setRewardTexts] = useState<RewardFloatText[]>([]);\r\n  const [isLoopTransitioning, setIsLoopTransitioning] = useState(false);\r\n  const [isStageShowActive, setIsStageShowActive] = useState(false);\r\n  const [isSideMenuHiding, setIsSideMenuHiding] = useState(false);\r\n  const [shouldRenderSideMenu, setShouldRenderSideMenu] = useState(true);\r\n  const [mapIntroPlayId, setMapIntroPlayId] = useState(0);\r\n  const [mapUiRevealId, setMapUiRevealId] = useState(0);\r\n  const [isMapIntroVisible, setIsMapIntroVisible] = useState(false);\r\n  const [mapPreviewBannerUrl, setMapPreviewBannerUrl] = useState<string | null>(null);\r\n  const [mapReturnTransitionPhase, setMapReturnTransitionPhase] = useState<'idle' | 'to-black' | 'from-black'>('idle');\r\n  const [bandManagementVenueContext, setBandManagementVenueContext] = useState<{ name: string; maxRevenue: number } | null>(null);\r\n  const [bandMenuView, setBandMenuView] = useState<BandMenuView>('band');\r\n  const [fameProgressValue, setFameProgressValue] = useState(0);\r\n  const [famePulseTick, setFamePulseTick] = useState(0);\r\n  const prevActiveScreenRef = useRef<'band' | 'musicians'>('band');\r\n  const prevActiveBandIdRef = useRef<string | null>(activeBandId ?? null);\r\n  const hasInitialMapIntroPlayedRef = useRef(false);\r\n  const prevIntroVisibleRef = useRef(false);\r\n  const sideMenuHideTimeoutRef = useRef<number | null>(null);\r\n  const moneyRewardHowlRef = useRef<Howl | null>(null);\r\n  const applauseHowlRef = useRef<Howl | null>(null);\r\n  const purchaseHowlRef = useRef<Howl | null>(null);\r\n  const starRewardHowlRef = useRef<Howl | null>(null);\r\n  const mapAmbienceHowlRef = useRef<Howl | null>(null);\r\n  const stageAmbienceHowlRef = useRef<Howl | null>(null);\r\n  const mapAmbienceFadeTimeoutRef = useRef<number | null>(null);\r\n  const stageAmbienceFadeTimeoutRef = useRef<number | null>(null);\r\n  const {\r\n    activeScreen,\r\n    isClosingMusiciansScreen,\r\n    selectedMusicianDetails,\r\n    isMusicianStoryOpen,\r\n    isClosingMusicianDetails,\r\n    isBandConfigOpen,\r\n    isClosingBandConfig,\r\n    isBandManagementOpen,\r\n    isClosingBandManagement,\r\n    activeBandSelectorInstrument,\r\n    setActiveBandSelectorInstrument,\r\n    openBandConfig,\r\n    closeBandConfig,\r\n    openBandManagementScreen,\r\n    closeBandManagementScreen,\r\n    openMusiciansScreen,\r\n    openMusicianDetails,\r\n    closeMusicianDetails,\r\n    closeMusiciansScreen,\r\n    toggleMusicianStory,\r\n  } = useBandScreensState<MusicianData>({\r\n    musiciansModalCloseMs: MUSICIANS_MODAL_CLOSE_MS,\r\n    musicianDetailsCloseMs: MUSICIANS_DETAIL_CLOSE_MS,\r\n    bandModalCloseMs: BAND_MODAL_CLOSE_MS,\r\n    bandConfigCloseMs: BAND_CONFIG_CLOSE_MS,\r\n    onStoryToggleSound: (isOpening) => {\r\n      playUiClickSound(isOpening ? 'open' : 'close');\r\n    },\r\n  });\r\n\r\n  const {\r\n    stages,\r\n    selectedMusic,\r\n    activeBand,\r\n    activeBandMusicians,\r\n    bandHypeValue,\r\n    bandFansValue,\r\n    bandPerformanceValue,\r\n    bandCacheValue,\r\n    selectedStage,\r\n    stageMapEntries,\r\n    stageBackground,\r\n    stage3DBackground,\r\n    selectedStageBadge,\r\n    stageAnimatedBackground,\r\n    listedMusicians,\r\n    availableBandCoins,\r\n    selectedInstrument,\r\n    unlockedMusicianIdSet,\r\n    isSelectedMusicianHired,\r\n    hasEnoughCoinsForSelected,\r\n    canHireSelectedMusician,\r\n    isSelectedMusicianLockedByCoins,\r\n    selectedMusicianRarityClass,\r\n    selectedMusicianFace,\r\n    selectedMusicianPortrait,\r\n    selectedMusicianInitials,\r\n    selectedMusicianInstrumentIcon,\r\n    selectedMusicianPrice,\r\n    listedMusicianItems,\r\n    availableToHireCount,\r\n    selectedMusicStems,\r\n    activeBandInstruments,\r\n    instrumentVolumeControls,\r\n    bandInstrumentColumns,\r\n    selectorMusicians,\r\n    selectedSelectorMusicianId,\r\n    stage3DActiveMusicians,\r\n    stage3DActiveMusiciansSignature,\r\n  } = useBandGameComputed({\r\n    bands,\r\n    activeBandId,\r\n    currentStageId,\r\n    hireFilter,\r\n    instrumentVolumes,\r\n    activeBandSelectorInstrument,\r\n    selectedMusicianDetails,\r\n  });\r\n\r\n  const hasActiveMusicians = activeBandMusicians.length > 0;\r\n  const isMusiciansScreenVisible = activeScreen === 'musicians' || isClosingMusiciansScreen;\r\n  const isBandManagementScreenVisible = isBandManagementOpen || isClosingBandManagement;\r\n  const isBandConfigVisible = isBandConfigOpen || isClosingBandConfig;\r\n  const activeBandInstrumentsKey = activeBandInstruments.join('|');\r\n  const bandManagementBackgroundImage = !isStageShowActive && mapPreviewBannerUrl ? mapPreviewBannerUrl : backgroundBackstage;\r\n  const openBandManagementWithContext = React.useCallback((stageContext?: { name: string; maxRevenue: number } | null) => {\r\n    setBandManagementVenueContext(stageContext ?? null);\r\n    openBandManagementScreen();\r\n  }, [openBandManagementScreen]);\r\n  const stageBandSlots = useMemo(\r\n    () => bandInstrumentColumns.map((column) => ({\r\n      id: column.id,\r\n      instrumentLabel: column.label,\r\n      instrumentIcon: column.icon,\r\n      musicianFace: column.musicianFace,\r\n      hasMusician: column.hasMusician,\r\n      rarityClass: column.rarityClass,\r\n    })),\r\n    [bandInstrumentColumns]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const shouldPlayMapTheme = isMusicEnabled && !isStageShowActive && mapReturnTransitionPhase !== 'to-black';\r\n\r\n    if (!shouldPlayMapTheme) {\r\n      pauseThemeMusic('map');\r\n      return;\r\n    }\r\n\r\n    playThemeMusic('map');\r\n  }, [isMusicEnabled, isStageShowActive, mapReturnTransitionPhase]);\r\n\r\n  const getStageAudios = () =>\r\n    Object.values(stageStemAudiosRef.current).filter((audio): audio is Howl => Boolean(audio));\r\n\r\n  const clearStageStemFadeTimeout = (instrument: Instrument) => {\r\n    const timeoutId = stageStemFadeTimeoutsRef.current[instrument];\r\n    if (timeoutId) {\r\n      window.clearTimeout(timeoutId);\r\n      delete stageStemFadeTimeoutsRef.current[instrument];\r\n    }\r\n  };\r\n\r\n  const pauseStageAudios = () => {\r\n    stagePlayPendingRef.current = false;\r\n    isMusicPlayingRef.current = false;\r\n\r\n    const stageAudios = getStageAudios();\r\n    if (stageAudios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const primaryAudio = garageAudioRef.current ?? stageAudios[0];\r\n    stagePlaybackSecRef.current = getHowlCurrentTime(primaryAudio);\r\n\r\n    instrumentPlaybackOrder.forEach((instrument) => {\r\n      const audio = stageStemAudiosRef.current[instrument];\r\n      if (!audio) {\r\n        return;\r\n      }\r\n\r\n      clearStageStemFadeTimeout(instrument);\r\n\r\n      if (!audio.playing()) {\r\n        audio.volume(0);\r\n        return;\r\n      }\r\n\r\n      const currentVolume = Number(audio.volume()) || 0;\r\n      audio.fade(currentVolume, 0, STAGE_STEM_FADE_OUT_MS);\r\n      stageStemFadeTimeoutsRef.current[instrument] = window.setTimeout(() => {\r\n        if (audio.playing()) {\r\n          audio.pause();\r\n        }\r\n        audio.volume(0);\r\n        delete stageStemFadeTimeoutsRef.current[instrument];\r\n      }, STAGE_STEM_FADE_OUT_MS + 40);\r\n    });\r\n  };\r\n\r\n  const clearAmbienceFadeTimeout = (timeoutRef: React.MutableRefObject<number | null>) => {\r\n    if (timeoutRef.current) {\r\n      window.clearTimeout(timeoutRef.current);\r\n      timeoutRef.current = null;\r\n    }\r\n  };\r\n\r\n  const playAmbienceWithFade = (\r\n    ambienceHowl: Howl | null,\r\n    targetVolume: number,\r\n    fadeTimeoutRef: React.MutableRefObject<number | null>\r\n  ) => {\r\n    if (!ambienceHowl) {\r\n      return;\r\n    }\r\n\r\n    clearAmbienceFadeTimeout(fadeTimeoutRef);\r\n\r\n    if (!ambienceHowl.playing()) {\r\n      ambienceHowl.volume(0);\r\n      ambienceHowl.play();\r\n    }\r\n\r\n    const currentVolume = Number(ambienceHowl.volume()) || 0;\r\n    if (currentVolume >= targetVolume) {\r\n      ambienceHowl.volume(targetVolume);\r\n      return;\r\n    }\r\n\r\n    ambienceHowl.fade(currentVolume, targetVolume, AMBIENCE_FADE_IN_MS);\r\n  };\r\n\r\n  const stopAmbienceWithFade = (\r\n    ambienceHowl: Howl | null,\r\n    fadeTimeoutRef: React.MutableRefObject<number | null>\r\n  ) => {\r\n    if (!ambienceHowl) {\r\n      return;\r\n    }\r\n\r\n    clearAmbienceFadeTimeout(fadeTimeoutRef);\r\n\r\n    if (!ambienceHowl.playing()) {\r\n      ambienceHowl.stop();\r\n      ambienceHowl.seek(0);\r\n      ambienceHowl.volume(0);\r\n      return;\r\n    }\r\n\r\n    const currentVolume = Number(ambienceHowl.volume()) || 0;\r\n    ambienceHowl.fade(currentVolume, 0, AMBIENCE_FADE_OUT_MS);\r\n    fadeTimeoutRef.current = window.setTimeout(() => {\r\n      ambienceHowl.stop();\r\n      ambienceHowl.seek(0);\r\n      ambienceHowl.volume(0);\r\n      fadeTimeoutRef.current = null;\r\n    }, AMBIENCE_FADE_OUT_MS + 60);\r\n  };\r\n\r\n  const attemptStageAudioPlay = () => {\r\n    const stageAudios = getStageAudios();\r\n    if (stageAudios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const stageAudio = garageAudioRef.current ?? stageAudios[0];\r\n    garageAudioRef.current = stageAudio;\r\n\r\n    if (!hasActiveMusiciansRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (rhythmMeterRef.current <= RHYTHM_PLAY_THRESHOLD) {\r\n      return;\r\n    }\r\n\r\n    const baseTime = Math.max(stagePlaybackSecRef.current, getHowlCurrentTime(stageAudio));\r\n\r\n    if (stagePlayPendingRef.current || isMusicPlayingRef.current || stageAudio.playing()) {\r\n      return;\r\n    }\r\n\r\n    Howler.autoSuspend = false;\r\n    void Howler.ctx?.resume();\r\n\r\n    stagePlayPendingRef.current = true;\r\n\r\n    instrumentPlaybackOrder.forEach((instrument) => {\r\n      const audio = stageStemAudiosRef.current[instrument];\r\n      if (!audio) {\r\n        return;\r\n      }\r\n\r\n      clearStageStemFadeTimeout(instrument);\r\n\r\n      const targetVolume = isMusicEnabled ? (instrumentVolumes[instrument] ?? 1) : 0;\r\n      const startFromZero = !audio.playing();\r\n\r\n      if (startFromZero) {\r\n        audio.seek(baseTime);\r\n        audio.volume(0);\r\n        audio.play();\r\n      }\r\n\r\n      const currentVolume = Number(audio.volume()) || 0;\r\n      if (currentVolume === targetVolume) {\r\n        return;\r\n      }\r\n\r\n      audio.fade(currentVolume, targetVolume, STAGE_STEM_FADE_IN_MS);\r\n    });\r\n  };\r\n\r\n  if (!activeBand) {\r\n    return (\r\n      <section className=\"game-screen\">\r\n        <div className=\"empty-card\">\r\n          <p>Nenhuma banda selecionada.</p>\r\n          <button type=\"button\" className=\"primary-btn\" onClick={onBackToMenu} data-click-sfx=\"close\">\r\n            Voltar ao menu\r\n          </button>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  const fameTarget = selectedStage?.Hype ?? 5000;\r\n  const lotacaoTarget = selectedStage?.Lotacao ?? 100;\r\n  const fameValue = fameProgressValue;\r\n  const lotacaoValue = showCrowd;\r\n  const fansTapGain = Math.max(0, bandFansValue);\r\n  const hypeTapGain = Math.max(0, bandHypeValue);\r\n  const famePct = Math.min(100, (fameValue / fameTarget) * 100);\r\n  const lotacaoPct = Math.min(100, (lotacaoValue / lotacaoTarget) * 100);\r\n  const bandCostValue = Math.max(0, bandCacheValue);\r\n  const stageTicketPrice = selectedStage?.Ingresso ?? 5;\r\n  const lotacaoTotalValue = lotacaoTarget * stageTicketPrice;\r\n  const gainValue = Math.max(0, lotacaoTotalValue - bandCostValue);\r\n  const fansRewardOnSoldOut = Math.round(lotacaoTarget * fansGainRate);\r\n  const currentSongName = selectedMusic?.nome ?? 'Música Principal';\r\n  const currentSongBpm = Math.max(1, selectedMusic?.bpm ?? DEFAULT_MUSIC_BPM);\r\n  const metronomeBeatMs = 60000 / currentSongBpm;\r\n  const metronomeHitWindowMs = metronomeBeatMs * 0.28;\r\n  const elapsedInCurrentStepMs = musicStreakMs % FANS_GAIN_STEP_MS;\r\n  const stepProgress = elapsedInCurrentStepMs / FANS_GAIN_STEP_MS;\r\n  const nextVisualRate = Math.min(FANS_GAIN_MAX_RATE, fansGainRate + FANS_GAIN_STEP_RATE * stepProgress);\r\n  const fansGainDisplayRate = isMusicPlaying ? nextVisualRate : fansGainRate;\r\n  const fansGainBarPct = (fansGainDisplayRate / FANS_GAIN_MAX_RATE) * 100;\r\n  const songProgressPct = songDurationSec > 0 ? Math.min(100, (songCurrentSec / songDurationSec) * 100) : 0;\r\n  const totalFlow = Math.max(1, gainValue + bandCostValue);\r\n  const costSharePct = (bandCostValue / totalFlow) * 100;\r\n  const gainSharePct = 100 - costSharePct;\r\n\r\n\r\n  useEffect(() => {\r\n    metronomeStartAtRef.current = Date.now();\r\n  }, [metronomeBeatMs]);\r\n\r\n  const getCenter = (element: HTMLElement | null) => {\r\n    if (!element || !stageRef.current) {\r\n      return null;\r\n    }\r\n\r\n    const stageBounds = stageRef.current.getBoundingClientRect();\r\n    const bounds = element.getBoundingClientRect();\r\n    return {\r\n      x: bounds.left - stageBounds.left + bounds.width / 2,\r\n      y: bounds.top - stageBounds.top + bounds.height / 2,\r\n    };\r\n  };\r\n\r\n  const triggerFameStarRewardAnimation = (starsGained: number) => {\r\n    if (starsGained <= 0) {\r\n      return;\r\n    }\r\n\r\n    const fameStart = getCenter(fameTrackRef.current);\r\n    const fameEnd = getCenter(topFameRef.current);\r\n\r\n    if (!fameStart || !fameEnd) {\r\n      return;\r\n    }\r\n\r\n    for (let index = 0; index < starsGained; index += 1) {\r\n      const id = rewardAnimationIdRef.current + 1;\r\n      rewardAnimationIdRef.current = id;\r\n      const delay = index * 180;\r\n\r\n      const fameParticle: RewardParticle = {\r\n        id,\r\n        kind: 'fame',\r\n        x: fameStart.x,\r\n        y: fameStart.y,\r\n        dx: fameEnd.x - fameStart.x,\r\n        dy: fameEnd.y - fameStart.y,\r\n        delay,\r\n        duration: 920,\r\n      };\r\n\r\n      setRewardParticles((currentParticles) => [...currentParticles, fameParticle]);\r\n      window.setTimeout(() => {\r\n        setRewardParticles((currentParticles) =>\r\n          currentParticles.filter((particle) => particle.id !== id)\r\n        );\r\n      }, delay + 1200);\r\n\r\n      window.setTimeout(() => {\r\n        setFamePulseTick((current) => current + 1);\r\n      }, delay + 900);\r\n    }\r\n  };\r\n\r\n  const applyFameGain = (gain: number) => {\r\n    if (gain <= 0 || fameTarget <= 0) {\r\n      return;\r\n    }\r\n\r\n    const total = fameProgressRef.current + gain;\r\n    const earnedStars = Math.floor(total / fameTarget);\r\n    const nextProgress = total % fameTarget;\r\n\r\n    fameProgressRef.current = nextProgress;\r\n    setFameProgressValue(nextProgress);\r\n\r\n    if (earnedStars > 0) {\r\n      addFameStars(earnedStars);\r\n      triggerFameStarRewardAnimation(earnedStars);\r\n      playFameStarSound();\r\n    }\r\n  };\r\n\r\n  const triggerSoldOutRewardAnimation = () => {\r\n\r\n    const fansStart = getCenter(crowdTrackRef.current);\r\n    const fansEnd = getCenter(topFansRef.current);\r\n    const moneyStart = getCenter(gainMeterRef.current);\r\n    const moneyEnd = getCenter(topMoneyRef.current);\r\n\r\n    if (fansStart && fansEnd) {\r\n      const newFansParticles: RewardParticle[] = Array.from({ length: 10 }, (_, index) => {\r\n        const id = rewardAnimationIdRef.current + 1;\r\n        rewardAnimationIdRef.current = id;\r\n        return {\r\n          id,\r\n          kind: 'fans',\r\n          x: fansStart.x + (Math.random() * 12 - 6),\r\n          y: fansStart.y + (Math.random() * 12 - 6),\r\n          dx: fansEnd.x - fansStart.x + (Math.random() * 26 - 13),\r\n          dy: fansEnd.y - fansStart.y + (Math.random() * 18 - 9),\r\n          delay: index * 34,\r\n          duration: 820,\r\n        };\r\n      });\r\n      const idsToClear = newFansParticles.map((particle) => particle.id);\r\n      setRewardParticles((currentParticles) => [...currentParticles, ...newFansParticles]);\r\n      window.setTimeout(() => {\r\n        setRewardParticles((currentParticles) =>\r\n          currentParticles.filter((particle) => !idsToClear.includes(particle.id))\r\n        );\r\n      }, 1480);\r\n\r\n      const fansTextId = rewardAnimationIdRef.current + 1;\r\n      rewardAnimationIdRef.current = fansTextId;\r\n      setRewardTexts((currentTexts) => [\r\n        ...currentTexts,\r\n        { id: fansTextId, kind: 'fans', value: fansRewardOnSoldOut, x: fansEnd.x, y: fansEnd.y },\r\n      ]);\r\n      window.setTimeout(() => {\r\n        setRewardTexts((currentTexts) => currentTexts.filter((entry) => entry.id !== fansTextId));\r\n      }, 3200);\r\n    }\r\n\r\n    if (moneyStart && moneyEnd) {\r\n      const newMoneyParticles: RewardParticle[] = Array.from({ length: 8 }, (_, index) => {\r\n        const id = rewardAnimationIdRef.current + 1;\r\n        rewardAnimationIdRef.current = id;\r\n        return {\r\n          id,\r\n          kind: 'money',\r\n          x: moneyStart.x + (Math.random() * 12 - 6),\r\n          y: moneyStart.y + (Math.random() * 12 - 6),\r\n          dx: moneyEnd.x - moneyStart.x + (Math.random() * 22 - 11),\r\n          dy: moneyEnd.y - moneyStart.y + (Math.random() * 16 - 8),\r\n          delay: index * 30,\r\n          duration: 860,\r\n        };\r\n      });\r\n      const idsToClear = newMoneyParticles.map((particle) => particle.id);\r\n      setRewardParticles((currentParticles) => [...currentParticles, ...newMoneyParticles]);\r\n      window.setTimeout(() => {\r\n        setRewardParticles((currentParticles) =>\r\n          currentParticles.filter((particle) => !idsToClear.includes(particle.id))\r\n        );\r\n      }, 1520);\r\n\r\n      const moneyTextId = rewardAnimationIdRef.current + 1;\r\n      rewardAnimationIdRef.current = moneyTextId;\r\n      setRewardTexts((currentTexts) => [\r\n        ...currentTexts,\r\n        { id: moneyTextId, kind: 'money', value: gainValue, x: moneyEnd.x, y: moneyEnd.y },\r\n      ]);\r\n      window.setTimeout(() => {\r\n        setRewardTexts((currentTexts) => currentTexts.filter((entry) => entry.id !== moneyTextId));\r\n      }, 3400);\r\n    }\r\n  };\r\n\r\n  const handleExitStageShow = () => {\r\n    if (mapReturnTransitionPhase !== 'idle') {\r\n      return;\r\n    }\r\n\r\n    pauseStageAudios();\r\n    stopAmbienceWithFade(stageAmbienceHowlRef.current, stageAmbienceFadeTimeoutRef);\r\n    stagePlayPendingRef.current = false;\r\n    lastPulseAtRef.current = 0;\r\n    rhythmStreakRef.current = 0;\r\n    rhythmBonusRef.current = 1;\r\n    metronomeBeatIndexRef.current = -1;\r\n\r\n    setIsMusicPlaying(false);\r\n    setMetronomeTick(false);\r\n    setBeatHitFeedback(false);\r\n    setRhythmBonus(1);\r\n    setRhythmMeter(0);\r\n    setBonusFlash(false);\r\n\r\n    setMapReturnTransitionPhase('to-black');\r\n    if (mapReturnTransitionTimeoutRef.current) {\r\n      window.clearTimeout(mapReturnTransitionTimeoutRef.current);\r\n    }\r\n\r\n    mapReturnTransitionTimeoutRef.current = window.setTimeout(() => {\r\n      setIsLoopTransitioning(false);\r\n      setIsStageShowActive(false);\r\n      setIsSideMenuHiding(false);\r\n      setMapReturnTransitionPhase('from-black');\r\n\r\n      mapReturnTransitionTimeoutRef.current = window.setTimeout(() => {\r\n        setMapReturnTransitionPhase('idle');\r\n        mapReturnTransitionTimeoutRef.current = null;\r\n      }, MAP_RETURN_FADE_IN_MS);\r\n    }, MAP_RETURN_FADE_OUT_MS);\r\n  };\r\n\r\n  const triggerLoopTransition = () => {\r\n    setIsLoopTransitioning(true);\r\n    if (loopTransitionTimeoutRef.current) {\r\n      window.clearTimeout(loopTransitionTimeoutRef.current);\r\n    }\r\n    loopTransitionTimeoutRef.current = window.setTimeout(() => {\r\n      setIsLoopTransitioning(false);\r\n    }, 360);\r\n  };\r\n\r\n  const handleStageVideoEnded = () => {\r\n    const stageVideo = stageVideoRef.current;\r\n    if (!stageVideo) {\r\n      return;\r\n    }\r\n\r\n    triggerLoopTransition();\r\n    stageVideo.currentTime = 0;\r\n    void stageVideo.play().catch(() => undefined);\r\n  };\r\n\r\n  const handleRhythmPulse = () => {\r\n    const stageAudio = garageAudioRef.current;\r\n    const audioRunning = isAudioActuallyPlaying(stageAudio);\r\n\r\n    if (audioRunning) {\r\n      if (fansTapGain > 0) {\r\n        setShowCrowd((current) => Math.min(lotacaoTarget, current + fansTapGain));\r\n      }\r\n      if (hypeTapGain > 0) {\r\n        applyShowRewards(0, hypeTapGain, 0);\r\n        applyFameGain(hypeTapGain);\r\n      }\r\n    }\r\n\r\n    if (!audioRunning) {\r\n      setBeatHitFeedback(false);\r\n      rhythmStreakRef.current = 0;\r\n      if (rhythmBonusRef.current !== 1) {\r\n        rhythmBonusRef.current = 1;\r\n        setRhythmBonus(1);\r\n      }\r\n      setRhythmMeter((current) => Math.min(100, current + PRE_MUSIC_TAP_GAIN));\r\n      return;\r\n    }\r\n\r\n    const now = Date.now();\r\n    const delta = lastPulseAtRef.current ? now - lastPulseAtRef.current : 0;\r\n    lastPulseAtRef.current = now;\r\n\r\n    const elapsed = stageAudio ? getHowlCurrentTime(stageAudio) * 1000 : now - metronomeStartAtRef.current;\r\n    const beatRemainder = elapsed % metronomeBeatMs;\r\n    const beatDistance = Math.min(beatRemainder, metronomeBeatMs - beatRemainder);\r\n    const onBeat = beatDistance <= metronomeHitWindowMs;\r\n\r\n    if (onBeat) {\r\n      setBeatHitFeedback(true);\r\n      if (beatHitTimeoutRef.current) {\r\n        window.clearTimeout(beatHitTimeoutRef.current);\r\n      }\r\n      beatHitTimeoutRef.current = window.setTimeout(() => {\r\n        setBeatHitFeedback(false);\r\n      }, 220);\r\n    }\r\n\r\n    if (delta > 0) {\r\n      if (onBeat) {\r\n        rhythmStreakRef.current += 1;\r\n      } else if (beatDistance <= metronomeHitWindowMs * 2) {\r\n        rhythmStreakRef.current = Math.max(0, rhythmStreakRef.current - 1);\r\n      } else {\r\n        rhythmStreakRef.current = 0;\r\n      }\r\n    }\r\n\r\n    const nextBonus =\r\n      rhythmStreakRef.current >= 10 ? 1.9 : rhythmStreakRef.current >= 7 ? 1.6 : rhythmStreakRef.current >= 4 ? 1.3 : 1;\r\n\r\n    if (nextBonus !== rhythmBonusRef.current) {\r\n      rhythmBonusRef.current = nextBonus;\r\n      setRhythmBonus(nextBonus);\r\n      if (nextBonus > 1) {\r\n        setBonusFlash(true);\r\n        if (bonusFlashTimeoutRef.current) {\r\n          window.clearTimeout(bonusFlashTimeoutRef.current);\r\n        }\r\n        bonusFlashTimeoutRef.current = window.setTimeout(() => {\r\n          setBonusFlash(false);\r\n        }, 240);\r\n      }\r\n    }\r\n\r\n    const gainBase = onBeat ? 8 : beatDistance <= metronomeHitWindowMs * 2 ? 5 : 3;\r\n    const gain = Math.ceil(gainBase * rhythmBonusRef.current);\r\n    setRhythmMeter((current) => Math.min(100, current + gain));\r\n  };\r\n\r\n  useEffect(() => {\r\n    fameProgressRef.current = 0;\r\n    setFameProgressValue(0);\r\n  }, [currentStageId, activeBandId]);\r\n\r\n  useEffect(() => {\r\n    if (!isStageShowActive) {\r\n      if (sideMenuHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(sideMenuHideTimeoutRef.current);\r\n        sideMenuHideTimeoutRef.current = null;\r\n      }\r\n      setIsSideMenuHiding(false);\r\n      setShouldRenderSideMenu(true);\r\n    }\r\n  }, [isStageShowActive]);\r\n\r\n  useEffect(() => {\r\n    if (prevIntroVisibleRef.current && !isMapIntroVisible) {\r\n      setMapUiRevealId((value) => value + 1);\r\n    }\r\n\r\n    prevIntroVisibleRef.current = isMapIntroVisible;\r\n  }, [isMapIntroVisible]);\r\n\r\n  useEffect(() => {\r\n    const isReturningFromMusicians = prevActiveScreenRef.current === 'musicians';\r\n\r\n    if (!isStageShowActive && activeScreen === 'band' && prevActiveScreenRef.current !== 'band' && !isReturningFromMusicians) {\r\n      setMapIntroPlayId((value) => value + 1);\r\n    }\r\n\r\n    prevActiveScreenRef.current = activeScreen;\r\n  }, [activeScreen, isStageShowActive]);\r\n\r\n  useEffect(() => {\r\n    if (!activeBandId) {\r\n      return;\r\n    }\r\n\r\n    if (!hasInitialMapIntroPlayedRef.current) {\r\n      setMapIntroPlayId((value) => value + 1);\r\n      hasInitialMapIntroPlayedRef.current = true;\r\n    }\r\n  }, [activeBandId]);\r\n\r\n  useEffect(() => {\r\n    if (!activeBandId) {\r\n      prevActiveBandIdRef.current = null;\r\n      hasInitialMapIntroPlayedRef.current = false;\r\n      return;\r\n    }\r\n\r\n    const isFirstBand = prevActiveBandIdRef.current === null;\r\n    const hasBandChanged = prevActiveBandIdRef.current !== null && prevActiveBandIdRef.current !== activeBandId;\r\n    const shouldPlayIntro = !isStageShowActive && (hasBandChanged || (isFirstBand && !hasInitialMapIntroPlayedRef.current));\r\n\r\n    if (shouldPlayIntro) {\r\n      setMapIntroPlayId((value) => value + 1);\r\n      hasInitialMapIntroPlayedRef.current = true;\r\n    }\r\n\r\n    prevActiveBandIdRef.current = activeBandId;\r\n    if (isFirstBand && activeBandId) {\r\n      hasInitialMapIntroPlayedRef.current = true;\r\n    }\r\n  }, [activeBandId, isStageShowActive]);\r\n\r\n  useEffect(() => {\r\n    mapAmbienceHowlRef.current = new Howl({\r\n      src: [ambienceMapAudio],\r\n      preload: true,\r\n      html5: false,\r\n      loop: true,\r\n      volume: 0,\r\n    });\r\n\r\n    stageAmbienceHowlRef.current = new Howl({\r\n      src: [ambienceStageCrowdAudio],\r\n      preload: true,\r\n      html5: false,\r\n      loop: true,\r\n      volume: 0,\r\n    });\r\n\r\n    return () => {\r\n      clearAmbienceFadeTimeout(mapAmbienceFadeTimeoutRef);\r\n      clearAmbienceFadeTimeout(stageAmbienceFadeTimeoutRef);\r\n\r\n      if (sideMenuHideTimeoutRef.current !== null) {\r\n        window.clearTimeout(sideMenuHideTimeoutRef.current);\r\n        sideMenuHideTimeoutRef.current = null;\r\n      }\r\n\r\n      mapAmbienceHowlRef.current?.stop();\r\n      mapAmbienceHowlRef.current?.unload();\r\n      mapAmbienceHowlRef.current = null;\r\n\r\n      stageAmbienceHowlRef.current?.stop();\r\n      stageAmbienceHowlRef.current?.unload();\r\n      stageAmbienceHowlRef.current = null;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const isMapMenuModalOpen = isMusiciansScreenVisible || isBandManagementScreenVisible || isBandConfigVisible;\r\n    const shouldPlayMapAmbience =\r\n      isSfxEnabled && !isStageShowActive && mapReturnTransitionPhase !== 'to-black' && !isMapMenuModalOpen;\r\n    const shouldPlayStageAmbience = isMusicEnabled && isSfxEnabled && isStageShowActive;\r\n\r\n    if (isStageShowActive) {\r\n      stopAmbienceWithFade(mapAmbienceHowlRef.current, mapAmbienceFadeTimeoutRef);\r\n      if (shouldPlayStageAmbience) {\r\n        playAmbienceWithFade(stageAmbienceHowlRef.current, STAGE_AMBIENCE_VOLUME, stageAmbienceFadeTimeoutRef);\r\n      } else {\r\n        stopAmbienceWithFade(stageAmbienceHowlRef.current, stageAmbienceFadeTimeoutRef);\r\n      }\r\n      return;\r\n    }\r\n\r\n    stopAmbienceWithFade(stageAmbienceHowlRef.current, stageAmbienceFadeTimeoutRef);\r\n    if (shouldPlayMapAmbience) {\r\n      playAmbienceWithFade(mapAmbienceHowlRef.current, MAP_AMBIENCE_VOLUME, mapAmbienceFadeTimeoutRef);\r\n    } else {\r\n      stopAmbienceWithFade(mapAmbienceHowlRef.current, mapAmbienceFadeTimeoutRef);\r\n    }\r\n  }, [\r\n    isStageShowActive,\r\n    isMusicEnabled,\r\n    isSfxEnabled,\r\n    isMusiciansScreenVisible,\r\n    isBandManagementScreenVisible,\r\n    isBandConfigVisible,\r\n    mapReturnTransitionPhase,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    pauseStageAudios();\r\n    getStageAudios().forEach((audio) => {\r\n      audio.seek(0);\r\n    });\r\n\r\n    stagePlayPendingRef.current = false;\r\n    stagePlaybackSecRef.current = 0;\r\n    soldOutHandledRef.current = false;\r\n    crowdDecayStepRef.current = 0;\r\n\r\n    rhythmStreakRef.current = 0;\r\n    rhythmBonusRef.current = 1;\r\n    lastPulseAtRef.current = 0;\r\n\r\n    setSongCurrentSec(0);\r\n    setRhythmMeter(0);\r\n    setRhythmBonus(1);\r\n    setIsMusicPlaying(false);\r\n    setMetronomeTick(false);\r\n    metronomeBeatIndexRef.current = -1;\r\n  }, [currentStageId]);\r\n\r\n  useEffect(() => {\r\n    moneyRewardHowlRef.current = new Howl({\r\n      src: [sfxMoneyReward],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    applauseHowlRef.current = new Howl({\r\n      src: [sfxCrowdApplause],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    purchaseHowlRef.current = new Howl({\r\n      src: [sfxPurchased],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    starRewardHowlRef.current = new Howl({\r\n      src: [sfxStarReward],\r\n      preload: true,\r\n      html5: false,\r\n      volume: 1,\r\n    });\r\n\r\n    return () => {\r\n      moneyRewardHowlRef.current?.stop();\r\n      moneyRewardHowlRef.current?.unload();\r\n      moneyRewardHowlRef.current = null;\r\n\r\n      applauseHowlRef.current?.stop();\r\n      applauseHowlRef.current?.unload();\r\n      applauseHowlRef.current = null;\r\n\r\n      purchaseHowlRef.current?.stop();\r\n      purchaseHowlRef.current?.unload();\r\n      purchaseHowlRef.current = null;\r\n\r\n      starRewardHowlRef.current?.stop();\r\n      starRewardHowlRef.current?.unload();\r\n      starRewardHowlRef.current = null;\r\n    };\r\n  }, []);\r\n\r\n  const playSoldOutRewardSounds = () => {\r\n    if (!isSfxEnabled) {\r\n      return;\r\n    }\r\n\r\n    const moneySfx = moneyRewardHowlRef.current;\r\n    const applauseSfx = applauseHowlRef.current;\r\n\r\n    if (moneySfx) {\r\n      moneySfx.stop();\r\n      moneySfx.play();\r\n    }\r\n\r\n    if (applauseSfx) {\r\n      applauseSfx.stop();\r\n      applauseSfx.play();\r\n    }\r\n  };\r\n\r\n  const playPurchaseSound = () => {\r\n    if (!isSfxEnabled) {\r\n      return;\r\n    }\r\n\r\n    const purchaseSfx = purchaseHowlRef.current;\r\n    if (!purchaseSfx) {\r\n      return;\r\n    }\r\n\r\n    purchaseSfx.stop();\r\n    purchaseSfx.play();\r\n  };\r\n\r\n  const playFameStarSound = () => {\r\n    if (!isSfxEnabled) {\r\n      return;\r\n    }\r\n\r\n    const starRewardSfx = starRewardHowlRef.current;\r\n    if (!starRewardSfx) {\r\n      return;\r\n    }\r\n\r\n    starRewardSfx.stop();\r\n    starRewardSfx.play();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!isMusicPlayingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (showCrowd < lotacaoTarget) {\r\n      soldOutHandledRef.current = false;\r\n      return;\r\n    }\r\n\r\n    if (soldOutHandledRef.current) {\r\n      return;\r\n    }\r\n\r\n    soldOutHandledRef.current = true;\r\n  playSoldOutRewardSounds();\r\n    triggerSoldOutRewardAnimation();\r\n    applyShowRewards(fansRewardOnSoldOut, SHOW_FAME_REWARD, gainValue);\r\n    applyFameGain(SHOW_FAME_REWARD);\r\n    setSessionNetGain((current) => current + gainValue);\r\n    setShowCrowd(0);\r\n  }, [showCrowd, lotacaoTarget, fansRewardOnSoldOut, applyShowRewards, gainValue, applyFameGain]);\r\n\r\n  useEffect(() => {\r\n    if (!isMusicPlaying) {\r\n      setMusicStreakMs(0);\r\n      setFansGainRate(0);\r\n      fansStepIndexRef.current = 0;\r\n      if (fansStepFlashTimeoutRef.current) {\r\n        window.clearTimeout(fansStepFlashTimeoutRef.current);\r\n      }\r\n      setFansStepFlash(false);\r\n      return;\r\n    }\r\n\r\n    setFansGainRate(FANS_GAIN_BASE_RATE);\r\n    fansStepIndexRef.current = 0;\r\n    const intervalId = window.setInterval(() => {\r\n      setMusicStreakMs((current) => {\r\n        const next = current + 200;\r\n        const rawStepCount = Math.floor(next / FANS_GAIN_STEP_MS);\r\n        const maxStepCount = Math.floor((FANS_GAIN_MAX_RATE - FANS_GAIN_BASE_RATE) / FANS_GAIN_STEP_RATE);\r\n        const stepCount = Math.min(maxStepCount, rawStepCount);\r\n        const nextRate = Math.min(FANS_GAIN_MAX_RATE, FANS_GAIN_BASE_RATE + stepCount * FANS_GAIN_STEP_RATE);\r\n\r\n        if (stepCount > fansStepIndexRef.current) {\r\n          fansStepIndexRef.current = stepCount;\r\n          setFansStepFlash(true);\r\n          if (fansStepFlashTimeoutRef.current) {\r\n            window.clearTimeout(fansStepFlashTimeoutRef.current);\r\n          }\r\n          fansStepFlashTimeoutRef.current = window.setTimeout(() => {\r\n            setFansStepFlash(false);\r\n          }, 850);\r\n        }\r\n\r\n        setFansGainRate(nextRate);\r\n        return next;\r\n      });\r\n    }, 200);\r\n\r\n    return () => {\r\n      window.clearInterval(intervalId);\r\n    };\r\n  }, [isMusicPlaying]);\r\n\r\n  useLayoutEffect(() => {\r\n    const stageElement = stageRef.current;\r\n    const centerPanelElement = centerPanelRef.current;\r\n    const currentSongElement = currentSongBarRef.current;\r\n    const fansTrackElement = fansGainTrackRef.current;\r\n\r\n    if (!stageElement || !centerPanelElement || (!currentSongElement && !fansTrackElement)) {\r\n      return;\r\n    }\r\n\r\n    const updateSideMetersPosition = () => {\r\n      const nextCenterPanelElement = centerPanelRef.current;\r\n      const nextFansTrackElement = fansGainTrackRef.current;\r\n      const nextCurrentSongElement = currentSongBarRef.current;\r\n      const anchorElement = nextFansTrackElement ?? nextCurrentSongElement;\r\n\r\n      if (!anchorElement || !nextCenterPanelElement) {\r\n        return;\r\n      }\r\n\r\n      const centerPanelBounds = nextCenterPanelElement.getBoundingClientRect();\r\n      const anchorBounds = anchorElement.getBoundingClientRect();\r\n\r\n      const desiredBottom = Math.round(centerPanelBounds.bottom - anchorBounds.top + 10);\r\n      const clampedBottom = Math.max(-180, Math.min(120, desiredBottom));\r\n      stageElement.style.setProperty('--stage-side-meter-bottom', `${clampedBottom}px`);\r\n    };\r\n\r\n    updateSideMetersPosition();\r\n\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      updateSideMetersPosition();\r\n    });\r\n\r\n    resizeObserver.observe(stageElement);\r\n    resizeObserver.observe(centerPanelElement);\r\n    if (currentSongElement) {\r\n      resizeObserver.observe(currentSongElement);\r\n    }\r\n    if (fansTrackElement) {\r\n      resizeObserver.observe(fansTrackElement);\r\n    }\r\n    window.addEventListener('resize', updateSideMetersPosition);\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n      window.removeEventListener('resize', updateSideMetersPosition);\r\n      stageElement.style.removeProperty('--stage-side-meter-bottom');\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (fansStepFlashTimeoutRef.current) {\r\n        window.clearTimeout(fansStepFlashTimeoutRef.current);\r\n      }\r\n      if (loopTransitionTimeoutRef.current) {\r\n        window.clearTimeout(loopTransitionTimeoutRef.current);\r\n      }\r\n      if (mapReturnTransitionTimeoutRef.current) {\r\n        window.clearTimeout(mapReturnTransitionTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const spawnTapEffect = (clientX: number, clientY: number) => {\r\n    const bounds = stageRef.current?.getBoundingClientRect();\r\n    if (!bounds) {\r\n      return;\r\n    }\r\n\r\n    const id = tapEffectIdRef.current + 1;\r\n    tapEffectIdRef.current = id;\r\n\r\n    setTapEffects((current) => [\r\n      ...current.slice(-(MAX_TAP_EFFECTS - 1)),\r\n      {\r\n        id,\r\n        x: clientX - bounds.left,\r\n        y: clientY - bounds.top,\r\n      },\r\n    ]);\r\n\r\n    window.setTimeout(() => {\r\n      setTapEffects((current) => current.filter((effect) => effect.id !== id));\r\n    }, TAP_EFFECT_LIFETIME_MS);\r\n  };\r\n\r\n  const handlePointerPulse = (event: React.PointerEvent<HTMLElement>) => {\r\n    if (activeScreen !== 'band' || isBandManagementScreenVisible || isBandConfigVisible || !isStageShowActive) {\r\n      return;\r\n    }\r\n\r\n    event.preventDefault();\r\n    handleRhythmPulse();\r\n    spawnTapEffect(event.clientX, event.clientY);\r\n  };\r\n\r\n  useEffect(() => {\r\n    setSongDurationSec(0);\r\n    setSongCurrentSec(0);\r\n    const stemEntries = activeBandInstruments\r\n      .map((instrument) => ({ instrument, src: selectedMusicStems[instrument] }))\r\n      .filter((entry): entry is { instrument: Instrument; src: string } => Boolean(entry.src));\r\n\r\n    const stageStemAudios: Partial<Record<Instrument, Howl>> = {};\r\n    stemEntries.forEach(({ instrument, src }) => {\r\n      stageStemAudios[instrument] = new Howl({\r\n        src: [src],\r\n        preload: true,\r\n        html5: false,\r\n        pool: 1,\r\n        volume: isMusicEnabled ? (instrumentVolumes[instrument] ?? 1) : 0,\r\n      });\r\n    });\r\n\r\n    stageStemAudiosRef.current = stageStemAudios;\r\n\r\n    const stageAudio = instrumentPlaybackOrder\r\n      .map((instrument) => stageStemAudios[instrument])\r\n      .find((audio): audio is Howl => Boolean(audio)) ?? null;\r\n\r\n    garageAudioRef.current = stageAudio;\r\n\r\n    if (stageAudio) {\r\n      stagePlaybackSecRef.current = Math.max(0, Math.min(stagePlaybackSecRef.current, stageAudio.duration() || stagePlaybackSecRef.current));\r\n    }\r\n\r\n    const handleLoadedMetadata = () => {\r\n      if (stageAudio) {\r\n        const duration = stageAudio.duration();\r\n        if (Number.isFinite(duration) && duration > 0) {\r\n          setSongDurationSec(duration);\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleAudioSeek = () => {\r\n      if (stageAudio) {\r\n        const currentTime = getHowlCurrentTime(stageAudio);\r\n        stagePlaybackSecRef.current = currentTime;\r\n        setSongCurrentSec(currentTime);\r\n        if (stageAudio.playing() && currentTime > 0 && !isMusicPlayingRef.current) {\r\n          setIsMusicPlaying(true);\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleAudioPlay = () => {\r\n      stagePlayPendingRef.current = false;\r\n      metronomeStartAtRef.current = Date.now();\r\n      metronomeBeatIndexRef.current = -1;\r\n      setIsMusicPlaying(true);\r\n    };\r\n\r\n    const handleAudioPause = () => {\r\n      stagePlayPendingRef.current = false;\r\n      setIsMusicPlaying(false);\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n    };\r\n\r\n    const handleAudioEnded = () => {\r\n      setSongCurrentSec(stageAudio ? stageAudio.duration() : 0);\r\n      stagePlaybackSecRef.current = 0;\r\n      handleAudioPause();\r\n    };\r\n\r\n    const handlePlayError = () => {\r\n      stagePlayPendingRef.current = false;\r\n      setIsMusicPlaying(false);\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n      if (!stageAudio) {\r\n        return;\r\n      }\r\n\r\n      stageAudio.once('unlock', () => {\r\n        attemptStageAudioPlay();\r\n      });\r\n      window.setTimeout(() => {\r\n        attemptStageAudioPlay();\r\n      }, 140);\r\n    };\r\n\r\n    stageAudio?.on('load', handleLoadedMetadata);\r\n    stageAudio?.on('play', handleAudioPlay);\r\n    stageAudio?.on('pause', handleAudioPause);\r\n    stageAudio?.on('end', handleAudioEnded);\r\n    stageAudio?.on('seek', handleAudioSeek);\r\n    stageAudio?.on('playerror', handlePlayError);\r\n\r\n    if (stageAudio?.state() === 'loaded') {\r\n      handleLoadedMetadata();\r\n    }\r\n\r\n    const decay = window.setInterval(() => {\r\n      if (stageAudio) {\r\n        const currentTime = getHowlCurrentTime(stageAudio);\r\n        stagePlaybackSecRef.current = currentTime;\r\n        setSongCurrentSec(currentTime);\r\n        if (stageAudio.playing() && currentTime > 0 && !isMusicPlayingRef.current) {\r\n          setIsMusicPlaying(true);\r\n        }\r\n      }\r\n\r\n      setRhythmMeter((current) => Math.max(0, current - (isMusicPlayingRef.current ? POST_MUSIC_DECAY : PRE_MUSIC_DECAY)));\r\n      if (!isMusicPlayingRef.current) {\r\n        crowdDecayStepRef.current += 1;\r\n        if (crowdDecayStepRef.current >= CROWD_DECAY_EVERY_STEPS) {\r\n          crowdDecayStepRef.current = 0;\r\n          setShowCrowd((current) => Math.max(0, current - crowdDecayAmountRef.current));\r\n        }\r\n      } else {\r\n        crowdDecayStepRef.current = 0;\r\n      }\r\n\r\n      const now = Date.now();\r\n      if (lastPulseAtRef.current && now - lastPulseAtRef.current > 900 && rhythmBonusRef.current > 1) {\r\n        rhythmStreakRef.current = 0;\r\n        rhythmBonusRef.current = 1;\r\n        setRhythmBonus(1);\r\n      }\r\n    }, 100);\r\n\r\n    return () => {\r\n      window.clearInterval(decay);\r\n      if (bonusFlashTimeoutRef.current) {\r\n        window.clearTimeout(bonusFlashTimeoutRef.current);\r\n      }\r\n      if (metronomeFlashTimeoutRef.current) {\r\n        window.clearTimeout(metronomeFlashTimeoutRef.current);\r\n      }\r\n      if (beatHitTimeoutRef.current) {\r\n        window.clearTimeout(beatHitTimeoutRef.current);\r\n      }\r\n      stagePlayPendingRef.current = false;\r\n      stageAudio?.off('load', handleLoadedMetadata);\r\n      stageAudio?.off('play', handleAudioPlay);\r\n      stageAudio?.off('pause', handleAudioPause);\r\n      stageAudio?.off('end', handleAudioEnded);\r\n      stageAudio?.off('seek', handleAudioSeek);\r\n      stageAudio?.off('playerror', handlePlayError);\r\n      instrumentPlaybackOrder.forEach((instrument) => {\r\n        clearStageStemFadeTimeout(instrument);\r\n      });\r\n      pauseStageAudios();\r\n      getStageAudios().forEach((audio) => {\r\n        audio.stop();\r\n        audio.unload();\r\n      });\r\n      stageStemAudiosRef.current = {};\r\n      garageAudioRef.current = null;\r\n    };\r\n  }, [selectedMusicStems, activeBandInstrumentsKey]);\r\n\r\n  useEffect(() => {\r\n    instrumentPlaybackOrder.forEach((instrument) => {\r\n      const audio = stageStemAudiosRef.current[instrument];\r\n      if (!audio) {\r\n        return;\r\n      }\r\n\r\n      audio.volume(isMusicEnabled ? (instrumentVolumes[instrument] ?? 1) : 0);\r\n    });\r\n  }, [isMusicEnabled, instrumentVolumes]);\r\n\r\n  useEffect(() => {\r\n    if (!isMusicPlaying) {\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n      if (metronomeAnimationFrameRef.current) {\r\n        window.cancelAnimationFrame(metronomeAnimationFrameRef.current);\r\n        metronomeAnimationFrameRef.current = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const syncMetronomeWithAudio = () => {\r\n      const stageAudio = garageAudioRef.current;\r\n      if (!isAudioActuallyPlaying(stageAudio)) {\r\n        setMetronomeTick(false);\r\n        setIsMusicPlaying(false);\r\n        metronomeBeatIndexRef.current = -1;\r\n        return;\r\n      }\r\n      const elapsedMs = stageAudio ? Math.max(0, getHowlCurrentTime(stageAudio) * 1000) : 0;\r\n      const beatIndex = Math.floor(elapsedMs / metronomeBeatMs);\r\n\r\n      if (beatIndex !== metronomeBeatIndexRef.current) {\r\n        metronomeBeatIndexRef.current = beatIndex;\r\n        setMetronomeTick(true);\r\n        if (metronomeFlashTimeoutRef.current) {\r\n          window.clearTimeout(metronomeFlashTimeoutRef.current);\r\n        }\r\n        metronomeFlashTimeoutRef.current = window.setTimeout(() => {\r\n          setMetronomeTick(false);\r\n        }, 120);\r\n      }\r\n\r\n      metronomeAnimationFrameRef.current = window.requestAnimationFrame(syncMetronomeWithAudio);\r\n    };\r\n\r\n    metronomeAnimationFrameRef.current = window.requestAnimationFrame(syncMetronomeWithAudio);\r\n\r\n    return () => {\r\n      if (metronomeAnimationFrameRef.current) {\r\n        window.cancelAnimationFrame(metronomeAnimationFrameRef.current);\r\n        metronomeAnimationFrameRef.current = null;\r\n      }\r\n    };\r\n  }, [isMusicPlaying, metronomeBeatMs]);\r\n\r\n  useEffect(() => {\r\n    isMusicPlayingRef.current = isMusicPlaying;\r\n  }, [isMusicPlaying]);\r\n\r\n  useEffect(() => {\r\n    rhythmMeterRef.current = rhythmMeter;\r\n  }, [rhythmMeter]);\r\n\r\n  useEffect(() => {\r\n    hasActiveMusiciansRef.current = hasActiveMusicians;\r\n  }, [hasActiveMusicians]);\r\n\r\n  useEffect(() => {\r\n    crowdDecayAmountRef.current = Math.max(0, Math.floor(bandFansValue));\r\n  }, [bandFansValue]);\r\n\r\n  useEffect(() => {\r\n    const stageAudio = garageAudioRef.current;\r\n    if (!stageAudio) {\r\n      return;\r\n    }\r\n\r\n    if (!hasActiveMusicians) {\r\n      pauseStageAudios();\r\n      setIsMusicPlaying(false);\r\n      setMetronomeTick(false);\r\n      metronomeBeatIndexRef.current = -1;\r\n      return;\r\n    }\r\n\r\n    if (rhythmMeter > RHYTHM_PLAY_THRESHOLD) {\r\n      attemptStageAudioPlay();\r\n      return;\r\n    }\r\n\r\n    pauseStageAudios();\r\n    setIsMusicPlaying(false);\r\n    setMetronomeTick(false);\r\n    metronomeBeatIndexRef.current = -1;\r\n  }, [rhythmMeter, hasActiveMusicians]);\r\n\r\n  useEffect(() => {\r\n    const tryResumeStageMusic = () => {\r\n      const stageAudio = garageAudioRef.current;\r\n      if (!stageAudio || !hasActiveMusicians) {\r\n        return;\r\n      }\r\n\r\n      if (typeof document !== 'undefined' && document.visibilityState === 'hidden') {\r\n        return;\r\n      }\r\n\r\n      attemptStageAudioPlay();\r\n    };\r\n\r\n    const handleVisibilityChange = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        tryResumeStageMusic();\r\n      }\r\n    };\r\n\r\n    const handlePageShow = () => {\r\n      tryResumeStageMusic();\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    window.addEventListener('pageshow', handlePageShow);\r\n\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      window.removeEventListener('pageshow', handlePageShow);\r\n    };\r\n  }, [rhythmMeter, hasActiveMusicians]);\r\n\r\n  useEffect(() => {\r\n    const unlockAudio = () => {\r\n      Howler.autoSuspend = false;\r\n      void Howler.ctx?.resume();\r\n      attemptStageAudioPlay();\r\n    };\r\n\r\n    window.addEventListener('pointerdown', unlockAudio, { passive: true });\r\n    window.addEventListener('keydown', unlockAudio);\r\n\r\n    return () => {\r\n      window.removeEventListener('pointerdown', unlockAudio);\r\n      window.removeEventListener('keydown', unlockAudio);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <section\r\n      className=\"game-screen stage-screen\"\r\n      ref={stageRef}\r\n      style={{ backgroundImage: `url(${stageBackground})` }}\r\n      onPointerDownCapture={handlePointerPulse}\r\n    >\r\n      <div className={`stage-loop-fade${isLoopTransitioning ? ' show' : ''}`} aria-hidden=\"true\" />\r\n      <div className=\"stage-overlay\" />\r\n      {isStageShowActive ? (\r\n        <>\r\n          <Stage3DScene\r\n            key={`stage3d-${currentStageId}`}\r\n            textureUrl={defaultStageFloorTexture}\r\n            backgroundImageUrl={stage3DBackground}\r\n            backgroundVideoUrl={stageAnimatedBackground}\r\n            isMusicPlaying={isMusicPlaying}\r\n            activeMusicians={stage3DActiveMusicians}\r\n            activeMusiciansSignature={stage3DActiveMusiciansSignature}\r\n            isCameraMotionEnabled={isCameraMotionEnabled}\r\n          />\r\n          <StageVisualEffectsLayer\r\n            tapEffects={tapEffects}\r\n            rewardParticles={rewardParticles}\r\n            rewardTexts={rewardTexts}\r\n            iconFansWhite={iconFansWhite}\r\n            iconMoneyWhite={iconMoneyWhite}\r\n            iconFameWhite={iconFameWhite}\r\n            formatNumber={formatNumber}\r\n          />\r\n        </>\r\n      ) : null}\r\n\r\n      <button type=\"button\" className=\"back-link\" onClick={onBackToMenu} data-click-sfx=\"close\">\r\n        Bandas\r\n      </button>\r\n\r\n      <MusiciansContractScreen\r\n        isVisible={isMusiciansScreenVisible}\r\n        isClosing={isClosingMusiciansScreen}\r\n        backgroundAudicao={backgroundAudicao}\r\n        portraitContratante={portraitContratante}\r\n        iconFechar={iconFechar}\r\n        iconBloqueado={iconBloqueado}\r\n        iconDisponivel={iconDisponivel}\r\n        selectedInstrumentIcon={selectedMusicianInstrumentIcon}\r\n        iconMoneyWhite={iconMoneyWhite}\r\n        iconFameWhite={iconFameWhite}\r\n        iconFansWhite={iconFansWhite}\r\n        iconRhythmWhite={iconRhythmWhite}\r\n        iconCost={iconCost}\r\n        selectedMusicianDetails={selectedMusicianDetails}\r\n        selectedMusicianFace={selectedMusicianFace}\r\n        selectedMusicianPortrait={selectedMusicianPortrait}\r\n        selectedMusicianInitials={selectedMusicianInitials}\r\n        selectedMusicianRarityClass={selectedMusicianRarityClass}\r\n        isClosingMusicianDetails={isClosingMusicianDetails}\r\n        isMusicianStoryOpen={isMusicianStoryOpen}\r\n        isSelectedMusicianHired={isSelectedMusicianHired}\r\n        isSelectedMusicianLockedByCoins={isSelectedMusicianLockedByCoins}\r\n        canHireSelectedMusician={canHireSelectedMusician}\r\n        selectedMusicianPrice={selectedMusicianPrice}\r\n        hireFilter={hireFilter}\r\n        filterOptions={filterOptions}\r\n        listedMusicianItems={listedMusicianItems}\r\n        formatNumber={formatNumber}\r\n        formatPerformancePercent={formatPerformancePercent}\r\n        instrumentNameById={instrumentNameById}\r\n        onCloseScreen={closeMusiciansScreen}\r\n        onCloseDetails={closeMusicianDetails}\r\n        onToggleStory={toggleMusicianStory}\r\n        onChangeFilter={setHireFilter}\r\n        onOpenMusicianDetails={openMusicianDetails}\r\n        onHireSelected={() => {\r\n          if (!selectedInstrument || !canHireSelectedMusician || !selectedMusicianDetails || availableBandCoins < selectedMusicianPrice) {\r\n            return;\r\n          }\r\n\r\n          hireMusician(selectedInstrument, selectedMusicianPrice, selectedMusicianDetails.ID);\r\n          playPurchaseSound();\r\n        }}\r\n      />\r\n\r\n      <BandManagementScreen\r\n        isVisible={isBandManagementScreenVisible}\r\n        isClosing={isClosingBandManagement}\r\n        backgroundBackstage={bandManagementBackgroundImage}\r\n        iconFechar={iconFechar}\r\n        iconBloqueado={iconBloqueado}\r\n        iconDisponivel={iconDisponivel}\r\n        iconMoneyWhite={iconMoneyWhite}\r\n        iconFameWhite={iconFameWhite}\r\n        iconFansWhite={iconFansWhite}\r\n        iconRhythmWhite={iconRhythmWhite}\r\n        iconCost={iconCost}\r\n        bandHypeValue={bandHypeValue}\r\n        bandFansValue={bandFansValue}\r\n        bandPerformanceValue={bandPerformanceValue}\r\n        bandCostValue={bandCostValue}\r\n        venueContext={bandManagementVenueContext}\r\n        iconGainWhite={iconCache}\r\n        iconCostWhite={iconCost}\r\n        formatNumber={formatNumber}\r\n        formatPerformancePercent={formatPerformancePercent}\r\n        formatCurrency={formatCurrency}\r\n        bandMenuView={bandMenuView}\r\n        bandMenuOptions={bandMenuOptions}\r\n        onChangeBandMenuView={setBandMenuView}\r\n        activeBandSelectorInstrument={activeBandSelectorInstrument}\r\n        bandInstrumentColumns={bandInstrumentColumns}\r\n        selectorMusicians={selectorMusicians}\r\n        selectedSelectorMusicianId={selectedSelectorMusicianId}\r\n        instrumentLabels={instrumentLabels}\r\n        iconMusicoVazio={iconMusicoVazio}\r\n        onOpenInstrument={setActiveBandSelectorInstrument}\r\n        onCloseSelector={() => setActiveBandSelectorInstrument(null)}\r\n        onSelectEmpty={(instrument) => {\r\n          setBandMusicianSelection(instrument, null);\r\n          setActiveBandSelectorInstrument(null);\r\n        }}\r\n        onSelectMusician={(instrument, musicianId) => {\r\n          setBandMusicianSelection(instrument, musicianId);\r\n          setActiveBandSelectorInstrument(null);\r\n        }}\r\n        onCloseScreen={closeBandManagementScreen}\r\n      />\r\n\r\n      <StageTopValuesBar\r\n        key={`top-${mapUiRevealId}`}\r\n        configIcon={iconConfigBlack}\r\n        isConfigOpen={isBandConfigOpen}\r\n        availableBandCoins={availableBandCoins}\r\n        fans={activeBand.fans}\r\n        fameStars={Math.max(0, Math.floor(activeBand.fameStars ?? 0))}\r\n        iconMoneyBlack={iconMoneyBlack}\r\n        iconFansBlack={iconFansBlack}\r\n        iconFameBlack={iconFameBlack}\r\n        onOpenBandConfig={openBandConfig}\r\n        formatCurrency={formatCurrency}\r\n        formatNumber={formatNumber}\r\n        famePulseTick={famePulseTick}\r\n        topMoneyRef={topMoneyRef}\r\n        topFansRef={topFansRef}\r\n        topFameRef={topFameRef}\r\n        className=\"map-ui-reveal\"\r\n      />\r\n\r\n      <BandConfigModal\r\n        isVisible={isBandConfigVisible}\r\n        isClosing={isClosingBandConfig}\r\n        bandName={activeBand.name}\r\n        bandLogoUrl={activeBand.logoUrl}\r\n        isSfxEnabled={isSfxEnabled}\r\n        isMusicEnabled={isMusicEnabled}\r\n        isCameraMotionEnabled={isCameraMotionEnabled}\r\n        iconConfig={iconConfigWhite}\r\n        iconFechar={iconFechar}\r\n        iconAudioOn={iconAudioOn}\r\n        iconCamera={iconCamera}\r\n        iconExitBand={iconExitBand}\r\n        instrumentVolumeControls={instrumentVolumeControls}\r\n        onClose={closeBandConfig}\r\n        onToggleSfx={setSfxEnabled}\r\n        onToggleMusic={setMusicEnabled}\r\n        onToggleCameraMotion={setCameraMotionEnabled}\r\n        onChangeInstrumentVolume={setInstrumentVolume}\r\n        onExitBand={() => {\r\n          closeBandConfig();\r\n          onBackToMenu();\r\n        }}\r\n      />\r\n\r\n      {isStageShowActive ? (\r\n        <div className=\"stage-progress-stack\">\r\n          <StageProgressList\r\n            iconFameWhite={iconFameWhite}\r\n            iconFansWhite={iconFansWhite}\r\n            famePct={famePct}\r\n            fameValue={fameValue}\r\n            fameTarget={fameTarget}\r\n            lotacaoPct={lotacaoPct}\r\n            lotacaoValue={lotacaoValue}\r\n            lotacaoTarget={lotacaoTarget}\r\n            formatNumber={formatNumber}\r\n            fameTrackRef={fameTrackRef}\r\n            crowdTrackRef={crowdTrackRef}\r\n          />\r\n\r\n          <StageCurrentSongBar\r\n            iconFansWhite={iconFansWhite}\r\n            iconMusicWhite={iconMusicWhite}\r\n            fansGainBarPct={fansGainBarPct}\r\n            fansGainRate={fansGainRate}\r\n            fansStepFlash={fansStepFlash}\r\n            songProgressPct={songProgressPct}\r\n            currentSongName={currentSongName}\r\n            wrapperRef={currentSongBarRef}\r\n            fansTrackRef={fansGainTrackRef}\r\n          />\r\n        </div>\r\n      ) : null}\r\n\r\n      {isStageShowActive ? (\r\n        <StageCenterPanel\r\n          iconFameWhite={iconFameWhite}\r\n          iconFansWhite={iconFansWhite}\r\n          iconRhythmWhite={iconRhythmWhite}\r\n          iconCost={iconCost}\r\n          iconIngresso={iconIngresso}\r\n          iconValorCacheTotal={iconValorCacheTotal}\r\n          iconCache={iconCache}\r\n          bandHypeValue={bandHypeValue}\r\n          bandFansValue={bandFansValue}\r\n          bandPerformanceValue={bandPerformanceValue}\r\n          selectedStageName={selectedStage?.Palco ?? 'Garagem de Casa'}\r\n          onExitShow={handleExitStageShow}\r\n          venueBadgeIcon={selectedStageBadge}\r\n          stageTicketPrice={stageTicketPrice}\r\n          lotacaoTotalValue={lotacaoTotalValue}\r\n          costSharePct={costSharePct}\r\n          gainSharePct={gainSharePct}\r\n          gainValue={gainValue}\r\n          metronomeTick={metronomeTick}\r\n          beatHitFeedback={beatHitFeedback}\r\n          isMusicPlaying={isMusicPlaying}\r\n          metronomeBeatMs={metronomeBeatMs}\r\n          rhythmBonus={rhythmBonus}\r\n          bonusFlash={bonusFlash}\r\n          rhythmMeter={rhythmMeter}\r\n          musicStartThreshold={RHYTHM_PLAY_THRESHOLD}\r\n          rhythmTone={getRhythmTone(rhythmMeter)}\r\n          bandCostValue={bandCostValue}\r\n          formatNumber={formatNumber}\r\n          formatPerformancePercent={formatPerformancePercent}\r\n          formatCurrency={formatCurrency}\r\n          gainMeterRef={gainMeterRef}\r\n          wrapperRef={centerPanelRef}\r\n        />\r\n      ) : null}\r\n\r\n      <StageMapModal\r\n        isVisible={!isStageShowActive}\r\n        mapImageUrl={stageWorldMap}\r\n        iconFansWhite={iconFansWhite}\r\n        iconIngressoWhite={iconIngressoBranco}\r\n        iconGainWhite={iconCache}\r\n        iconCostWhite={iconCost}\r\n        iconValorCacheTotal={iconCache}\r\n        bandSlots={stageBandSlots}\r\n        bandTotalCache={bandCostValue}\r\n        emptyMusicianIcon={iconMusicoVazio}\r\n        onOpenBandManagement={openBandManagementWithContext}\r\n        isBandQuickAccessVisible={shouldRenderSideMenu && activeScreen !== 'musicians' && !isBandManagementScreenVisible}\r\n        isBandQuickAccessHiding={isSideMenuHiding}\r\n        introImageUrl={stageWorldPreview}\r\n        bandName={activeBand.name}\r\n        bandLogoUrl={activeBand.logoUrl}\r\n        introPlayId={mapIntroPlayId}\r\n        onIntroVisibilityChange={setIsMapIntroVisible}\r\n        onPreviewStageBannerChange={setMapPreviewBannerUrl}\r\n        stages={stageMapEntries}\r\n        currentStageId={currentStageId}\r\n        isEmbedded\r\n        onClose={() => undefined}\r\n        onSelectStage={(stageId) => {\r\n          setCurrentStage(stageId);\r\n          setIsStageShowActive(true);\r\n        }}\r\n      />\r\n      {shouldRenderSideMenu && (!isStageShowActive || isSideMenuHiding) && activeScreen !== 'musicians' && !isBandManagementScreenVisible && (\r\n        <StageBottomNav\r\n          key={`nav-${mapUiRevealId}`}\r\n          variant=\"side\"\r\n          isHiding={isSideMenuHiding}\r\n          isBandManagementScreenVisible={isBandManagementScreenVisible}\r\n          className=\"map-ui-reveal\"\r\n          availableToHireCount={availableToHireCount}\r\n          navBand={navBand}\r\n          navHire={navHire}\r\n          navStore={navStore}\r\n          navStage={navStage}\r\n          navSongs={navSongs}\r\n          onOpenBandManagementScreen={() => openBandManagementWithContext(null)}\r\n          onOpenMusiciansScreen={openMusiciansScreen}\r\n          onCycleStage={() => undefined}\r\n        />\r\n      )}\r\n\r\n      <div\r\n        className={`stage-map-return-overlay${mapReturnTransitionPhase !== 'idle' ? ' active' : ''}${mapReturnTransitionPhase === 'to-black' ? ' to-black' : ''}${mapReturnTransitionPhase === 'from-black' ? ' from-black' : ''}`}\r\n        aria-hidden=\"true\"\r\n      />\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default BandGame;\r\n"],"names":["BandConfigModal","isVisible","isClosing","bandName","bandLogoUrl","isSfxEnabled","isMusicEnabled","isCameraMotionEnabled","iconConfig","iconFechar","iconAudioOn","iconCamera","iconExitBand","instrumentVolumeControls","onClose","onToggleSfx","onToggleMusic","onToggleCameraMotion","onChangeInstrumentVolume","onExitBand","jsxs","Fragment","jsx","event","control","sliderValue","BandInstrumentSelector","bandInstrumentColumns","activeInstrument","isDetailOpen","selectorMusicians","selectedMusicianId","instrumentLabels","iconMusicoVazio","onOpenInstrument","onCloseSelector","onSelectEmpty","onOpenMusicianDetail","isSelectorClosing","setIsSelectorClosing","useState","selectorCloseTimeoutRef","useRef","useEffect","runSelectorCloseAnimation","onClosed","instrumentRoleByKey","activeInstrumentIcon","column","activeInstrumentRole","handleOpenInstrument","instrument","musicianId","detailMusician","item","musician","MusicianDetailModal","selectedMusicianFace","selectedMusicianPortrait","selectedMusicianInitials","selectedMusicianRarityClass","selectedInstrumentIcon","isStoryOpen","isSelectedMusicianHired","isSelectedMusicianLockedByCoins","canHireSelectedMusician","selectedMusicianPrice","iconBloqueado","iconDisponivel","iconMoneyWhite","iconFameWhite","iconFansWhite","iconRhythmWhite","iconCost","formatNumber","formatPerformancePercent","instrumentNameById","showStoryToggle","hideCloseButton","customAction","onCloseDetails","onToggleStory","onHireSelected","displayMode","displayMusician","setDisplayMusician","React","isContentLeaving","setIsContentLeaving","isContentEntering","setIsContentEntering","switchTimer","settleTimer","currentMusician","rarityLabel","displayPortrait","transitionClass","StageVenueCacheCard","maxRevenue","bandTotalCache","iconGainWhite","iconCostWhite","className","showCenterGainBadge","hideSideValues","revenueValue","cacheValue","gainValue","cacheRatio","gainRatio","isCacheOverLimit","formatCurrency","value","BandManagementScreen","backgroundBackstage","bandHypeValue","bandFansValue","bandPerformanceValue","bandCostValue","venueContext","bandMenuView","bandMenuOptions","onChangeBandMenuView","activeBandSelectorInstrument","selectedSelectorMusicianId","onSelectMusician","onCloseScreen","selectedSelectorDetail","setSelectedSelectorDetail","isDetailClosing","setIsDetailClosing","detailCloseTimeoutRef","isSelectorDetailOpen","instrumentIdByKey","activeBandColumn","currentMusicianId","openSelectorDetail","closeSelectorDetail","closeSelectorAndDetail","action","option","MusiciansContractScreen","backgroundAudicao","portraitContratante","selectedMusicianDetails","isClosingMusicianDetails","isMusicianStoryOpen","hireFilter","filterOptions","listedMusicianItems","onChangeFilter","onOpenMusicianDetails","collapsedGroups","setCollapsedGroups","prevHireMapRef","recentlyHiredId","setRecentlyHiredId","detectedHiredId","nextMap","id","current","rarityRank","hiredMusicianItems","a","b","rarityDiff","availableMusicianItems","toggleGroup","group","prev","renderMusicianCard","StageTopValuesBar","configIcon","availableBandCoins","fans","fameStars","iconMoneyBlack","iconFansBlack","iconFameBlack","onOpenBandConfig","famePulseTick","topMoneyRef","topFansRef","topFameRef","isConfigOpen","StageBottomNav","variant","isHiding","isBandManagementScreenVisible","availableToHireCount","navBand","navHire","navStore","navStage","navSongs","onOpenBandManagementScreen","onOpenMusiciansScreen","onCycleStage","resolvedClassName","StageProgressList","famePct","fameValue","fameTarget","lotacaoPct","lotacaoValue","lotacaoTarget","fameTrackRef","crowdTrackRef","StageCenterPanel","iconIngresso","iconValorCacheTotal","iconCache","selectedStageName","onExitShow","venueBadgeIcon","stageTicketPrice","lotacaoTotalValue","costSharePct","gainSharePct","metronomeTick","beatHitFeedback","isMusicPlaying","metronomeBeatMs","rhythmBonus","bonusFlash","rhythmMeter","musicStartThreshold","rhythmTone","gainMeterRef","wrapperRef","popoverCloseTimeoutRef","shouldRenderVenuePopover","setShouldRenderVenuePopover","isVenuePopoverClosing","setIsVenuePopoverClosing","isVenuePopoverOpen","handleVenueBadgeToggle","StageCurrentSongBar","iconMusicWhite","fansGainBarPct","fansGainRate","fansStepFlash","songProgressPct","currentSongName","fansTrackRef","StageVisualEffectsLayer","tapEffects","rewardParticles","rewardTexts","getRewardIcon","kind","effect","particle","entry","baseCameraPosition","THREE.Vector3","baseLookAtPosition","stageVerticalOffset","performerPositions","performerSpriteScale","performerShadowScale","generalShot","sweepShotLeft","sweepShotRight","focusShotByInstrument","buildShotQueue","activeInstruments","cycle","availableOrder","rotateBy","rotatedOrder","focusOrder","sweepStart","sweepEnd","queue","index","Stage3DScene","textureUrl","backgroundImageUrl","backgroundVideoUrl","activeMusicians","activeMusiciansSignature","isMobile","containerRef","isMusicPlayingRef","activeMusiciansRef","isCameraMotionEnabledRef","currentFocusedInstrumentRef","shotQueueRef","shotIndexRef","currentShotRef","fromShotPosRef","fromShotLookRef","fromShotFovRef","currentLookRef","currentFovRef","shotEndsAtRef","shotStartedAtRef","shotMoveDurationRef","shotQueueCycleRef","lastShadowFrameSentAtRef","wasMusicPlayingRef","randomMotionRefreshAtRef","randomPosOffsetRef","randomPosOffsetTargetRef","randomLookOffsetRef","randomLookOffsetTargetRef","container","renderer","THREE.WebGLRenderer","THREE.BasicShadowMap","THREE.PCFSoftShadowMap","THREE.SRGBColorSpace","scene","THREE.Scene","camera","THREE.PerspectiveCamera","textureLoader","THREE.TextureLoader","sceneBackgroundTexture","sceneBackgroundVideoElement","backgroundGeometry","THREE.PlaneGeometry","backgroundMaterial","THREE.MeshBasicMaterial","THREE.DoubleSide","backgroundPlane","THREE.Mesh","backgroundBaseY","backgroundParallaxCurrent","THREE.Vector2","backgroundParallaxTarget","backgroundParallaxLimits","getBackgroundAspect","bgMap","source","width","height","updateBackgroundPlaneScale","distance","frustumHeight","THREE.MathUtils","frustumWidth","textureAspect","planeHeight","planeWidth","maxOffsetX","maxOffsetY","bgTexture","video","videoTexture","THREE.VideoTexture","THREE.LinearFilter","activateVideoTexture","ambientLight","THREE.AmbientLight","frontKeyLight","THREE.SpotLight","fillLight","THREE.DirectionalLight","backLight","hemiLight","THREE.HemisphereLight","floorTexture","THREE.RepeatWrapping","floorMaterial","THREE.MeshStandardMaterial","floorGeometry","floor","frontEdgeGeometry","THREE.BoxGeometry","frontEdgeMaterial","frontEdge","shadowCanvas","shadowCtx","gradient","shadowTexture","THREE.CanvasTexture","shadowGeometry","spriteTextureLoader","musicianSprites","basePosition","spriteTexture","spriteMaterial","THREE.SpriteMaterial","sprite","THREE.Sprite","scaleX","scaleY","shadowMaterial","shadow","shadowWidth","shadowHeight","standInGeometry","THREE.CapsuleGeometry","standInMaterial","performerStandIns","position","standIn","composerRenderTarget","THREE.WebGLRenderTarget","THREE.RGBAFormat","composer","EffectComposer","renderPass","RenderPass","bokehPass","BokehPass","resize","clientWidth","clientHeight","resizeObserver","clock","THREE.Clock","animationFrameId","targetFps","lastFrameTime","cameraTarget","lookAtTarget","setFocusedInstrument","rebuildShotQueue","applyNextShot","elapsed","cameraObject","nextIndex","nextShot","animate","now","playing","shot","shotElapsed","moveDuration","moveProgress","easeProgress","isCloseShot","nextWindow","handAmount","targetPos","focusPosition","focusAnchor","closeDistance","shotDirection","sideSway","frontBackSway","idleSwayX","idleSwayY","idleSwayZ","targetLook","sweepZoomBreath","targetFov","focusDistance","closeStrengthRaw","closeStrength","smoothClose","shadowDrift","baseShadowX","baseShadowZ","texture","iconFechar$1","StageBandSlotsGroup","slots","emptyMusicianIcon","onClick","ariaLabel","mergedClassName","content","slot","sofiaPortrait","StageSofiaDialog","message","confirmLabel","cancelLabel","onConfirm","onCancel","closeTimeoutRef","shouldRender","setShouldRender","setIsClosing","dialogNode","createPortal","STAGE_SELECT_TRANSITION_MS","STAGE_MAP_CLOSE_FADE_MS","STAGE_BLACKOUT_START_PROGRESS","STAGE_SELECT_ZOOM_MULTIPLIER","STAGE_SELECT_FINAL_BLACK_HOLD_MS","STAGE_PREVIEW_EXIT_MS","TOUCH_SCROLL_DAMPING","StageMapModal","mapImageUrl","iconIngressoWhite","bandSlots","onOpenBandManagement","isBandQuickAccessVisible","isBandQuickAccessHiding","stages","currentStageId","isEmbedded","introImageUrl","introPlayId","resetViewToken","onIntroVisibilityChange","onPreviewStageBannerChange","onStageTransitionStart","onSelectStage","mapImageRef","mapScrollRef","hasInitializedOpenViewRef","imageSize","setImageSize","mapScale","setMapScale","mapScaleRef","pinchStartDistanceRef","pinchStartScaleRef","touchPanLastPointRef","isStageTransitioning","setIsStageTransitioning","transitionOverlayOpacity","setTransitionOverlayOpacity","previewStage","setPreviewStage","isPreviewClosing","setIsPreviewClosing","sofiaDialog","setSofiaDialog","previewCloseTimeoutRef","transitionFrameRef","transitionTimeoutRef","introHoldTimeoutRef","introHideTimeoutRef","lastIntroPlayIdRef","introPhase","setIntroPhase","getClampedScrollPosition","scrollContainer","left","top","scale","renderedWidth","renderedHeight","maxScrollLeft","maxScrollTop","closePreviewWithAnimation","afterClose","closeSofiaDialog","allocatedMusiciansCount","getStageValidationMessage","stage","minScale","containerWidth","containerHeight","fitHeightScale","fitWidthScale","coverScale","getTouchDistance","touches","first","second","dx","dy","handleTouchStart","touch","handleTouchMove","previousTouch","deltaX","deltaY","targetLeft","targetTop","clampedPosition","startDistance","pinchRatio","nextScale","handleTouchEnd","timeoutId","clearIntroTimers","defaultScale","defaultLeft","defaultTop","targetScale","frameId","handleMapScroll","handleCloseModal","handleSelectStageWithTransition","startScale","startLeft","startTop","targetPointX","targetPointY","requestedLeft","requestedTop","targetPosition","animationStart","easeInOutCubic","progress","easedProgress","blackoutProgress","nextLeft","nextTop","nextOverlayOpacity","markersToRender","handleOpenBandFromMap","handleOpenBandFromPreview","image","marker","isActive","stageToGo","validationMessage","useBandScreensState","musiciansModalCloseMs","musicianDetailsCloseMs","bandModalCloseMs","bandConfigCloseMs","onStoryToggleSound","activeScreen","setActiveScreen","isClosingMusiciansScreen","setIsClosingMusiciansScreen","setSelectedMusicianDetails","setIsMusicianStoryOpen","setIsClosingMusicianDetails","isBandConfigOpen","setIsBandConfigOpen","isClosingBandConfig","setIsClosingBandConfig","isBandManagementOpen","setIsBandManagementOpen","isClosingBandManagement","setIsClosingBandManagement","setActiveBandSelectorInstrument","musiciansCloseTimeoutRef","musicianDetailsCloseTimeoutRef","bandManagementCloseTimeoutRef","bandConfigCloseTimeoutRef","clearTimeoutRef","timeoutRef","openBandConfig","useCallback","closeBandConfig","openBandManagementScreen","closeBandManagementScreen","openMusiciansScreen","openMusicianDetails","closeMusicianDetails","closeMusiciansScreen","toggleMusicianStory","next","defaultStageBackground","defaultStageFloorTexture","iconIngressoBranco","stageWorldMap","stageWorldPreview","iconTodos","iconGuitarra","iconBaixo","iconBateria","iconTeclado","iconBandaMenu","iconEspeciaisMenu","iconAnaliseMenu","iconConfigBlack","iconConfigWhite","iconGuitarraVazia","iconBaixoVazio","iconBateriaVazio","iconTecladoVazio","sfxMoneyReward","sfxCrowdApplause","sfxPurchased","sfxStarReward","ambienceMapAudio","ambienceStageCrowdAudio","RHYTHM_PLAY_THRESHOLD","SHOW_FAME_REWARD","FANS_GAIN_BASE_RATE","FANS_GAIN_MAX_RATE","FANS_GAIN_STEP_RATE","FANS_GAIN_STEP_MS","DEFAULT_MUSIC_BPM","PRE_MUSIC_TAP_GAIN","PRE_MUSIC_DECAY","POST_MUSIC_DECAY","CROWD_DECAY_EVERY_STEPS","TAP_EFFECT_LIFETIME_MS","MUSICIANS_MODAL_CLOSE_MS","MUSICIANS_DETAIL_CLOSE_MS","BAND_MODAL_CLOSE_MS","BAND_CONFIG_CLOSE_MS","MAP_RETURN_FADE_OUT_MS","MAP_RETURN_FADE_IN_MS","AMBIENCE_FADE_IN_MS","AMBIENCE_FADE_OUT_MS","STAGE_STEM_FADE_IN_MS","STAGE_STEM_FADE_OUT_MS","MAP_AMBIENCE_VOLUME","STAGE_AMBIENCE_VOLUME","instrumentById","instrumentIconById","instrumentPlaybackOrder","instrumentConfigOrder","instrumentIconByInstrument","stageMapPositionById","getRhythmTone","getRarity","level","__vite_glob_1_0","__vite_glob_1_1","__vite_glob_1_2","__vite_glob_1_3","__vite_glob_1_4","__vite_glob_1_5","__vite_glob_1_6","__vite_glob_1_7","__vite_glob_1_8","__vite_glob_1_9","__vite_glob_1_10","__vite_glob_1_11","__vite_glob_1_12","__vite_glob_1_13","__vite_glob_1_14","__vite_glob_1_15","__vite_glob_2_0","__vite_glob_2_1","__vite_glob_2_2","__vite_glob_2_3","__vite_glob_2_4","__vite_glob_2_5","__vite_glob_2_6","__vite_glob_3_0","__vite_glob_3_1","__vite_glob_3_2","__vite_glob_3_3","__vite_glob_3_4","__vite_glob_3_5","__vite_glob_3_6","__vite_glob_4_0","__vite_glob_4_1","__vite_glob_4_2","__vite_glob_4_3","__vite_glob_4_4","__vite_glob_4_5","__vite_glob_4_6","__vite_glob_4_7","__vite_glob_4_8","__vite_glob_4_9","__vite_glob_4_10","__vite_glob_4_11","__vite_glob_4_12","__vite_glob_4_13","__vite_glob_4_14","__vite_glob_4_15","__vite_glob_4_16","__vite_glob_4_17","__vite_glob_4_18","__vite_glob_4_19","__vite_glob_4_20","__vite_glob_4_21","__vite_glob_4_22","__vite_glob_4_23","__vite_glob_4_24","__vite_glob_4_25","__vite_glob_4_26","__vite_glob_4_27","__vite_glob_4_28","__vite_glob_4_29","__vite_glob_5_0","__vite_glob_5_1","__vite_glob_5_2","__vite_glob_5_3","__vite_glob_5_4","__vite_glob_5_5","__vite_glob_5_6","__vite_glob_5_7","__vite_glob_5_8","__vite_glob_5_9","__vite_glob_5_10","__vite_glob_5_11","__vite_glob_5_12","__vite_glob_5_13","__vite_glob_5_14","__vite_glob_5_15","__vite_glob_5_16","__vite_glob_5_17","__vite_glob_5_18","__vite_glob_5_19","__vite_glob_5_20","__vite_glob_5_21","__vite_glob_5_22","__vite_glob_5_23","stageImageAssetMap","__vite_glob_0_0","__vite_glob_0_1","__vite_glob_0_2","__vite_glob_0_3","__vite_glob_0_4","__vite_glob_0_5","__vite_glob_0_6","__vite_glob_0_7","__vite_glob_0_8","__vite_glob_0_9","__vite_glob_0_10","__vite_glob_0_11","__vite_glob_0_12","__vite_glob_0_13","__vite_glob_0_14","__vite_glob_0_15","__vite_glob_0_16","stageMapBadgeAssetMap","stageVideoAssetMap","musicStreamAssetMap","musicianFaceAssetMap","musicianPortraitAssetMap","resolveStageAsset","assetPath","viteAssetPath","resolveStageAnimatedAsset","animatedPath","resolveStageMapBadgeAsset","badgePath","resolveMusicStreamAsset","streamPath","resolveMusicianFaceAsset","faceAsset","directFacePath","legacyFaceMatch","parsedFaceNumber","migratedFacePath","resolveMusicianPortraitAsset","portraitAsset","directPortraitPath","useBandGameComputed","bands","activeBandId","instrumentVolumes","availableMusics","useMemo","musicsData","musicians","musicosData","palcosData","selectedMusic","music","activeBand","band","activeBandMusicians","total","bandCacheValue","selectedStage","stageMapEntries","stageBackground","stage3DBackground","selectedStageBadge","stageAnimatedBackground","filteredMusicians","listedMusicians","right","leftInstrument","rightInstrument","leftSlot","rightSlot","leftHired","rightHired","selectedInstrument","unlockedMusicianIdSet","persistedIds","equippedIds","hasEnoughCoinsForSelected","part","selectedMusicianInstrumentIcon","rarity","isMusicianHired","isLockedByCoins","instrumentIcon","initials","selectedMusicStems","activeBandInstruments","guitarMusician","bassMusician","drumsMusician","keysMusician","stageBandPerformers","portraitSrc","stage3DActiveMusicians","performer","stage3DActiveMusiciansSignature","normalized","clamped","getHowlCurrentTime","audio","seekValue","isAudioActuallyPlaying","BandGame","onBackToMenu","useGameStore","state","setCurrentStage","applyShowRewards","addFameStars","hireMusician","setBandMusicianSelection","setMusicEnabled","setSfxEnabled","setCameraMotionEnabled","setInstrumentVolume","setHireFilter","setRhythmMeter","showCrowd","setShowCrowd","sessionNetGain","setSessionNetGain","setIsMusicPlaying","setFansGainRate","musicStreakMs","setMusicStreakMs","setFansStepFlash","setRhythmBonus","setBonusFlash","setMetronomeTick","setBeatHitFeedback","songDurationSec","setSongDurationSec","songCurrentSec","setSongCurrentSec","lastPulseAtRef","metronomeStartAtRef","garageAudioRef","stageStemAudiosRef","stagePlaybackSecRef","stageStemFadeTimeoutsRef","rhythmStreakRef","rhythmBonusRef","bonusFlashTimeoutRef","metronomeFlashTimeoutRef","metronomeAnimationFrameRef","metronomeBeatIndexRef","beatHitTimeoutRef","loopTransitionTimeoutRef","stagePlayPendingRef","rhythmMeterRef","hasActiveMusiciansRef","stageRef","centerPanelRef","currentSongBarRef","fansGainTrackRef","tapEffectIdRef","rewardAnimationIdRef","soldOutHandledRef","fameProgressRef","crowdDecayStepRef","crowdDecayAmountRef","fansStepIndexRef","fansStepFlashTimeoutRef","mapReturnTransitionTimeoutRef","setTapEffects","setRewardParticles","setRewardTexts","isLoopTransitioning","setIsLoopTransitioning","isStageShowActive","setIsStageShowActive","isSideMenuHiding","setIsSideMenuHiding","shouldRenderSideMenu","setShouldRenderSideMenu","mapIntroPlayId","setMapIntroPlayId","mapUiRevealId","setMapUiRevealId","isMapIntroVisible","setIsMapIntroVisible","mapPreviewBannerUrl","setMapPreviewBannerUrl","mapReturnTransitionPhase","setMapReturnTransitionPhase","bandManagementVenueContext","setBandManagementVenueContext","setBandMenuView","fameProgressValue","setFameProgressValue","setFamePulseTick","prevActiveScreenRef","prevActiveBandIdRef","hasInitialMapIntroPlayedRef","prevIntroVisibleRef","sideMenuHideTimeoutRef","moneyRewardHowlRef","applauseHowlRef","purchaseHowlRef","starRewardHowlRef","mapAmbienceHowlRef","stageAmbienceHowlRef","mapAmbienceFadeTimeoutRef","stageAmbienceFadeTimeoutRef","isOpening","playUiClickSound","hasActiveMusicians","isMusiciansScreenVisible","isBandConfigVisible","activeBandInstrumentsKey","bandManagementBackgroundImage","openBandManagementWithContext","stageContext","stageBandSlots","pauseThemeMusic","playThemeMusic","getStageAudios","clearStageStemFadeTimeout","pauseStageAudios","stageAudios","primaryAudio","currentVolume","clearAmbienceFadeTimeout","playAmbienceWithFade","ambienceHowl","targetVolume","fadeTimeoutRef","stopAmbienceWithFade","attemptStageAudioPlay","stageAudio","baseTime","Howler","fansTapGain","hypeTapGain","fansRewardOnSoldOut","metronomeHitWindowMs","stepProgress","nextVisualRate","totalFlow","getCenter","element","stageBounds","bounds","triggerFameStarRewardAnimation","starsGained","fameStart","fameEnd","delay","fameParticle","currentParticles","applyFameGain","gain","earnedStars","nextProgress","playFameStarSound","triggerSoldOutRewardAnimation","fansStart","fansEnd","moneyStart","moneyEnd","newFansParticles","_","idsToClear","fansTextId","currentTexts","newMoneyParticles","moneyTextId","handleExitStageShow","handleRhythmPulse","audioRunning","delta","beatRemainder","beatDistance","onBeat","nextBonus","gainBase","isReturningFromMusicians","isFirstBand","hasBandChanged","Howl","shouldPlayMapAmbience","shouldPlayStageAmbience","playSoldOutRewardSounds","moneySfx","applauseSfx","playPurchaseSound","purchaseSfx","starRewardSfx","intervalId","rawStepCount","maxStepCount","stepCount","nextRate","useLayoutEffect","stageElement","centerPanelElement","currentSongElement","fansTrackElement","updateSideMetersPosition","nextCenterPanelElement","nextFansTrackElement","nextCurrentSongElement","anchorElement","centerPanelBounds","anchorBounds","desiredBottom","clampedBottom","spawnTapEffect","clientX","clientY","handlePointerPulse","stemEntries","stageStemAudios","src","handleLoadedMetadata","duration","handleAudioSeek","currentTime","handleAudioPlay","handleAudioPause","handleAudioEnded","handlePlayError","decay","syncMetronomeWithAudio","elapsedMs","beatIndex","tryResumeStageMusic","handleVisibilityChange","handlePageShow","unlockAudio","stageId"],"mappings":"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"}